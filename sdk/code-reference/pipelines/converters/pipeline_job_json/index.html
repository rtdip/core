<!-- Extends base.html -->

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Easy access to high volume, historical and real time process data  for analytics applications, engineers, and data scientists wherever they are.">
      
      
        <meta name="author" content="Real Time Data Ingestion Platform">
      
      
        <link rel="canonical" href="https://github.com/rtdip/core/sdk/code-reference/pipelines/converters/pipeline_job_json/">
      
      
        <link rel="prev" href="../../utilities/azure/autoloader_resources/">
      
      
        <link rel="next" href="../../secrets/databricks/">
      
      
      <link rel="icon" href="../../../../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.20">
    
    
      
        <title>Json - Real Time Data Ingestion Platform</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


  
  
    
    
      
    
    
  
  
  <style>.md-tag.md-tag--pipelines{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M128 72a24 24 0 1 1 0 48 24 24 0 1 1 0-48zm32 97.3c28.3-12.3 48-40.5 48-73.3 0-44.2-35.8-80-80-80S48 51.8 48 96c0 32.8 19.7 61 48 73.3V224H32c-17.7 0-32 14.3-32 32s14.3 32 32 32h256v54.7c-28.3 12.3-48 40.5-48 73.3 0 44.2 35.8 80 80 80s80-35.8 80-80c0-32.8-19.7-61-48-73.3V288h256c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64v-54.7c28.3-12.3 48-40.5 48-73.3 0-44.2-35.8-80-80-80s-80 35.8-80 80c0 32.8 19.7 61 48 73.3V224H160v-54.7zM488 96a24 24 0 1 1 48 0 24 24 0 1 1-48 0zM320 392a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"/></svg>');}</style>

    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../../assets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Real Time Data Ingestion Platform" class="md-header__button md-logo" aria-label="Real Time Data Ingestion Platform" data-md-component="logo">
      
  <img src="../../../../../assets/logo_lfe.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Real Time Data Ingestion Platform
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Json
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/rtdip/core/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    rtdip/core
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../getting-started/about-rtdip/" class="md-tabs__link">
          
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../overview/" class="md-tabs__link">
          
  
    
  
  SDK

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../api/overview/" class="md-tabs__link">
          
  
    
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../domains/process_control/overview/" class="md-tabs__link">
          
  
    
  
  Domains

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../integration/power-bi/" class="md-tabs__link">
          
  
    
  
  Integration

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../roadmap/roadmap-overview/" class="md-tabs__link">
          
  
    
  
  Roadmaps

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../releases/core/" class="md-tabs__link">
          
  
    
  
  Releases

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../blog/" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../university/overview/" class="md-tabs__link">
          
  
    
  
  University

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Real Time Data Ingestion Platform" class="md-nav__button md-logo" aria-label="Real Time Data Ingestion Platform" data-md-component="logo">
      
  <img src="../../../../../assets/logo_lfe.png" alt="logo">

    </a>
    Real Time Data Ingestion Platform
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rtdip/core/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    rtdip/core
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../getting-started/about-rtdip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About RTDIP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../getting-started/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    SDK
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            SDK
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Authentication
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_1" >
        
          
          <label class="md-nav__link" for="__nav_3_2_1" id="__nav_3_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_1">
            <span class="md-nav__icon md-icon"></span>
            Azure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../authentication/azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../authentication/azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Active Directory
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../authentication/databricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databricks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pipelines
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Pipelines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/framework/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3_2" id="__nav_3_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Components
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3_2">
            <span class="md-nav__icon md-icon"></span>
            Components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_2" id="__nav_3_3_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Sources
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            Sources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_2_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_2_1" id="__nav_3_3_2_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spark
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_3_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            Spark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/eventhub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Eventhub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/kafka_eventhub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Eventhub Kafka
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/delta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/delta_sharing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta Sharing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/autoloader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Autoloader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/iot_hub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IoT Hub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/kafka/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/kinesis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kinesis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_2_1_9" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_2_1_9" id="__nav_3_3_2_2_1_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ISO
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_3_2_2_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_2_1_9">
            <span class="md-nav__icon md-icon"></span>
            ISO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/iso/miso_daily_load_iso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MISO Daily Load
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/iso/miso_historical_load_iso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MISO Historical Load
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/iso/pjm_daily_load_iso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PJM Daily Load
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/iso/pjm_historical_load_iso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PJM Historical Load
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/iso/caiso_daily_load_iso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CAISO Daily Load
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/iso/caiso_historical_load_iso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CAISO Historical Load
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/iso/ercot_daily_load_iso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ERCOT Daily Load
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/iso/pjm_daily_pricing_iso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PJM Daily Pricing Load
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/iso/pjm_historical_pricing_iso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PJM Historical Pricing Load
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_2_1_10" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_2_1_10" id="__nav_3_3_2_2_1_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Weather
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_3_2_2_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_2_1_10">
            <span class="md-nav__icon md-icon"></span>
            Weather
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/the_weather_company/base_weather/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Base Weather
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/the_weather_company/weather_forecast_api_v1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Weather Forecast API V1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/the_weather_company/weather_forecast_api_v1_multi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Weather Forecast V1 Multi
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_2_1_11" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_2_1_11" id="__nav_3_3_2_2_1_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ECMWF
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_3_2_2_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_2_1_11">
            <span class="md-nav__icon md-icon"></span>
            ECMWF
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/ecmwf/base_mars/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Base MARS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/spark/ecmwf/weather_forecast/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Weather Forecast
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_2_2" id="__nav_3_3_2_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_3_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/python/delta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/python/delta_sharing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta Sharing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/python/entsoe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ENTSO-E
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sources/python/mffbas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MFFBAS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_3" id="__nav_3_3_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Transformers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_3">
            <span class="md-nav__icon md-icon"></span>
            Transformers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_3_1" id="__nav_3_3_2_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spark
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_3_2_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_3_1">
            <span class="md-nav__icon md-icon"></span>
            Spark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/binary_to_string/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binary To String
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/opc_publisher_opcua_json_to_pcdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OPC Publisher Json To Process Control Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/opc_publisher_opcae_json_to_pcdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OPC Publisher Json for A&E(Alarm & Events) Data to Process Control Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/fledge_opcua_json_to_pcdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fledge Json To Process Control Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/edgex_opcua_json_to_pcdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EdgeX JSON data To Process Control Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/sem_json_to_pcdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SEM data To Process Control Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/ssip_pi_binary_file_to_pcdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSIP PI Binary File data To Process Control Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/ssip_pi_binary_json_to_pcdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSIP PI Binary JSON data To Process Control Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/pandas_to_pyspark/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pandas to PySpark DataFrame Conversion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/pyspark_to_pandas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PySpark to Pandas DataFrame Conversion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/honeywell_apm_to_pcdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Honeywell APM To Process Control Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/pcdm_to_honeywell_apm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Process Control Data Model To Honeywell APM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/mirico_json_to_pcdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mirico data To Process Control Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_3_1_14" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_3_1_14" id="__nav_3_3_2_3_1_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ISO
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_3_2_3_1_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_3_1_14">
            <span class="md-nav__icon md-icon"></span>
            ISO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/iso/miso_to_mdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MISO To Meters Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/iso/pjm_to_mdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PJM To Meters Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/iso/ercot_to_mdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ERCOT To Meters Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/iso/caiso_to_mdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CAISO To Meters Data Model
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_3_1_15" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_3_1_15" id="__nav_3_3_2_3_1_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    The Weather Company
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_3_2_3_1_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_3_1_15">
            <span class="md-nav__icon md-icon"></span>
            The Weather Company
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/the_weather_company/raw_forecast_to_weather_data_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Raw Forecast To Weather Data Model
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_3_1_16" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_3_1_16" id="__nav_3_3_2_3_1_16_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ECMWF
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_3_2_3_1_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_3_1_16">
            <span class="md-nav__icon md-icon"></span>
            ECMWF
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/ecmwf/nc_extractbase_to_weather_data_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NC Forecast Extract Base To Weather Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/ecmwf/nc_extractpoint_to_weather_data_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NC Forecast Extract Point To Weather Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transformers/spark/ecmwf/nc_extractgrid_to_weather_data_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NC Forecast Extract Grid To Weather Data Model
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_4" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_4" id="__nav_3_3_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Destinations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_4">
            <span class="md-nav__icon md-icon"></span>
            Destinations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_4_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_4_1" id="__nav_3_3_2_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spark
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_3_2_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_4_1">
            <span class="md-nav__icon md-icon"></span>
            Spark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../destinations/spark/delta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../destinations/spark/delta_merge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta Merge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../destinations/spark/eventhub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Eventhub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../destinations/spark/kafka_eventhub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Eventhub Kafka
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../destinations/spark/kafka/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../destinations/spark/kinesis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kinesis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../destinations/spark/rest_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rest API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../destinations/spark/pcdm_to_delta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PCDM To Delta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../destinations/spark/pcdm_latest_to_delta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PCDM Latest To Delta
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_4_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_4_2" id="__nav_3_3_2_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_3_2_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../destinations/python/delta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_4_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_4_3" id="__nav_3_3_2_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blockchain
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_3_2_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_4_3">
            <span class="md-nav__icon md-icon"></span>
            Blockchain
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../destinations/blockchain/evm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EVM
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_5" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_5" id="__nav_3_3_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Utilities
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_5">
            <span class="md-nav__icon md-icon"></span>
            Utilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_5_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_5_1" id="__nav_3_3_2_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spark
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_3_2_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_5_1">
            <span class="md-nav__icon md-icon"></span>
            Spark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/spark/session/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Session
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/spark/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/spark/delta_table_create/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta Table Create
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/spark/delta_table_optimize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta Table Optimize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/spark/delta_table_vacuum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta Table Vacuum
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/spark/adls_gen2_spn_connect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADLS Gen 2 Service Principal Connect
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_5_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_5_2" id="__nav_3_3_2_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AWS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_3_2_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_5_2">
            <span class="md-nav__icon md-icon"></span>
            AWS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/aws/s3_bucket_policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    S3 Bucket Policy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/aws/s3_copy_utility/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    S3 Copy Utility
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_5_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_5_3" id="__nav_3_3_2_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_3_2_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_5_3">
            <span class="md-nav__icon md-icon"></span>
            Azure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/azure/adls_gen2_acl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADLS Gen 2 ACLs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/azure/autoloader_resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Autoloader Resources
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_6" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3_2_6" id="__nav_3_3_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Converters
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3_2_6">
            <span class="md-nav__icon md-icon"></span>
            Converters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Json
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Json
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      EdgeXOPCUAJsonToPCDMTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EdgeXOPCUAJsonToPCDMTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractBaseToWeatherDataModel" class="md-nav__link">
    <span class="md-ellipsis">
      ECMWFExtractBaseToWeatherDataModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ECMWFExtractBaseToWeatherDataModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractBaseToWeatherDataModel.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractBaseToWeatherDataModel.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractGridToWeatherDataModel" class="md-nav__link">
    <span class="md-ellipsis">
      ECMWFExtractGridToWeatherDataModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractPointToWeatherDataModel" class="md-nav__link">
    <span class="md-ellipsis">
      ECMWFExtractPointToWeatherDataModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.RawForecastToWeatherDataModel" class="md-nav__link">
    <span class="md-ellipsis">
      RawForecastToWeatherDataModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RawForecastToWeatherDataModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.RawForecastToWeatherDataModel.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.RawForecastToWeatherDataModel.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PCDMToHoneywellAPMTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      PCDMToHoneywellAPMTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PCDMToHoneywellAPMTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PCDMToHoneywellAPMTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PCDMToHoneywellAPMTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PCDMToHoneywellAPMTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HoneywellAPMJsonToPCDMTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      HoneywellAPMJsonToPCDMTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HoneywellAPMJsonToPCDMTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HoneywellAPMJsonToPCDMTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HoneywellAPMJsonToPCDMTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HoneywellAPMJsonToPCDMTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SEMJsonToPCDMTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      SEMJsonToPCDMTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SEMJsonToPCDMTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SEMJsonToPCDMTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SEMJsonToPCDMTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SEMJsonToPCDMTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToPCDMTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      MiricoJsonToPCDMTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MiricoJsonToPCDMTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToPCDMTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToPCDMTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToPCDMTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToMetadataTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      MiricoJsonToMetadataTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MiricoJsonToMetadataTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToMetadataTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToMetadataTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToMetadataTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PandasToPySparkTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      PandasToPySparkTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PandasToPySparkTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PandasToPySparkTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PandasToPySparkTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PandasToPySparkTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PySparkToPandasTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      PySparkToPandasTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PySparkToPandasTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PySparkToPandasTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PySparkToPandasTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PySparkToPandasTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkDeltaDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkDeltaDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkDeltaMergeDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkDeltaMergeDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkEventhubDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkEventhubDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkKafkaDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkKafkaDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkKinesisDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkKinesisDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkRestAPIDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkRestAPIDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkPCDMToDeltaDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkPCDMToDeltaDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkPCDMLatestToDeltaDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkPCDMLatestToDeltaDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkKafkaEventhubDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkKafkaEventhubDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination" class="md-nav__link">
    <span class="md-ellipsis">
      EVMContractDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EVMContractDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination" class="md-nav__link">
    <span class="md-ellipsis">
      PythonDeltaDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PythonDeltaDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets" class="md-nav__link">
    <span class="md-ellipsis">
      DatabricksSecrets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatabricksSecrets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets.set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets" class="md-nav__link">
    <span class="md-ellipsis">
      HashiCorpVaultSecrets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HashiCorpVaultSecrets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets.set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets" class="md-nav__link">
    <span class="md-ellipsis">
      AzureKeyVaultSecrets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AzureKeyVaultSecrets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets.set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SystemType" class="md-nav__link">
    <span class="md-ellipsis">
      SystemType
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableCreateUtility" class="md-nav__link">
    <span class="md-ellipsis">
      DeltaTableCreateUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeltaTableCreateUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableCreateUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableCreateUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableOptimizeUtility" class="md-nav__link">
    <span class="md-ellipsis">
      DeltaTableOptimizeUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeltaTableOptimizeUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableOptimizeUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableOptimizeUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableVacuumUtility" class="md-nav__link">
    <span class="md-ellipsis">
      DeltaTableVacuumUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeltaTableVacuumUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableVacuumUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableVacuumUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkConfigurationUtility" class="md-nav__link">
    <span class="md-ellipsis">
      SparkConfigurationUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkConfigurationUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkConfigurationUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkConfigurationUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkConfigurationUtility.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkADLSGen2SPNConnectUtility" class="md-nav__link">
    <span class="md-ellipsis">
      SparkADLSGen2SPNConnectUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkADLSGen2SPNConnectUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkADLSGen2SPNConnectUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkADLSGen2SPNConnectUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkADLSGen2SPNConnectUtility.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ADLSGen2DirectoryACLUtility" class="md-nav__link">
    <span class="md-ellipsis">
      ADLSGen2DirectoryACLUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ADLSGen2DirectoryACLUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ADLSGen2DirectoryACLUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ADLSGen2DirectoryACLUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureAutoloaderResourcesUtility" class="md-nav__link">
    <span class="md-ellipsis">
      AzureAutoloaderResourcesUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AzureAutoloaderResourcesUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureAutoloaderResourcesUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureAutoloaderResourcesUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineComponentsGetUtility" class="md-nav__link">
    <span class="md-ellipsis">
      PipelineComponentsGetUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PipelineComponentsGetUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineComponentsGetUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkSessionUtility" class="md-nav__link">
    <span class="md-ellipsis">
      SparkSessionUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkSessionUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkSessionUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkSessionUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkSessionUtility.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobFromJsonConverter" class="md-nav__link">
    <span class="md-ellipsis">
      PipelineJobFromJsonConverter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PipelineJobFromJsonConverter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobFromJsonConverter--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobFromJsonConverter.convert" class="md-nav__link">
    <span class="md-ellipsis">
      convert
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobToJsonConverter" class="md-nav__link">
    <span class="md-ellipsis">
      PipelineJobToJsonConverter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PipelineJobToJsonConverter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobToJsonConverter--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobToJsonConverter.convert" class="md-nav__link">
    <span class="md-ellipsis">
      convert
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_7" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_7" id="__nav_3_3_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Secrets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_7">
            <span class="md-nav__icon md-icon"></span>
            Secrets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../secrets/databricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databricks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../secrets/hashicorp_vault/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hashicorp Vault
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../secrets/azure_key_vault/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Key Vault
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_8" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_8" id="__nav_3_3_2_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deploy
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_8">
            <span class="md-nav__icon md-icon"></span>
            Deploy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/databricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databricks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_9" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_9" id="__nav_3_3_2_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Monitoring
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_9">
            <span class="md-nav__icon md-icon"></span>
            Monitoring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_9_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_9_1" id="__nav_3_3_2_9_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data Quality
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_3_2_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_9_1">
            <span class="md-nav__icon md-icon"></span>
            Data Quality
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_9_1_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_9_1_1" id="__nav_3_3_2_9_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Great Expectations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_3_2_9_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_9_1_1">
            <span class="md-nav__icon md-icon"></span>
            Great Expectations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitoring/spark/data_quality/great_expectations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Quality Monitoring
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/jobs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jobs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_3_4" id="__nav_3_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deploy
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_4">
            <span class="md-nav__icon md-icon"></span>
            Deploy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/deploy/databricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databricks Workflows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/deploy/apache-airflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apache Airflow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_3_5" id="__nav_3_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_5">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/pipelines/deploy/Python-Delta-to-Delta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python Delta to Delta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/pipelines/deploy/EdgeX-Eventhub-to-Delta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EdgeX Eventhub to Delta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/pipelines/deploy/ECMWF-to-Delta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ECMWF to Delta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_5_4" >
        
          
          <label class="md-nav__link" for="__nav_3_3_5_4" id="__nav_3_3_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Dagster
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_5_4">
            <span class="md-nav__icon md-icon"></span>
            Dagster
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/pipelines/deploy/dagster/Fledge-Dagster-Pipeline-Databricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databricks Connect
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/pipelines/deploy/dagster/Fledge-Dagster-Pipeline-Local/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Local
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_5_5" >
        
          
          <label class="md-nav__link" for="__nav_3_3_5_5" id="__nav_3_3_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Databricks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_5_5">
            <span class="md-nav__icon md-icon"></span>
            Databricks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/pipelines/deploy/databricks/MISODailyLoad-Batch-Pipeline-Databricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MISO Daily Load Databricks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/pipelines/deploy/Fledge-SparkConnect-PCDM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spark Connect
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/pipelines/deploy/MISODailyLoad-Batch-Pipeline-Local/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MISO Daily Load Local
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/pipelines/deploy/PJMDailyLoad-Batch-Pipeline-Local/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PJM Daily Load Local
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Queries
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Queries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_1" >
        
          
          <label class="md-nav__link" for="__nav_3_4_1" id="__nav_3_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Query Types
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_1">
            <span class="md-nav__icon md-icon"></span>
            Query Types
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../queries/functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metadata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_1_3" >
        
          
          <label class="md-nav__link" for="__nav_3_4_1_3" id="__nav_3_4_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Time Series
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_1_3">
            <span class="md-nav__icon md-icon"></span>
            Time Series
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/time_series/time_series_query_builder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time Series Query Builder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/time_series/raw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Raw
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/time_series/latest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Latest
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/time_series/resample/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resample
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/time_series/plot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/time_series/interpolate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interpolate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/time_series/interpolation-at-time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interpolation at Time
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/time_series/time-weighted-average/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time Weighted Average
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/time_series/circular-average/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Circular Average
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/time_series/circular-standard-deviation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Circular Standard Deviation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/time_series/summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Summary
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_1_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4_1_4" id="__nav_3_4_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Weather
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_1_4">
            <span class="md-nav__icon md-icon"></span>
            Weather
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/weather/weather_query_builder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Weather Data Query Builder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/weather/raw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Weather Raw
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/functions/weather/latest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Weather Latest
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/sql/sql_query/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3" >
        
          
          <label class="md-nav__link" for="__nav_3_4_3" id="__nav_3_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Connectors
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            Connectors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../queries/connectors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/connectors/db-sql-connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databricks SQL Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/connectors/pyodbc-sql-connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PYODBC SQL Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/connectors/turbodbc-sql-connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TURBODBC SQL Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/connectors/spark-connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spark Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/connectors/chatopenai_databricks_connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chat Open AI Databricks Connector
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4_4" id="__nav_3_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Databricks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_4">
            <span class="md-nav__icon md-icon"></span>
            Databricks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../queries/databricks/databricks-sql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databricks SQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../queries/databricks/sql-warehouses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL Warehouses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../queries/databricks/troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../queries/spark/spark-connect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spark Connect
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_6" >
        
          
          <label class="md-nav__link" for="__nav_3_4_6" id="__nav_3_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    LLMs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_6">
            <span class="md-nav__icon md-icon"></span>
            LLMs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../queries/llm/chatopenai_databricks_connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chat Open AI Databricks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_7" >
        
          
          <label class="md-nav__link" for="__nav_3_4_7" id="__nav_3_4_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_7">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/query/Interpolate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interpolate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/query/Interpolation-at-Time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interpolation at Time
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/query/Metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metadata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/query/Raw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Raw
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/query/Resample/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resample
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/query/Plot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/query/Time-Weighted-Average/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time Weighted Average
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/query/Circular-Average/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Circular Average
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/query/Circular-Standard-Deviation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Circular Standard Deviation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/query/Summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Summary
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../api/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../api/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../api/examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../api/rest_apis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST API Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../api/deployment/azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Domains
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Domains
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Process Control
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Process Control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../domains/process_control/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../domains/process_control/data_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Model
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Smart Meter Data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Smart Meter Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../domains/smart_meter/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../domains/smart_meter/data_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Model
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Weather Data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Weather Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../domains/weather/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../domains/weather/data_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Model
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Integration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Integration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../integration/power-bi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power BI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Roadmaps
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Roadmaps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../roadmap/roadmap-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../roadmap/yearly-roadmaps/2023-development-roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../roadmap/yearly-roadmaps/2022-development-roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Releases
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Releases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../releases/core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    core
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../blog/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_2" >
        
          
          <label class="md-nav__link" for="__nav_9_2" id="__nav_9_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../blog/archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../blog/archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../blog/archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    University
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            University
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../university/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    University
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      EdgeXOPCUAJsonToPCDMTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EdgeXOPCUAJsonToPCDMTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractBaseToWeatherDataModel" class="md-nav__link">
    <span class="md-ellipsis">
      ECMWFExtractBaseToWeatherDataModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ECMWFExtractBaseToWeatherDataModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractBaseToWeatherDataModel.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractBaseToWeatherDataModel.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractGridToWeatherDataModel" class="md-nav__link">
    <span class="md-ellipsis">
      ECMWFExtractGridToWeatherDataModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractPointToWeatherDataModel" class="md-nav__link">
    <span class="md-ellipsis">
      ECMWFExtractPointToWeatherDataModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.RawForecastToWeatherDataModel" class="md-nav__link">
    <span class="md-ellipsis">
      RawForecastToWeatherDataModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RawForecastToWeatherDataModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.RawForecastToWeatherDataModel.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.RawForecastToWeatherDataModel.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PCDMToHoneywellAPMTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      PCDMToHoneywellAPMTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PCDMToHoneywellAPMTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PCDMToHoneywellAPMTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PCDMToHoneywellAPMTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PCDMToHoneywellAPMTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HoneywellAPMJsonToPCDMTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      HoneywellAPMJsonToPCDMTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HoneywellAPMJsonToPCDMTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HoneywellAPMJsonToPCDMTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HoneywellAPMJsonToPCDMTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HoneywellAPMJsonToPCDMTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SEMJsonToPCDMTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      SEMJsonToPCDMTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SEMJsonToPCDMTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SEMJsonToPCDMTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SEMJsonToPCDMTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SEMJsonToPCDMTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToPCDMTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      MiricoJsonToPCDMTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MiricoJsonToPCDMTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToPCDMTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToPCDMTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToPCDMTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToMetadataTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      MiricoJsonToMetadataTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MiricoJsonToMetadataTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToMetadataTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToMetadataTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToMetadataTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PandasToPySparkTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      PandasToPySparkTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PandasToPySparkTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PandasToPySparkTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PandasToPySparkTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PandasToPySparkTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PySparkToPandasTransformer" class="md-nav__link">
    <span class="md-ellipsis">
      PySparkToPandasTransformer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PySparkToPandasTransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PySparkToPandasTransformer--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PySparkToPandasTransformer.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PySparkToPandasTransformer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkDeltaDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkDeltaDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkDeltaMergeDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkDeltaMergeDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkEventhubDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkEventhubDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkKafkaDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkKafkaDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkKinesisDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkKinesisDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkRestAPIDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkRestAPIDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkPCDMToDeltaDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkPCDMToDeltaDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkPCDMLatestToDeltaDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkPCDMLatestToDeltaDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination" class="md-nav__link">
    <span class="md-ellipsis">
      SparkKafkaEventhubDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkKafkaEventhubDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination" class="md-nav__link">
    <span class="md-ellipsis">
      EVMContractDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EVMContractDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination" class="md-nav__link">
    <span class="md-ellipsis">
      PythonDeltaDestination
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PythonDeltaDestination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination.write_batch" class="md-nav__link">
    <span class="md-ellipsis">
      write_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination.write_stream" class="md-nav__link">
    <span class="md-ellipsis">
      write_stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets" class="md-nav__link">
    <span class="md-ellipsis">
      DatabricksSecrets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatabricksSecrets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets.set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets" class="md-nav__link">
    <span class="md-ellipsis">
      HashiCorpVaultSecrets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HashiCorpVaultSecrets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets.set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets" class="md-nav__link">
    <span class="md-ellipsis">
      AzureKeyVaultSecrets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AzureKeyVaultSecrets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets.set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SystemType" class="md-nav__link">
    <span class="md-ellipsis">
      SystemType
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableCreateUtility" class="md-nav__link">
    <span class="md-ellipsis">
      DeltaTableCreateUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeltaTableCreateUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableCreateUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableCreateUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableOptimizeUtility" class="md-nav__link">
    <span class="md-ellipsis">
      DeltaTableOptimizeUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeltaTableOptimizeUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableOptimizeUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableOptimizeUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableVacuumUtility" class="md-nav__link">
    <span class="md-ellipsis">
      DeltaTableVacuumUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeltaTableVacuumUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableVacuumUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableVacuumUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkConfigurationUtility" class="md-nav__link">
    <span class="md-ellipsis">
      SparkConfigurationUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkConfigurationUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkConfigurationUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkConfigurationUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkConfigurationUtility.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkADLSGen2SPNConnectUtility" class="md-nav__link">
    <span class="md-ellipsis">
      SparkADLSGen2SPNConnectUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkADLSGen2SPNConnectUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkADLSGen2SPNConnectUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkADLSGen2SPNConnectUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkADLSGen2SPNConnectUtility.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ADLSGen2DirectoryACLUtility" class="md-nav__link">
    <span class="md-ellipsis">
      ADLSGen2DirectoryACLUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ADLSGen2DirectoryACLUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ADLSGen2DirectoryACLUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ADLSGen2DirectoryACLUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureAutoloaderResourcesUtility" class="md-nav__link">
    <span class="md-ellipsis">
      AzureAutoloaderResourcesUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AzureAutoloaderResourcesUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureAutoloaderResourcesUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureAutoloaderResourcesUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineComponentsGetUtility" class="md-nav__link">
    <span class="md-ellipsis">
      PipelineComponentsGetUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PipelineComponentsGetUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineComponentsGetUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkSessionUtility" class="md-nav__link">
    <span class="md-ellipsis">
      SparkSessionUtility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SparkSessionUtility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkSessionUtility--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkSessionUtility.system_type" class="md-nav__link">
    <span class="md-ellipsis">
      system_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkSessionUtility.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobFromJsonConverter" class="md-nav__link">
    <span class="md-ellipsis">
      PipelineJobFromJsonConverter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PipelineJobFromJsonConverter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobFromJsonConverter--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobFromJsonConverter.convert" class="md-nav__link">
    <span class="md-ellipsis">
      convert
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobToJsonConverter" class="md-nav__link">
    <span class="md-ellipsis">
      PipelineJobToJsonConverter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PipelineJobToJsonConverter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobToJsonConverter--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobToJsonConverter.convert" class="md-nav__link">
    <span class="md-ellipsis">
      convert
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Json</h1>

<div class="doc doc-object doc-module">



<a id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource" class="doc doc-heading">
            <code>DataBricksAutoLoaderSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>The Spark Auto Loader is used to read new data files as they arrive in cloud storage. Further information on Auto Loader is available <a href="https://docs.databricks.com/ingestion/auto-loader/index.html">here</a></p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource--example">Example</h4>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource--__tabbed_1_1" name="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource--__tabbed_1" type="radio" /><input id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource--__tabbed_1_2" name="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource--__tabbed_1" type="radio" /><input id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource--__tabbed_1_3" name="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource--__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource--__tabbed_1_1">ADLS Gen2</label><label for="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource--__tabbed_1_2">AWS S3</label><label for="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource--__tabbed_1_3">GCS</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">DataBricksAutoLoaderSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;abfss://{FILE-SYSTEM}@{ACCOUNT-NAME}.dfs.core.windows.net/</span><span class="si">{PATH}</span><span class="s2">/{FILE-NAME}</span>
<span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;{DESIRED-FILE-FORMAT}&quot;</span>

<span class="n">DataBricksAutoLoaderSource</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span><span class="o">.</span><span class="n">read_stream</span><span class="p">()</span>

<span class="n">OR</span>

<span class="n">DataBricksAutoLoaderSource</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">DataBricksAutoLoaderSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;https://s3.{REGION-CODE}.amazonaws.com/{BUCKET-NAME}/{KEY-NAME}&quot;</span>
<span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;{DESIRED-FILE-FORMAT}&quot;</span>

<span class="n">DataBricksAutoLoaderSource</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span><span class="o">.</span><span class="n">read_stream</span><span class="p">()</span>

<span class="n">OR</span>

<span class="n">DataBricksAutoLoaderSource</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">DataBricksAutoLoaderSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;gs://{BUCKET-NAME}/{FILE-PATH}&quot;</span>
<span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;{DESIRED-FILE-FORMAT}&quot;</span>

<span class="n">DataBricksAutoLoaderSource</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span><span class="o">.</span><span class="n">read_stream</span><span class="p">()</span>

<span class="n">OR</span>

<span class="n">DataBricksAutoLoaderSource</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>
</div>
</div>
</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session required to read data from cloud storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Options that can be specified for configuring the Auto Loader. Further information on the options available are <a href="https://docs.databricks.com/ingestion/auto-loader/options.html">here</a></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The cloud storage path</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>format</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specifies the file format to be read. Supported formats are available <a href="https://docs.databricks.com/ingestion/auto-loader/options.html#file-format-options">here</a></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/autoloader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DataBricksAutoLoaderSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Spark Auto Loader is used to read new data files as they arrive in cloud storage. Further information on Auto Loader is available [here](https://docs.databricks.com/ingestion/auto-loader/index.html)</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    === &quot;ADLS Gen2&quot;</span>

<span class="sd">        ```python</span>
<span class="sd">        from rtdip_sdk.pipelines.sources import DataBricksAutoLoaderSource</span>
<span class="sd">        from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">        # Not required if using Databricks</span>
<span class="sd">        spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">        options = {}</span>
<span class="sd">        path = &quot;abfss://{FILE-SYSTEM}@{ACCOUNT-NAME}.dfs.core.windows.net/{PATH}/{FILE-NAME}</span>
<span class="sd">        format = &quot;{DESIRED-FILE-FORMAT}&quot;</span>

<span class="sd">        DataBricksAutoLoaderSource(spark, options, path, format).read_stream()</span>

<span class="sd">        OR</span>

<span class="sd">        DataBricksAutoLoaderSource(spark, options, path, format).read_batch()</span>
<span class="sd">        ```</span>
<span class="sd">    === &quot;AWS S3&quot;</span>

<span class="sd">        ```python</span>
<span class="sd">        from rtdip_sdk.pipelines.sources import DataBricksAutoLoaderSource</span>
<span class="sd">        from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">        # Not required if using Databricks</span>
<span class="sd">        spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">        options = {}</span>
<span class="sd">        path = &quot;https://s3.{REGION-CODE}.amazonaws.com/{BUCKET-NAME}/{KEY-NAME}&quot;</span>
<span class="sd">        format = &quot;{DESIRED-FILE-FORMAT}&quot;</span>

<span class="sd">        DataBricksAutoLoaderSource(spark, options, path, format).read_stream()</span>

<span class="sd">        OR</span>

<span class="sd">        DataBricksAutoLoaderSource(spark, options, path, format).read_batch()</span>
<span class="sd">        ```</span>
<span class="sd">    === &quot;GCS&quot;</span>

<span class="sd">        ```python</span>
<span class="sd">        from rtdip_sdk.pipelines.sources import DataBricksAutoLoaderSource</span>
<span class="sd">        from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">        # Not required if using Databricks</span>
<span class="sd">        spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">        options = {}</span>
<span class="sd">        path = &quot;gs://{BUCKET-NAME}/{FILE-PATH}&quot;</span>
<span class="sd">        format = &quot;{DESIRED-FILE-FORMAT}&quot;</span>

<span class="sd">        DataBricksAutoLoaderSource(spark, options, path, format).read_stream()</span>

<span class="sd">        OR</span>

<span class="sd">        DataBricksAutoLoaderSource(spark, options, path, format).read_batch()</span>
<span class="sd">        ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session required to read data from cloud storage</span>
<span class="sd">        options (dict): Options that can be specified for configuring the Auto Loader. Further information on the options available are [here](https://docs.databricks.com/ingestion/auto-loader/options.html)</span>
<span class="sd">        path (str): The cloud storage path</span>
<span class="sd">        format (str): Specifies the file format to be read. Supported formats are available [here](https://docs.databricks.com/ingestion/auto-loader/options.html#file-format-options)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;cloudFiles.format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK on Databricks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK_DATABRICKS</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_delta_core&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: Auto Loader only supports streaming reads. To perform a batch read, use the read_stream method of this component and specify the Trigger on the write_stream to be `availableNow` to perform batch-like reads of cloud storage files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Auto Loader only supports streaming reads. To perform a batch read, use the read_stream method and specify Trigger on the write_stream as `availableNow`&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs streaming reads of files in cloud storage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;cloudFiles&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK on Databricks</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/autoloader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK on Databricks</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK_DATABRICKS</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>NotImplementedError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Auto Loader only supports streaming reads. To perform a batch read, use the read_stream method of this component and specify the Trigger on the write_stream to be <code>availableNow</code> to perform batch-like reads of cloud storage files.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/autoloader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: Auto Loader only supports streaming reads. To perform a batch read, use the read_stream method of this component and specify the Trigger on the write_stream to be `availableNow` to perform batch-like reads of cloud storage files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="s2">&quot;Auto Loader only supports streaming reads. To perform a batch read, use the read_stream method and specify Trigger on the write_stream as `availableNow`&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DataBricksAutoLoaderSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Performs streaming reads of files in cloud storage.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/autoloader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs streaming reads of files in cloud storage.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;cloudFiles&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource" class="doc doc-heading">
            <code>SparkDeltaSharingSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>The Spark Delta Sharing Source is used to read data from a Delta table where Delta sharing is configured</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource--example">Example</h4>
<p><div class="highlight"><pre><span></span><code><span class="c1">#Delta Sharing Source for Streaming Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkDeltaSharingSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">delta_sharing_source</span> <span class="o">=</span> <span class="n">SparkDeltaSharingSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;maxFilesPerTrigger&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">&quot;ignoreChanges: True,</span>
        <span class="s2">&quot;startingVersion&quot;</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">},</span>
    <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;{YOUR-DELTA-TABLE-PATH}&quot;</span>
<span class="p">)</span>

<span class="n">delta_sharing_source</span><span class="o">.</span><span class="n">read_stream</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">#Delta Sharing Source for Batch Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkDeltaSharingSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">delta_sharing_source</span> <span class="o">=</span> <span class="n">SparkDeltaSharingSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;versionAsOf&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;timestampAsOf&quot;</span><span class="p">:</span> <span class="s2">&quot;yyyy-mm-dd hh:mm:ss[.fffffffff]&quot;</span>
    <span class="p">},</span>
    <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;{YOUR-DELTA-TABLE-PATH}&quot;</span>
<span class="p">)</span>

<span class="n">delta_sharing_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session required to read data from a Delta table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Options that can be specified for a Delta Table read operation (See Attributes table below). Further information on the options is available <a href="https://docs.databricks.com/data-sharing/read-data-open.html#apache-spark-read-shared-data" target="_blank">here</a></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>table_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to credentials file and Delta table to query</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource.ignoreDeletes">ignoreDeletes</span></code></td>
            <td>
                  <code>bool str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ignore transactions that delete data at partition boundaries. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource.ignoreChanges">ignoreChanges</span></code></td>
            <td>
                  <code>bool str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-process updates if files had to be rewritten in the source table due to a data changing operation. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource.startingVersion">startingVersion</span></code></td>
            <td>
                  <code>int str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Delta Lake version to start from. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource.startingTimestamp">startingTimestamp</span></code></td>
            <td>
                  <code>datetime str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The timestamp to start from. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource.maxFilesPerTrigger">maxFilesPerTrigger</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many new files to be considered in every micro-batch. The default is 1000. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource.maxBytesPerTrigger">maxBytesPerTrigger</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How much data gets processed in each micro-batch. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource.readChangeFeed">readChangeFeed</span></code></td>
            <td>
                  <code>bool str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stream read the change data feed of the shared table. (Batch &amp; Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource.timestampAsOf">timestampAsOf</span></code></td>
            <td>
                  <code>datetime str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Query the Delta Table from a specific point in time. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource.versionAsOf">versionAsOf</span></code></td>
            <td>
                  <code>int str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Query the Delta Table from a specific version. (Batch)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/delta_sharing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkDeltaSharingSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Spark Delta Sharing Source is used to read data from a Delta table where Delta sharing is configured</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    #Delta Sharing Source for Streaming Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.sources import SparkDeltaSharingSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    delta_sharing_source = SparkDeltaSharingSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;maxFilesPerTrigger&quot;: 1000,</span>
<span class="sd">            &quot;ignoreChanges: True,</span>
<span class="sd">            &quot;startingVersion&quot;: 0</span>
<span class="sd">        },</span>
<span class="sd">        table_name=&quot;{YOUR-DELTA-TABLE-PATH}&quot;</span>
<span class="sd">    )</span>

<span class="sd">    delta_sharing_source.read_stream()</span>
<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">    #Delta Sharing Source for Batch Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.sources import SparkDeltaSharingSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    delta_sharing_source = SparkDeltaSharingSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;versionAsOf&quot;: 0,</span>
<span class="sd">            &quot;timestampAsOf&quot;: &quot;yyyy-mm-dd hh:mm:ss[.fffffffff]&quot;</span>
<span class="sd">        },</span>
<span class="sd">        table_name=&quot;{YOUR-DELTA-TABLE-PATH}&quot;</span>
<span class="sd">    )</span>

<span class="sd">    delta_sharing_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session required to read data from a Delta table</span>
<span class="sd">        options (dict): Options that can be specified for a Delta Table read operation (See Attributes table below). Further information on the options is available [here](https://docs.databricks.com/data-sharing/read-data-open.html#apache-spark-read-shared-data){ target=&quot;_blank&quot; }</span>
<span class="sd">        table_path (str): Path to credentials file and Delta table to query</span>

<span class="sd">    Attributes:</span>
<span class="sd">        ignoreDeletes (bool str): Ignore transactions that delete data at partition boundaries. (Streaming)</span>
<span class="sd">        ignoreChanges (bool str): Pre-process updates if files had to be rewritten in the source table due to a data changing operation. (Streaming)</span>
<span class="sd">        startingVersion (int str): The Delta Lake version to start from. (Streaming)</span>
<span class="sd">        startingTimestamp (datetime str): The timestamp to start from. (Streaming)</span>
<span class="sd">        maxFilesPerTrigger (int): How many new files to be considered in every micro-batch. The default is 1000. (Streaming)</span>
<span class="sd">        maxBytesPerTrigger (int): How much data gets processed in each micro-batch. (Streaming)</span>
<span class="sd">        readChangeFeed (bool str): Stream read the change data feed of the shared table. (Batch &amp; Streaming)</span>
<span class="sd">        timestampAsOf (datetime str): Query the Delta Table from a specific point in time. (Batch)</span>
<span class="sd">        versionAsOf (int str): Query the Delta Table from a specific version. (Batch)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">table_path</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">table_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_path</span> <span class="o">=</span> <span class="n">table_path</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_delta_sharing&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads batch data from Delta. Most of the options provided by the Apache Spark DataFrame read API are supported for performing batch reads on Delta tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;deltaSharing&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_path</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads streaming data from Delta. All of the data in the table is processed as well as any new data that arrives after the stream started. .load() can take table name or path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;deltaSharing&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_path</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/delta_sharing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads batch data from Delta. Most of the options provided by the Apache Spark DataFrame read API are supported for performing batch reads on Delta tables.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/delta_sharing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads batch data from Delta. Most of the options provided by the Apache Spark DataFrame read API are supported for performing batch reads on Delta tables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;deltaSharing&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_path</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSharingSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads streaming data from Delta. All of the data in the table is processed as well as any new data that arrives after the stream started. .load() can take table name or path.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/delta_sharing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads streaming data from Delta. All of the data in the table is processed as well as any new data that arrives after the stream started. .load() can take table name or path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;deltaSharing&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_path</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubSource" class="doc doc-heading">
            <code>SparkEventhubSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>This Spark source class is used to read batch or streaming data from Eventhubs. Eventhub configurations need to be specified as options in a dictionary.
Additionally, there are more optional configurations which can be found <a href="https://github.com/Azure/azure-event-hubs-spark/blob/master/docs/PySpark/structured-streaming-pyspark.md#event-hubs-configuration" target="_blank">here.</a>
If using startingPosition or endingPosition make sure to check out the <strong>Event Position</strong> section for more details and examples.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubSource--example">Example</h4>
<p><div class="highlight"><pre><span></span><code><span class="c1">#Eventhub Source for Streaming Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkEventhubSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">connectionString</span> <span class="o">=</span> <span class="s2">&quot;Endpoint=sb://</span><span class="si">{NAMESPACE}</span><span class="s2">.servicebus.windows.net/;SharedAccessKeyName=</span><span class="si">{ACCESS_KEY_NAME}</span><span class="s2">;SharedAccessKey=</span><span class="si">{ACCESS_KEY}</span><span class="s2">=;EntityPath=</span><span class="si">{EVENT_HUB_NAME}</span><span class="s2">&quot;</span>

<span class="n">startingEventPosition</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="s2">&quot;seqNo&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="s2">&quot;enqueuedTime&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="s2">&quot;isInclusive&quot;</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">}</span>

<span class="n">eventhub_source</span> <span class="o">=</span> <span class="n">SparkEventhubSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;eventhubs.connectionString&quot;</span><span class="p">:</span> <span class="n">connectionString</span><span class="p">,</span>
        <span class="s2">&quot;eventhubs.consumerGroup&quot;</span><span class="p">:</span> <span class="s2">&quot;{YOUR-CONSUMER-GROUP}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;eventhubs.startingPosition&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">startingEventPosition</span><span class="p">),</span>
        <span class="s2">&quot;maxEventsPerTrigger&quot;</span> <span class="p">:</span> <span class="mi">1000</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">eventhub_source</span><span class="o">.</span><span class="n">read_stream</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code> <span class="c1">#Eventhub Source for Batch Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkEventhubSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">connectionString</span> <span class="o">=</span> <span class="s2">&quot;Endpoint=sb://</span><span class="si">{NAMESPACE}</span><span class="s2">.servicebus.windows.net/;SharedAccessKeyName=</span><span class="si">{ACCESS_KEY_NAME}</span><span class="s2">;SharedAccessKey=</span><span class="si">{ACCESS_KEY}</span><span class="s2">=;EntityPath=</span><span class="si">{EVENT_HUB_NAME}</span><span class="s2">&quot;</span>

<span class="n">startingEventPosition</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;seqNo&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;enqueuedTime&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;isInclusive&quot;</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">}</span>

<span class="n">endingEventPosition</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;seqNo&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;enqueuedTime&quot;</span><span class="p">:</span> <span class="n">endTime</span><span class="p">,</span>
    <span class="s2">&quot;isInclusive&quot;</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">}</span>

<span class="n">eventhub_source</span> <span class="o">=</span> <span class="n">SparkEventhubSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;eventhubs.connectionString&quot;</span><span class="p">:</span> <span class="n">connectionString</span><span class="p">,</span>
        <span class="s2">&quot;eventhubs.consumerGroup&quot;</span><span class="p">:</span> <span class="s2">&quot;{YOUR-CONSUMER-GROUP}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;eventhubs.startingPosition&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">startingEventPosition</span><span class="p">),</span>
        <span class="s2">&quot;eventhubs.endingPosition&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">endingEventPosition</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">eventhub_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of Eventhub configurations (See Attributes table below)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubSource.eventhubs.connectionString">eventhubs.connectionString</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Eventhubs connection string is required to connect to the Eventhubs service. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubSource.eventhubs.consumerGroup">eventhubs.consumerGroup</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A consumer group is a view of an entire eventhub. Consumer groups enable multiple consuming applications to each have a separate view of the event stream, and to read the stream independently at their own pace and with their own offsets. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubSource.eventhubs.startingPosition">eventhubs.startingPosition</span></code></td>
            <td>
                  <code>JSON str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The starting position for your Structured Streaming job. If a specific EventPosition is not set for a partition using startingPositions, then we use the EventPosition set in startingPosition. If nothing is set in either option, we will begin consuming from the end of the partition. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubSource.eventhubs.endingPosition">eventhubs.endingPosition</span></code></td>
            <td>
                  <code>JSON str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(JSON str): The ending position of a batch query. This works the same as startingPosition. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubSource.maxEventsPerTrigger">maxEventsPerTrigger</span></code></td>
            <td>
                  <code>long</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rate limit on maximum number of events processed per trigger interval. The specified total number of events will be proportionally split across partitions of different volume. (Stream)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/eventhub.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkEventhubSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Spark source class is used to read batch or streaming data from Eventhubs. Eventhub configurations need to be specified as options in a dictionary.</span>
<span class="sd">    Additionally, there are more optional configurations which can be found [here.](https://github.com/Azure/azure-event-hubs-spark/blob/master/docs/PySpark/structured-streaming-pyspark.md#event-hubs-configuration){ target=&quot;_blank&quot; }</span>
<span class="sd">    If using startingPosition or endingPosition make sure to check out the **Event Position** section for more details and examples.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    #Eventhub Source for Streaming Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.sources import SparkEventhubSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>
<span class="sd">    import json</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    connectionString = &quot;Endpoint=sb://{NAMESPACE}.servicebus.windows.net/;SharedAccessKeyName={ACCESS_KEY_NAME};SharedAccessKey={ACCESS_KEY}=;EntityPath={EVENT_HUB_NAME}&quot;</span>

<span class="sd">    startingEventPosition = {</span>
<span class="sd">    &quot;offset&quot;: -1,</span>
<span class="sd">    &quot;seqNo&quot;: -1,</span>
<span class="sd">    &quot;enqueuedTime&quot;: None,</span>
<span class="sd">    &quot;isInclusive&quot;: True</span>
<span class="sd">    }</span>

<span class="sd">    eventhub_source = SparkEventhubSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options = {</span>
<span class="sd">            &quot;eventhubs.connectionString&quot;: connectionString,</span>
<span class="sd">            &quot;eventhubs.consumerGroup&quot;: &quot;{YOUR-CONSUMER-GROUP}&quot;,</span>
<span class="sd">            &quot;eventhubs.startingPosition&quot;: json.dumps(startingEventPosition),</span>
<span class="sd">            &quot;maxEventsPerTrigger&quot; : 1000</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    eventhub_source.read_stream()</span>
<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">     #Eventhub Source for Batch Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.sources import SparkEventhubSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>
<span class="sd">    import json</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    connectionString = &quot;Endpoint=sb://{NAMESPACE}.servicebus.windows.net/;SharedAccessKeyName={ACCESS_KEY_NAME};SharedAccessKey={ACCESS_KEY}=;EntityPath={EVENT_HUB_NAME}&quot;</span>

<span class="sd">    startingEventPosition = {</span>
<span class="sd">        &quot;offset&quot;: -1,</span>
<span class="sd">        &quot;seqNo&quot;: -1,</span>
<span class="sd">        &quot;enqueuedTime&quot;: None,</span>
<span class="sd">        &quot;isInclusive&quot;: True</span>
<span class="sd">    }</span>

<span class="sd">    endingEventPosition = {</span>
<span class="sd">        &quot;offset&quot;: None,</span>
<span class="sd">        &quot;seqNo&quot;: -1,</span>
<span class="sd">        &quot;enqueuedTime&quot;: endTime,</span>
<span class="sd">        &quot;isInclusive&quot;: True</span>
<span class="sd">    }</span>

<span class="sd">    eventhub_source = SparkEventhubSource(</span>
<span class="sd">        spark,</span>
<span class="sd">        options = {</span>
<span class="sd">            &quot;eventhubs.connectionString&quot;: connectionString,</span>
<span class="sd">            &quot;eventhubs.consumerGroup&quot;: &quot;{YOUR-CONSUMER-GROUP}&quot;,</span>
<span class="sd">            &quot;eventhubs.startingPosition&quot;: json.dumps(startingEventPosition),</span>
<span class="sd">            &quot;eventhubs.endingPosition&quot;: json.dumps(endingEventPosition)</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    eventhub_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session</span>
<span class="sd">        options (dict): A dictionary of Eventhub configurations (See Attributes table below)</span>

<span class="sd">    Attributes:</span>
<span class="sd">        eventhubs.connectionString (str):  Eventhubs connection string is required to connect to the Eventhubs service. (Streaming and Batch)</span>
<span class="sd">        eventhubs.consumerGroup (str): A consumer group is a view of an entire eventhub. Consumer groups enable multiple consuming applications to each have a separate view of the event stream, and to read the stream independently at their own pace and with their own offsets. (Streaming and Batch)</span>
<span class="sd">        eventhubs.startingPosition (JSON str): The starting position for your Structured Streaming job. If a specific EventPosition is not set for a partition using startingPositions, then we use the EventPosition set in startingPosition. If nothing is set in either option, we will begin consuming from the end of the partition. (Streaming and Batch)</span>
<span class="sd">        eventhubs.endingPosition: (JSON str): The ending position of a batch query. This works the same as startingPosition. (Batch)</span>
<span class="sd">        maxEventsPerTrigger (long): Rate limit on maximum number of events processed per trigger interval. The specified total number of events will be proportionally split across partitions of different volume. (Stream)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">EVENTHUB_SCHEMA</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">spark_libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">spark_libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_azure_eventhub&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">spark_libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads batch data from Eventhubs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eventhub_connection_string</span> <span class="o">=</span> <span class="s2">&quot;eventhubs.connectionString&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">eventhub_connection_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">sc</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">eventhubs</span><span class="o">.</span><span class="n">EventHubsUtils</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;eventhubs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads streaming data from Eventhubs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eventhub_connection_string</span> <span class="o">=</span> <span class="s2">&quot;eventhubs.connectionString&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">eventhub_connection_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">sc</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">eventhubs</span><span class="o">.</span><span class="n">EventHubsUtils</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;eventhubs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubSource.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubSource.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/eventhub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads batch data from Eventhubs.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/eventhub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads batch data from Eventhubs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eventhub_connection_string</span> <span class="o">=</span> <span class="s2">&quot;eventhubs.connectionString&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">eventhub_connection_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">sc</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">eventhubs</span><span class="o">.</span><span class="n">EventHubsUtils</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;eventhubs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads streaming data from Eventhubs.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/eventhub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads streaming data from Eventhubs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eventhub_connection_string</span> <span class="o">=</span> <span class="s2">&quot;eventhubs.connectionString&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">eventhub_connection_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">sc</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">eventhubs</span><span class="o">.</span><span class="n">EventHubsUtils</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;eventhubs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkIoThubSource" class="doc doc-heading">
            <code>SparkIoThubSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>This Spark source class is used to read batch or streaming data from an IoT Hub. IoT Hub configurations need to be specified as options in a dictionary.
Additionally, there are more optional configurations which can be found <a href="https://github.com/Azure/azure-event-hubs-spark/blob/master/docs/PySpark/structured-streaming-pyspark.md#event-hubs-configuration" target="_blank">here.</a>
If using startingPosition or endingPosition make sure to check out the <strong>Event Position</strong> section for more details and examples.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkIoThubSource--example">Example</h4>
<p><div class="highlight"><pre><span></span><code><span class="c1">#IoT Hub Source for Streaming Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkIoThubSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">connectionString</span> <span class="o">=</span> <span class="s2">&quot;Endpoint=sb://</span><span class="si">{NAMESPACE}</span><span class="s2">.servicebus.windows.net/;SharedAccessKeyName=</span><span class="si">{ACCESS_KEY_NAME}</span><span class="s2">;SharedAccessKey=</span><span class="si">{ACCESS_KEY}</span><span class="s2">=;EntityPath=</span><span class="si">{EVENT_HUB_NAME}</span><span class="s2">&quot;</span>

<span class="n">startingEventPosition</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="s2">&quot;seqNo&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="s2">&quot;enqueuedTime&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="s2">&quot;isInclusive&quot;</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">}</span>

<span class="n">iot_hub_source</span> <span class="o">=</span> <span class="n">SparkIoThubSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;eventhubs.connectionString&quot;</span><span class="p">:</span> <span class="n">connectionString</span><span class="p">,</span>
        <span class="s2">&quot;eventhubs.consumerGroup&quot;</span><span class="p">:</span> <span class="s2">&quot;{YOUR-CONSUMER-GROUP}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;eventhubs.startingPosition&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">startingEventPosition</span><span class="p">),</span>
        <span class="s2">&quot;maxEventsPerTrigger&quot;</span> <span class="p">:</span> <span class="mi">1000</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">iot_hub_source</span><span class="o">.</span><span class="n">read_stream</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code> <span class="c1">#IoT Hub Source for Batch Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkIoThubSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">connectionString</span> <span class="o">=</span> <span class="s2">&quot;Endpoint=sb://</span><span class="si">{NAMESPACE}</span><span class="s2">.servicebus.windows.net/;SharedAccessKeyName=</span><span class="si">{ACCESS_KEY_NAME}</span><span class="s2">;SharedAccessKey=</span><span class="si">{ACCESS_KEY}</span><span class="s2">=;EntityPath=</span><span class="si">{EVENT_HUB_NAME}</span><span class="s2">&quot;</span>

<span class="n">startingEventPosition</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;seqNo&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;enqueuedTime&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;isInclusive&quot;</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">}</span>

<span class="n">endingEventPosition</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;seqNo&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;enqueuedTime&quot;</span><span class="p">:</span> <span class="n">endTime</span><span class="p">,</span>
    <span class="s2">&quot;isInclusive&quot;</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">}</span>

<span class="n">iot_hub_source</span> <span class="o">=</span> <span class="n">SparkIoThubSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;eventhubs.connectionString&quot;</span><span class="p">:</span> <span class="n">connectionString</span><span class="p">,</span>
        <span class="s2">&quot;eventhubs.consumerGroup&quot;</span><span class="p">:</span> <span class="s2">&quot;{YOUR-CONSUMER-GROUP}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;eventhubs.startingPosition&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">startingEventPosition</span><span class="p">),</span>
        <span class="s2">&quot;eventhubs.endingPosition&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">endingEventPosition</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">iot_hub_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of IoT Hub configurations (See Attributes table below)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkIoThubSource.eventhubs.connectionString">eventhubs.connectionString</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IoT Hub connection string is required to connect to the Eventhubs service. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkIoThubSource.eventhubs.consumerGroup">eventhubs.consumerGroup</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A consumer group is a view of an entire IoT Hub. Consumer groups enable multiple consuming applications to each have a separate view of the event stream, and to read the stream independently at their own pace and with their own offsets. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkIoThubSource.eventhubs.startingPosition">eventhubs.startingPosition</span></code></td>
            <td>
                  <code>JSON str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The starting position for your Structured Streaming job. If a specific EventPosition is not set for a partition using startingPositions, then we use the EventPosition set in startingPosition. If nothing is set in either option, we will begin consuming from the end of the partition. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkIoThubSource.eventhubs.endingPosition">eventhubs.endingPosition</span></code></td>
            <td>
                  <code>JSON str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(JSON str): The ending position of a batch query. This works the same as startingPosition. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkIoThubSource.maxEventsPerTrigger">maxEventsPerTrigger</span></code></td>
            <td>
                  <code>long</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rate limit on maximum number of events processed per trigger interval. The specified total number of events will be proportionally split across partitions of different volume. (Stream)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iot_hub.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkIoThubSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Spark source class is used to read batch or streaming data from an IoT Hub. IoT Hub configurations need to be specified as options in a dictionary.</span>
<span class="sd">    Additionally, there are more optional configurations which can be found [here.](https://github.com/Azure/azure-event-hubs-spark/blob/master/docs/PySpark/structured-streaming-pyspark.md#event-hubs-configuration){ target=&quot;_blank&quot; }</span>
<span class="sd">    If using startingPosition or endingPosition make sure to check out the **Event Position** section for more details and examples.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    #IoT Hub Source for Streaming Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.sources import SparkIoThubSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>
<span class="sd">    import json</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    connectionString = &quot;Endpoint=sb://{NAMESPACE}.servicebus.windows.net/;SharedAccessKeyName={ACCESS_KEY_NAME};SharedAccessKey={ACCESS_KEY}=;EntityPath={EVENT_HUB_NAME}&quot;</span>

<span class="sd">    startingEventPosition = {</span>
<span class="sd">    &quot;offset&quot;: -1,</span>
<span class="sd">    &quot;seqNo&quot;: -1,</span>
<span class="sd">    &quot;enqueuedTime&quot;: None,</span>
<span class="sd">    &quot;isInclusive&quot;: True</span>
<span class="sd">    }</span>

<span class="sd">    iot_hub_source = SparkIoThubSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options = {</span>
<span class="sd">            &quot;eventhubs.connectionString&quot;: connectionString,</span>
<span class="sd">            &quot;eventhubs.consumerGroup&quot;: &quot;{YOUR-CONSUMER-GROUP}&quot;,</span>
<span class="sd">            &quot;eventhubs.startingPosition&quot;: json.dumps(startingEventPosition),</span>
<span class="sd">            &quot;maxEventsPerTrigger&quot; : 1000</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    iot_hub_source.read_stream()</span>
<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">     #IoT Hub Source for Batch Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.sources import SparkIoThubSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>
<span class="sd">    import json</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    connectionString = &quot;Endpoint=sb://{NAMESPACE}.servicebus.windows.net/;SharedAccessKeyName={ACCESS_KEY_NAME};SharedAccessKey={ACCESS_KEY}=;EntityPath={EVENT_HUB_NAME}&quot;</span>

<span class="sd">    startingEventPosition = {</span>
<span class="sd">        &quot;offset&quot;: -1,</span>
<span class="sd">        &quot;seqNo&quot;: -1,</span>
<span class="sd">        &quot;enqueuedTime&quot;: None,</span>
<span class="sd">        &quot;isInclusive&quot;: True</span>
<span class="sd">    }</span>

<span class="sd">    endingEventPosition = {</span>
<span class="sd">        &quot;offset&quot;: None,</span>
<span class="sd">        &quot;seqNo&quot;: -1,</span>
<span class="sd">        &quot;enqueuedTime&quot;: endTime,</span>
<span class="sd">        &quot;isInclusive&quot;: True</span>
<span class="sd">    }</span>

<span class="sd">    iot_hub_source = SparkIoThubSource(</span>
<span class="sd">        spark,</span>
<span class="sd">        options = {</span>
<span class="sd">            &quot;eventhubs.connectionString&quot;: connectionString,</span>
<span class="sd">            &quot;eventhubs.consumerGroup&quot;: &quot;{YOUR-CONSUMER-GROUP}&quot;,</span>
<span class="sd">            &quot;eventhubs.startingPosition&quot;: json.dumps(startingEventPosition),</span>
<span class="sd">            &quot;eventhubs.endingPosition&quot;: json.dumps(endingEventPosition)</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    iot_hub_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session</span>
<span class="sd">        options (dict): A dictionary of IoT Hub configurations (See Attributes table below)</span>

<span class="sd">    Attributes:</span>
<span class="sd">        eventhubs.connectionString (str):  IoT Hub connection string is required to connect to the Eventhubs service. (Streaming and Batch)</span>
<span class="sd">        eventhubs.consumerGroup (str): A consumer group is a view of an entire IoT Hub. Consumer groups enable multiple consuming applications to each have a separate view of the event stream, and to read the stream independently at their own pace and with their own offsets. (Streaming and Batch)</span>
<span class="sd">        eventhubs.startingPosition (JSON str): The starting position for your Structured Streaming job. If a specific EventPosition is not set for a partition using startingPositions, then we use the EventPosition set in startingPosition. If nothing is set in either option, we will begin consuming from the end of the partition. (Streaming and Batch)</span>
<span class="sd">        eventhubs.endingPosition: (JSON str): The ending position of a batch query. This works the same as startingPosition. (Batch)</span>
<span class="sd">        maxEventsPerTrigger (long): Rate limit on maximum number of events processed per trigger interval. The specified total number of events will be proportionally split across partitions of different volume. (Stream)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">EVENTHUB_SCHEMA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">spark_libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">spark_libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_azure_eventhub&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">spark_libraries</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads batch data from IoT Hubs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">iothub_connection_string</span> <span class="o">=</span> <span class="s2">&quot;eventhubs.connectionString&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">iothub_connection_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">iothub_connection_string</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">sc</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">eventhubs</span><span class="o">.</span><span class="n">EventHubsUtils</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">iothub_connection_string</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;eventhubs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads streaming data from IoT Hubs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">iothub_connection_string</span> <span class="o">=</span> <span class="s2">&quot;eventhubs.connectionString&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">iothub_connection_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">iothub_connection_string</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">sc</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">eventhubs</span><span class="o">.</span><span class="n">EventHubsUtils</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">iothub_connection_string</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;eventhubs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkIoThubSource.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkIoThubSource.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iot_hub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkIoThubSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads batch data from IoT Hubs.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iot_hub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads batch data from IoT Hubs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iothub_connection_string</span> <span class="o">=</span> <span class="s2">&quot;eventhubs.connectionString&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">iothub_connection_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">iothub_connection_string</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">sc</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">eventhubs</span><span class="o">.</span><span class="n">EventHubsUtils</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">iothub_connection_string</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;eventhubs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkIoThubSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads streaming data from IoT Hubs.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iot_hub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads streaming data from IoT Hubs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iothub_connection_string</span> <span class="o">=</span> <span class="s2">&quot;eventhubs.connectionString&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">iothub_connection_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">iothub_connection_string</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">sc</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">eventhubs</span><span class="o">.</span><span class="n">EventHubsUtils</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">iothub_connection_string</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;eventhubs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource" class="doc doc-heading">
            <code>SparkKafkaSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>This Spark source class is used to read batch or streaming data from Kafka. Required and optional configurations can be found in the Attributes tables below.</p>
<p>Additionally, there are more optional configurations which can be found <a href="https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html" target="_blank">here.</a></p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource--example">Example</h4>
<p><div class="highlight"><pre><span></span><code> <span class="c1">#Kafka Source for Streaming Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkKafkaSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">kafka_source</span> <span class="o">=</span> <span class="n">SparkKafkaSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;kafka.bootstrap.servers&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{HOST_1}</span><span class="s2">:</span><span class="si">{PORT_1}</span><span class="s2">,</span><span class="si">{HOST_2}</span><span class="s2">:</span><span class="si">{PORT_2}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subscribe&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{TOPIC_1}</span><span class="s2">,</span><span class="si">{TOPIC_2}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;includeHeaders&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">kafka_source</span><span class="o">.</span><span class="n">read_stream</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code> <span class="c1">#Kafka Source for Batch Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkKafkaSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">kafka_source</span> <span class="o">=</span> <span class="n">SparkKafkaSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;kafka.bootstrap.servers&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{HOST_1}</span><span class="s2">:</span><span class="si">{PORT_1}</span><span class="s2">,</span><span class="si">{HOST_2}</span><span class="s2">:</span><span class="si">{PORT_2}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subscribe&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{TOPIC_1}</span><span class="s2">,</span><span class="si">{TOPIC_2}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;startingOffsets&quot;</span><span class="p">:</span> <span class="s2">&quot;earliest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;endingOffsets&quot;</span><span class="p">:</span> <span class="s2">&quot;latest&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">kafka_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of Kafka configurations (See Attributes tables below). For more information on configuration options see <a href="https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html" target="_blank">here</a></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The following attributes are the most common configurations for Kafka.</p>
<p>The only configuration that must be set for the Kafka source for both batch and streaming queries is listed below.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.kafka.bootstrap.servers">kafka.bootstrap.servers</span></code></td>
            <td>
                  <code>A comma-separated list of host︰port</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Kafka "bootstrap.servers" configuration. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>There are multiple ways of specifying which topics to subscribe to. You should provide only one of these attributes:</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.assign">assign</span></code></td>
            <td>
                  <code>json string {&#34;topicA&#34;︰[0,1],&#34;topicB&#34;︰[2,4]}</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific TopicPartitions to consume. Only one of "assign", "subscribe" or "subscribePattern" options can be specified for Kafka source. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.subscribe">subscribe</span></code></td>
            <td>
                  <code>A comma-separated list of topics</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The topic list to subscribe. Only one of "assign", "subscribe" or "subscribePattern" options can be specified for Kafka source. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.subscribePattern">subscribePattern</span></code></td>
            <td>
                  <code>Java regex string</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pattern used to subscribe to topic(s). Only one of "assign, "subscribe" or "subscribePattern" options can be specified for Kafka source. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The following configurations are optional:</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.startingTimestamp">startingTimestamp</span></code></td>
            <td>
                  <code>timestamp str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start point of timestamp when a query is started, a string specifying a starting timestamp for all partitions in topics being subscribed. Please refer the note on starting timestamp offset options below. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.startingOffsetsByTimestamp">startingOffsetsByTimestamp</span></code></td>
            <td>
                  <code>JSON str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start point of timestamp when a query is started, a json string specifying a starting timestamp for each TopicPartition. Please refer the note on starting timestamp offset options below. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.startingOffsets">startingOffsets</span></code></td>
            <td>
                  <code>&#34;earliest&#34;, &#34;latest&#34; (streaming only), or JSON string</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start point when a query is started, either "earliest" which is from the earliest offsets, "latest" which is just from the latest offsets, or a json string specifying a starting offset for each TopicPartition. In the json, -2 as an offset can be used to refer to earliest, -1 to latest.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.endingTimestamp">endingTimestamp</span></code></td>
            <td>
                  <code>timestamp str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end point when a batch query is ended, a json string specifying an ending timestamp for all partitions in topics being subscribed. Please refer the note on ending timestamp offset options below. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.endingOffsetsByTimestamp">endingOffsetsByTimestamp</span></code></td>
            <td>
                  <code>JSON str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end point when a batch query is ended, a json string specifying an ending timestamp for each TopicPartition. Please refer the note on ending timestamp offset options below. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.endingOffsets">endingOffsets</span></code></td>
            <td>
                  <code>latest or JSON str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end point when a batch query is ended, either "latest" which is just referred to the latest, or a json string specifying an ending offset for each TopicPartition. In the json, -1 as an offset can be used to refer to latest, and -2 (earliest) as an offset is not allowed. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.maxOffsetsPerTrigger">maxOffsetsPerTrigger</span></code></td>
            <td>
                  <code>long</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rate limit on maximum number of offsets processed per trigger interval. The specified total number of offsets will be proportionally split across topicPartitions of different volume. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.minOffsetsPerTrigger">minOffsetsPerTrigger</span></code></td>
            <td>
                  <code>long</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of offsets to be processed per trigger interval. The specified total number of offsets will be proportionally split across topicPartitions of different volume. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.failOnDataLoss">failOnDataLoss</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to fail the query when it's possible that data is lost (e.g., topics are deleted, or offsets are out of range). This may be a false alarm. You can disable it when it doesn't work as you expected.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.minPartitions">minPartitions</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired minimum number of partitions to read from Kafka. By default, Spark has a 1-1 mapping of topicPartitions to Spark partitions consuming from Kafka. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.includeHeaders">includeHeaders</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include the Kafka headers in the row. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <div class="admonition note">
<p class="admonition-title">Starting Timestamp Offset Note</p>
<p>If Kafka doesn't return the matched offset, the behavior will follow to the value of the option <code>startingOffsetsByTimestampStrategy</code>.</p>
<p><code>startingTimestamp</code> takes precedence over <code>startingOffsetsByTimestamp</code> and </code>startingOffsets</code>.</p>
<p>For streaming queries, this only applies when a new query is started, and that resuming will always pick up from where the query left off. Newly discovered partitions during a query will start at earliest.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Ending Timestamp Offset Note</p>
<p>If Kafka doesn't return the matched offset, the offset will be set to latest.</p>
<p><code>endingOffsetsByTimestamp</code> takes precedence over <code>endingOffsets</code>.</p>
</div>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/kafka.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkKafkaSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Spark source class is used to read batch or streaming data from Kafka. Required and optional configurations can be found in the Attributes tables below.</span>

<span class="sd">    Additionally, there are more optional configurations which can be found [here.](https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html){ target=&quot;_blank&quot; }</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">     #Kafka Source for Streaming Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.sources import SparkKafkaSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    kafka_source = SparkKafkaSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;kafka.bootstrap.servers&quot;: &quot;{HOST_1}:{PORT_1},{HOST_2}:{PORT_2}&quot;,</span>
<span class="sd">            &quot;subscribe&quot;: &quot;{TOPIC_1},{TOPIC_2}&quot;,</span>
<span class="sd">            &quot;includeHeaders&quot;, &quot;true&quot;</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    kafka_source.read_stream()</span>
<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">     #Kafka Source for Batch Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.sources import SparkKafkaSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    kafka_source = SparkKafkaSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;kafka.bootstrap.servers&quot;: &quot;{HOST_1}:{PORT_1},{HOST_2}:{PORT_2}&quot;,</span>
<span class="sd">            &quot;subscribe&quot;: &quot;{TOPIC_1},{TOPIC_2}&quot;,</span>
<span class="sd">            &quot;startingOffsets&quot;: &quot;earliest&quot;,</span>
<span class="sd">            &quot;endingOffsets&quot;: &quot;latest&quot;</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    kafka_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session</span>
<span class="sd">        options (dict): A dictionary of Kafka configurations (See Attributes tables below). For more information on configuration options see [here](https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html){ target=&quot;_blank&quot; }</span>

<span class="sd">    The following attributes are the most common configurations for Kafka.</span>

<span class="sd">    The only configuration that must be set for the Kafka source for both batch and streaming queries is listed below.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        kafka.bootstrap.servers (A comma-separated list of host︰port):  The Kafka &quot;bootstrap.servers&quot; configuration. (Streaming and Batch)</span>

<span class="sd">    There are multiple ways of specifying which topics to subscribe to. You should provide only one of these attributes:</span>

<span class="sd">    Attributes:</span>
<span class="sd">        assign (json string {&quot;topicA&quot;︰[0,1],&quot;topicB&quot;︰[2,4]}):  Specific TopicPartitions to consume. Only one of &quot;assign&quot;, &quot;subscribe&quot; or &quot;subscribePattern&quot; options can be specified for Kafka source. (Streaming and Batch)</span>
<span class="sd">        subscribe (A comma-separated list of topics): The topic list to subscribe. Only one of &quot;assign&quot;, &quot;subscribe&quot; or &quot;subscribePattern&quot; options can be specified for Kafka source. (Streaming and Batch)</span>
<span class="sd">        subscribePattern (Java regex string): The pattern used to subscribe to topic(s). Only one of &quot;assign, &quot;subscribe&quot; or &quot;subscribePattern&quot; options can be specified for Kafka source. (Streaming and Batch)</span>

<span class="sd">    The following configurations are optional:</span>

<span class="sd">    Attributes:</span>
<span class="sd">        startingTimestamp (timestamp str): The start point of timestamp when a query is started, a string specifying a starting timestamp for all partitions in topics being subscribed. Please refer the note on starting timestamp offset options below. (Streaming and Batch)</span>
<span class="sd">        startingOffsetsByTimestamp (JSON str): The start point of timestamp when a query is started, a json string specifying a starting timestamp for each TopicPartition. Please refer the note on starting timestamp offset options below. (Streaming and Batch)</span>
<span class="sd">        startingOffsets (&quot;earliest&quot;, &quot;latest&quot; (streaming only), or JSON string): The start point when a query is started, either &quot;earliest&quot; which is from the earliest offsets, &quot;latest&quot; which is just from the latest offsets, or a json string specifying a starting offset for each TopicPartition. In the json, -2 as an offset can be used to refer to earliest, -1 to latest.</span>
<span class="sd">        endingTimestamp (timestamp str): The end point when a batch query is ended, a json string specifying an ending timestamp for all partitions in topics being subscribed. Please refer the note on ending timestamp offset options below. (Batch)</span>
<span class="sd">        endingOffsetsByTimestamp (JSON str): The end point when a batch query is ended, a json string specifying an ending timestamp for each TopicPartition. Please refer the note on ending timestamp offset options below. (Batch)</span>
<span class="sd">        endingOffsets (latest or JSON str): The end point when a batch query is ended, either &quot;latest&quot; which is just referred to the latest, or a json string specifying an ending offset for each TopicPartition. In the json, -1 as an offset can be used to refer to latest, and -2 (earliest) as an offset is not allowed. (Batch)</span>
<span class="sd">        maxOffsetsPerTrigger (long): Rate limit on maximum number of offsets processed per trigger interval. The specified total number of offsets will be proportionally split across topicPartitions of different volume. (Streaming)</span>
<span class="sd">        minOffsetsPerTrigger (long): Minimum number of offsets to be processed per trigger interval. The specified total number of offsets will be proportionally split across topicPartitions of different volume. (Streaming)</span>
<span class="sd">        failOnDataLoss (bool): Whether to fail the query when it&#39;s possible that data is lost (e.g., topics are deleted, or offsets are out of range). This may be a false alarm. You can disable it when it doesn&#39;t work as you expected.</span>
<span class="sd">        minPartitions (int): Desired minimum number of partitions to read from Kafka. By default, Spark has a 1-1 mapping of topicPartitions to Spark partitions consuming from Kafka. (Streaming and Batch)</span>
<span class="sd">        includeHeaders (bool): Whether to include the Kafka headers in the row. (Streaming and Batch)</span>

<span class="sd">    !!! note &quot;Starting Timestamp Offset Note&quot;</span>
<span class="sd">        If Kafka doesn&#39;t return the matched offset, the behavior will follow to the value of the option &lt;code&gt;startingOffsetsByTimestampStrategy&lt;/code&gt;.</span>

<span class="sd">        &lt;code&gt;startingTimestamp&lt;/code&gt; takes precedence over &lt;code&gt;startingOffsetsByTimestamp&lt;/code&gt; and &lt;/code&gt;startingOffsets&lt;/code&gt;.</span>

<span class="sd">        For streaming queries, this only applies when a new query is started, and that resuming will always pick up from where the query left off. Newly discovered partitions during a query will start at earliest.</span>

<span class="sd">    !!! note &quot;Ending Timestamp Offset Note&quot;</span>
<span class="sd">        If Kafka doesn&#39;t return the matched offset, the offset will be set to latest.</span>

<span class="sd">        &lt;code&gt;endingOffsetsByTimestamp&lt;/code&gt; takes precedence over &lt;code&gt;endingOffsets&lt;/code&gt;.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">KAFKA_SCHEMA</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">spark_libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">spark_libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_sql_kafka&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">spark_libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads batch data from Kafka.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads streaming data from Kafka.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/kafka.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads batch data from Kafka.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/kafka.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads batch data from Kafka.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads streaming data from Kafka.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/kafka.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads streaming data from Kafka.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource" class="doc doc-heading">
            <code>SparkKafkaEventhubSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>This Spark source class is used to read batch or streaming data from an Eventhub using the Kafka protocol. This enables Eventhubs to be used as a source in applications like Delta Live Tables or Databricks Serverless Jobs as the Spark Eventhubs JAR is not supported in these scenarios.</p>
<p>The dataframe returned is transformed to ensure the schema is as close to the Eventhub Spark source as possible. There are some minor differences:</p>
<ul>
<li><code>offset</code> is dependent on <code>x-opt-offset</code> being populated in the headers provided. If this is not found in the headers, the value will be null</li>
<li><code>publisher</code> is dependent on <code>x-opt-publisher</code> being populated in the headers provided. If this is not found in the headers, the value will be null</li>
<li><code>partitionKey</code> is dependent on <code>x-opt-partition-key</code> being populated in the headers provided. If this is not found in the headers, the value will be null</li>
<li><code>systemProperties</code> are identified according to the list provided in the <a href="https://learn.microsoft.com/en-us/azure/data-explorer/ingest-data-event-hub-overview#event-system-properties-mapping" target="_blank">Eventhub documentation</a> and <a href="https://learn.microsoft.com/en-us/azure/data-explorer/ingest-data-iot-hub-overview#event-system-properties-mapping" target="_blank">IoT Hub documentation</a></li>
</ul>
<p>Default settings will be specified if not provided in the <code>options</code> parameter:</p>
<ul>
<li><code>kafka.sasl.mechanism</code> will be set to <code>PLAIN</code></li>
<li><code>kafka.security.protocol</code> will be set to <code>SASL_SSL</code></li>
<li><code>kafka.request.timeout.ms</code> will be set to <code>60000</code></li>
<li><code>kafka.session.timeout.ms</code> will be set to <code>60000</code></li>
</ul>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource--examples">Examples</h4>
<p><div class="highlight"><pre><span></span><code><span class="c1">#Kafka Source for Streaming Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkKafkaEventhubSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">connectionString</span> <span class="o">=</span> <span class="s2">&quot;Endpoint=sb://</span><span class="si">{NAMESPACE}</span><span class="s2">.servicebus.windows.net/;SharedAccessKeyName=</span><span class="si">{ACCESS_KEY_NAME}</span><span class="s2">;SharedAccessKey=</span><span class="si">{ACCESS_KEY}</span><span class="s2">=;EntityPath=</span><span class="si">{EVENT_HUB_NAME}</span><span class="s2">&quot;</span>
<span class="n">consumerGroup</span> <span class="o">=</span> <span class="s2">&quot;{YOUR-CONSUMER-GROUP}&quot;</span>

<span class="n">kafka_eventhub_source</span> <span class="o">=</span> <span class="n">SparkKafkaEventhubSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;startingOffsets&quot;</span><span class="p">:</span> <span class="s2">&quot;earliest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;maxOffsetsPerTrigger&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
        <span class="s2">&quot;failOnDataLoss&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">connection_string</span><span class="o">=</span><span class="n">connectionString</span><span class="p">,</span>
    <span class="n">consumer_group</span><span class="o">=</span><span class="s2">&quot;consumerGroup&quot;</span>
<span class="p">)</span>

<span class="n">kafka_eventhub_source</span><span class="o">.</span><span class="n">read_stream</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">#Kafka Source for Batch Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkKafkaEventhubSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">connectionString</span> <span class="o">=</span> <span class="s2">&quot;Endpoint=sb://</span><span class="si">{NAMESPACE}</span><span class="s2">.servicebus.windows.net/;SharedAccessKeyName=</span><span class="si">{ACCESS_KEY_NAME}</span><span class="s2">;SharedAccessKey=</span><span class="si">{ACCESS_KEY}</span><span class="s2">=;EntityPath=</span><span class="si">{EVENT_HUB_NAME}</span><span class="s2">&quot;</span>
<span class="n">consumerGroup</span> <span class="o">=</span> <span class="s2">&quot;{YOUR-CONSUMER-GROUP}&quot;</span>

<span class="n">kafka_eventhub_source</span> <span class="o">=</span> <span class="n">SparkKafkaEventhubSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;startingOffsets&quot;</span><span class="p">:</span> <span class="s2">&quot;earliest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;endingOffsets&quot;</span><span class="p">:</span> <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;failOnDataLoss&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span>
    <span class="p">},</span>
    <span class="n">connection_string</span><span class="o">=</span><span class="n">connectionString</span><span class="p">,</span>
    <span class="n">consumer_group</span><span class="o">=</span><span class="s2">&quot;consumerGroup&quot;</span>
<span class="p">)</span>

<span class="n">kafka_eventhub_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div></p>
<p>Required and optional configurations can be found in the Attributes and Parameter tables below.
Additionally, there are more optional configurations which can be found <a href="https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html" target="_blank">here.</a></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of Kafka configurations (See Attributes tables below). For more information on configuration options see <a href="https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html" target="_blank">here</a></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>connection_string</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Eventhubs connection string is required to connect to the Eventhubs service. This must include the Eventhub name as the <code>EntityPath</code> parameter. Example <code>"Endpoint=sb://test.servicebus.windows.net/;SharedAccessKeyName=test;SharedAccessKey=test_key;EntityPath=test_eventhub"</code></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>consumer_group</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Eventhub consumer group to use for the connection</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>decode_kafka_headers_to_amqp_properties</code></td>
            <td>
                  <code>optional bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Perform decoding of Kafka headers into their AMQP properties. Default is True</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The only configuration that must be set for the Kafka source for both batch and streaming queries is listed below.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.kafka.bootstrap.servers">kafka.bootstrap.servers</span></code></td>
            <td>
                  <code>A comma-separated list of host︰port</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Kafka "bootstrap.servers" configuration. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>There are multiple ways of specifying which topics to subscribe to. You should provide only one of these parameters:</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.assign">assign</span></code></td>
            <td>
                  <code>json string {&#34;topicA&#34;︰[0,1],&#34;topicB&#34;︰[2,4]}</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific TopicPartitions to consume. Only one of "assign", "subscribe" or "subscribePattern" options can be specified for Kafka source. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.subscribe">subscribe</span></code></td>
            <td>
                  <code>A comma-separated list of topics</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The topic list to subscribe. Only one of "assign", "subscribe" or "subscribePattern" options can be specified for Kafka source. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.subscribePattern">subscribePattern</span></code></td>
            <td>
                  <code>Java regex string</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pattern used to subscribe to topic(s). Only one of "assign, "subscribe" or "subscribePattern" options can be specified for Kafka source. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The following configurations are optional:</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.startingTimestamp">startingTimestamp</span></code></td>
            <td>
                  <code>timestamp str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start point of timestamp when a query is started, a string specifying a starting timestamp for all partitions in topics being subscribed. Please refer the note on starting timestamp offset options below. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.startingOffsetsByTimestamp">startingOffsetsByTimestamp</span></code></td>
            <td>
                  <code>JSON str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start point of timestamp when a query is started, a json string specifying a starting timestamp for each TopicPartition. Please refer the note on starting timestamp offset options below. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.startingOffsets">startingOffsets</span></code></td>
            <td>
                  <code>&#34;earliest&#34;, &#34;latest&#34; (streaming only), or JSON string</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start point when a query is started, either "earliest" which is from the earliest offsets, "latest" which is just from the latest offsets, or a json string specifying a starting offset for each TopicPartition. In the json, -2 as an offset can be used to refer to earliest, -1 to latest.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.endingTimestamp">endingTimestamp</span></code></td>
            <td>
                  <code>timestamp str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end point when a batch query is ended, a json string specifying an ending timestamp for all partitions in topics being subscribed. Please refer the note on ending timestamp offset options below. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.endingOffsetsByTimestamp">endingOffsetsByTimestamp</span></code></td>
            <td>
                  <code>JSON str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end point when a batch query is ended, a json string specifying an ending timestamp for each TopicPartition. Please refer the note on ending timestamp offset options below. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.endingOffsets">endingOffsets</span></code></td>
            <td>
                  <code>latest or JSON str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end point when a batch query is ended, either "latest" which is just referred to the latest, or a json string specifying an ending offset for each TopicPartition. In the json, -1 as an offset can be used to refer to latest, and -2 (earliest) as an offset is not allowed. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.maxOffsetsPerTrigger">maxOffsetsPerTrigger</span></code></td>
            <td>
                  <code>long</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rate limit on maximum number of offsets processed per trigger interval. The specified total number of offsets will be proportionally split across topicPartitions of different volume. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.minOffsetsPerTrigger">minOffsetsPerTrigger</span></code></td>
            <td>
                  <code>long</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of offsets to be processed per trigger interval. The specified total number of offsets will be proportionally split across topicPartitions of different volume. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.failOnDataLoss">failOnDataLoss</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to fail the query when it's possible that data is lost (e.g., topics are deleted, or offsets are out of range). This may be a false alarm. You can disable it when it doesn't work as you expected.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.minPartitions">minPartitions</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired minimum number of partitions to read from Kafka. By default, Spark has a 1-1 mapping of topicPartitions to Spark partitions consuming from Kafka. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.includeHeaders">includeHeaders</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include the Kafka headers in the row. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <div class="admonition note">
<p class="admonition-title">Starting Timestamp Offset Note</p>
<p>If Kafka doesn't return the matched offset, the behavior will follow to the value of the option <code>startingOffsetsByTimestampStrategy</code>.</p>
<p><code>startingTimestamp</code> takes precedence over <code>startingOffsetsByTimestamp</code> and </code>startingOffsets</code>.</p>
<p>For streaming queries, this only applies when a new query is started, and that resuming will always pick up from where the query left off. Newly discovered partitions during a query will start at earliest.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Ending Timestamp Offset Note</p>
<p>If Kafka doesn't return the matched offset, the offset will be set to latest.</p>
<p><code>endingOffsetsByTimestamp</code> takes precedence over <code>endingOffsets</code>.</p>
</div>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/kafka_eventhub.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkKafkaEventhubSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Spark source class is used to read batch or streaming data from an Eventhub using the Kafka protocol. This enables Eventhubs to be used as a source in applications like Delta Live Tables or Databricks Serverless Jobs as the Spark Eventhubs JAR is not supported in these scenarios.</span>

<span class="sd">    The dataframe returned is transformed to ensure the schema is as close to the Eventhub Spark source as possible. There are some minor differences:</span>

<span class="sd">    - `offset` is dependent on `x-opt-offset` being populated in the headers provided. If this is not found in the headers, the value will be null</span>
<span class="sd">    - `publisher` is dependent on `x-opt-publisher` being populated in the headers provided. If this is not found in the headers, the value will be null</span>
<span class="sd">    - `partitionKey` is dependent on `x-opt-partition-key` being populated in the headers provided. If this is not found in the headers, the value will be null</span>
<span class="sd">    - `systemProperties` are identified according to the list provided in the [Eventhub documentation](https://learn.microsoft.com/en-us/azure/data-explorer/ingest-data-event-hub-overview#event-system-properties-mapping){ target=&quot;_blank&quot; } and [IoT Hub documentation](https://learn.microsoft.com/en-us/azure/data-explorer/ingest-data-iot-hub-overview#event-system-properties-mapping){ target=&quot;_blank&quot; }</span>

<span class="sd">    Default settings will be specified if not provided in the `options` parameter:</span>

<span class="sd">    - `kafka.sasl.mechanism` will be set to `PLAIN`</span>
<span class="sd">    - `kafka.security.protocol` will be set to `SASL_SSL`</span>
<span class="sd">    - `kafka.request.timeout.ms` will be set to `60000`</span>
<span class="sd">    - `kafka.session.timeout.ms` will be set to `60000`</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    #Kafka Source for Streaming Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.sources import SparkKafkaEventhubSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    connectionString = &quot;Endpoint=sb://{NAMESPACE}.servicebus.windows.net/;SharedAccessKeyName={ACCESS_KEY_NAME};SharedAccessKey={ACCESS_KEY}=;EntityPath={EVENT_HUB_NAME}&quot;</span>
<span class="sd">    consumerGroup = &quot;{YOUR-CONSUMER-GROUP}&quot;</span>

<span class="sd">    kafka_eventhub_source = SparkKafkaEventhubSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;startingOffsets&quot;: &quot;earliest&quot;,</span>
<span class="sd">            &quot;maxOffsetsPerTrigger&quot;: 10000,</span>
<span class="sd">            &quot;failOnDataLoss&quot;: &quot;false&quot;,</span>
<span class="sd">        },</span>
<span class="sd">        connection_string=connectionString,</span>
<span class="sd">        consumer_group=&quot;consumerGroup&quot;</span>
<span class="sd">    )</span>

<span class="sd">    kafka_eventhub_source.read_stream()</span>
<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">    #Kafka Source for Batch Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.sources import SparkKafkaEventhubSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    connectionString = &quot;Endpoint=sb://{NAMESPACE}.servicebus.windows.net/;SharedAccessKeyName={ACCESS_KEY_NAME};SharedAccessKey={ACCESS_KEY}=;EntityPath={EVENT_HUB_NAME}&quot;</span>
<span class="sd">    consumerGroup = &quot;{YOUR-CONSUMER-GROUP}&quot;</span>

<span class="sd">    kafka_eventhub_source = SparkKafkaEventhubSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;startingOffsets&quot;: &quot;earliest&quot;,</span>
<span class="sd">            &quot;endingOffsets&quot;: &quot;latest&quot;,</span>
<span class="sd">            &quot;failOnDataLoss&quot;: &quot;false&quot;</span>
<span class="sd">        },</span>
<span class="sd">        connection_string=connectionString,</span>
<span class="sd">        consumer_group=&quot;consumerGroup&quot;</span>
<span class="sd">    )</span>

<span class="sd">    kafka_eventhub_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Required and optional configurations can be found in the Attributes and Parameter tables below.</span>
<span class="sd">    Additionally, there are more optional configurations which can be found [here.](https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html){ target=&quot;_blank&quot; }</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session</span>
<span class="sd">        options (dict): A dictionary of Kafka configurations (See Attributes tables below). For more information on configuration options see [here](https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html){ target=&quot;_blank&quot; }</span>
<span class="sd">        connection_string (str): Eventhubs connection string is required to connect to the Eventhubs service. This must include the Eventhub name as the `EntityPath` parameter. Example `&quot;Endpoint=sb://test.servicebus.windows.net/;SharedAccessKeyName=test;SharedAccessKey=test_key;EntityPath=test_eventhub&quot;`</span>
<span class="sd">        consumer_group (str): The Eventhub consumer group to use for the connection</span>
<span class="sd">        decode_kafka_headers_to_amqp_properties (optional bool): Perform decoding of Kafka headers into their AMQP properties. Default is True</span>

<span class="sd">    The only configuration that must be set for the Kafka source for both batch and streaming queries is listed below.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        kafka.bootstrap.servers (A comma-separated list of host︰port):  The Kafka &quot;bootstrap.servers&quot; configuration. (Streaming and Batch)</span>

<span class="sd">    There are multiple ways of specifying which topics to subscribe to. You should provide only one of these parameters:</span>

<span class="sd">    Attributes:</span>
<span class="sd">        assign (json string {&quot;topicA&quot;︰[0,1],&quot;topicB&quot;︰[2,4]}):  Specific TopicPartitions to consume. Only one of &quot;assign&quot;, &quot;subscribe&quot; or &quot;subscribePattern&quot; options can be specified for Kafka source. (Streaming and Batch)</span>
<span class="sd">        subscribe (A comma-separated list of topics): The topic list to subscribe. Only one of &quot;assign&quot;, &quot;subscribe&quot; or &quot;subscribePattern&quot; options can be specified for Kafka source. (Streaming and Batch)</span>
<span class="sd">        subscribePattern (Java regex string): The pattern used to subscribe to topic(s). Only one of &quot;assign, &quot;subscribe&quot; or &quot;subscribePattern&quot; options can be specified for Kafka source. (Streaming and Batch)</span>

<span class="sd">    The following configurations are optional:</span>

<span class="sd">    Attributes:</span>
<span class="sd">        startingTimestamp (timestamp str): The start point of timestamp when a query is started, a string specifying a starting timestamp for all partitions in topics being subscribed. Please refer the note on starting timestamp offset options below. (Streaming and Batch)</span>
<span class="sd">        startingOffsetsByTimestamp (JSON str): The start point of timestamp when a query is started, a json string specifying a starting timestamp for each TopicPartition. Please refer the note on starting timestamp offset options below. (Streaming and Batch)</span>
<span class="sd">        startingOffsets (&quot;earliest&quot;, &quot;latest&quot; (streaming only), or JSON string): The start point when a query is started, either &quot;earliest&quot; which is from the earliest offsets, &quot;latest&quot; which is just from the latest offsets, or a json string specifying a starting offset for each TopicPartition. In the json, -2 as an offset can be used to refer to earliest, -1 to latest.</span>
<span class="sd">        endingTimestamp (timestamp str): The end point when a batch query is ended, a json string specifying an ending timestamp for all partitions in topics being subscribed. Please refer the note on ending timestamp offset options below. (Batch)</span>
<span class="sd">        endingOffsetsByTimestamp (JSON str): The end point when a batch query is ended, a json string specifying an ending timestamp for each TopicPartition. Please refer the note on ending timestamp offset options below. (Batch)</span>
<span class="sd">        endingOffsets (latest or JSON str): The end point when a batch query is ended, either &quot;latest&quot; which is just referred to the latest, or a json string specifying an ending offset for each TopicPartition. In the json, -1 as an offset can be used to refer to latest, and -2 (earliest) as an offset is not allowed. (Batch)</span>
<span class="sd">        maxOffsetsPerTrigger (long): Rate limit on maximum number of offsets processed per trigger interval. The specified total number of offsets will be proportionally split across topicPartitions of different volume. (Streaming)</span>
<span class="sd">        minOffsetsPerTrigger (long): Minimum number of offsets to be processed per trigger interval. The specified total number of offsets will be proportionally split across topicPartitions of different volume. (Streaming)</span>
<span class="sd">        failOnDataLoss (bool): Whether to fail the query when it&#39;s possible that data is lost (e.g., topics are deleted, or offsets are out of range). This may be a false alarm. You can disable it when it doesn&#39;t work as you expected.</span>
<span class="sd">        minPartitions (int): Desired minimum number of partitions to read from Kafka. By default, Spark has a 1-1 mapping of topicPartitions to Spark partitions consuming from Kafka. (Streaming and Batch)</span>
<span class="sd">        includeHeaders (bool): Whether to include the Kafka headers in the row. (Streaming and Batch)</span>

<span class="sd">    !!! note &quot;Starting Timestamp Offset Note&quot;</span>
<span class="sd">        If Kafka doesn&#39;t return the matched offset, the behavior will follow to the value of the option &lt;code&gt;startingOffsetsByTimestampStrategy&lt;/code&gt;.</span>

<span class="sd">        &lt;code&gt;startingTimestamp&lt;/code&gt; takes precedence over &lt;code&gt;startingOffsetsByTimestamp&lt;/code&gt; and &lt;/code&gt;startingOffsets&lt;/code&gt;.</span>

<span class="sd">        For streaming queries, this only applies when a new query is started, and that resuming will always pick up from where the query left off. Newly discovered partitions during a query will start at earliest.</span>

<span class="sd">    !!! note &quot;Ending Timestamp Offset Note&quot;</span>
<span class="sd">        If Kafka doesn&#39;t return the matched offset, the offset will be set to latest.</span>

<span class="sd">        &lt;code&gt;endingOffsetsByTimestamp&lt;/code&gt; takes precedence over &lt;code&gt;endingOffsets&lt;/code&gt;.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">connection_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">consumer_group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">decode_kafka_headers_to_amqp_properties</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_string</span> <span class="o">=</span> <span class="n">connection_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consumer_group</span> <span class="o">=</span> <span class="n">consumer_group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decode_kafka_headers_to_amqp_properties</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">decode_kafka_headers_to_amqp_properties</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_string_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_connection_string</span><span class="p">(</span>
            <span class="n">connection_string</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">KAFKA_EVENTHUB_SCHEMA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configure_options</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">spark_libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">spark_libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_sql_kafka&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">spark_libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Code is from Azure Eventhub Python SDK. Will import the package if possible with Conda in the  conda-forge channel in the future</span>
    <span class="k">def</span> <span class="nf">_parse_connection_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">conn_settings</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">connection_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">conn_settings</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Connection string is either blank or malformed.&quot;</span><span class="p">)</span>
        <span class="n">conn_settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">conn_settings</span><span class="p">)</span>
        <span class="n">shared_access_signature</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">conn_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sharedaccesssignature&quot;</span><span class="p">:</span>
                <span class="n">shared_access_signature</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">shared_access_key</span> <span class="o">=</span> <span class="n">conn_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SharedAccessKey&quot;</span><span class="p">)</span>
        <span class="n">shared_access_key_name</span> <span class="o">=</span> <span class="n">conn_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SharedAccessKeyName&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">shared_access_key</span><span class="p">,</span> <span class="n">shared_access_key_name</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="n">shared_access_key</span><span class="p">,</span> <span class="n">shared_access_key_name</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Connection string must have both SharedAccessKeyName and SharedAccessKey.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">shared_access_signature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">shared_access_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Only one of the SharedAccessKey or SharedAccessSignature must be present.&quot;</span>
            <span class="p">)</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="n">conn_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Endpoint&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Connection string is either blank or malformed.&quot;</span><span class="p">)</span>
        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">endpoint</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed</span><span class="o">.</span><span class="n">netloc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Endpoint on the Connection String.&quot;</span><span class="p">)</span>
        <span class="n">namespace</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">netloc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;fully_qualified_namespace&quot;</span><span class="p">:</span> <span class="n">namespace</span><span class="p">,</span>
            <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span> <span class="n">endpoint</span><span class="p">,</span>
            <span class="s2">&quot;eventhub_name&quot;</span><span class="p">:</span> <span class="n">conn_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;EntityPath&quot;</span><span class="p">),</span>
            <span class="s2">&quot;shared_access_signature&quot;</span><span class="p">:</span> <span class="n">shared_access_signature</span><span class="p">,</span>
            <span class="s2">&quot;shared_access_key_name&quot;</span><span class="p">:</span> <span class="n">shared_access_key_name</span><span class="p">,</span>
            <span class="s2">&quot;shared_access_key&quot;</span><span class="p">:</span> <span class="n">shared_access_key</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">properties</span>

    <span class="k">def</span> <span class="nf">_connection_string_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">connection_string</span> <span class="o">=</span> <span class="s2">&quot;Endpoint=&quot;</span> <span class="o">+</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;endpoint&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>

        <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shared_access_key&quot;</span><span class="p">):</span>
            <span class="n">connection_string</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;SharedAccessKey=&quot;</span> <span class="o">+</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shared_access_key&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shared_access_key_name&quot;</span><span class="p">):</span>
            <span class="n">connection_string</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;SharedAccessKeyName=&quot;</span> <span class="o">+</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shared_access_key_name&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shared_access_signature&quot;</span><span class="p">):</span>
            <span class="n">connection_string</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;SharedAccessSignature=&quot;</span>
                <span class="o">+</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shared_access_signature&quot;</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">connection_string</span>

    <span class="k">def</span> <span class="nf">_configure_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;subscribe&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;subscribe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_string_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;eventhub_name&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.bootstrap.servers&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.bootstrap.servers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_string_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fully_qualified_namespace&quot;</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;:9093&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.sasl.mechanism&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.sasl.mechanism&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PLAIN&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.security.protocol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.security.protocol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SASL_SSL&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.sasl.jaas.config&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">kafka_package</span> <span class="o">=</span> <span class="s2">&quot;org.apache.kafka.common.security.plain.PlainLoginModule&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;DATABRICKS_RUNTIME_VERSION&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="s2">&quot;_client&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="vm">__dict__</span>
                <span class="ow">and</span> <span class="s2">&quot;databricks&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">host</span>
            <span class="p">):</span>
                <span class="n">kafka_package</span> <span class="o">=</span> <span class="s2">&quot;kafkashaded.org.apache.kafka.common.security.plain.PlainLoginModule&quot;</span>
            <span class="n">connection_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_string_builder</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_string_properties</span>
            <span class="p">)</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.sasl.jaas.config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> required username=&quot;$ConnectionString&quot; password=&quot;</span><span class="si">{}</span><span class="s1">&quot;;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">kafka_package</span><span class="p">,</span> <span class="n">connection_string</span>
                <span class="p">)</span>
            <span class="p">)</span>  <span class="c1"># NOSONAR</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.request.timeout.ms&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.request.timeout.ms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;60000&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.session.timeout.ms&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.session.timeout.ms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;60000&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.group.id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.group.id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer_group</span>

        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;includeHeaders&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>

        <span class="k">return</span> <span class="n">options</span>

    <span class="k">def</span> <span class="nf">_transform_to_eventhub_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;headers&quot;</span><span class="p">,</span> <span class="n">map_from_entries</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;headers&quot;</span><span class="p">)))</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;partition&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;sequenceNumber&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;enqueuedTime&quot;</span><span class="p">),</span>
                <span class="p">(</span>
                    <span class="n">decode_kafka_headers_to_amqp_properties</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;headers&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
                        <span class="s2">&quot;properties&quot;</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_kafka_headers_to_amqp_properties</span>
                    <span class="k">else</span> <span class="n">create_map</span><span class="p">()</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;map&lt;string,string&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;x-opt-offset&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;publisher&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;x-opt-publisher&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;partitionKey&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;x-opt-partition-key&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;systemProperties&quot;</span><span class="p">,</span>
                <span class="n">map_filter</span><span class="p">(</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">eventhub_system_properties</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">,</span>
                <span class="n">map_filter</span><span class="p">(</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="o">~</span><span class="n">k</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">eventhub_system_properties</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;partition&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;sequenceNumber&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;enqueuedTime&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;publisher&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;partitionKey&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;systemProperties&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads batch data from Kafka.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_to_eventhub_schema</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads streaming data from Kafka.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_to_eventhub_schema</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/kafka_eventhub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads batch data from Kafka.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/kafka_eventhub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads batch data from Kafka.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_to_eventhub_schema</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads streaming data from Kafka.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/kafka_eventhub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads streaming data from Kafka.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_to_eventhub_schema</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisSource" class="doc doc-heading">
            <code>SparkKinesisSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>The Spark Kinesis Source is used to read data from Kinesis in a Databricks environment.
Structured streaming from Kinesis is <strong>not</strong> supported in open source Spark.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisSource--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkKinesisSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">kinesis_source</span> <span class="o">=</span> <span class="n">SparkKinesisSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;awsAccessKey&quot;</span><span class="p">:</span> <span class="s2">&quot;{AWS-ACCESS-KEY}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;awsSecretKey&quot;</span><span class="p">:</span> <span class="s2">&quot;{AWS-SECRET-KEY}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;streamName&quot;</span><span class="p">:</span> <span class="s2">&quot;{STREAM-NAME}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{REGION}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://kinesis.</span><span class="si">{REGION}</span><span class="s2">.amazonaws.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;initialPosition&quot;</span><span class="p">:</span> <span class="s2">&quot;earliest&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">kinesis_source</span><span class="o">.</span><span class="n">read_stream</span><span class="p">()</span>

<span class="n">OR</span>

<span class="n">kinesis_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session required to read data from Kinesis</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Options that can be specified for a Kinesis read operation (See Attributes table below). Further information on the options is available <a href="https://docs.databricks.com/structured-streaming/kinesis.html#configuration" target="_blank">here</a></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisSource.awsAccessKey">awsAccessKey</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>AWS access key.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisSource.awsSecretKey">awsSecretKey</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>AWS secret access key corresponding to the access key.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisSource.streamName">streamName</span></code></td>
            <td>
                  <code>List[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The stream names to subscribe to.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisSource.region">region</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The region the streams are defined in.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisSource.endpoint">endpoint</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The regional endpoint for Kinesis Data Streams.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisSource.initialPosition">initialPosition</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The point to start reading from; earliest, latest, or at_timestamp.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/kinesis.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkKinesisSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Spark Kinesis Source is used to read data from Kinesis in a Databricks environment.</span>
<span class="sd">    Structured streaming from Kinesis is **not** supported in open source Spark.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.sources import SparkKinesisSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    kinesis_source = SparkKinesisSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;awsAccessKey&quot;: &quot;{AWS-ACCESS-KEY}&quot;,</span>
<span class="sd">            &quot;awsSecretKey&quot;: &quot;{AWS-SECRET-KEY}&quot;,</span>
<span class="sd">            &quot;streamName&quot;: &quot;{STREAM-NAME}&quot;,</span>
<span class="sd">            &quot;region&quot;: &quot;{REGION}&quot;,</span>
<span class="sd">            &quot;endpoint&quot;: &quot;https://kinesis.{REGION}.amazonaws.com&quot;,</span>
<span class="sd">            &quot;initialPosition&quot;: &quot;earliest&quot;</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    kinesis_source.read_stream()</span>

<span class="sd">    OR</span>

<span class="sd">    kinesis_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session required to read data from Kinesis</span>
<span class="sd">        options (dict): Options that can be specified for a Kinesis read operation (See Attributes table below). Further information on the options is available [here](https://docs.databricks.com/structured-streaming/kinesis.html#configuration){ target=&quot;_blank&quot; }</span>

<span class="sd">    Attributes:</span>
<span class="sd">        awsAccessKey (str): AWS access key.</span>
<span class="sd">        awsSecretKey (str): AWS secret access key corresponding to the access key.</span>
<span class="sd">        streamName (List[str]): The stream names to subscribe to.</span>
<span class="sd">        region (str): The region the streams are defined in.</span>
<span class="sd">        endpoint (str): The regional endpoint for Kinesis Data Streams.</span>
<span class="sd">        initialPosition (str): The point to start reading from; earliest, latest, or at_timestamp.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">KINESIS_SCHEMA</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK_DATABRICKS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK_DATABRICKS</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: Kinesis only supports streaming reads. To perform a batch read, use the read_stream method of this component and specify the Trigger on the write_stream to be `availableNow=True` to perform batch-like reads of cloud storage files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Kinesis only supports streaming reads. To perform a batch read, use the read_stream method and specify Trigger on the write_stream as `availableNow=True`&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads streaming data from Kinesis. All of the data in the table is processed as well as any new data that arrives after the stream started.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kinesis&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisSource.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisSource.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK_DATABRICKS</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/kinesis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK_DATABRICKS</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK_DATABRICKS</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>NotImplementedError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Kinesis only supports streaming reads. To perform a batch read, use the read_stream method of this component and specify the Trigger on the write_stream to be <code>availableNow=True</code> to perform batch-like reads of cloud storage files.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/kinesis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: Kinesis only supports streaming reads. To perform a batch read, use the read_stream method of this component and specify the Trigger on the write_stream to be `availableNow=True` to perform batch-like reads of cloud storage files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="s2">&quot;Kinesis only supports streaming reads. To perform a batch read, use the read_stream method and specify Trigger on the write_stream as `availableNow=True`&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads streaming data from Kinesis. All of the data in the table is processed as well as any new data that arrives after the stream started.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/kinesis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads streaming data from Kinesis. All of the data in the table is processed as well as any new data that arrives after the stream started.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kinesis&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.BaseISOSource" class="doc doc-heading">
            <code>BaseISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseISOSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">iso_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="n">required_options</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)])</span>
    <span class="n">default_query_timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_timezone&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_query_timezone</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets data from external ISO API.</span>

<span class="sd">        Args:</span>
<span class="sd">            url_suffix: String to be used as suffix to iso url.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw content of the data received.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iso_url</span><span class="si">}{</span><span class="n">url_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting URL - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to access URL `</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Received status code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> with message </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datetime_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts string datetime into Python datetime object with configured format and timezone.</span>
<span class="sd">        Args:</span>
<span class="sd">            datetime_str: String to be converted into datetime.</span>

<span class="sd">        Returns: Timezone aware datetime object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">parsed_dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parsed_dt</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hits the fetch_from_url method with certain parameters to get raw data from API.</span>

<span class="sd">        All the children ISO classes must override this method and call the fetch_url method</span>
<span class="sd">        in it.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Raw DataFrame from API.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the basic transformations to prepare data for further processing.</span>
<span class="sd">        All the children ISO classes must override this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Raw DataFrame, received from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Modified DataFrame, ready for basic use.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Another data transformation helper method to be called after prepare data.</span>
<span class="sd">        Used for advance data processing such as cleaning, filtering, restructuring.</span>
<span class="sd">        All the children ISO classes must override this method if there is any post-processing required.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Initial modified version of DataFrame, received after preparing the data.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final version of data after all the fixes and modifications.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Entrypoint method to return the final version of DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Modified form of data for specific use case.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pull_data</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># Reorder columns to keep the data consistent</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the options checks. Raises exception in case of any invalid value.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures all the required options are provided and performs other validations.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

            <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame after all the processing.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.BaseISOSource.pre_read_validation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pre_read_validation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Ensures all the required options are provided and performs other validations.
Returns:
     True if all checks are passed.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures all the required options are provided and performs other validations.</span>
<span class="sd">    Returns:</span>
<span class="sd">         True if all checks are passed.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.BaseISOSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.
Returns:
     Final Spark DataFrame converted from Pandas DataFrame post-execution.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

        <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.BaseISOSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Final Spark DataFrame after all the processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame after all the processing.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ERCOTDailyLoadISOSource" class="doc doc-heading">
            <code>ERCOTDailyLoadISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.BaseISOSource" href="../../sources/spark/iso/pjm_historical_load_iso/#src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource">BaseISOSource</a></code></p>


      <p>The ERCOT Daily Load ISO Source is used to read daily load data from ERCOT using WebScrapping.
It supports actual and forecast data. To read more about the reports, visit the following URLs
(The urls are only accessible if the requester/client is in US)-</p>
<p>For load type <code>actual</code>: <a href="https://www.ercot.com/mp/data-products/
data-product-details?id=NP6-345-CD">Actual System Load by Weather Zone</a>
<br>
For load type <code>forecast</code>: <a href="https://www.ercot.com/mp/data-products/
data-product-details?id=NP3-561-CD">Seven-Day Load Forecast by Weather Zone</a></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations (See Attributes table below)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ERCOTDailyLoadISOSource.load_type">load_type</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be one of <code>actual</code> or <code>forecast</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ERCOTDailyLoadISOSource.date">date</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be in <code>YYYY-MM-DD</code> format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ERCOTDailyLoadISOSource.certificate_pfx_key">certificate_pfx_key</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The certificate key data or password received from ERCOT.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ERCOTDailyLoadISOSource.certificate_pfx_key_contents">certificate_pfx_key_contents</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The certificate data received from ERCOT, it could be base64 encoded.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Please check the BaseISOSource for available methods.</p>


<details class="baseisosource" open>
  <summary>BaseISOSource</summary>
  <div class="doc doc-object doc-module">



<a id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource" class="doc doc-heading">
            <code>BaseISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseISOSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">iso_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="n">required_options</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)])</span>
    <span class="n">default_query_timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_timezone&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_query_timezone</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets data from external ISO API.</span>

<span class="sd">        Args:</span>
<span class="sd">            url_suffix: String to be used as suffix to iso url.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw content of the data received.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iso_url</span><span class="si">}{</span><span class="n">url_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting URL - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to access URL `</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Received status code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> with message </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datetime_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts string datetime into Python datetime object with configured format and timezone.</span>
<span class="sd">        Args:</span>
<span class="sd">            datetime_str: String to be converted into datetime.</span>

<span class="sd">        Returns: Timezone aware datetime object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">parsed_dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parsed_dt</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hits the fetch_from_url method with certain parameters to get raw data from API.</span>

<span class="sd">        All the children ISO classes must override this method and call the fetch_url method</span>
<span class="sd">        in it.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Raw DataFrame from API.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the basic transformations to prepare data for further processing.</span>
<span class="sd">        All the children ISO classes must override this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Raw DataFrame, received from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Modified DataFrame, ready for basic use.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Another data transformation helper method to be called after prepare data.</span>
<span class="sd">        Used for advance data processing such as cleaning, filtering, restructuring.</span>
<span class="sd">        All the children ISO classes must override this method if there is any post-processing required.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Initial modified version of DataFrame, received after preparing the data.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final version of data after all the fixes and modifications.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Entrypoint method to return the final version of DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Modified form of data for specific use case.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pull_data</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># Reorder columns to keep the data consistent</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the options checks. Raises exception in case of any invalid value.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures all the required options are provided and performs other validations.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

            <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame after all the processing.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.pre_read_validation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pre_read_validation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Ensures all the required options are provided and performs other validations.
Returns:
     True if all checks are passed.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures all the required options are provided and performs other validations.</span>
<span class="sd">    Returns:</span>
<span class="sd">         True if all checks are passed.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.
Returns:
     Final Spark DataFrame converted from Pandas DataFrame post-execution.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

        <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Final Spark DataFrame after all the processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame after all the processing.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
</details>
              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/ercot_daily_load_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ERCOTDailyLoadISOSource</span><span class="p">(</span><span class="n">BaseISOSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ERCOT Daily Load ISO Source is used to read daily load data from ERCOT using WebScrapping.</span>
<span class="sd">    It supports actual and forecast data. To read more about the reports, visit the following URLs</span>
<span class="sd">    (The urls are only accessible if the requester/client is in US)-</span>

<span class="sd">    For load type `actual`: [Actual System Load by Weather Zone](https://www.ercot.com/mp/data-products/</span>
<span class="sd">    data-product-details?id=NP6-345-CD)</span>
<span class="sd">    &lt;br&gt;</span>
<span class="sd">    For load type `forecast`: [Seven-Day Load Forecast by Weather Zone](https://www.ercot.com/mp/data-products/</span>
<span class="sd">    data-product-details?id=NP3-561-CD)</span>


<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations (See Attributes table below)</span>

<span class="sd">    Attributes:</span>
<span class="sd">        load_type (list): Must be one of `actual` or `forecast`.</span>
<span class="sd">        date (str): Must be in `YYYY-MM-DD` format.</span>
<span class="sd">        certificate_pfx_key (str): The certificate key data or password received from ERCOT.</span>
<span class="sd">        certificate_pfx_key_contents (str): The certificate data received from ERCOT, it could be base64 encoded.</span>

<span class="sd">    Please check the BaseISOSource for available methods.</span>

<span class="sd">    BaseISOSource:</span>
<span class="sd">        ::: src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">url_forecast</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://mis.ercot.com/misapp/GetReports.do?reportTypeId=12312&quot;</span>
    <span class="n">url_actual</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://mis.ercot.com/misapp/GetReports.do?reportTypeId=13101&quot;</span>
    <span class="n">url_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://mis.ercot.com&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="n">required_options</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;load_type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;certificate_pfx_key&quot;</span><span class="p">,</span>
        <span class="s2">&quot;certificate_pfx_key_contents&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">ERCOT_SCHEMA</span>
    <span class="n">default_query_timezone</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;load_type&quot;</span><span class="p">,</span> <span class="s2">&quot;actual&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">certificate_pfx_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;certificate_pfx_key&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">certificate_pfx_key_contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;certificate_pfx_key_contents&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">generate_temp_client_cert_files_from_pfx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">certificate_pfx_key</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">pfx</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">certificate_pfx_key_contents</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">pfx</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">certificate_pfx_key_contents</span><span class="o">.</span><span class="n">encode</span><span class="p">():</span>
            <span class="n">pfx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">certificate_pfx_key_contents</span>

        <span class="n">key</span><span class="p">,</span> <span class="n">cert</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pkcs12</span><span class="o">.</span><span class="n">load_key_and_certificates</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pfx</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="n">key_bytes</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">private_bytes</span><span class="p">(</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">serialization</span><span class="o">.</span><span class="n">Encoding</span><span class="o">.</span><span class="n">PEM</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="n">serialization</span><span class="o">.</span><span class="n">PrivateFormat</span><span class="o">.</span><span class="n">TraditionalOpenSSL</span><span class="p">,</span>
            <span class="n">encryption_algorithm</span><span class="o">=</span><span class="n">serialization</span><span class="o">.</span><span class="n">NoEncryption</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="n">cert_bytes</span> <span class="o">=</span> <span class="n">cert</span><span class="o">.</span><span class="n">public_bytes</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">serialization</span><span class="o">.</span><span class="n">Encoding</span><span class="o">.</span><span class="n">PEM</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">TempCertFiles</span><span class="p">(</span><span class="n">cert_bytes</span><span class="p">,</span> <span class="n">key_bytes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pulls data from the ERCOT API and parses the zip files for CSV data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw form of data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">load_type</span><span class="si">}</span><span class="s2"> data for date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_forecast</span>
        <span class="n">req_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="o">==</span> <span class="s2">&quot;actual&quot;</span><span class="p">:</span>
            <span class="n">req_date</span> <span class="o">=</span> <span class="n">req_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_actual</span>

        <span class="n">url_lists</span><span class="p">,</span> <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_urls_for_zip</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">req_date</span><span class="p">)</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">url_lists</span><span class="p">)</span><span class="si">}</span><span class="s2"> URLs - </span><span class="si">{</span><span class="n">url_lists</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting files - </span><span class="si">{</span><span class="n">files</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">url_lists</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_zip</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">final_df</span>

    <span class="k">def</span> <span class="nf">download_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading zip using </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_temp_client_cert_files_from_pfx</span><span class="p">()</span> <span class="k">as</span> <span class="n">cert</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">cert</span><span class="o">=</span><span class="n">cert</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="s2">&quot;Empty Response was returned&quot;</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unzipping the file&quot;</span><span class="p">)</span>
        <span class="n">zf</span> <span class="o">=</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
        <span class="n">csvs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">zf</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;.csv&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">csvs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No data was found in the specified interval&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">csvs</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">generate_urls_for_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finding urls list for date </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_temp_client_cert_files_from_pfx</span><span class="p">()</span> <span class="k">as</span> <span class="n">cert</span><span class="p">:</span>
            <span class="n">page_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cert</span><span class="o">=</span><span class="n">cert</span><span class="p">)</span>

        <span class="n">page_content</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">page_response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
        <span class="n">zip_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">page_content</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;td&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;labelOptional_ind&quot;</span><span class="p">}))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
            <span class="n">zip_name</span> <span class="o">=</span> <span class="n">page_content</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;td&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;labelOptional_ind&quot;</span><span class="p">})[</span>
                <span class="n">i</span>
            <span class="p">]</span><span class="o">.</span><span class="n">text</span>
            <span class="n">zip_link</span> <span class="o">=</span> <span class="n">page_content</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
            <span class="n">zip_info</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">zip_name</span><span class="p">,</span> <span class="n">zip_link</span><span class="p">))</span>

        <span class="n">date_str</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">zip_info</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">filter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">f_info</span><span class="p">:</span> <span class="n">f_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;csv.zip&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">date_str</span> <span class="ow">in</span> <span class="n">f_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">zip_info</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zip_info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No file was found for date - </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># As Forecast is generated every hour, pick the latest one.</span>
        <span class="n">zip_info</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">zip_info</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">zip_info_item</span> <span class="o">=</span> <span class="n">zip_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">file_name</span><span class="p">,</span> <span class="n">file_url</span> <span class="o">=</span> <span class="n">zip_info_item</span>
        <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url_prefix</span> <span class="o">+</span> <span class="n">file_url</span><span class="p">)</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">urls</span><span class="p">,</span> <span class="n">files</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="o">==</span> <span class="s2">&quot;actual&quot;</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;OperDay&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y&quot;</span><span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;COAST&quot;</span><span class="p">:</span> <span class="s2">&quot;Coast&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;EAST&quot;</span><span class="p">:</span> <span class="s2">&quot;East&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;FAR_WEST&quot;</span><span class="p">:</span> <span class="s2">&quot;FarWest&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;NORTH&quot;</span><span class="p">:</span> <span class="s2">&quot;North&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;NORTH_C&quot;</span><span class="p">:</span> <span class="s2">&quot;NorthCentral&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;SOUTH_C&quot;</span><span class="p">:</span> <span class="s2">&quot;SouthCentral&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;SOUTHERN&quot;</span><span class="p">:</span> <span class="s2">&quot;Southern&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;WEST&quot;</span><span class="p">:</span> <span class="s2">&quot;West&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;TOTAL&quot;</span><span class="p">:</span> <span class="s2">&quot;SystemTotal&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;DSTFlag&quot;</span><span class="p">:</span> <span class="s2">&quot;DstFlag&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;DSTFlag&quot;</span><span class="p">:</span> <span class="s2">&quot;DstFlag&quot;</span><span class="p">})</span>

            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;DeliveryDate&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to parse date. Please specify in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="si">}</span><span class="s2"> format.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MISODailyLoadISOSource" class="doc doc-heading">
            <code>MISODailyLoadISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.BaseISOSource" href="../../sources/spark/iso/pjm_historical_load_iso/#src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource">BaseISOSource</a></code></p>


      <p>The MISO Daily Load ISO Source is used to read daily load data from MISO API. It supports both Actual and Forecast data.</p>
<p>To read more about the available reports from MISO API, download the file -
<a href="https://cdn.misoenergy.org/Market%20Reports%20Directory115139.xlsx">Market Reports</a></p>
<p>From the list of reports in the file, it pulls the report named
<code>Daily Forecast and Actual Load by Local Resource Zone</code>.</p>
<p>Actual data is available for one day minus from the given date.</p>
<p>Forecast data is available for next 6 day (inclusive of given date).</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MISODailyLoadISOSource--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">MISODailyLoadISOSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">miso_source</span> <span class="o">=</span> <span class="n">MISODailyLoadISOSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;load_type&quot;</span><span class="p">:</span> <span class="s2">&quot;actual&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;20230520&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">miso_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations (See Attributes table below)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MISODailyLoadISOSource.load_type">load_type</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be one of <code>actual</code> or <code>forecast</code></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MISODailyLoadISOSource.date">date</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be in <code>YYYYMMDD</code> format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Please check the BaseISOSource for available methods.</p>


<details class="baseisosource" open>
  <summary>BaseISOSource</summary>
  <div class="doc doc-object doc-module">



<a id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource" class="doc doc-heading">
            <code>BaseISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseISOSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">iso_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="n">required_options</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)])</span>
    <span class="n">default_query_timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_timezone&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_query_timezone</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets data from external ISO API.</span>

<span class="sd">        Args:</span>
<span class="sd">            url_suffix: String to be used as suffix to iso url.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw content of the data received.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iso_url</span><span class="si">}{</span><span class="n">url_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting URL - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to access URL `</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Received status code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> with message </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datetime_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts string datetime into Python datetime object with configured format and timezone.</span>
<span class="sd">        Args:</span>
<span class="sd">            datetime_str: String to be converted into datetime.</span>

<span class="sd">        Returns: Timezone aware datetime object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">parsed_dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parsed_dt</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hits the fetch_from_url method with certain parameters to get raw data from API.</span>

<span class="sd">        All the children ISO classes must override this method and call the fetch_url method</span>
<span class="sd">        in it.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Raw DataFrame from API.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the basic transformations to prepare data for further processing.</span>
<span class="sd">        All the children ISO classes must override this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Raw DataFrame, received from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Modified DataFrame, ready for basic use.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Another data transformation helper method to be called after prepare data.</span>
<span class="sd">        Used for advance data processing such as cleaning, filtering, restructuring.</span>
<span class="sd">        All the children ISO classes must override this method if there is any post-processing required.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Initial modified version of DataFrame, received after preparing the data.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final version of data after all the fixes and modifications.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Entrypoint method to return the final version of DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Modified form of data for specific use case.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pull_data</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># Reorder columns to keep the data consistent</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the options checks. Raises exception in case of any invalid value.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures all the required options are provided and performs other validations.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

            <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame after all the processing.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.pre_read_validation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pre_read_validation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Ensures all the required options are provided and performs other validations.
Returns:
     True if all checks are passed.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures all the required options are provided and performs other validations.</span>
<span class="sd">    Returns:</span>
<span class="sd">         True if all checks are passed.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.
Returns:
     Final Spark DataFrame converted from Pandas DataFrame post-execution.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

        <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Final Spark DataFrame after all the processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame after all the processing.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
</details>
              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/miso_daily_load_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MISODailyLoadISOSource</span><span class="p">(</span><span class="n">BaseISOSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The MISO Daily Load ISO Source is used to read daily load data from MISO API. It supports both Actual and Forecast data.</span>

<span class="sd">    To read more about the available reports from MISO API, download the file -</span>
<span class="sd">    [Market Reports](https://cdn.misoenergy.org/Market%20Reports%20Directory115139.xlsx)</span>

<span class="sd">    From the list of reports in the file, it pulls the report named</span>
<span class="sd">    `Daily Forecast and Actual Load by Local Resource Zone`.</span>

<span class="sd">    Actual data is available for one day minus from the given date.</span>

<span class="sd">    Forecast data is available for next 6 day (inclusive of given date).</span>


<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.sources import MISODailyLoadISOSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    miso_source = MISODailyLoadISOSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;load_type&quot;: &quot;actual&quot;,</span>
<span class="sd">            &quot;date&quot;: &quot;20230520&quot;,</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    miso_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations (See Attributes table below)</span>

<span class="sd">    Attributes:</span>
<span class="sd">        load_type (str): Must be one of `actual` or `forecast`</span>
<span class="sd">        date (str): Must be in `YYYYMMDD` format.</span>

<span class="sd">    Please check the BaseISOSource for available methods.</span>

<span class="sd">    BaseISOSource:</span>
<span class="sd">        ::: src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">iso_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://docs.misoenergy.org/marketreports/&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="n">required_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;load_type&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">]</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">MISO_SCHEMA</span>
    <span class="n">default_query_timezone</span> <span class="o">=</span> <span class="s2">&quot;US/Central&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;load_type&quot;</span><span class="p">,</span> <span class="s2">&quot;actual&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pulls data from the MISO API and parses the Excel file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw form of data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">load_type</span><span class="si">}</span><span class="s2"> data for date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">_df_al.xls&quot;</span><span class="p">),</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new `date_time` column and removes null values.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Raw form of data received from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Data after basic transformations.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;HourEnding&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;HourEnding&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;MISO MTLF (MWh)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()],</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Market Day&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;date_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;HourEnding&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span>
        <span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;HourEnding&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">data_cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s2">&quot;date_time&quot;</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="n">data_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">data_cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter outs Actual or Forecast data based on `load_type`.</span>
<span class="sd">        Args:</span>
<span class="sd">            df: Data received after preparation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Final data either containing Actual or Forecast values.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">skip_col_suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="o">==</span> <span class="s2">&quot;actual&quot;</span><span class="p">:</span>
            <span class="n">skip_col_suffix</span> <span class="o">=</span> <span class="s2">&quot;MTLF (MWh)&quot;</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="o">==</span> <span class="s2">&quot;forecast&quot;</span><span class="p">:</span>
            <span class="n">skip_col_suffix</span> <span class="o">=</span> <span class="s2">&quot;ActualLoad (MWh)&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">skip_col_suffix</span><span class="p">)]]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="n">rename_cols</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;LRZ1&quot;</span><span class="p">:</span> <span class="s2">&quot;Lrz1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LRZ2_7&quot;</span><span class="p">:</span> <span class="s2">&quot;Lrz2_7&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LRZ3_5&quot;</span><span class="p">:</span> <span class="s2">&quot;Lrz3_5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LRZ4&quot;</span><span class="p">:</span> <span class="s2">&quot;Lrz4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LRZ6&quot;</span><span class="p">:</span> <span class="s2">&quot;Lrz6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LRZ8_9_10&quot;</span><span class="p">:</span> <span class="s2">&quot;Lrz8_9_10&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MISO&quot;</span><span class="p">:</span> <span class="s2">&quot;Miso&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DATE_TIME&quot;</span><span class="p">:</span> <span class="s2">&quot;Datetime&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename_cols</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the following options:</span>
<span class="sd">            - `date` must be in the correct format.</span>
<span class="sd">            - `load_type` must be valid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if all looks good otherwise raises Exception.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unable to parse Date. Please specify in YYYYMMDD format.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">date</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query date can&#39;t be in future.&quot;</span><span class="p">)</span>

        <span class="n">valid_load_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;actual&quot;</span><span class="p">,</span> <span class="s2">&quot;forecast&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_load_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid load_type `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">load_type</span><span class="si">}</span><span class="s2">` given. Supported values are </span><span class="si">{</span><span class="n">valid_load_types</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MISOHistoricalLoadISOSource" class="doc doc-heading">
            <code>MISOHistoricalLoadISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.MISODailyLoadISOSource" href="../../sources/spark/iso/miso_daily_load_iso/#src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.miso_daily_load_iso.MISODailyLoadISOSource">MISODailyLoadISOSource</a></code></p>


      <p>The MISO Historical Load ISO Source is used to read historical load data from MISO API.</p>
<p>To read more about the available reports from MISO API, download the file -
 <a href="https://cdn.misoenergy.org/Market%20Reports%20Directory115139.xlsx">Market Reports</a></p>
<p>From the list of reports in the file, it pulls the report named
 <code>Historical Daily Forecast and Actual Load by Local Resource Zone</code>.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MISOHistoricalLoadISOSource--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">MISOHistoricalLoadISOSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">miso_source</span> <span class="o">=</span> <span class="n">MISOHistoricalLoadISOSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;20230510&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;20230520&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">miso_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations (See Attributes table below)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MISOHistoricalLoadISOSource.start_date">start_date</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be in <code>YYYYMMDD</code> format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MISOHistoricalLoadISOSource.end_date">end_date</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be in <code>YYYYMMDD</code> format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MISOHistoricalLoadISOSource.fill_missing">fill_missing</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set to <code>"true"</code> to fill missing Actual load with Forecast load. Default - <code>true</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Please check the BaseISOSource for available methods.</p>


<details class="baseisosource" open>
  <summary>BaseISOSource</summary>
  <div class="doc doc-object doc-module">



<a id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource" class="doc doc-heading">
            <code>BaseISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseISOSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">iso_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="n">required_options</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)])</span>
    <span class="n">default_query_timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_timezone&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_query_timezone</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets data from external ISO API.</span>

<span class="sd">        Args:</span>
<span class="sd">            url_suffix: String to be used as suffix to iso url.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw content of the data received.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iso_url</span><span class="si">}{</span><span class="n">url_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting URL - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to access URL `</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Received status code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> with message </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datetime_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts string datetime into Python datetime object with configured format and timezone.</span>
<span class="sd">        Args:</span>
<span class="sd">            datetime_str: String to be converted into datetime.</span>

<span class="sd">        Returns: Timezone aware datetime object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">parsed_dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parsed_dt</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hits the fetch_from_url method with certain parameters to get raw data from API.</span>

<span class="sd">        All the children ISO classes must override this method and call the fetch_url method</span>
<span class="sd">        in it.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Raw DataFrame from API.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the basic transformations to prepare data for further processing.</span>
<span class="sd">        All the children ISO classes must override this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Raw DataFrame, received from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Modified DataFrame, ready for basic use.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Another data transformation helper method to be called after prepare data.</span>
<span class="sd">        Used for advance data processing such as cleaning, filtering, restructuring.</span>
<span class="sd">        All the children ISO classes must override this method if there is any post-processing required.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Initial modified version of DataFrame, received after preparing the data.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final version of data after all the fixes and modifications.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Entrypoint method to return the final version of DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Modified form of data for specific use case.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pull_data</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># Reorder columns to keep the data consistent</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the options checks. Raises exception in case of any invalid value.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures all the required options are provided and performs other validations.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

            <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame after all the processing.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.pre_read_validation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pre_read_validation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Ensures all the required options are provided and performs other validations.
Returns:
     True if all checks are passed.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures all the required options are provided and performs other validations.</span>
<span class="sd">    Returns:</span>
<span class="sd">         True if all checks are passed.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.
Returns:
     Final Spark DataFrame converted from Pandas DataFrame post-execution.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

        <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Final Spark DataFrame after all the processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame after all the processing.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
</details>
              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/miso_historical_load_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MISOHistoricalLoadISOSource</span><span class="p">(</span><span class="n">MISODailyLoadISOSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The MISO Historical Load ISO Source is used to read historical load data from MISO API.</span>

<span class="sd">    To read more about the available reports from MISO API, download the file -</span>
<span class="sd">     [Market Reports](https://cdn.misoenergy.org/Market%20Reports%20Directory115139.xlsx)</span>

<span class="sd">    From the list of reports in the file, it pulls the report named</span>
<span class="sd">     `Historical Daily Forecast and Actual Load by Local Resource Zone`.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.sources import MISOHistoricalLoadISOSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    miso_source = MISOHistoricalLoadISOSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;start_date&quot;: &quot;20230510&quot;,</span>
<span class="sd">            &quot;end_date&quot;: &quot;20230520&quot;,</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    miso_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations (See Attributes table below)</span>

<span class="sd">    Attributes:</span>
<span class="sd">        start_date (str): Must be in `YYYYMMDD` format.</span>
<span class="sd">        end_date (str): Must be in `YYYYMMDD` format.</span>
<span class="sd">        fill_missing (str): Set to `&quot;true&quot;` to fill missing Actual load with Forecast load. Default - `true`.</span>

<span class="sd">    Please check the BaseISOSource for available methods.</span>

<span class="sd">    BaseISOSource:</span>
<span class="sd">        ::: src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">required_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_missing</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fill_missing&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_historical_data_for_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting historical data for date </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span><span class="si">}</span><span class="s2">_dfal_HIST.xls&quot;</span>
            <span class="p">),</span>
            <span class="n">skiprows</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">12</span> <span class="ow">and</span> <span class="n">date</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">31</span><span class="p">:</span>
            <span class="n">expected_year_rows</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">7</span>
            <span class="p">)</span>  <span class="c1"># Every hour has 7 zones.</span>
            <span class="n">received_year_rows</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;MarketDay&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;MarketDay&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">2</span>
            <span class="p">)</span>  <span class="c1"># Last 2 rows are invalid.</span>

            <span class="k">if</span> <span class="n">expected_year_rows</span> <span class="o">!=</span> <span class="n">received_year_rows</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Didn&#39;t receive full year historical data for year </span><span class="si">{</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; Expected </span><span class="si">{</span><span class="n">expected_year_rows</span><span class="si">}</span><span class="s2"> but Received </span><span class="si">{</span><span class="n">received_year_rows</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pulls data from the MISO API and parses the Excel file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw form of data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Historical load requested from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>

        <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
            <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="n">inclusive</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated date ranges are - </span><span class="si">{</span><span class="n">dates</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Collect all historical data on yearly basis.</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_historical_data_for_date</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates</span>
            <span class="p">],</span>
            <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new `Datetime` column, removes null values and pivots the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Raw form of data received from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Data after basic transformations and pivoting.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;MarketDay&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;MarketDay&quot;</span><span class="p">]</span>

        <span class="c1"># Fill missing actual values with the forecast values to avoid gaps.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_missing</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">({</span><span class="s2">&quot;ActualLoad (MWh)&quot;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;MTLF (MWh)&quot;</span><span class="p">]})</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;MarketDay&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
                <span class="s2">&quot;HourEnding&quot;</span><span class="p">:</span> <span class="s2">&quot;hour&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ActualLoad (MWh)&quot;</span><span class="p">:</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span>
                <span class="s2">&quot;LoadResource Zone&quot;</span><span class="p">:</span> <span class="s2">&quot;zone&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;date_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span>
        <span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;load&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;load&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="s2">&quot;date_time&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;zone&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="n">rename_cols</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;LRZ1&quot;</span><span class="p">:</span> <span class="s2">&quot;Lrz1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LRZ2_7&quot;</span><span class="p">:</span> <span class="s2">&quot;Lrz2_7&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LRZ3_5&quot;</span><span class="p">:</span> <span class="s2">&quot;Lrz3_5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LRZ4&quot;</span><span class="p">:</span> <span class="s2">&quot;Lrz4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LRZ6&quot;</span><span class="p">:</span> <span class="s2">&quot;Lrz6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LRZ8_9_10&quot;</span><span class="p">:</span> <span class="s2">&quot;Lrz8_9_10&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MISO&quot;</span><span class="p">:</span> <span class="s2">&quot;Miso&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DATE_TIME&quot;</span><span class="p">:</span> <span class="s2">&quot;Datetime&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename_cols</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter outs data outside the requested date range.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Data received after preparation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Final data after all the transformations.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">hour</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">59</span>
        <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Datetime&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Datetime&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
        <span class="p">]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Datetime&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">expected_rows</span> <span class="o">=</span> <span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="p">)</span> <span class="o">-</span> <span class="n">start_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span>

        <span class="n">actual_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rows Expected = </span><span class="si">{</span><span class="n">expected_rows</span><span class="si">}</span><span class="s2">, Rows Found = </span><span class="si">{</span><span class="n">actual_rows</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the following options:</span>
<span class="sd">            - `start_date` &amp; `end_data` must be in the correct format.</span>
<span class="sd">            - `start_date` must be behind `end_data`.</span>
<span class="sd">            - `start_date` must not be in the future (UTC).</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if all looks good otherwise raises Exception.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to parse Start date. Please specify in YYYYMMDD format.&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to parse End date. Please specify in YYYYMMDD format.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">start_date</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start date can&#39;t be in future.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start_date</span> <span class="o">&gt;</span> <span class="n">end_date</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start date can&#39;t be ahead of End date.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMDailyLoadISOSource" class="doc doc-heading">
            <code>PJMDailyLoadISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.BaseISOSource" href="../../sources/spark/iso/pjm_historical_load_iso/#src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource">BaseISOSource</a></code></p>


      <p>The PJM Daily Load ISO Source is used to read daily load data from PJM API.
It supports both Actual and Forecast data. Actual will return 1 day, Forecast will return 7 days.</p>
<p>To read more about the reports, visit the following URLs -
<br>
Actual doc:    <a href="https://dataminer2.pjm.com/feed/ops_sum_prev_period/definition">ops_sum_prev_period</a>
<br>
Forecast doc:  <a href="https://dataminer2.pjm.com/feed/load_frcstd_7_day/definition">load_frcstd_7_day</a></p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMDailyLoadISOSource--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">PJMDailyLoadISOSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">pjm_source</span> <span class="o">=</span> <span class="n">PJMDailyLoadISOSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{api_key}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;load_type&quot;</span><span class="p">:</span> <span class="s2">&quot;actual&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">pjm_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations (See Attributes table below)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMDailyLoadISOSource.api_key">api_key</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be a valid key from PJM, see api url</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMDailyLoadISOSource.load_type">load_type</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be one of <code>actual</code> or <code>forecast</code></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Please check the BaseISOSource for available methods.</p>


<details class="baseisosource" open>
  <summary>BaseISOSource</summary>
  <div class="doc doc-object doc-module">



<a id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource" class="doc doc-heading">
            <code>BaseISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseISOSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">iso_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="n">required_options</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)])</span>
    <span class="n">default_query_timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_timezone&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_query_timezone</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets data from external ISO API.</span>

<span class="sd">        Args:</span>
<span class="sd">            url_suffix: String to be used as suffix to iso url.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw content of the data received.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iso_url</span><span class="si">}{</span><span class="n">url_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting URL - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to access URL `</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Received status code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> with message </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datetime_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts string datetime into Python datetime object with configured format and timezone.</span>
<span class="sd">        Args:</span>
<span class="sd">            datetime_str: String to be converted into datetime.</span>

<span class="sd">        Returns: Timezone aware datetime object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">parsed_dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parsed_dt</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hits the fetch_from_url method with certain parameters to get raw data from API.</span>

<span class="sd">        All the children ISO classes must override this method and call the fetch_url method</span>
<span class="sd">        in it.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Raw DataFrame from API.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the basic transformations to prepare data for further processing.</span>
<span class="sd">        All the children ISO classes must override this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Raw DataFrame, received from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Modified DataFrame, ready for basic use.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Another data transformation helper method to be called after prepare data.</span>
<span class="sd">        Used for advance data processing such as cleaning, filtering, restructuring.</span>
<span class="sd">        All the children ISO classes must override this method if there is any post-processing required.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Initial modified version of DataFrame, received after preparing the data.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final version of data after all the fixes and modifications.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Entrypoint method to return the final version of DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Modified form of data for specific use case.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pull_data</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># Reorder columns to keep the data consistent</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the options checks. Raises exception in case of any invalid value.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures all the required options are provided and performs other validations.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

            <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame after all the processing.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.pre_read_validation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pre_read_validation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Ensures all the required options are provided and performs other validations.
Returns:
     True if all checks are passed.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures all the required options are provided and performs other validations.</span>
<span class="sd">    Returns:</span>
<span class="sd">         True if all checks are passed.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.
Returns:
     Final Spark DataFrame converted from Pandas DataFrame post-execution.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

        <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Final Spark DataFrame after all the processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame after all the processing.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
</details>
              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/pjm_daily_load_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PJMDailyLoadISOSource</span><span class="p">(</span><span class="n">BaseISOSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The PJM Daily Load ISO Source is used to read daily load data from PJM API.</span>
<span class="sd">    It supports both Actual and Forecast data. Actual will return 1 day, Forecast will return 7 days.</span>

<span class="sd">    To read more about the reports, visit the following URLs -</span>
<span class="sd">    &lt;br&gt;</span>
<span class="sd">    Actual doc:    [ops_sum_prev_period](https://dataminer2.pjm.com/feed/ops_sum_prev_period/definition)</span>
<span class="sd">    &lt;br&gt;</span>
<span class="sd">    Forecast doc:  [load_frcstd_7_day](https://dataminer2.pjm.com/feed/load_frcstd_7_day/definition)</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.sources import PJMDailyLoadISOSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    pjm_source = PJMDailyLoadISOSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;api_key&quot;: &quot;{api_key}&quot;,</span>
<span class="sd">            &quot;load_type&quot;: &quot;actual&quot;</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    pjm_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations (See Attributes table below)</span>

<span class="sd">    Attributes:</span>
<span class="sd">        api_key (str): Must be a valid key from PJM, see api url</span>
<span class="sd">        load_type (str): Must be one of `actual` or `forecast`</span>

<span class="sd">    Please check the BaseISOSource for available methods.</span>

<span class="sd">    BaseISOSource:</span>
<span class="sd">        ::: src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">PJM_SCHEMA</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">iso_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://api.pjm.com/api/v1/&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span>
    <span class="n">required_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="s2">&quot;load_type&quot;</span><span class="p">]</span>
    <span class="n">default_query_timezone</span> <span class="o">=</span> <span class="s2">&quot;US/Eastern&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;load_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;days&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets data from external ISO API.</span>

<span class="sd">        Args:</span>
<span class="sd">            url_suffix: String to be used as suffix to iso url.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw content of the data received.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iso_url</span><span class="si">}{</span><span class="n">url_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Ocp-Apim-Subscription-Key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">}</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Requesting URL - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">, start_date=</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">, end_date=</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">, load_type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">load_type</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">load_key</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;datetime_beginning_ept&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="o">!=</span> <span class="s2">&quot;forecast&quot;</span>
            <span class="k">else</span> <span class="s2">&quot;forecast_datetime_beginning_ept&quot;</span>
        <span class="p">)</span>
        <span class="n">feed</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;ops_sum_prev_period&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="o">!=</span> <span class="s2">&quot;forecast&quot;</span>
            <span class="k">else</span> <span class="s2">&quot;load_frcstd_7_day&quot;</span>
        <span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;startRow&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="n">load_key</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">to</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;csv&quot;</span><span class="p">,</span>
            <span class="s2">&quot;download&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">query_s</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;=&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">new_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}{</span><span class="n">feed</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">query_s</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">new_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">requests</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to access URL `</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Received status code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> with message </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pulls data from the PJM API and parses the return.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw form of data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">days</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
        <span class="n">start_date_str</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
        <span class="n">end_date_str</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">start_date_str</span><span class="p">,</span> <span class="n">end_date_str</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new date time column and removes null values. Renames columns</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Raw form of data received from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Data after basic transformations.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="o">==</span> <span class="s2">&quot;forecast&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;forecast_datetime_beginning_utc&quot;</span><span class="p">:</span> <span class="s2">&quot;start_time&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;forecast_area&quot;</span><span class="p">:</span> <span class="s2">&quot;zone&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;forecast_datetime_ending_utc&quot;</span><span class="p">:</span> <span class="s2">&quot;end_time&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;forecast_load_mw&quot;</span><span class="p">:</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;datetime_beginning_utc&quot;</span><span class="p">:</span> <span class="s2">&quot;start_time&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="s2">&quot;zone&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;datetime_ending_utc&quot;</span><span class="p">:</span> <span class="s2">&quot;end_time&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;actual_load&quot;</span><span class="p">:</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;zone&quot;</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">]]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

        <span class="n">date_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">date_cols</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y %I:%M:%S %p&quot;</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;load&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;load&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>

        <span class="n">rename_cols</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;START_TIME&quot;</span><span class="p">:</span> <span class="s2">&quot;StartTime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;END_TIME&quot;</span><span class="p">:</span> <span class="s2">&quot;EndTime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ZONE&quot;</span><span class="p">:</span> <span class="s2">&quot;Zone&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LOAD&quot;</span><span class="p">:</span> <span class="s2">&quot;Load&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename_cols</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the following options:</span>
<span class="sd">            - `load_type` must be valid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if all looks good otherwise raises Exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">valid_load_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;actual&quot;</span><span class="p">,</span> <span class="s2">&quot;forecast&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_load_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid load_type `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">load_type</span><span class="si">}</span><span class="s2">` given. Supported values are </span><span class="si">{</span><span class="n">valid_load_types</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMDailyPricingISOSource" class="doc doc-heading">
            <code>PJMDailyPricingISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.BaseISOSource" href="../../sources/spark/iso/pjm_historical_load_iso/#src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource">BaseISOSource</a></code></p>


      <p>The PJM Daily Pricing ISO Source is used to retrieve Real-Time and Day-Ahead hourly data from PJM API.
Real-Time will return data for T - 3 to T days and Day-Ahead will return T - 3 to T + 1 days data.</p>
<p>API:             <a href="https://api.pjm.com/api/v1/">https://api.pjm.com/api/v1/</a>  (must be a valid apy key from PJM)</p>
<p>Real-Time doc:    <a href="https://dataminer2.pjm.com/feed/rt_hrl_lmps/definition">https://dataminer2.pjm.com/feed/rt_hrl_lmps/definition</a></p>
<p>Day-Ahead doc:    <a href="https://dataminer2.pjm.com/feed/da_hrl_lmps/definition">https://dataminer2.pjm.com/feed/da_hrl_lmps/definition</a></p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMDailyPricingISOSource--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">PJMDailyPricingISOSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">pjm_source</span> <span class="o">=</span> <span class="n">PJMDailyPricingISOSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{api_key}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;load_type&quot;</span><span class="p">:</span> <span class="s2">&quot;real_time&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">pjm_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations (See Attributes table below)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMDailyPricingISOSource.api_key">api_key</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be a valid key from PJM, see api url</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMDailyPricingISOSource.load_type">load_type</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be one of <code>real_time</code> or <code>day_ahead</code></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Please check the BaseISOSource for available methods.</p>


<details class="baseisosource" open>
  <summary>BaseISOSource</summary>
  <div class="doc doc-object doc-module">



<a id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource" class="doc doc-heading">
            <code>BaseISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseISOSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">iso_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="n">required_options</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)])</span>
    <span class="n">default_query_timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_timezone&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_query_timezone</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets data from external ISO API.</span>

<span class="sd">        Args:</span>
<span class="sd">            url_suffix: String to be used as suffix to iso url.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw content of the data received.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iso_url</span><span class="si">}{</span><span class="n">url_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting URL - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to access URL `</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Received status code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> with message </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datetime_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts string datetime into Python datetime object with configured format and timezone.</span>
<span class="sd">        Args:</span>
<span class="sd">            datetime_str: String to be converted into datetime.</span>

<span class="sd">        Returns: Timezone aware datetime object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">parsed_dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parsed_dt</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hits the fetch_from_url method with certain parameters to get raw data from API.</span>

<span class="sd">        All the children ISO classes must override this method and call the fetch_url method</span>
<span class="sd">        in it.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Raw DataFrame from API.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the basic transformations to prepare data for further processing.</span>
<span class="sd">        All the children ISO classes must override this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Raw DataFrame, received from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Modified DataFrame, ready for basic use.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Another data transformation helper method to be called after prepare data.</span>
<span class="sd">        Used for advance data processing such as cleaning, filtering, restructuring.</span>
<span class="sd">        All the children ISO classes must override this method if there is any post-processing required.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Initial modified version of DataFrame, received after preparing the data.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final version of data after all the fixes and modifications.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Entrypoint method to return the final version of DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Modified form of data for specific use case.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pull_data</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># Reorder columns to keep the data consistent</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the options checks. Raises exception in case of any invalid value.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures all the required options are provided and performs other validations.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

            <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame after all the processing.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.pre_read_validation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pre_read_validation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Ensures all the required options are provided and performs other validations.
Returns:
     True if all checks are passed.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures all the required options are provided and performs other validations.</span>
<span class="sd">    Returns:</span>
<span class="sd">         True if all checks are passed.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.
Returns:
     Final Spark DataFrame converted from Pandas DataFrame post-execution.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

        <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Final Spark DataFrame after all the processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame after all the processing.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
</details>
              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/pjm_daily_pricing_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PJMDailyPricingISOSource</span><span class="p">(</span><span class="n">BaseISOSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The PJM Daily Pricing ISO Source is used to retrieve Real-Time and Day-Ahead hourly data from PJM API.</span>
<span class="sd">    Real-Time will return data for T - 3 to T days and Day-Ahead will return T - 3 to T + 1 days data.</span>

<span class="sd">    API:             &lt;a href=&quot;https://api.pjm.com/api/v1/&quot;&gt;https://api.pjm.com/api/v1/&lt;/a&gt;  (must be a valid apy key from PJM)</span>

<span class="sd">    Real-Time doc:    &lt;a href=&quot;https://dataminer2.pjm.com/feed/rt_hrl_lmps/definition&quot;&gt;https://dataminer2.pjm.com/feed/rt_hrl_lmps/definition&lt;/a&gt;</span>

<span class="sd">    Day-Ahead doc:    &lt;a href=&quot;https://dataminer2.pjm.com/feed/da_hrl_lmps/definition&quot;&gt;https://dataminer2.pjm.com/feed/da_hrl_lmps/definition&lt;/a&gt;</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.sources import PJMDailyPricingISOSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    pjm_source = PJMDailyPricingISOSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;api_key&quot;: &quot;{api_key}&quot;,</span>
<span class="sd">            &quot;load_type&quot;: &quot;real_time&quot;</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    pjm_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">       spark (SparkSession): Spark Session instance</span>
<span class="sd">       options (dict): A dictionary of ISO Source specific configurations (See Attributes table below)</span>

<span class="sd">    Attributes:</span>
<span class="sd">        api_key (str): Must be a valid key from PJM, see api url</span>
<span class="sd">        load_type (str): Must be one of `real_time` or `day_ahead`</span>

<span class="sd">    Please check the BaseISOSource for available methods.</span>

<span class="sd">    BaseISOSource:</span>
<span class="sd">        ::: src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">PJM_PRICING_SCHEMA</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">iso_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://api.pjm.com/api/v1/&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span>
    <span class="n">required_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="s2">&quot;load_type&quot;</span><span class="p">]</span>
    <span class="n">default_query_timezone</span> <span class="o">=</span> <span class="s2">&quot;US/Eastern&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;load_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;days&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_paginated_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">url_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches data from the PJM API with pagination support.</span>

<span class="sd">        Args:</span>
<span class="sd">            url_suffix: String to be used as suffix to ISO URL.</span>
<span class="sd">            start_date: Start date for the data retrieval.</span>
<span class="sd">            end_date: End date for the data retrieval.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw content of the data received.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Ocp-Apim-Subscription-Key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">}</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;startRow&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rowCount&quot;</span><span class="p">:</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;datetime_beginning_ept&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">to</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">query_s</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;=&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iso_url</span><span class="si">}{</span><span class="n">url_suffix</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">query_s</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">next_page</span> <span class="o">=</span> <span class="n">base_url</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Requesting URL - </span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">, start_date=</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">, end_date=</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">, load_type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">load_type</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">while</span> <span class="n">next_page</span><span class="p">:</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timestamp: </span><span class="si">{</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">next_page</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

            <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">requests</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Unable to access URL `</span><span class="si">{</span><span class="n">next_page</span><span class="si">}</span><span class="s2">`.&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; Received status code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> with message </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data for page </span><span class="si">{</span><span class="n">next_page</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">])</span>
            <span class="n">next_urls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;rel&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;next&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">]))</span>
            <span class="n">next_page</span> <span class="o">=</span> <span class="n">next_urls</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;href&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">next_urls</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">items</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pulls data from the PJM API and parses the return.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw form of data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">days</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
        <span class="n">start_date_str</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
        <span class="n">end_date_str</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="o">==</span> <span class="s2">&quot;day_ahead&quot;</span><span class="p">:</span>
            <span class="n">url_suffix</span> <span class="o">=</span> <span class="s2">&quot;da_hrl_lmps&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url_suffix</span> <span class="o">=</span> <span class="s2">&quot;rt_hrl_lmps&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_paginated_data</span><span class="p">(</span><span class="n">url_suffix</span><span class="p">,</span> <span class="n">start_date_str</span><span class="p">,</span> <span class="n">end_date_str</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data fetched successfully: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new date time column and removes null values. Renames columns</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Raw form of data received from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Data after basic transformations.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="o">==</span> <span class="s2">&quot;day_ahead&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;datetime_beginning_utc&quot;</span><span class="p">:</span> <span class="s2">&quot;StartTime&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;pnode_id&quot;</span><span class="p">:</span> <span class="s2">&quot;PnodeId&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;pnode_name&quot;</span><span class="p">:</span> <span class="s2">&quot;PnodeName&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;voltage&quot;</span><span class="p">:</span> <span class="s2">&quot;Voltage&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;equipment&quot;</span><span class="p">:</span> <span class="s2">&quot;Equipment&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;zone&quot;</span><span class="p">:</span> <span class="s2">&quot;Zone&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;system_energy_price_da&quot;</span><span class="p">:</span> <span class="s2">&quot;SystemEnergyPrice&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;total_lmp_da&quot;</span><span class="p">:</span> <span class="s2">&quot;TotalLmp&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;congestion_price_da&quot;</span><span class="p">:</span> <span class="s2">&quot;CongestionPrice&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;marginal_loss_price_da&quot;</span><span class="p">:</span> <span class="s2">&quot;MarginalLossPrice&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;version_nbr&quot;</span><span class="p">:</span> <span class="s2">&quot;VersionNbr&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;datetime_beginning_utc&quot;</span><span class="p">:</span> <span class="s2">&quot;StartTime&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;pnode_id&quot;</span><span class="p">:</span> <span class="s2">&quot;PnodeId&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;pnode_name&quot;</span><span class="p">:</span> <span class="s2">&quot;PnodeName&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;voltage&quot;</span><span class="p">:</span> <span class="s2">&quot;Voltage&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;equipment&quot;</span><span class="p">:</span> <span class="s2">&quot;Equipment&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;zone&quot;</span><span class="p">:</span> <span class="s2">&quot;Zone&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;system_energy_price_rt&quot;</span><span class="p">:</span> <span class="s2">&quot;SystemEnergyPrice&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;total_lmp_rt&quot;</span><span class="p">:</span> <span class="s2">&quot;TotalLmp&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;congestion_price_rt&quot;</span><span class="p">:</span> <span class="s2">&quot;CongestionPrice&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;marginal_loss_price_rt&quot;</span><span class="p">:</span> <span class="s2">&quot;MarginalLossPrice&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;version_nbr&quot;</span><span class="p">:</span> <span class="s2">&quot;VersionNbr&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
            <span class="p">[</span>
                <span class="s2">&quot;StartTime&quot;</span><span class="p">,</span>
                <span class="s2">&quot;PnodeId&quot;</span><span class="p">,</span>
                <span class="s2">&quot;PnodeName&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Voltage&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Equipment&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Type&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Zone&quot;</span><span class="p">,</span>
                <span class="s2">&quot;SystemEnergyPrice&quot;</span><span class="p">,</span>
                <span class="s2">&quot;TotalLmp&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CongestionPrice&quot;</span><span class="p">,</span>
                <span class="s2">&quot;MarginalLossPrice&quot;</span><span class="p">,</span>
                <span class="s2">&quot;VersionNbr&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;StartTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;StartTime&quot;</span><span class="p">])</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the following options:</span>
<span class="sd">            - `load_type` must be valid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if all looks good otherwise raises Exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">valid_load_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;real_time&quot;</span><span class="p">,</span> <span class="s2">&quot;day_ahead&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_load_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid load_type `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">load_type</span><span class="si">}</span><span class="s2">` given. Supported values are </span><span class="si">{</span><span class="n">valid_load_types</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalPricingISOSource" class="doc doc-heading">
            <code>PJMHistoricalPricingISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.pjm_daily_pricing_iso.PJMDailyPricingISOSource" href="../../sources/spark/iso/pjm_daily_pricing_iso/#src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.pjm_daily_pricing_iso.PJMDailyPricingISOSource">PJMDailyPricingISOSource</a></code></p>


      <p>The PJM Historical Pricing ISO Source is used to retrieve historical Real-Time and Day-Ahead hourly data from the PJM API.</p>
<p>API:             <a href="https://api.pjm.com/api/v1/">https://api.pjm.com/api/v1/</a>  (must be a valid apy key from PJM)</p>
<p>Real-Time doc:    <a href="https://dataminer2.pjm.com/feed/rt_hrl_lmps/definition">https://dataminer2.pjm.com/feed/rt_hrl_lmps/definition</a></p>
<p>Day-Ahead doc:    <a href="https://dataminer2.pjm.com/feed/da_hrl_lmps/definition">https://dataminer2.pjm.com/feed/da_hrl_lmps/definition</a></p>
<p>The PJM Historical Pricing ISO Source accesses the same PJM endpoints as the daily pricing source but is tailored for retrieving data within a specified historical range defined by the <code>start_date</code> and <code>end_date</code> attributes.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalPricingISOSource--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">PJMHistoricalPricingISOSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">pjm_source</span> <span class="o">=</span> <span class="n">PJMHistoricalPricingISOSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{api_key}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-05-10&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-05-20&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">pjm_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Spark Session instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalPricingISOSource.api_key">api_key</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A valid key from PJM required for authentication.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalPricingISOSource.load_type">load_type</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of data to retrieve, either <code>real_time</code> or <code>day_ahead</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalPricingISOSource.start_date">start_date</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be in <code>YYYY-MM-DD</code> format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalPricingISOSource.end_date">end_date</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be in <code>YYYY-MM-DD</code> format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Please refer to the BaseISOSource for available methods and further details.</p>
<p>BaseISOSource: ::: src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso</p>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/pjm_historical_pricing_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PJMHistoricalPricingISOSource</span><span class="p">(</span><span class="n">PJMDailyPricingISOSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The PJM Historical Pricing ISO Source is used to retrieve historical Real-Time and Day-Ahead hourly data from the PJM API.</span>

<span class="sd">    API:             &lt;a href=&quot;https://api.pjm.com/api/v1/&quot;&gt;https://api.pjm.com/api/v1/&lt;/a&gt;  (must be a valid apy key from PJM)</span>

<span class="sd">    Real-Time doc:    &lt;a href=&quot;https://dataminer2.pjm.com/feed/rt_hrl_lmps/definition&quot;&gt;https://dataminer2.pjm.com/feed/rt_hrl_lmps/definition&lt;/a&gt;</span>

<span class="sd">    Day-Ahead doc:    &lt;a href=&quot;https://dataminer2.pjm.com/feed/da_hrl_lmps/definition&quot;&gt;https://dataminer2.pjm.com/feed/da_hrl_lmps/definition&lt;/a&gt;</span>

<span class="sd">    The PJM Historical Pricing ISO Source accesses the same PJM endpoints as the daily pricing source but is tailored for retrieving data within a specified historical range defined by the `start_date` and `end_date` attributes.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.sources import PJMHistoricalPricingISOSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    pjm_source = PJMHistoricalPricingISOSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;api_key&quot;: &quot;{api_key}&quot;,</span>
<span class="sd">            &quot;start_date&quot;: &quot;2023-05-10&quot;,</span>
<span class="sd">            &quot;end_date&quot;: &quot;2023-05-20&quot;,</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    pjm_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): The Spark Session instance.</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        api_key (str): A valid key from PJM required for authentication.</span>
<span class="sd">        load_type (str): The type of data to retrieve, either `real_time` or `day_ahead`.</span>
<span class="sd">        start_date (str): Must be in `YYYY-MM-DD` format.</span>
<span class="sd">        end_date (str): Must be in `YYYY-MM-DD` format.</span>

<span class="sd">    Please refer to the BaseISOSource for available methods and further details.</span>

<span class="sd">    BaseISOSource: ::: src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso&quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">required_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="s2">&quot;load_type&quot;</span><span class="p">,</span> <span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pulls historical pricing data from the PJM API within the specified date range.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing the raw historical pricing data retrieved from the PJM API.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Historical data requested from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">start_date_str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span>
        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">end_date_str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span>
        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span> <span class="o">==</span> <span class="s2">&quot;day_ahead&quot;</span><span class="p">:</span>
            <span class="n">url_suffix</span> <span class="o">=</span> <span class="s2">&quot;da_hrl_lmps&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url_suffix</span> <span class="o">=</span> <span class="s2">&quot;rt_hrl_lmps&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_paginated_data</span><span class="p">(</span><span class="n">url_suffix</span><span class="p">,</span> <span class="n">start_date_str</span><span class="p">,</span> <span class="n">end_date_str</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data fetched successfully: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates all parameters including the following examples:</span>
<span class="sd">            - `start_date` &amp; `end_data` must be in the correct format.</span>
<span class="sd">            - `start_date` must be behind `end_data`.</span>
<span class="sd">            - `start_date` must not be in the future (UTC).</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if all looks good otherwise raises Exception.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to parse Start date. Please specify in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="si">}</span><span class="s2"> format.&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to parse End date. Please specify in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="si">}</span><span class="s2"> format.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">start_date</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span>
            <span class="n">days</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start date can&#39;t be in future.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start_date</span> <span class="o">&gt;</span> <span class="n">end_date</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start date can&#39;t be ahead of End date.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">end_date</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span>
            <span class="n">days</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;End date can&#39;t be in future.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalLoadISOSource" class="doc doc-heading">
            <code>PJMHistoricalLoadISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.PJMDailyLoadISOSource" href="../../sources/spark/iso/pjm_daily_load_iso/#src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.pjm_daily_load_iso.PJMDailyLoadISOSource">PJMDailyLoadISOSource</a></code></p>


      <p>The PJM Historical Load ISO Source is used to read historical load data from PJM API.</p>
<p>To read more about the reports, visit the following URLs -
<br>
Actual doc:    <a href="https://dataminer2.pjm.com/feed/ops_sum_prev_period/definition">ops_sum_prev_period</a>
<br>
Forecast doc:  <a href="https://dataminer2.pjm.com/feed/load_frcstd_7_day/definition">load_frcstd_7_day</a></p>
<p>Historical is the same PJM endpoint as Actual, but is called repeatedly within a range established by the
start_date &amp; end_date attributes</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalLoadISOSource--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">PJMHistoricalLoadISOSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">pjm_source</span> <span class="o">=</span> <span class="n">PJMHistoricalLoadISOSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{api_key}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;20230510&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;20230520&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">pjm_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations (See Attributes table below)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalLoadISOSource.api_key">api_key</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be a valid key from PJM, see PJM documentation</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalLoadISOSource.start_date">start_date</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be in <code>YYYY-MM-DD</code> format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalLoadISOSource.end_date">end_date</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be in <code>YYYY-MM-DD</code> format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalLoadISOSource.query_batch_days">query_batch_days</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(optional) Number of days must be &lt; 160 as per PJM &amp; is defaulted to <code>120</code></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalLoadISOSource.sleep_duration">sleep_duration</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(optional) Number of seconds to sleep between request, defaulted to <code>5</code> seconds, used to manage requests to PJM endpoint</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMHistoricalLoadISOSource.request_count">request_count</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(optional) Number of requests made to PJM endpoint before sleep_duration, currently defaulted to <code>1</code></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Please check the BaseISOSource for available methods.</p>


<details class="baseisosource" open>
  <summary>BaseISOSource</summary>
  <div class="doc doc-object doc-module">



<a id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource" class="doc doc-heading">
            <code>BaseISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseISOSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">iso_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="n">required_options</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)])</span>
    <span class="n">default_query_timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_timezone&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_query_timezone</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets data from external ISO API.</span>

<span class="sd">        Args:</span>
<span class="sd">            url_suffix: String to be used as suffix to iso url.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw content of the data received.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iso_url</span><span class="si">}{</span><span class="n">url_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting URL - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to access URL `</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Received status code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> with message </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datetime_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts string datetime into Python datetime object with configured format and timezone.</span>
<span class="sd">        Args:</span>
<span class="sd">            datetime_str: String to be converted into datetime.</span>

<span class="sd">        Returns: Timezone aware datetime object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">parsed_dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parsed_dt</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hits the fetch_from_url method with certain parameters to get raw data from API.</span>

<span class="sd">        All the children ISO classes must override this method and call the fetch_url method</span>
<span class="sd">        in it.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Raw DataFrame from API.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the basic transformations to prepare data for further processing.</span>
<span class="sd">        All the children ISO classes must override this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Raw DataFrame, received from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Modified DataFrame, ready for basic use.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Another data transformation helper method to be called after prepare data.</span>
<span class="sd">        Used for advance data processing such as cleaning, filtering, restructuring.</span>
<span class="sd">        All the children ISO classes must override this method if there is any post-processing required.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Initial modified version of DataFrame, received after preparing the data.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final version of data after all the fixes and modifications.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Entrypoint method to return the final version of DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Modified form of data for specific use case.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pull_data</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># Reorder columns to keep the data consistent</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the options checks. Raises exception in case of any invalid value.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures all the required options are provided and performs other validations.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

            <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame after all the processing.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.pre_read_validation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pre_read_validation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Ensures all the required options are provided and performs other validations.
Returns:
     True if all checks are passed.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures all the required options are provided and performs other validations.</span>
<span class="sd">    Returns:</span>
<span class="sd">         True if all checks are passed.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.
Returns:
     Final Spark DataFrame converted from Pandas DataFrame post-execution.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

        <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Final Spark DataFrame after all the processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame after all the processing.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
</details>
              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/pjm_historical_load_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PJMHistoricalLoadISOSource</span><span class="p">(</span><span class="n">PJMDailyLoadISOSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The PJM Historical Load ISO Source is used to read historical load data from PJM API.</span>

<span class="sd">    To read more about the reports, visit the following URLs -</span>
<span class="sd">    &lt;br&gt;</span>
<span class="sd">    Actual doc:    [ops_sum_prev_period](https://dataminer2.pjm.com/feed/ops_sum_prev_period/definition)</span>
<span class="sd">    &lt;br&gt;</span>
<span class="sd">    Forecast doc:  [load_frcstd_7_day](https://dataminer2.pjm.com/feed/load_frcstd_7_day/definition)</span>

<span class="sd">    Historical is the same PJM endpoint as Actual, but is called repeatedly within a range established by the</span>
<span class="sd">    start_date &amp; end_date attributes</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.sources import PJMHistoricalLoadISOSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    pjm_source = PJMHistoricalLoadISOSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;api_key&quot;: &quot;{api_key}&quot;,</span>
<span class="sd">            &quot;start_date&quot;: &quot;20230510&quot;,</span>
<span class="sd">            &quot;end_date&quot;: &quot;20230520&quot;,</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    pjm_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations (See Attributes table below)</span>

<span class="sd">    Attributes:</span>
<span class="sd">        api_key (str): Must be a valid key from PJM, see PJM documentation</span>
<span class="sd">        start_date (str): Must be in `YYYY-MM-DD` format.</span>
<span class="sd">        end_date (str): Must be in `YYYY-MM-DD` format.</span>

<span class="sd">        query_batch_days (int): (optional) Number of days must be &lt; 160 as per PJM &amp; is defaulted to `120`</span>
<span class="sd">        sleep_duration (int): (optional) Number of seconds to sleep between request, defaulted to `5` seconds, used to manage requests to PJM endpoint</span>
<span class="sd">        request_count (int): (optional) Number of requests made to PJM endpoint before sleep_duration, currently defaulted to `1`</span>

<span class="sd">    Please check the BaseISOSource for available methods.</span>

<span class="sd">    BaseISOSource:</span>
<span class="sd">        ::: src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso&quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">required_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_batch_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_batch_days&quot;</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sleep_duration&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;request_count&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;actual&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pulls data from the PJM API and parses the return including date ranges.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw form of data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Historical load requested from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">hour</span><span class="o">=</span><span class="mi">23</span>
        <span class="p">)</span>

        <span class="n">days_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_date</span> <span class="o">-</span> <span class="n">start_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected hours for a single zone = </span><span class="si">{</span><span class="p">(</span><span class="n">days_diff</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">24</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">generated_days_ranges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
            <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_batch_days</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
            <span class="n">py_date</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span>
            <span class="n">date_last</span> <span class="o">=</span> <span class="p">(</span><span class="n">py_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_batch_days</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">hour</span><span class="o">=</span><span class="mi">23</span>
            <span class="p">)</span>
            <span class="n">date_last</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">date_last</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
            <span class="n">generated_days_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">py_date</span><span class="p">,</span> <span class="n">date_last</span><span class="p">))</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Generated date ranges for batch days </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">query_batch_days</span><span class="si">}</span><span class="s2"> are </span><span class="si">{</span><span class="n">generated_days_ranges</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Collect all historical data on yearly basis.</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">date_range</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">generated_days_ranges</span><span class="p">):</span>
            <span class="n">start_date_str</span> <span class="o">=</span> <span class="n">date_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
            <span class="n">end_date_str</span> <span class="o">=</span> <span class="n">date_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                <span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">start_date_str</span><span class="p">,</span> <span class="n">end_date_str</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Going to sleep for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_duration</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_duration</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates all parameters including the following examples:</span>
<span class="sd">            - `start_date` &amp; `end_data` must be in the correct format.</span>
<span class="sd">            - `start_date` must be behind `end_data`.</span>
<span class="sd">            - `start_date` must not be in the future (UTC).</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if all looks good otherwise raises Exception.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to parse Start date. Please specify in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="si">}</span><span class="s2"> format.&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to parse End date. Please specify in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="si">}</span><span class="s2"> format.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">start_date</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span>
            <span class="n">days</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start date can&#39;t be in future.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start_date</span> <span class="o">&gt;</span> <span class="n">end_date</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start date can&#39;t be ahead of End date.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">end_date</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span>
            <span class="n">days</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;End date can&#39;t be in future.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_duration</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sleep duration can&#39;t be negative.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Request count can&#39;t be negative.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_batch_days</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query batch days count can&#39;t be negative.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.CAISODailyLoadISOSource" class="doc doc-heading">
            <code>CAISODailyLoadISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.BaseISOSource" href="../../sources/spark/iso/pjm_historical_load_iso/#src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource">BaseISOSource</a></code></p>


      <p>The CAISO Daily Load ISO Source is used to read daily load data from CAISO API.
It supports multiple types of data. Check the <code>load_types</code> attribute.</p>
<p>To read more about the available reports from CAISO API, download the file -
 <a href="https://www.caiso.com/Documents/OASISAPISpecification.pdf">Interface Specification</a></p>
<p>From the list of reports in the file, it pulls the report named <code>CAISO Demand Forecast</code> in the file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations (See Attributes table below)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.CAISODailyLoadISOSource.load_types">load_types</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be a subset of [<code>Demand Forecast 7-Day Ahead</code>, <code>Demand Forecast 2-Day Ahead</code>, <code>Demand Forecast Day Ahead</code>, <code>RTM 15Min Load Forecast</code>, <code>RTM 5Min Load Forecast</code>, <code>Total Actual Hourly Integrated Load</code>]. <br> Default Value - <code>[Total Actual Hourly Integrated Load]</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.CAISODailyLoadISOSource.date">date</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be in <code>YYYY-MM-DD</code> format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Please check the BaseISOSource for available methods.</p>


<details class="baseisosource" open>
  <summary>BaseISOSource</summary>
  <div class="doc doc-object doc-module">



<a id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource" class="doc doc-heading">
            <code>BaseISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseISOSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">iso_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="n">required_options</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)])</span>
    <span class="n">default_query_timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_timezone&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_query_timezone</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets data from external ISO API.</span>

<span class="sd">        Args:</span>
<span class="sd">            url_suffix: String to be used as suffix to iso url.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw content of the data received.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iso_url</span><span class="si">}{</span><span class="n">url_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting URL - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to access URL `</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Received status code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> with message </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datetime_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts string datetime into Python datetime object with configured format and timezone.</span>
<span class="sd">        Args:</span>
<span class="sd">            datetime_str: String to be converted into datetime.</span>

<span class="sd">        Returns: Timezone aware datetime object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">parsed_dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parsed_dt</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hits the fetch_from_url method with certain parameters to get raw data from API.</span>

<span class="sd">        All the children ISO classes must override this method and call the fetch_url method</span>
<span class="sd">        in it.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Raw DataFrame from API.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the basic transformations to prepare data for further processing.</span>
<span class="sd">        All the children ISO classes must override this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Raw DataFrame, received from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Modified DataFrame, ready for basic use.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Another data transformation helper method to be called after prepare data.</span>
<span class="sd">        Used for advance data processing such as cleaning, filtering, restructuring.</span>
<span class="sd">        All the children ISO classes must override this method if there is any post-processing required.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Initial modified version of DataFrame, received after preparing the data.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final version of data after all the fixes and modifications.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Entrypoint method to return the final version of DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Modified form of data for specific use case.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pull_data</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># Reorder columns to keep the data consistent</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the options checks. Raises exception in case of any invalid value.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures all the required options are provided and performs other validations.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

            <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame after all the processing.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.pre_read_validation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pre_read_validation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Ensures all the required options are provided and performs other validations.
Returns:
     True if all checks are passed.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures all the required options are provided and performs other validations.</span>
<span class="sd">    Returns:</span>
<span class="sd">         True if all checks are passed.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.
Returns:
     Final Spark DataFrame converted from Pandas DataFrame post-execution.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

        <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Final Spark DataFrame after all the processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame after all the processing.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
</details>
              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/caiso_daily_load_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CAISODailyLoadISOSource</span><span class="p">(</span><span class="n">BaseISOSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The CAISO Daily Load ISO Source is used to read daily load data from CAISO API.</span>
<span class="sd">    It supports multiple types of data. Check the `load_types` attribute.</span>

<span class="sd">    To read more about the available reports from CAISO API, download the file -</span>
<span class="sd">     [Interface Specification](https://www.caiso.com/Documents/OASISAPISpecification.pdf)</span>

<span class="sd">    From the list of reports in the file, it pulls the report named `CAISO Demand Forecast` in the file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations (See Attributes table below)</span>

<span class="sd">    Attributes:</span>
<span class="sd">        load_types (list): Must be a subset of [`Demand Forecast 7-Day Ahead`, `Demand Forecast 2-Day Ahead`, `Demand Forecast Day Ahead`, `RTM 15Min Load Forecast`, `RTM 5Min Load Forecast`, `Total Actual Hourly Integrated Load`]. &lt;br&gt; Default Value - `[Total Actual Hourly Integrated Load]`.</span>
<span class="sd">        date (str): Must be in `YYYY-MM-DD` format.</span>

<span class="sd">    Please check the BaseISOSource for available methods.</span>

<span class="sd">    BaseISOSource:</span>
<span class="sd">        ::: src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">iso_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://oasis.caiso.com/oasisapi/SingleZip&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T00:00-0000&quot;</span>
    <span class="n">required_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;load_types&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">]</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">CAISO_SCHEMA</span>
    <span class="n">default_query_timezone</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;load_types&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Total Actual Hourly Integrated Load&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span>

        <span class="c1"># The following to fix the Security Check Error as the CAISO API is timing out with HTTPS protocol.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iso_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iso_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;s://&quot;</span><span class="p">,</span> <span class="s2">&quot;://&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pulls data from the CAISO API and parses the zip files for CSV data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw form of data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">load_types</span><span class="si">}</span><span class="s2"> data for date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_and_parse_zip</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_and_parse_zip</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;?resultformat=6&amp;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;queryname=SLD_FCST&amp;&quot;</span>
            <span class="s2">&quot;version=1&amp;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;startdatetime=</span><span class="si">{</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span><span class="si">}</span><span class="s2">&amp;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;enddatetime=</span><span class="si">{</span><span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="s2">&quot;Empty Response was returned&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unzipping the file&quot;</span><span class="p">)</span>

        <span class="n">zf</span> <span class="o">=</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>

        <span class="n">csvs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;.csv&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">,</span> <span class="n">zf</span><span class="o">.</span><span class="n">namelist</span><span class="p">()))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">csvs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No data was found in the specified interval&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">csvs</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">date_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;INTERVALSTARTTIME_GMT&quot;</span><span class="p">,</span> <span class="s2">&quot;INTERVALENDTIME_GMT&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">date_col</span> <span class="ow">in</span> <span class="n">date_cols</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="n">date_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">date_col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)[:</span><span class="mi">19</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;INTERVALSTARTTIME_GMT&quot;</span><span class="p">:</span> <span class="s2">&quot;StartTime&quot;</span><span class="p">,</span>
                <span class="s2">&quot;INTERVALENDTIME_GMT&quot;</span><span class="p">:</span> <span class="s2">&quot;EndTime&quot;</span><span class="p">,</span>
                <span class="s2">&quot;LOAD_TYPE&quot;</span><span class="p">:</span> <span class="s2">&quot;LoadType&quot;</span><span class="p">,</span>
                <span class="s2">&quot;OPR_DT&quot;</span><span class="p">:</span> <span class="s2">&quot;OprDt&quot;</span><span class="p">,</span>
                <span class="s2">&quot;OPR_HR&quot;</span><span class="p">:</span> <span class="s2">&quot;OprHr&quot;</span><span class="p">,</span>
                <span class="s2">&quot;OPR_INTERVAL&quot;</span><span class="p">:</span> <span class="s2">&quot;OprInterval&quot;</span><span class="p">,</span>
                <span class="s2">&quot;MARKET_RUN_ID&quot;</span><span class="p">:</span> <span class="s2">&quot;MarketRunId&quot;</span><span class="p">,</span>
                <span class="s2">&quot;TAC_AREA_NAME&quot;</span><span class="p">:</span> <span class="s2">&quot;TacAreaName&quot;</span><span class="p">,</span>
                <span class="s2">&quot;LABEL&quot;</span><span class="p">:</span> <span class="s2">&quot;Label&quot;</span><span class="p">,</span>
                <span class="s2">&quot;XML_DATA_ITEM&quot;</span><span class="p">:</span> <span class="s2">&quot;XmlDataItem&quot;</span><span class="p">,</span>
                <span class="s2">&quot;POS&quot;</span><span class="p">:</span> <span class="s2">&quot;Pos&quot;</span><span class="p">,</span>
                <span class="s2">&quot;MW&quot;</span><span class="p">:</span> <span class="s2">&quot;Load&quot;</span><span class="p">,</span>
                <span class="s2">&quot;EXECUTION_TYPE&quot;</span><span class="p">:</span> <span class="s2">&quot;ExecutionType&quot;</span><span class="p">,</span>
                <span class="s2">&quot;GROUP&quot;</span><span class="p">:</span> <span class="s2">&quot;Group&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_types</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to parse date. Please specify in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="si">}</span><span class="s2"> format.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.CAISOHistoricalLoadISOSource" class="doc doc-heading">
            <code>CAISOHistoricalLoadISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.caiso_daily_load_iso.CAISODailyLoadISOSource" href="../../sources/spark/iso/caiso_daily_load_iso/#src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.caiso_daily_load_iso.CAISODailyLoadISOSource">CAISODailyLoadISOSource</a></code></p>


      <p>The CAISO Historical Load ISO Source is used to read load data for an interval of dates
 between start_date and end_date inclusive from CAISO API.
It supports multiple types of data. Check the <code>load_types</code> attribute.</p>
<p>To read more about the available reports from CAISO API, download the file -
 <a href="https://www.caiso.com/Documents/OASISAPISpecification.pdf">Interface Specification</a></p>
<p>From the list of reports in the file, it pulls the report named <code>CAISO Demand Forecast</code> in the file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations (See Attributes table below)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.CAISOHistoricalLoadISOSource.load_types">load_types</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be a subset of [<code>Demand Forecast 7-Day Ahead</code>, <code>Demand Forecast 2-Day Ahead</code>, <code>Demand Forecast Day Ahead</code>, <code>RTM 15Min Load Forecast</code>, <code>RTM 5Min Load Forecast</code>, <code>Total Actual Hourly Integrated Load</code>]. <br> Default Value - <code>[Total Actual Hourly Integrated Load]</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.CAISOHistoricalLoadISOSource.start_date">start_date</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be in <code>YYYY-MM-DD</code> format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.CAISOHistoricalLoadISOSource.end_date">end_date</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be in <code>YYYY-MM-DD</code> format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Please check the BaseISOSource for available methods.</p>


<details class="baseisosource" open>
  <summary>BaseISOSource</summary>
  <div class="doc doc-object doc-module">



<a id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource" class="doc doc-heading">
            <code>BaseISOSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseISOSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all the ISO Sources. It provides common functionality and helps in reducing the code redundancy.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">iso_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span>
    <span class="n">query_datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="n">required_options</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)])</span>
    <span class="n">default_query_timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_timezone&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_query_timezone</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets data from external ISO API.</span>

<span class="sd">        Args:</span>
<span class="sd">            url_suffix: String to be used as suffix to iso url.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw content of the data received.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iso_url</span><span class="si">}{</span><span class="n">url_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting URL - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to access URL `</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Received status code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> with message </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">_get_localized_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datetime_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts string datetime into Python datetime object with configured format and timezone.</span>
<span class="sd">        Args:</span>
<span class="sd">            datetime_str: String to be converted into datetime.</span>

<span class="sd">        Returns: Timezone aware datetime object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_datetime_format</span><span class="p">)</span>
        <span class="n">parsed_dt</span> <span class="o">=</span> <span class="n">parsed_dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_timezone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parsed_dt</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hits the fetch_from_url method with certain parameters to get raw data from API.</span>

<span class="sd">        All the children ISO classes must override this method and call the fetch_url method</span>
<span class="sd">        in it.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Raw DataFrame from API.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the basic transformations to prepare data for further processing.</span>
<span class="sd">        All the children ISO classes must override this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Raw DataFrame, received from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Modified DataFrame, ready for basic use.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Another data transformation helper method to be called after prepare data.</span>
<span class="sd">        Used for advance data processing such as cleaning, filtering, restructuring.</span>
<span class="sd">        All the children ISO classes must override this method if there is any post-processing required.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Initial modified version of DataFrame, received after preparing the data.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final version of data after all the fixes and modifications.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Entrypoint method to return the final version of DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Modified form of data for specific use case.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pull_data</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># Reorder columns to keep the data consistent</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs all the options checks. Raises exception in case of any invalid value.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures all the required options are provided and performs other validations.</span>
<span class="sd">        Returns:</span>
<span class="sd">             True if all checks are passed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

            <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Final Spark DataFrame after all the processing.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.pre_read_validation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pre_read_validation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Ensures all the required options are provided and performs other validations.
Returns:
     True if all checks are passed.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures all the required options are provided and performs other validations.</span>
<span class="sd">    Returns:</span>
<span class="sd">         True if all checks are passed.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_options</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required option `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is missing.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_options</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.
Returns:
     Final Spark DataFrame converted from Pandas DataFrame post-execution.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spark entrypoint, It executes the entire process of pulling, transforming &amp; fixing data.</span>
<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame converted from Pandas DataFrame post-execution.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_read_validation</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

        <span class="c1"># The below is to fix the compatibility issues between Pandas 2.0 and PySpark.</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">iteritems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">items</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Final Spark DataFrame after all the processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/base_iso.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    By default, the streaming operation is not supported but child classes can override if ISO supports streaming.</span>

<span class="sd">    Returns:</span>
<span class="sd">         Final Spark DataFrame after all the processing.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> connector doesn&#39;t support stream operation.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
</details>
              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/iso/caiso_historical_load_iso.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CAISOHistoricalLoadISOSource</span><span class="p">(</span><span class="n">CAISODailyLoadISOSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The CAISO Historical Load ISO Source is used to read load data for an interval of dates</span>
<span class="sd">     between start_date and end_date inclusive from CAISO API.</span>
<span class="sd">    It supports multiple types of data. Check the `load_types` attribute.</span>

<span class="sd">    To read more about the available reports from CAISO API, download the file -</span>
<span class="sd">     [Interface Specification](https://www.caiso.com/Documents/OASISAPISpecification.pdf)</span>

<span class="sd">    From the list of reports in the file, it pulls the report named `CAISO Demand Forecast` in the file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations (See Attributes table below)</span>

<span class="sd">    Attributes:</span>
<span class="sd">        load_types (list): Must be a subset of [`Demand Forecast 7-Day Ahead`, `Demand Forecast 2-Day Ahead`, `Demand Forecast Day Ahead`, `RTM 15Min Load Forecast`, `RTM 5Min Load Forecast`, `Total Actual Hourly Integrated Load`]. &lt;br&gt; Default Value - `[Total Actual Hourly Integrated Load]`.</span>
<span class="sd">        start_date (str): Must be in `YYYY-MM-DD` format.</span>
<span class="sd">        end_date (str): Must be in `YYYY-MM-DD` format.</span>

<span class="sd">    Please check the BaseISOSource for available methods.</span>

<span class="sd">    BaseISOSource:</span>
<span class="sd">        ::: src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">required_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;load_types&quot;</span><span class="p">,</span> <span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;load_types&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Total Actual Hourly Integrated Load&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pulls data from the CAISO API and parses the zip files for CSV data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw form of data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Getting </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">load_types</span><span class="si">}</span><span class="s2"> data from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">generated_days_ranges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;30D&quot;</span><span class="p">,</span> <span class="n">inclusive</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
            <span class="n">py_date</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span>
            <span class="n">date_last</span> <span class="o">=</span> <span class="n">py_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">date_last</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">date_last</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
            <span class="n">generated_days_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">py_date</span><span class="p">,</span> <span class="n">date_last</span><span class="p">))</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated date ranges are </span><span class="si">{</span><span class="n">generated_days_ranges</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">date_range</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">generated_days_ranges</span><span class="p">):</span>
            <span class="n">start_date_str</span><span class="p">,</span> <span class="n">end_date_str</span> <span class="o">=</span> <span class="n">date_range</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_and_parse_zip</span><span class="p">(</span><span class="n">start_date_str</span><span class="p">,</span> <span class="n">end_date_str</span><span class="p">)</span>

            <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to parse start_date. Please specify in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="si">}</span><span class="s2"> format.&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to parse end_date. Please specify in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_datetime_format</span><span class="si">}</span><span class="s2"> format.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkWeatherCompanyBaseWeatherSource" class="doc doc-heading">
            <code>SparkWeatherCompanyBaseWeatherSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.BaseISOSource" href="../../sources/spark/iso/pjm_historical_load_iso/#src.sdk.python.rtdip_sdk.pipelines.sources.spark.iso.base_iso.BaseISOSource">BaseISOSource</a></code></p>


      <p>Base class for all the Weather related sources. Provides common functionality.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of Weather Source specific configurations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/the_weather_company/base_weather.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkWeatherCompanyBaseWeatherSource</span><span class="p">(</span><span class="n">BaseISOSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all the Weather related sources. Provides common functionality.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of Weather Source specific configurations.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">weather_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span>
    <span class="n">api_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SparkWeatherCompanyBaseWeatherSource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>

    <span class="k">def</span> <span class="nf">_get_api_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_params</span>

    <span class="k">def</span> <span class="nf">_fetch_weather_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets data from external Weather Forecast API.</span>

<span class="sd">        Args:</span>
<span class="sd">            url_suffix: String to be used as suffix to weather url.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw content of the data received.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">weather_url</span><span class="si">}{</span><span class="n">url_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting URL - `</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">` with params - </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to access URL `</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Received status code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> with message </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">_fetch_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_weather_from_url</span><span class="p">(</span><span class="n">url_suffix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_api_params</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkWeatherCompanyForecastAPIV1Source" class="doc doc-heading">
            <code>SparkWeatherCompanyForecastAPIV1Source</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.sources.spark.the_weather_company.base_weather.SparkWeatherCompanyBaseWeatherSource" href="../../sources/spark/the_weather_company/base_weather/#src.sdk.python.rtdip_sdk.pipelines.sources.spark.the_weather_company.base_weather.SparkWeatherCompanyBaseWeatherSource">SparkWeatherCompanyBaseWeatherSource</a></code></p>


      <p>The Weather Forecast API V1 Source is used to read 15 days forecast from the Weather API.</p>
<p>URL: <a href="https://api.weather.com/v1/geocode/32.3667/-95.4/forecast/hourly/360hour.json">
https://api.weather.com/v1/geocode/32.3667/-95.4/forecast/hourly/360hour.json</a></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations (See Attributes table below).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkWeatherCompanyForecastAPIV1Source.lat">lat</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude of the Weather Station.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkWeatherCompanyForecastAPIV1Source.lon">lon</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude of the Weather Station.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkWeatherCompanyForecastAPIV1Source.api_key">api_key</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weather API key.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkWeatherCompanyForecastAPIV1Source.language">language</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>API response language. Defaults to <code>en-US</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkWeatherCompanyForecastAPIV1Source.units">units</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unit of measurements. Defaults to <code>e</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/the_weather_company/weather_forecast_api_v1.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkWeatherCompanyForecastAPIV1Source</span><span class="p">(</span><span class="n">SparkWeatherCompanyBaseWeatherSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Weather Forecast API V1 Source is used to read 15 days forecast from the Weather API.</span>

<span class="sd">    URL: &lt;a href=&quot;https://api.weather.com/v1/geocode/32.3667/-95.4/forecast/hourly/360hour.json&quot;&gt;</span>
<span class="sd">    https://api.weather.com/v1/geocode/32.3667/-95.4/forecast/hourly/360hour.json&lt;/a&gt;</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations (See Attributes table below).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        lat (str): Latitude of the Weather Station.</span>
<span class="sd">        lon (str): Longitude of the Weather Station.</span>
<span class="sd">        api_key (str): Weather API key.</span>
<span class="sd">        language (str): API response language. Defaults to `en-US`.</span>
<span class="sd">        units (str): Unit of measurements. Defaults to `e`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">WEATHER_FORECAST_SCHEMA</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">weather_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://api.weather.com/v1/geocode/&quot;</span>
    <span class="n">required_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;api_key&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SparkWeatherCompanyForecastAPIV1Source</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="s2">&quot;en-US&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepares weather data for the use.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Data received after preparation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Final data after all the transformations.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rename_cols</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;Latitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;Longitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;Class&quot;</span><span class="p">,</span>
            <span class="s2">&quot;expire_time_gmt&quot;</span><span class="p">:</span> <span class="s2">&quot;ExpireTimeGmt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fcst_valid&quot;</span><span class="p">:</span> <span class="s2">&quot;FcstValid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fcst_valid_local&quot;</span><span class="p">:</span> <span class="s2">&quot;FcstValidLocal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;num&quot;</span><span class="p">:</span> <span class="s2">&quot;Num&quot;</span><span class="p">,</span>
            <span class="s2">&quot;day_ind&quot;</span><span class="p">:</span> <span class="s2">&quot;DayInd&quot;</span><span class="p">,</span>
            <span class="s2">&quot;temp&quot;</span><span class="p">:</span> <span class="s2">&quot;Temp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dewpt&quot;</span><span class="p">:</span> <span class="s2">&quot;Dewpt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hi&quot;</span><span class="p">:</span> <span class="s2">&quot;Hi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;wc&quot;</span><span class="p">:</span> <span class="s2">&quot;Wc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;feels_like&quot;</span><span class="p">:</span> <span class="s2">&quot;FeelsLike&quot;</span><span class="p">,</span>
            <span class="s2">&quot;icon_extd&quot;</span><span class="p">:</span> <span class="s2">&quot;IconExtd&quot;</span><span class="p">,</span>
            <span class="s2">&quot;wxman&quot;</span><span class="p">:</span> <span class="s2">&quot;Wxman&quot;</span><span class="p">,</span>
            <span class="s2">&quot;icon_code&quot;</span><span class="p">:</span> <span class="s2">&quot;IconCode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dow&quot;</span><span class="p">:</span> <span class="s2">&quot;Dow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;phrase_12char&quot;</span><span class="p">:</span> <span class="s2">&quot;Phrase12Char&quot;</span><span class="p">,</span>
            <span class="s2">&quot;phrase_22char&quot;</span><span class="p">:</span> <span class="s2">&quot;Phrase22Char&quot;</span><span class="p">,</span>
            <span class="s2">&quot;phrase_32char&quot;</span><span class="p">:</span> <span class="s2">&quot;Phrase32Char&quot;</span><span class="p">,</span>
            <span class="s2">&quot;subphrase_pt1&quot;</span><span class="p">:</span> <span class="s2">&quot;SubphrasePt1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;subphrase_pt2&quot;</span><span class="p">:</span> <span class="s2">&quot;SubphrasePt2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;subphrase_pt3&quot;</span><span class="p">:</span> <span class="s2">&quot;SubphrasePt3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pop&quot;</span><span class="p">:</span> <span class="s2">&quot;Pop&quot;</span><span class="p">,</span>
            <span class="s2">&quot;precip_type&quot;</span><span class="p">:</span> <span class="s2">&quot;PrecipType&quot;</span><span class="p">,</span>
            <span class="s2">&quot;qpf&quot;</span><span class="p">:</span> <span class="s2">&quot;Qpf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;snow_qpf&quot;</span><span class="p">:</span> <span class="s2">&quot;SnowQpf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rh&quot;</span><span class="p">:</span> <span class="s2">&quot;Rh&quot;</span><span class="p">,</span>
            <span class="s2">&quot;wspd&quot;</span><span class="p">:</span> <span class="s2">&quot;Wspd&quot;</span><span class="p">,</span>
            <span class="s2">&quot;wdir&quot;</span><span class="p">:</span> <span class="s2">&quot;Wdir&quot;</span><span class="p">,</span>
            <span class="s2">&quot;wdir_cardinal&quot;</span><span class="p">:</span> <span class="s2">&quot;WdirCardinal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gust&quot;</span><span class="p">:</span> <span class="s2">&quot;Gust&quot;</span><span class="p">,</span>
            <span class="s2">&quot;clds&quot;</span><span class="p">:</span> <span class="s2">&quot;Clds&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vis&quot;</span><span class="p">:</span> <span class="s2">&quot;Vis&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mslp&quot;</span><span class="p">:</span> <span class="s2">&quot;Mslp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uv_index_raw&quot;</span><span class="p">:</span> <span class="s2">&quot;UvIndexRaw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uv_index&quot;</span><span class="p">:</span> <span class="s2">&quot;UvIndex&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uv_warning&quot;</span><span class="p">:</span> <span class="s2">&quot;UvWarning&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uv_desc&quot;</span><span class="p">:</span> <span class="s2">&quot;UvDesc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;golf_index&quot;</span><span class="p">:</span> <span class="s2">&quot;GolfIndex&quot;</span><span class="p">,</span>
            <span class="s2">&quot;golf_category&quot;</span><span class="p">:</span> <span class="s2">&quot;GolfCategory&quot;</span><span class="p">,</span>
            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="s2">&quot;Severity&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename_cols</span><span class="p">)</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark_schema</span><span class="o">.</span><span class="n">fields</span>

        <span class="n">str_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dataType</span><span class="p">,</span> <span class="n">StringType</span><span class="p">),</span> <span class="n">fields</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">double_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dataType</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">),</span> <span class="n">fields</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">int_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dataType</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">),</span> <span class="n">fields</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="n">str_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">str_cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="n">double_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">double_cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="n">int_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">int_cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_api_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
            <span class="s2">&quot;apiKey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">_pull_for_weather_station</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lon</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s2">/forecast/hourly/360hour.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
                <span class="s2">&quot;utf-8&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;forecasts&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pulls data from the Weather API and parses the JSON file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw form of data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pull_for_weather_station</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkWeatherCompanyForecastAPIV1MultiSource" class="doc doc-heading">
            <code>SparkWeatherCompanyForecastAPIV1MultiSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.sources.spark.the_weather_company.weather_forecast_api_v1.SparkWeatherCompanyForecastAPIV1Source" href="../../sources/spark/the_weather_company/weather_forecast_api_v1/#src.sdk.python.rtdip_sdk.pipelines.sources.spark.the_weather_company.weather_forecast_api_v1.SparkWeatherCompanyForecastAPIV1Source">SparkWeatherCompanyForecastAPIV1Source</a></code></p>


      <p>The Weather Forecast API V1 Multi Source is used to read 15 days forecast from the Weather API. It allows to
pull weather data for multiple stations and returns all of them in a single DataFrame.</p>
<p>URL for one station: <a href="https://api.weather.com/v1/geocode/32.3667/-95.4/forecast/hourly/360hour.json">
https://api.weather.com/v1/geocode/32.3667/-95.4/forecast/hourly/360hour.json</a></p>
<p>It takes a list of Weather Stations. Each station item must contain comma separated Latitude &amp; Longitude.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkWeatherCompanyForecastAPIV1MultiSource--examples">Examples</h4>
<p><code>["32.3667,-95.4", "51.52,-0.11"]</code></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of ISO Source specific configurations (See Attributes table below).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkWeatherCompanyForecastAPIV1MultiSource.stations">stations</span></code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of Weather Stations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkWeatherCompanyForecastAPIV1MultiSource.api_key">api_key</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weather API key.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkWeatherCompanyForecastAPIV1MultiSource.language">language</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>API response language. Defaults to <code>en-US</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkWeatherCompanyForecastAPIV1MultiSource.units">units</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unit of measurements. Defaults to <code>e</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/the_weather_company/weather_forecast_api_v1_multi.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkWeatherCompanyForecastAPIV1MultiSource</span><span class="p">(</span>
    <span class="n">SparkWeatherCompanyForecastAPIV1Source</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Weather Forecast API V1 Multi Source is used to read 15 days forecast from the Weather API. It allows to</span>
<span class="sd">    pull weather data for multiple stations and returns all of them in a single DataFrame.</span>

<span class="sd">    URL for one station: &lt;a href=&quot;https://api.weather.com/v1/geocode/32.3667/-95.4/forecast/hourly/360hour.json&quot;&gt;</span>
<span class="sd">    https://api.weather.com/v1/geocode/32.3667/-95.4/forecast/hourly/360hour.json&lt;/a&gt;</span>

<span class="sd">    It takes a list of Weather Stations. Each station item must contain comma separated Latitude &amp; Longitude.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    `[&quot;32.3667,-95.4&quot;, &quot;51.52,-0.11&quot;]`</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        options (dict): A dictionary of ISO Source specific configurations (See Attributes table below).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        stations (list[str]): List of Weather Stations.</span>
<span class="sd">        api_key (str): Weather API key.</span>
<span class="sd">        language (str): API response language. Defaults to `en-US`.</span>
<span class="sd">        units (str): Unit of measurements. Defaults to `e`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">spark_schema</span> <span class="o">=</span> <span class="n">WEATHER_FORECAST_SCHEMA</span>
    <span class="n">required_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stations&quot;</span><span class="p">,</span> <span class="s2">&quot;api_key&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SparkWeatherCompanyForecastAPIV1MultiSource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">spark</span><span class="p">,</span> <span class="n">options</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stations&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="s2">&quot;en-US&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_pull_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pulls data from the Weather API and parses the JSON file for multiple stations</span>

<span class="sd">        Returns:</span>
<span class="sd">            Raw form of data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">result_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stations</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">station</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">parts</span>

            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pull_for_weather_station</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon</span>

            <span class="k">if</span> <span class="n">result_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">result_df</span><span class="p">,</span> <span class="n">df</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result_df</span> <span class="o">=</span> <span class="n">df</span>

        <span class="k">return</span> <span class="n">result_df</span>

    <span class="k">def</span> <span class="nf">_validate_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stations</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">station</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Each station item must contain comma separated Latitude &amp; Longitude. Eg: 10.23:45.2&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSource" class="doc doc-heading">
            <code>PythonDeltaSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>The Python Delta Source is used to read data from a Delta table without using Apache Spark, returning a Polars LazyFrame.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSource--example">Example</h4>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSource--__tabbed_1_1" name="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSource--__tabbed_1" type="radio" /><input id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSource--__tabbed_1_2" name="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSource--__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSource--__tabbed_1_1">Azure</label><label for="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSource--__tabbed_1_2">AWS</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">PythonDeltaSource</span>

<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;abfss://{FILE-SYSTEM}@{ACCOUNT-NAME}.dfs.core.windows.net/</span><span class="si">{PATH}</span><span class="s2">/{FILE-NAME}</span>

<span class="n">python_delta_source</span> <span class="o">=</span> <span class="n">PythonDeltaSource</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;azure_storage_account_name&quot;</span><span class="p">:</span> <span class="s2">&quot;{AZURE-STORAGE-ACCOUNT-NAME}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;azure_storage_account_key&quot;</span><span class="p">:</span> <span class="s2">&quot;{AZURE-STORAGE-ACCOUNT-KEY}&quot;</span>
    <span class="p">},</span>
    <span class="n">pyarrow_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">without_files</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">python_delta_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">PythonDeltaSource</span>

<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;https://s3.{REGION-CODE}.amazonaws.com/{BUCKET-NAME}/{KEY-NAME}&quot;</span>

<span class="n">python_delta_source</span> <span class="o">=</span> <span class="n">PythonDeltaSource</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;aws_access_key_id&quot;</span><span class="p">:</span> <span class="s2">&quot;{AWS-ACCESS-KEY-ID}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aws_secret_access_key&quot;</span><span class="p">:</span> <span class="s2">&quot;{AWS-SECRET-ACCESS-KEY}&quot;</span>
    <span class="p">},</span>
    <span class="n">pyarrow_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">without_files</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">python_delta_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>
</div>
</div>
</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the Delta table. Can be local or in S3/Azure storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>version</code></td>
            <td>
                  <code>optional int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specify the Delta table version to read from. Defaults to the latest version</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>storage_options</code></td>
            <td>
                  <code>optional dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Used to read from AWS/Azure storage. For AWS use format {"aws_access_key_id": "&lt;&gt;", "aws_secret_access_key":"&lt;&gt;"}. For Azure use format {"azure_storage_account_name": "&lt;&gt;", "azure_storage_account_key": "&lt;&gt;"}.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pyarrow_options</code></td>
            <td>
                  <code>optional dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data Access and Efficiency options when reading from Delta. See <a href="https://delta-io.github.io/delta-rs/python/api_reference.html#deltalake.table.DeltaTable.to_pyarrow_dataset" target="_blank">to_pyarrow_dataset</a>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>without_files</code></td>
            <td>
                  <code>optional bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True loads the table without tracking files</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/python/delta.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PythonDeltaSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Python Delta Source is used to read data from a Delta table without using Apache Spark, returning a Polars LazyFrame.</span>

<span class="sd">     Example</span>
<span class="sd">    --------</span>
<span class="sd">    === &quot;Azure&quot;</span>

<span class="sd">        ```python</span>
<span class="sd">        from rtdip_sdk.pipelines.sources import PythonDeltaSource</span>

<span class="sd">        path = &quot;abfss://{FILE-SYSTEM}@{ACCOUNT-NAME}.dfs.core.windows.net/{PATH}/{FILE-NAME}</span>

<span class="sd">        python_delta_source = PythonDeltaSource(</span>
<span class="sd">            path=path,</span>
<span class="sd">            version=None,</span>
<span class="sd">            storage_options={</span>
<span class="sd">                &quot;azure_storage_account_name&quot;: &quot;{AZURE-STORAGE-ACCOUNT-NAME}&quot;,</span>
<span class="sd">                &quot;azure_storage_account_key&quot;: &quot;{AZURE-STORAGE-ACCOUNT-KEY}&quot;</span>
<span class="sd">            },</span>
<span class="sd">            pyarrow_options=None,</span>
<span class="sd">            without_files=False</span>
<span class="sd">        )</span>

<span class="sd">        python_delta_source.read_batch()</span>
<span class="sd">        ```</span>
<span class="sd">    === &quot;AWS&quot;</span>

<span class="sd">        ```python</span>
<span class="sd">        from rtdip_sdk.pipelines.sources import PythonDeltaSource</span>

<span class="sd">        path = &quot;https://s3.{REGION-CODE}.amazonaws.com/{BUCKET-NAME}/{KEY-NAME}&quot;</span>

<span class="sd">        python_delta_source = PythonDeltaSource(</span>
<span class="sd">            path=path,</span>
<span class="sd">            version=None,</span>
<span class="sd">            storage_options={</span>
<span class="sd">                &quot;aws_access_key_id&quot;: &quot;{AWS-ACCESS-KEY-ID}&quot;,</span>
<span class="sd">                &quot;aws_secret_access_key&quot;: &quot;{AWS-SECRET-ACCESS-KEY}&quot;</span>
<span class="sd">            },</span>
<span class="sd">            pyarrow_options=None,</span>
<span class="sd">            without_files=False</span>
<span class="sd">        )</span>

<span class="sd">        python_delta_source.read_batch()</span>
<span class="sd">        ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        path (str): Path to the Delta table. Can be local or in S3/Azure storage</span>
<span class="sd">        version (optional int): Specify the Delta table version to read from. Defaults to the latest version</span>
<span class="sd">        storage_options (optional dict): Used to read from AWS/Azure storage. For AWS use format {&quot;aws_access_key_id&quot;: &quot;&lt;&gt;&quot;, &quot;aws_secret_access_key&quot;:&quot;&lt;&gt;&quot;}. For Azure use format {&quot;azure_storage_account_name&quot;: &quot;&lt;&gt;&quot;, &quot;azure_storage_account_key&quot;: &quot;&lt;&gt;&quot;}.</span>
<span class="sd">        pyarrow_options (optional dict): Data Access and Efficiency options when reading from Delta. See [to_pyarrow_dataset](https://delta-io.github.io/delta-rs/python/api_reference.html#deltalake.table.DeltaTable.to_pyarrow_dataset){ target=&quot;_blank&quot; }.</span>
<span class="sd">        without_files (optional bool): If True loads the table without tracking files</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">storage_options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">pyarrow_options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">without_files</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">storage_options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pyarrow_options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">without_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage_options</span> <span class="o">=</span> <span class="n">storage_options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyarrow_options</span> <span class="o">=</span> <span class="n">pyarrow_options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">without_files</span> <span class="o">=</span> <span class="n">without_files</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYTHON</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LazyFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads data from a Delta table into a Polars LazyFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">without_files_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;without_files&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">without_files</span><span class="p">}</span>
        <span class="n">lf</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">scan_delta</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_options</span><span class="p">,</span>
            <span class="n">delta_table_options</span><span class="o">=</span><span class="n">without_files_dict</span><span class="p">,</span>
            <span class="n">pyarrow_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pyarrow_options</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">lf</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: Reading from a Delta table using Python is only possible for batch reads. To perform a streaming read, use the read_stream method of the SparkDeltaSource component.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Reading from a Delta table using Python is only possible for batch reads. To perform a streaming read, use the read_stream method of the SparkDeltaSource component&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSource.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSource.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYTHON</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/python/delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYTHON</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads data from a Delta table into a Polars LazyFrame</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/python/delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LazyFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads data from a Delta table into a Polars LazyFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">without_files_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;without_files&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">without_files</span><span class="p">}</span>
    <span class="n">lf</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">scan_delta</span><span class="p">(</span>
        <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
        <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_options</span><span class="p">,</span>
        <span class="n">delta_table_options</span><span class="o">=</span><span class="n">without_files_dict</span><span class="p">,</span>
        <span class="n">pyarrow_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pyarrow_options</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">lf</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>NotImplementedError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reading from a Delta table using Python is only possible for batch reads. To perform a streaming read, use the read_stream method of the SparkDeltaSource component.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/python/delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: Reading from a Delta table using Python is only possible for batch reads. To perform a streaming read, use the read_stream method of the SparkDeltaSource component.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="s2">&quot;Reading from a Delta table using Python is only possible for batch reads. To perform a streaming read, use the read_stream method of the SparkDeltaSource component&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSharingSource" class="doc doc-heading">
            <code>PythonDeltaSharingSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>The Python Delta Sharing Source is used to read data from a Delta table with Delta Sharing configured, without using Apache Spark.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSharingSource--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">PythonDeltaSharingSource</span>

<span class="n">python_delta_sharing_source</span> <span class="o">=</span> <span class="n">PythonDeltaSharingSource</span><span class="p">(</span>
    <span class="n">profile_path</span><span class="o">=</span><span class="s2">&quot;{CREDENTIAL-FILE-LOCATION}&quot;</span><span class="p">,</span>
    <span class="n">share_name</span><span class="o">=</span><span class="s2">&quot;{SHARE-NAME}&quot;</span><span class="p">,</span>
    <span class="n">schema_name</span><span class="o">=</span><span class="s2">&quot;{SCHEMA-NAME}&quot;</span><span class="p">,</span>
    <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;{TABLE-NAME}&quot;</span>
<span class="p">)</span>

<span class="n">python_delta_sharing_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>profile_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Location of the credential file. Can be any URL supported by <a href="https://filesystem-spec.readthedocs.io/en/latest/index.html" target="_blank">FSSPEC</a></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>share_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value of 'share=' for the table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>schema_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value of 'schema=' for the table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>table_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value of 'name=' for the table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/python/delta_sharing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PythonDeltaSharingSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Python Delta Sharing Source is used to read data from a Delta table with Delta Sharing configured, without using Apache Spark.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.sources import PythonDeltaSharingSource</span>

<span class="sd">    python_delta_sharing_source = PythonDeltaSharingSource(</span>
<span class="sd">        profile_path=&quot;{CREDENTIAL-FILE-LOCATION}&quot;,</span>
<span class="sd">        share_name=&quot;{SHARE-NAME}&quot;,</span>
<span class="sd">        schema_name=&quot;{SCHEMA-NAME}&quot;,</span>
<span class="sd">        table_name=&quot;{TABLE-NAME}&quot;</span>
<span class="sd">    )</span>

<span class="sd">    python_delta_sharing_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        profile_path (str): Location of the credential file. Can be any URL supported by [FSSPEC](https://filesystem-spec.readthedocs.io/en/latest/index.html){ target=&quot;_blank&quot; }</span>
<span class="sd">        share_name (str): The value of &#39;share=&#39; for the table</span>
<span class="sd">        schema_name (str): The value of &#39;schema=&#39; for the table</span>
<span class="sd">        table_name (str): The value of &#39;name=&#39; for the table</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">profile_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">share_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">profile_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">share_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span> <span class="o">=</span> <span class="n">profile_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">share_name</span> <span class="o">=</span> <span class="n">share_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema_name</span> <span class="o">=</span> <span class="n">schema_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYTHON</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LazyFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads data from a Delta table with Delta Sharing into a Polars LazyFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pandas_df</span> <span class="o">=</span> <span class="n">delta_sharing</span><span class="o">.</span><span class="n">load_as_pandas</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">share_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">polars_lazyframe</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">pandas_df</span><span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">polars_lazyframe</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: Reading from a Delta table with Delta Sharing using Python is only possible for batch reads.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Reading from a Delta table with Delta Sharing using Python is only possible for batch reads.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSharingSource.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSharingSource.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYTHON</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/python/delta_sharing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYTHON</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSharingSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads data from a Delta table with Delta Sharing into a Polars LazyFrame.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/python/delta_sharing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LazyFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads data from a Delta table with Delta Sharing into a Polars LazyFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pandas_df</span> <span class="o">=</span> <span class="n">delta_sharing</span><span class="o">.</span><span class="n">load_as_pandas</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">share_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">polars_lazyframe</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">pandas_df</span><span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">polars_lazyframe</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaSharingSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>NotImplementedError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reading from a Delta table with Delta Sharing using Python is only possible for batch reads.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/python/delta_sharing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: Reading from a Delta table with Delta Sharing using Python is only possible for batch reads.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="s2">&quot;Reading from a Delta table with Delta Sharing using Python is only possible for batch reads.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkECMWFBaseMarsSource" class="doc doc-heading">
            <code>SparkECMWFBaseMarsSource</code>


</h2>


    <div class="doc doc-contents ">


      <p>Download nc files from ECMWF MARS server using the ECMWF python API.
Data is downloaded in parallel using joblib from ECMWF MARS server using the ECMWF python API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>save_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to local directory where the nc files will be stored, in format "yyyy-mm-dd_HH.nc"</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>date_start</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date of extraction in "YYYY-MM-DD HH:MM:SS" format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>date_end</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date of extraction in "YYYY-MM-DD HH:MM:SS" format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ecmwf_api_key</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>API key for ECMWF MARS server</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ecmwf_api_email</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email for ECMWF MARS server</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ecmwf_api_url</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URL for ECMWF MARS server</p>
              </div>
            </td>
            <td>
                  <code>&#39;https://api.ecmwf.int/v1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>run_frequency</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency format of runs to download, e.g. "H"</p>
              </div>
            </td>
            <td>
                  <code>&#39;H&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>run_interval</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interval of runs, e.g. a run_frequency of "H" and run_interval of "12" will extract the data of the 00 and 12 run for each day.</p>
              </div>
            </td>
            <td>
                  <code>&#39;12&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/ecmwf/base_mars.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkECMWFBaseMarsSource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download nc files from ECMWF MARS server using the ECMWF python API.</span>
<span class="sd">    Data is downloaded in parallel using joblib from ECMWF MARS server using the ECMWF python API.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        save_path (str): Path to local directory where the nc files will be stored, in format &quot;yyyy-mm-dd_HH.nc&quot;</span>
<span class="sd">        date_start (str): Start date of extraction in &quot;YYYY-MM-DD HH:MM:SS&quot; format</span>
<span class="sd">        date_end (str): End date of extraction in &quot;YYYY-MM-DD HH:MM:SS&quot; format</span>
<span class="sd">        ecmwf_api_key (str): API key for ECMWF MARS server</span>
<span class="sd">        ecmwf_api_email (str): Email for ECMWF MARS server</span>
<span class="sd">        ecmwf_api_url (str): URL for ECMWF MARS server</span>
<span class="sd">        run_frequency (str):Frequency format of runs to download, e.g. &quot;H&quot;</span>
<span class="sd">        run_interval (str): Interval of runs, e.g. a run_frequency of &quot;H&quot; and run_interval of &quot;12&quot; will extract the data of the 00 and 12 run for each day.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">date_start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">date_end</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ecmwf_api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ecmwf_api_email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ecmwf_api_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://api.ecmwf.int/v1&quot;</span><span class="p">,</span>
        <span class="n">run_interval</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;12&quot;</span><span class="p">,</span>
        <span class="n">run_frequency</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_ran</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_start</span> <span class="o">=</span> <span class="n">date_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_end</span> <span class="o">=</span> <span class="n">date_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">save_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="nb">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_interval</span> <span class="o">=</span> <span class="n">run_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_frequency</span> <span class="o">=</span> <span class="n">run_frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_key</span> <span class="o">=</span> <span class="n">ecmwf_api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_url</span> <span class="o">=</span> <span class="n">ecmwf_api_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_email</span> <span class="o">=</span> <span class="n">ecmwf_api_email</span>

        <span class="c1"># Pandas date_list (info best retrieved per forecast day)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
            <span class="n">start</span><span class="o">=</span><span class="n">date_start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">date_end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">run_interval</span> <span class="o">+</span> <span class="n">run_frequency</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">retrieve</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mars_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;loky&quot;</span><span class="p">,</span>
        <span class="n">tries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">cost</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the data from the server.</span>

<span class="sd">        Function will use the ecmwf api to download the data from the server.</span>
<span class="sd">        Note that mars has a max of two active requests per user and 20 queued</span>
<span class="sd">        requests.</span>
<span class="sd">        Data is downloaded in parallel using joblib from ECMWF MARS server using the ECMWF python API.</span>


<span class="sd">        Parameters:</span>
<span class="sd">            mars_dict (dict): Dictionary of mars parameters.</span>
<span class="sd">            n_jobs (int, optional): Download in parallel? by default None, i.e. no parallelization</span>
<span class="sd">            backend (str, optional) : Specify the parallelization backend implementation in joblib, by default &quot;loky&quot;</span>
<span class="sd">            tries (int, optional): Number of tries for each request if it fails, by default 5</span>
<span class="sd">            cost (bool, optional):  Pass a cost request to mars to estimate the size and efficiency of your request,</span>
<span class="sd">                but not actually download the data. Can be useful for defining requests,</span>
<span class="sd">                by default False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chk</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">chk</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mars_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;don&#39;t include </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> in the mars_dict&quot;</span><span class="p">)</span>

        <span class="n">parallel</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_retrieve_datetime</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">):</span>
            <span class="n">i_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">j</span><span class="p">}</span>

            <span class="k">if</span> <span class="n">cost</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">.txt&quot;</span>  <span class="c1"># NOSONAR</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">.nc&quot;</span>
                <span class="n">i_dict</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;netcdf&quot;</span>  <span class="c1"># NOSONAR</span>

            <span class="n">target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;retrieving mars data --- </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">req_dict</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">i_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">mars_dict</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">req_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="n">req_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">])</span>  <span class="c1"># NOSONAR</span>

            <span class="n">req_dict</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">req_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
            <span class="k">if</span> <span class="n">cost</span><span class="p">:</span>
                <span class="n">req_dict</span> <span class="o">=</span> <span class="s2">&quot;list,output=cost,</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">req_dict</span><span class="p">))</span>  <span class="c1"># NOSONAR</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">req_dict</span> <span class="o">=</span> <span class="s2">&quot;retrieve,</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">req_dict</span><span class="p">))</span>  <span class="c1"># NOSONAR</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tries</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="n">server</span> <span class="o">=</span> <span class="n">ECMWFService</span><span class="p">(</span>
                        <span class="s2">&quot;mars&quot;</span><span class="p">,</span>
                        <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_url</span><span class="p">,</span>
                        <span class="n">email</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_email</span><span class="p">,</span>
                        <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_key</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">server</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">req_dict</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                    <span class="k">return</span> <span class="mi">1</span>  <span class="c1"># NOSONAR</span>
                <span class="k">except</span><span class="p">:</span>  <span class="c1"># NOSONAR</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">tries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">continue</span>  <span class="c1"># NOSONAR</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># NOSONAR</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="n">parallel</span><span class="p">(</span>
            <span class="n">delayed</span><span class="p">(</span><span class="n">_retrieve_datetime</span><span class="p">)(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">date</span><span class="p">()),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="o">.</span><span class="n">hour</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_ran</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return info on each ECMWF request.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.Series: Successful request for each run == 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_ran</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Before using self.info(), prepare the request using &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;self.retrieve()&quot;</span>
            <span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkECMWFBaseMarsSource.retrieve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">retrieve</span><span class="p">(</span><span class="n">mars_dict</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;loky&#39;</span><span class="p">,</span> <span class="n">tries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Retrieve the data from the server.</p>
<p>Function will use the ecmwf api to download the data from the server.
Note that mars has a max of two active requests per user and 20 queued
requests.
Data is downloaded in parallel using joblib from ECMWF MARS server using the ECMWF python API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>mars_dict</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of mars parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>n_jobs</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Download in parallel? by default None, i.e. no parallelization</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>backend</code></td>
            <td>
                  <code>str, optional) </code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specify the parallelization backend implementation in joblib, by default "loky"</p>
              </div>
            </td>
            <td>
                  <code>&#39;loky&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tries</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of tries for each request if it fails, by default 5</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cost</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pass a cost request to mars to estimate the size and efficiency of your request,
but not actually download the data. Can be useful for defining requests,
by default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/ecmwf/base_mars.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">retrieve</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">mars_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;loky&quot;</span><span class="p">,</span>
    <span class="n">tries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">cost</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the data from the server.</span>

<span class="sd">    Function will use the ecmwf api to download the data from the server.</span>
<span class="sd">    Note that mars has a max of two active requests per user and 20 queued</span>
<span class="sd">    requests.</span>
<span class="sd">    Data is downloaded in parallel using joblib from ECMWF MARS server using the ECMWF python API.</span>


<span class="sd">    Parameters:</span>
<span class="sd">        mars_dict (dict): Dictionary of mars parameters.</span>
<span class="sd">        n_jobs (int, optional): Download in parallel? by default None, i.e. no parallelization</span>
<span class="sd">        backend (str, optional) : Specify the parallelization backend implementation in joblib, by default &quot;loky&quot;</span>
<span class="sd">        tries (int, optional): Number of tries for each request if it fails, by default 5</span>
<span class="sd">        cost (bool, optional):  Pass a cost request to mars to estimate the size and efficiency of your request,</span>
<span class="sd">            but not actually download the data. Can be useful for defining requests,</span>
<span class="sd">            by default False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chk</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">chk</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mars_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;don&#39;t include </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> in the mars_dict&quot;</span><span class="p">)</span>

    <span class="n">parallel</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_retrieve_datetime</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">):</span>
        <span class="n">i_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">j</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">cost</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">.txt&quot;</span>  <span class="c1"># NOSONAR</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">.nc&quot;</span>
            <span class="n">i_dict</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;netcdf&quot;</span>  <span class="c1"># NOSONAR</span>

        <span class="n">target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;retrieving mars data --- </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">req_dict</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">i_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">mars_dict</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">req_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">req_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">])</span>  <span class="c1"># NOSONAR</span>

        <span class="n">req_dict</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">req_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">cost</span><span class="p">:</span>
            <span class="n">req_dict</span> <span class="o">=</span> <span class="s2">&quot;list,output=cost,</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">req_dict</span><span class="p">))</span>  <span class="c1"># NOSONAR</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">req_dict</span> <span class="o">=</span> <span class="s2">&quot;retrieve,</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">req_dict</span><span class="p">))</span>  <span class="c1"># NOSONAR</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tries</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">server</span> <span class="o">=</span> <span class="n">ECMWFService</span><span class="p">(</span>
                    <span class="s2">&quot;mars&quot;</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_url</span><span class="p">,</span>
                    <span class="n">email</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_email</span><span class="p">,</span>
                    <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_key</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">server</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">req_dict</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">1</span>  <span class="c1"># NOSONAR</span>
            <span class="k">except</span><span class="p">:</span>  <span class="c1"># NOSONAR</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">tries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># NOSONAR</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># NOSONAR</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="n">parallel</span><span class="p">(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">_retrieve_datetime</span><span class="p">)(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">date</span><span class="p">()),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="o">.</span><span class="n">hour</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_ran</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkECMWFBaseMarsSource.info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">info</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return info on each ECMWF request.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.Series: Successful request for each run == 1.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/ecmwf/base_mars.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return info on each ECMWF request.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.Series: Successful request for each run == 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_ran</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Before using self.info(), prepare the request using &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;self.retrieve()&quot;</span>
        <span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkECMWFWeatherForecastSource" class="doc doc-heading">
            <code>SparkECMWFWeatherForecastSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>The Weather Forecast API V1 Source class to doownload nc files from ECMWF MARS server using the ECMWF python API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>save_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to local directory where the nc files will be stored, in format "yyyy-mm-dd_HH.nc"</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>date_start</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date of extraction in "YYYY-MM-DD HH:MM:SS" format    date_end:str,</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>date_end</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date of extraction in "YYYY-MM-DD HH:MM:SS" format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ecmwf_class</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ecmwf classification of data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>stream</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Operational model stream</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>expver</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Version of data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>leveltype</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surface level forecasts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ec_vars</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variables of forecast measurements.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>forecast_area</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>N/W/S/E coordinates of the forecast area</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ecmwf_api_key</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>API key for ECMWF API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ecmwf_api_email</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email for ECMWF API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/ecmwf/weather_forecast.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkECMWFWeatherForecastSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Weather Forecast API V1 Source class to doownload nc files from ECMWF MARS server using the ECMWF python API.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance</span>
<span class="sd">        save_path (str): Path to local directory where the nc files will be stored, in format &quot;yyyy-mm-dd_HH.nc&quot;</span>
<span class="sd">        date_start (str): Start date of extraction in &quot;YYYY-MM-DD HH:MM:SS&quot; format    date_end:str,</span>
<span class="sd">        date_end (str): End date of extraction in &quot;YYYY-MM-DD HH:MM:SS&quot; format</span>
<span class="sd">        ecmwf_class (str): ecmwf classification of data</span>
<span class="sd">        stream (str): Operational model stream</span>
<span class="sd">        expver (str): Version of data</span>
<span class="sd">        leveltype (str): Surface level forecasts</span>
<span class="sd">        ec_vars (list): Variables of forecast measurements.</span>
<span class="sd">        forecast_area (list): N/W/S/E coordinates of the forecast area</span>
<span class="sd">        ecmwf_api_key (str): API key for ECMWF API</span>
<span class="sd">        ecmwf_api_email (str): Email for ECMWF API</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">date_start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">date_end</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ecmwf_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">stream</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">expver</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">leveltype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ec_vars</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">forecast_area</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">ecmwf_api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ecmwf_api_email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">save_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_start</span> <span class="o">=</span> <span class="n">date_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_end</span> <span class="o">=</span> <span class="n">date_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_class</span> <span class="o">=</span> <span class="n">ecmwf_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">stream</span>  <span class="c1"># operational model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expver</span> <span class="o">=</span> <span class="n">expver</span>  <span class="c1"># experiment version of data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leveltype</span> <span class="o">=</span> <span class="n">leveltype</span>  <span class="c1"># surface level forecasts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ec_vars</span> <span class="o">=</span> <span class="n">ec_vars</span>  <span class="c1"># variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forecast_area</span> <span class="o">=</span> <span class="n">forecast_area</span>  <span class="c1"># N/W/S/E</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_key</span> <span class="o">=</span> <span class="n">ecmwf_api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_email</span> <span class="o">=</span> <span class="n">ecmwf_api_email</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_lead_time</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lead time for the forecast data.</span>
<span class="sd">        90 hours - 1 Hour Interval</span>
<span class="sd">        90-146 - 3 Hour interval</span>
<span class="sd">        146 -246 - 6 Hour interval</span>

<span class="sd">        Returns:</span>
<span class="sd">            lead_times: Lead times in an array format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lead_times</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">91</span><span class="p">),</span> <span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">93</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">246</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lead_times</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lead_times</span>

    <span class="k">def</span> <span class="nf">_get_api_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lead_times</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        API parameters for the forecast data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            params (dict): API parameters for the forecast data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_class</span><span class="p">,</span>  <span class="c1"># ecmwf classification of data</span>
            <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">,</span>  <span class="c1"># operational model</span>
            <span class="s2">&quot;expver&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">expver</span><span class="p">,</span>  <span class="c1"># experiment version of data</span>
            <span class="s2">&quot;levtype&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">leveltype</span><span class="p">,</span>  <span class="c1"># surface level forecasts</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fc&quot;</span><span class="p">,</span>  <span class="c1"># forecasts</span>
            <span class="s2">&quot;param&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ec_vars</span><span class="p">,</span>  <span class="c1"># variables</span>
            <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">lead_times</span><span class="p">,</span>  <span class="c1"># which lead times to download</span>
            <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_area</span><span class="p">,</span>  <span class="c1"># N/W/S/E</span>
            <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>  <span class="c1"># grid res of output</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pulls data from the Weather API and returns as .nc files.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lead_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lead_time</span><span class="p">()</span>
        <span class="n">para</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_api_params</span><span class="p">(</span><span class="n">lead_times</span><span class="o">=</span><span class="n">lead_times</span><span class="p">)</span>

        <span class="n">ec_conn</span> <span class="o">=</span> <span class="n">SparkECMWFBaseMarsSource</span><span class="p">(</span>
            <span class="n">date_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_start</span><span class="p">,</span>
            <span class="n">date_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_end</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span>
            <span class="n">run_interval</span><span class="o">=</span><span class="s2">&quot;12&quot;</span><span class="p">,</span>
            <span class="n">run_frequency</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="p">,</span>
            <span class="n">ecmwf_api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_key</span><span class="p">,</span>
            <span class="n">ecmwf_api_email</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_email</span><span class="p">,</span>
            <span class="n">ecmwf_api_url</span><span class="o">=</span><span class="s2">&quot;https://api.ecmwf.int/v1&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ec_conn</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
            <span class="n">mars_dict</span><span class="o">=</span><span class="n">para</span><span class="p">,</span>
            <span class="n">tries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># maximum of 20 queued requests per user (only two allowed active)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkECMWFWeatherForecastSource.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkECMWFWeatherForecastSource.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/ecmwf/weather_forecast.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkECMWFWeatherForecastSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Pulls data from the Weather API and returns as .nc files.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/ecmwf/weather_forecast.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pulls data from the Weather API and returns as .nc files.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lead_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lead_time</span><span class="p">()</span>
    <span class="n">para</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_api_params</span><span class="p">(</span><span class="n">lead_times</span><span class="o">=</span><span class="n">lead_times</span><span class="p">)</span>

    <span class="n">ec_conn</span> <span class="o">=</span> <span class="n">SparkECMWFBaseMarsSource</span><span class="p">(</span>
        <span class="n">date_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_start</span><span class="p">,</span>
        <span class="n">date_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_end</span><span class="p">,</span>
        <span class="n">save_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span>
        <span class="n">run_interval</span><span class="o">=</span><span class="s2">&quot;12&quot;</span><span class="p">,</span>
        <span class="n">run_frequency</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="p">,</span>
        <span class="n">ecmwf_api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_key</span><span class="p">,</span>
        <span class="n">ecmwf_api_email</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ecmwf_api_email</span><span class="p">,</span>
        <span class="n">ecmwf_api_url</span><span class="o">=</span><span class="s2">&quot;https://api.ecmwf.int/v1&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ec_conn</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
        <span class="n">mars_dict</span><span class="o">=</span><span class="n">para</span><span class="p">,</span>
        <span class="n">tries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># maximum of 20 queued requests per user (only two allowed active)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource" class="doc doc-heading">
            <code>SparkDeltaSource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.sources.interfaces.SourceInterface">SourceInterface</span></code></p>


      <p>The Spark Delta Source is used to read data from a Delta table.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource--example">Example</h4>
<p><div class="highlight"><pre><span></span><code><span class="c1">#Delta Source for Streaming Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkDeltaSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">delta_source</span> <span class="o">=</span> <span class="n">SparkDeltaSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;maxFilesPerTrigger&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">&quot;ignoreChanges: True,</span>
        <span class="s2">&quot;startingVersion&quot;</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">},</span>
    <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;{YOUR-DELTA-TABLE-PATH}&quot;</span>
<span class="p">)</span>

<span class="n">delta_source</span><span class="o">.</span><span class="n">read_stream</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">#Delta Source for Batch Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkDeltaSource</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">delta_source</span> <span class="o">=</span> <span class="n">SparkDeltaSource</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;versionAsOf&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;timestampAsOf&quot;</span><span class="p">:</span> <span class="s2">&quot;yyyy-mm-dd hh:mm:ss[.fffffffff]&quot;</span>
    <span class="p">},</span>
    <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;{YOUR-DELTA-TABLE-PATH}&quot;</span>
<span class="p">)</span>

<span class="n">delta_source</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session required to read data from a Delta table.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Options that can be specified for a Delta Table read operation (See Attributes table below). Further information on the options is available for <a href="https://docs.delta.io/latest/delta-batch.html#read-a-table" target="_blank">batch</a> and <a href="https://docs.delta.io/latest/delta-streaming.html#delta-table-as-a-source" target="_blank">streaming</a>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>table_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the Hive Metastore or Unity Catalog Delta Table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource.maxFilesPerTrigger">maxFilesPerTrigger</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many new files to be considered in every micro-batch. The default is 1000. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource.maxBytesPerTrigger">maxBytesPerTrigger</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How much data gets processed in each micro-batch. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource.ignoreDeletes">ignoreDeletes</span></code></td>
            <td>
                  <code>bool str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ignore transactions that delete data at partition boundaries. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource.ignoreChanges">ignoreChanges</span></code></td>
            <td>
                  <code>bool str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-process updates if files had to be rewritten in the source table due to a data changing operation. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource.startingVersion">startingVersion</span></code></td>
            <td>
                  <code>int str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Delta Lake version to start from. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource.startingTimestamp">startingTimestamp</span></code></td>
            <td>
                  <code>datetime str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The timestamp to start from. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource.withEventTimeOrder">withEventTimeOrder</span></code></td>
            <td>
                  <code>bool str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the initial snapshot should be processed with event time order. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource.timestampAsOf">timestampAsOf</span></code></td>
            <td>
                  <code>datetime str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Query the Delta Table from a specific point in time. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource.versionAsOf">versionAsOf</span></code></td>
            <td>
                  <code>int str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Query the Delta Table from a specific version. (Batch)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/delta.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkDeltaSource</span><span class="p">(</span><span class="n">SourceInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Spark Delta Source is used to read data from a Delta table.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    #Delta Source for Streaming Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.sources import SparkDeltaSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    delta_source = SparkDeltaSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;maxFilesPerTrigger&quot;: 1000,</span>
<span class="sd">            &quot;ignoreChanges: True,</span>
<span class="sd">            &quot;startingVersion&quot;: 0</span>
<span class="sd">        },</span>
<span class="sd">        table_name=&quot;{YOUR-DELTA-TABLE-PATH}&quot;</span>
<span class="sd">    )</span>

<span class="sd">    delta_source.read_stream()</span>
<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">    #Delta Source for Batch Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.sources import SparkDeltaSource</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    delta_source = SparkDeltaSource(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;versionAsOf&quot;: 0,</span>
<span class="sd">            &quot;timestampAsOf&quot;: &quot;yyyy-mm-dd hh:mm:ss[.fffffffff]&quot;</span>
<span class="sd">        },</span>
<span class="sd">        table_name=&quot;{YOUR-DELTA-TABLE-PATH}&quot;</span>
<span class="sd">    )</span>

<span class="sd">    delta_source.read_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session required to read data from a Delta table.</span>
<span class="sd">        options (dict): Options that can be specified for a Delta Table read operation (See Attributes table below). Further information on the options is available for [batch](https://docs.delta.io/latest/delta-batch.html#read-a-table){ target=&quot;_blank&quot; } and [streaming](https://docs.delta.io/latest/delta-streaming.html#delta-table-as-a-source){ target=&quot;_blank&quot; }.</span>
<span class="sd">        table_name (str): Name of the Hive Metastore or Unity Catalog Delta Table</span>

<span class="sd">    Attributes:</span>
<span class="sd">        maxFilesPerTrigger (int): How many new files to be considered in every micro-batch. The default is 1000. (Streaming)</span>
<span class="sd">        maxBytesPerTrigger (int): How much data gets processed in each micro-batch. (Streaming)</span>
<span class="sd">        ignoreDeletes (bool str): Ignore transactions that delete data at partition boundaries. (Streaming)</span>
<span class="sd">        ignoreChanges (bool str): Pre-process updates if files had to be rewritten in the source table due to a data changing operation. (Streaming)</span>
<span class="sd">        startingVersion (int str): The Delta Lake version to start from. (Streaming)</span>
<span class="sd">        startingTimestamp (datetime str): The timestamp to start from. (Streaming)</span>
<span class="sd">        withEventTimeOrder (bool str): Whether the initial snapshot should be processed with event time order. (Streaming)</span>
<span class="sd">        timestampAsOf (datetime str): Query the Delta Table from a specific point in time. (Batch)</span>
<span class="sd">        versionAsOf (int str): Query the Delta Table from a specific version. (Batch)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_delta_core&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_read_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads batch data from Delta. Most of the options provided by the Apache Spark DataFrame read API are supported for performing batch reads on Delta tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads streaming data from Delta. All of the data in the table is processed as well as any new data that arrives after the stream started. .load() can take table name or path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource.read_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads batch data from Delta. Most of the options provided by the Apache Spark DataFrame read API are supported for performing batch reads on Delta tables.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads batch data from Delta. Most of the options provided by the Apache Spark DataFrame read API are supported for performing batch reads on Delta tables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaSource.read_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads streaming data from Delta. All of the data in the table is processed as well as any new data that arrives after the stream started. .load() can take table name or path.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/sources/spark/delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads streaming data from Delta. All of the data in the table is processed as well as any new data that arrives after the stream started. .load() can take table name or path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.BinaryToStringTransformer" class="doc doc-heading">
            <code>BinaryToStringTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a dataframe body column from a binary to a string.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.BinaryToStringTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">BinaryToStringTransformer</span>

<span class="n">binary_to_string_transformer</span> <span class="o">=</span> <span class="n">BinaryToStringTransformer</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">souce_column_name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="p">,</span>
    <span class="n">target_column_name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">binary_to_string_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe to be transformed</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe column containing the Binary data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>target_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe column name to be used for the String data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/binary_to_string.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BinaryToStringTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a dataframe body column from a binary to a string.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import BinaryToStringTransformer</span>

<span class="sd">    binary_to_string_transformer = BinaryToStringTransformer(</span>
<span class="sd">        data=df,</span>
<span class="sd">        souce_column_name=&quot;body&quot;,</span>
<span class="sd">        target_column_name=&quot;body&quot;</span>
<span class="sd">    )</span>

<span class="sd">    result = binary_to_string_transformer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe to be transformed</span>
<span class="sd">        source_column_name (str): Spark Dataframe column containing the Binary data</span>
<span class="sd">        target_column_name (str): Spark Dataframe column name to be used for the String data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">target_column_name</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_column_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">=</span> <span class="n">source_column_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_column_name</span> <span class="o">=</span> <span class="n">target_column_name</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the body column converted to string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.BinaryToStringTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.BinaryToStringTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/binary_to_string.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.BinaryToStringTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the body column converted to string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/binary_to_string.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the body column converted to string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCPublisherOPCUAJsonToPCDMTransformer" class="doc doc-heading">
            <code>OPCPublisherOPCUAJsonToPCDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Spark Dataframe column containing a json string created by OPC Publisher to the Process Control Data Model.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCPublisherOPCUAJsonToPCDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">OPCPublisherOPCUAJsonToPCDMTransformer</span>

<span class="n">opc_publisher_opcua_json_to_pcdm_transformer</span> <span class="o">=</span> <span class="n">OPCPublisherOPCUAJsonToPCDMTransformer</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">souce_column_name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="p">,</span>
    <span class="n">multiple_rows_per_message</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">status_null_value</span><span class="o">=</span><span class="s2">&quot;Good&quot;</span><span class="p">,</span>
    <span class="n">change_type_value</span><span class="o">=</span><span class="s2">&quot;insert&quot;</span><span class="p">,</span>
    <span class="n">timestamp_formats</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ssX&quot;</span>
    <span class="p">],</span>
    <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">opc_publisher_opcua_json_to_pcdm_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe containing the column with Json OPC UA data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe column containing the OPC Publisher Json OPC UA data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>multiple_rows_per_message</code></td>
            <td>
                  <code>optional bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Each Dataframe Row contains an array of/multiple OPC UA messages. The list of Json will be exploded into rows in the Dataframe.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>status_null_value</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace null values in the Status column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>change_type_value</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'insert' in the ChangeType column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;insert&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>timestamp_formats</code></td>
            <td>
                  <code>optional list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specifies the timestamp formats to be used for converting the timestamp string to a Timestamp Type. For more information on formats, refer to this <a href="https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html">documentation.</a></p>
              </div>
            </td>
            <td>
                  <code>[&#34;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX&#34;, &#34;yyyy-MM-dd&#39;T&#39;HH:mm:ssX&#34;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filter</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Enables providing a filter to the data which can be required in certain scenarios. For example, it would be possible to filter on IoT Hub Device Id and Module by providing a filter in SQL format such as <code>systemProperties.iothub-connection-device-id = "&lt;Device Id&gt;" AND systemProperties.iothub-connection-module-id = "&lt;Module&gt;"</code></p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/opc_publisher_opcua_json_to_pcdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">OPCPublisherOPCUAJsonToPCDMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Spark Dataframe column containing a json string created by OPC Publisher to the Process Control Data Model.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import OPCPublisherOPCUAJsonToPCDMTransformer</span>

<span class="sd">    opc_publisher_opcua_json_to_pcdm_transformer = OPCPublisherOPCUAJsonToPCDMTransformer(</span>
<span class="sd">        data=df,</span>
<span class="sd">        souce_column_name=&quot;body&quot;,</span>
<span class="sd">        multiple_rows_per_message=True,</span>
<span class="sd">        status_null_value=&quot;Good&quot;,</span>
<span class="sd">        change_type_value=&quot;insert&quot;,</span>
<span class="sd">        timestamp_formats=[</span>
<span class="sd">            &quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX&quot;,</span>
<span class="sd">            &quot;yyyy-MM-dd&#39;T&#39;HH:mm:ssX&quot;</span>
<span class="sd">        ],</span>
<span class="sd">        filter=None</span>
<span class="sd">    )</span>

<span class="sd">    result = opc_publisher_opcua_json_to_pcdm_transformer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe containing the column with Json OPC UA data</span>
<span class="sd">        source_column_name (str): Spark Dataframe column containing the OPC Publisher Json OPC UA data</span>
<span class="sd">        multiple_rows_per_message (optional bool): Each Dataframe Row contains an array of/multiple OPC UA messages. The list of Json will be exploded into rows in the Dataframe.</span>
<span class="sd">        status_null_value (optional str): If populated, will replace null values in the Status column with the specified value.</span>
<span class="sd">        change_type_value (optional str): If populated, will replace &#39;insert&#39; in the ChangeType column with the specified value.</span>
<span class="sd">        timestamp_formats (optional list[str]): Specifies the timestamp formats to be used for converting the timestamp string to a Timestamp Type. For more information on formats, refer to this [documentation.](https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html)</span>
<span class="sd">        filter (optional str): Enables providing a filter to the data which can be required in certain scenarios. For example, it would be possible to filter on IoT Hub Device Id and Module by providing a filter in SQL format such as `systemProperties.iothub-connection-device-id = &quot;&lt;Device Id&gt;&quot; AND systemProperties.iothub-connection-module-id = &quot;&lt;Module&gt;&quot;`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">multiple_rows_per_message</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">tagname_field</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp_formats</span><span class="p">:</span> <span class="nb">list</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">multiple_rows_per_message</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tagname_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DisplayName&quot;</span><span class="p">,</span>
        <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;insert&quot;</span><span class="p">,</span>
        <span class="n">timestamp_formats</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX&quot;</span><span class="p">,</span>
            <span class="s2">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ssX&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># NOSONAR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">=</span> <span class="n">source_column_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiple_rows_per_message</span> <span class="o">=</span> <span class="n">multiple_rows_per_message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tagname_field</span> <span class="o">=</span> <span class="n">tagname_field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span> <span class="o">=</span> <span class="n">status_null_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span> <span class="o">=</span> <span class="n">change_type_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_formats</span> <span class="o">=</span> <span class="n">timestamp_formats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="nb">filter</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiple_rows_per_message</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
                <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="n">ArrayType</span><span class="p">(</span><span class="n">StringType</span><span class="p">())),</span>
            <span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">explode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
                <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="n">StringType</span><span class="p">()),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;OPCUA&quot;</span><span class="p">,</span> <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="n">OPC_PUBLISHER_SCHEMA</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCUA.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagname_field</span><span class="p">))))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span>
                <span class="n">coalesce</span><span class="p">(</span>
                    <span class="o">*</span><span class="p">[</span>
                        <span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCUA.Value.SourceTimestamp&quot;</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_formats</span>
                    <span class="p">]</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCUA.Value.Value&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
                <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">status_col_name</span> <span class="o">=</span> <span class="s2">&quot;OPCUA.Value.StatusCode.Symbol&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;Status&quot;</span><span class="p">,</span>
                <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">status_col_name</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span> <span class="n">col</span><span class="p">(</span><span class="n">status_col_name</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                    <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">status_col_name</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCPublisherOPCUAJsonToPCDMTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCPublisherOPCUAJsonToPCDMTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/opc_publisher_opcua_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCPublisherOPCUAJsonToPCDMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the specified column converted to PCDM</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/opc_publisher_opcua_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiple_rows_per_message</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
            <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="n">ArrayType</span><span class="p">(</span><span class="n">StringType</span><span class="p">())),</span>
        <span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">explode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
            <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="n">StringType</span><span class="p">()),</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;OPCUA&quot;</span><span class="p">,</span> <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="n">OPC_PUBLISHER_SCHEMA</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCUA.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagname_field</span><span class="p">))))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span>
            <span class="n">coalesce</span><span class="p">(</span>
                <span class="o">*</span><span class="p">[</span>
                    <span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCUA.Value.SourceTimestamp&quot;</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_formats</span>
                <span class="p">]</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCUA.Value.Value&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
            <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="n">status_col_name</span> <span class="o">=</span> <span class="s2">&quot;OPCUA.Value.StatusCode.Symbol&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;Status&quot;</span><span class="p">,</span>
            <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">status_col_name</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span> <span class="n">col</span><span class="p">(</span><span class="n">status_col_name</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">status_col_name</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCPublisherOPCAEJsonToPCDMTransformer" class="doc doc-heading">
            <code>OPCPublisherOPCAEJsonToPCDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Spark Dataframe column containing a json string created by OPC Publisher for A&amp;E(Alarm &amp;Events) data to the Process Control Data Model.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCPublisherOPCAEJsonToPCDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">OPCPublisherOPCAEJsonToPCDMTransformer</span>

<span class="n">opc_publisher_opcae_json_to_pcdm_transformer</span> <span class="o">=</span> <span class="n">OPCPublisherOPCAEJsonToPCDMTransformer</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">souce_column_name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="p">,</span>
    <span class="n">timestamp_formats</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ssX&quot;</span>
    <span class="p">],</span>
    <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">opc_publisher_opcae_json_to_pcdm_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe containing the column with Json OPC AE data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe column containing the OPC Publisher Json OPC AE data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>timestamp_formats</code></td>
            <td>
                  <code>optional list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specifies the timestamp formats to be used for converting the timestamp string to a Timestamp Type. For more information on formats, refer to this <a href="https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html">documentation.</a></p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filter</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Enables providing a filter to the data which can be required in certain scenarios. For example, it would be possible to filter on IoT Hub Device Id and Module by providing a filter in SQL format such as <code>systemProperties.iothub-connection-device-id = "&lt;Device Id&gt;" AND systemProperties.iothub-connection-module-id = "&lt;Module&gt;"</code></p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/opc_publisher_opcae_json_to_pcdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">OPCPublisherOPCAEJsonToPCDMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Spark Dataframe column containing a json string created by OPC Publisher for A&amp;E(Alarm &amp;Events) data to the Process Control Data Model.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import OPCPublisherOPCAEJsonToPCDMTransformer</span>

<span class="sd">    opc_publisher_opcae_json_to_pcdm_transformer = OPCPublisherOPCAEJsonToPCDMTransformer(</span>
<span class="sd">        data=df,</span>
<span class="sd">        souce_column_name=&quot;body&quot;,</span>
<span class="sd">        timestamp_formats=[</span>
<span class="sd">            &quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX&quot;,</span>
<span class="sd">            &quot;yyyy-MM-dd&#39;T&#39;HH:mm:ssX&quot;</span>
<span class="sd">        ],</span>
<span class="sd">        filter=None</span>
<span class="sd">    )</span>

<span class="sd">    result = opc_publisher_opcae_json_to_pcdm_transformer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe containing the column with Json OPC AE data</span>
<span class="sd">        source_column_name (str): Spark Dataframe column containing the OPC Publisher Json OPC AE data</span>
<span class="sd">        timestamp_formats (optional list[str]): Specifies the timestamp formats to be used for converting the timestamp string to a Timestamp Type. For more information on formats, refer to this [documentation.](https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html)</span>
<span class="sd">        filter (optional str): Enables providing a filter to the data which can be required in certain scenarios. For example, it would be possible to filter on IoT Hub Device Id and Module by providing a filter in SQL format such as `systemProperties.iothub-connection-device-id = &quot;&lt;Device Id&gt;&quot; AND systemProperties.iothub-connection-module-id = &quot;&lt;Module&gt;&quot;`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp_formats</span><span class="p">:</span> <span class="nb">list</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">timestamp_formats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># NOSONAR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">=</span> <span class="n">source_column_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_formats</span> <span class="o">=</span> <span class="n">timestamp_formats</span> <span class="ow">or</span> <span class="p">[</span>
            <span class="s2">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX&quot;</span><span class="p">,</span>
            <span class="s2">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ssX&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="nb">filter</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the OPC Publisher A&amp;E data converted to the Process Control Data Model</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
            <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="n">ArrayType</span><span class="p">(</span><span class="n">StringType</span><span class="p">())),</span>
        <span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">explode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;OPCAE&quot;</span><span class="p">,</span> <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="n">OPC_PUBLISHER_AE_SCHEMA</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.NodeId&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.DisplayName&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.ConditionId.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ConditionId&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.AckedState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;AckedState&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.AckedState/FalseState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
                <span class="s2">&quot;AckedState/FalseState&quot;</span>
            <span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.AckedState/Id.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;AckedState/Id&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.AckedState/TrueState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;AckedState/TrueState&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.ActiveState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ActiveState&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.ActiveState/FalseState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
                <span class="s2">&quot;ActiveState/FalseState&quot;</span>
            <span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.ActiveState/Id.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ActiveState/Id&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.ActiveState/TrueState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
                <span class="s2">&quot;ActiveState/TrueState&quot;</span>
            <span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.EnabledState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EnabledState&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.EnabledState/FalseState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
                <span class="s2">&quot;EnabledState/FalseState&quot;</span>
            <span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.EnabledState/Id.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EnabledState/Id&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.EnabledState/TrueState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
                <span class="s2">&quot;EnabledState/TrueState&quot;</span>
            <span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.EventId.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventId&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.EventType.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventType&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.HighHighLimit.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;HighHighLimit&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.HighLimit.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;HighLimit&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.InputNode.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;InputNode&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.LowLimit.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;LowLimit&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.LowLowLimit.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;LowLowLimit&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.Message.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Message&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.Quality.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Quality&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.ReceiveTime.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ReceiveTime&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.Retain.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Retain&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.Severity.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Severity&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.SourceName.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;SourceName&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.SourceNode.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;SourceNode&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.Time.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span>
            <span class="n">coalesce</span><span class="p">(</span>
                <span class="o">*</span><span class="p">[</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_formats</span><span class="p">]</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCPublisherOPCAEJsonToPCDMTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCPublisherOPCAEJsonToPCDMTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/opc_publisher_opcae_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCPublisherOPCAEJsonToPCDMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the OPC Publisher A&amp;E data converted to the Process Control Data Model</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/opc_publisher_opcae_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the OPC Publisher A&amp;E data converted to the Process Control Data Model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
        <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="n">ArrayType</span><span class="p">(</span><span class="n">StringType</span><span class="p">())),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">explode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
        <span class="s2">&quot;OPCAE&quot;</span><span class="p">,</span> <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="n">OPC_PUBLISHER_AE_SCHEMA</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.NodeId&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.DisplayName&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.ConditionId.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ConditionId&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.AckedState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;AckedState&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.AckedState/FalseState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
            <span class="s2">&quot;AckedState/FalseState&quot;</span>
        <span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.AckedState/Id.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;AckedState/Id&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.AckedState/TrueState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;AckedState/TrueState&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.ActiveState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ActiveState&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.ActiveState/FalseState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
            <span class="s2">&quot;ActiveState/FalseState&quot;</span>
        <span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.ActiveState/Id.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ActiveState/Id&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.ActiveState/TrueState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
            <span class="s2">&quot;ActiveState/TrueState&quot;</span>
        <span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.EnabledState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EnabledState&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.EnabledState/FalseState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
            <span class="s2">&quot;EnabledState/FalseState&quot;</span>
        <span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.EnabledState/Id.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EnabledState/Id&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.EnabledState/TrueState.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
            <span class="s2">&quot;EnabledState/TrueState&quot;</span>
        <span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.EventId.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventId&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.EventType.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventType&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.HighHighLimit.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;HighHighLimit&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.HighLimit.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;HighLimit&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.InputNode.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;InputNode&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.LowLimit.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;LowLimit&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.LowLowLimit.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;LowLowLimit&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.Message.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Message&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.Quality.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Quality&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.ReceiveTime.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ReceiveTime&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.Retain.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Retain&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.Severity.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Severity&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.SourceName.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;SourceName&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.SourceNode.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;SourceNode&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;OPCAE.Value.Time.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
        <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span>
        <span class="n">coalesce</span><span class="p">(</span>
            <span class="o">*</span><span class="p">[</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_formats</span><span class="p">]</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.FledgeOPCUAJsonToPCDMTransformer" class="doc doc-heading">
            <code>FledgeOPCUAJsonToPCDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Spark Dataframe column containing a json string created by Fledge to the Process Control Data Model.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.FledgeOPCUAJsonToPCDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">FledgeOPCUAJsonToPCDMTransformer</span>

<span class="n">fledge_opcua_json_to_pcdm_transfromer</span> <span class="o">=</span> <span class="n">FledgeOPCUAJsonToPCDMTransformer</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">souce_column_name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="p">,</span>
    <span class="n">status_null_value</span><span class="o">=</span><span class="s2">&quot;Good&quot;</span><span class="p">,</span>
    <span class="n">change_type_value</span><span class="o">=</span><span class="s2">&quot;insert&quot;</span><span class="p">,</span>
    <span class="n">timestamp_formats</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ssX&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">fledge_opcua_json_to_pcdm_transfromer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe containing the column with Json Fledge data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe column containing the OPC Publisher Json OPC UA data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>status_null_value</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'Good' in the Status column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Good&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>change_type_value</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'insert' in the ChangeType column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;insert&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>timestamp_formats</code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specifies the timestamp formats to be used for converting the timestamp string to a Timestamp Type. For more information on formats, refer to this <a href="https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html">documentation.</a></p>
              </div>
            </td>
            <td>
                  <code>[&#34;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX&#34;, &#34;yyyy-MM-dd&#39;T&#39;HH:mm:ssX&#34;]</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/fledge_opcua_json_to_pcdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FledgeOPCUAJsonToPCDMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Spark Dataframe column containing a json string created by Fledge to the Process Control Data Model.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import FledgeOPCUAJsonToPCDMTransformer</span>

<span class="sd">    fledge_opcua_json_to_pcdm_transfromer = FledgeOPCUAJsonToPCDMTransformer(</span>
<span class="sd">        data=df,</span>
<span class="sd">        souce_column_name=&quot;body&quot;,</span>
<span class="sd">        status_null_value=&quot;Good&quot;,</span>
<span class="sd">        change_type_value=&quot;insert&quot;,</span>
<span class="sd">        timestamp_formats=[</span>
<span class="sd">            &quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX&quot;,</span>
<span class="sd">            &quot;yyyy-MM-dd&#39;T&#39;HH:mm:ssX&quot;,</span>
<span class="sd">        ]</span>
<span class="sd">    )</span>

<span class="sd">    result = fledge_opcua_json_to_pcdm_transfromer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe containing the column with Json Fledge data</span>
<span class="sd">        source_column_name (str): Spark Dataframe column containing the OPC Publisher Json OPC UA data</span>
<span class="sd">        status_null_value (str): If populated, will replace &#39;Good&#39; in the Status column with the specified value.</span>
<span class="sd">        change_type_value (optional str): If populated, will replace &#39;insert&#39; in the ChangeType column with the specified value.</span>
<span class="sd">        timestamp_formats (list[str]): Specifies the timestamp formats to be used for converting the timestamp string to a Timestamp Type. For more information on formats, refer to this [documentation.](https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp_formats</span><span class="p">:</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Good&quot;</span><span class="p">,</span>
        <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;insert&quot;</span><span class="p">,</span>
        <span class="n">timestamp_formats</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX&quot;</span><span class="p">,</span>
            <span class="s2">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ssX&quot;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># NOSONAR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">=</span> <span class="n">source_column_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span> <span class="o">=</span> <span class="n">status_null_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span> <span class="o">=</span> <span class="n">change_type_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_formats</span> <span class="o">=</span> <span class="n">timestamp_formats</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
                <span class="n">from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">FLEDGE_SCHEMA</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s2">&quot;inline(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">))</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;readings&quot;</span><span class="p">),</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span>
                <span class="n">coalesce</span><span class="p">(</span>
                    <span class="o">*</span><span class="p">[</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_formats</span><span class="p">]</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;TagName&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
                <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="s2">&quot;string&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.FledgeOPCUAJsonToPCDMTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.FledgeOPCUAJsonToPCDMTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/fledge_opcua_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.FledgeOPCUAJsonToPCDMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the specified column converted to PCDM</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/fledge_opcua_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
            <span class="n">from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">FLEDGE_SCHEMA</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s2">&quot;inline(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">))</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;readings&quot;</span><span class="p">),</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span>
            <span class="n">coalesce</span><span class="p">(</span>
                <span class="o">*</span><span class="p">[</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_formats</span><span class="p">]</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;TagName&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
            <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="s2">&quot;string&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SSIPPIBinaryFileToPCDMTransformer" class="doc doc-heading">
            <code>SSIPPIBinaryFileToPCDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Spark DataFrame column containing binaryFile parquet data to the Process Control Data Model.</p>
<p>This DataFrame should contain a path and the binary data. Typically this can be done using the Autoloader source component and specify "binaryFile" as the format.</p>
<p>For more information about the SSIP PI Batch Connector, please see <a href="https://bakerhughesc3.ai/oai-solution/shell-sensor-intelligence-platform/">here.</a></p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SSIPPIBinaryFileToPCDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">SSIPPIBinaryFileToPCDMTransformer</span>

<span class="n">ssip_pi_binary_file_to_pcdm_transformer</span> <span class="o">=</span> <span class="n">SSIPPIBinaryFileToPCDMTransformer</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">ssip_pi_binary_file_to_pcdm_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing the path and binaryFile data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/ssip_pi_binary_file_to_pcdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SSIPPIBinaryFileToPCDMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Spark DataFrame column containing binaryFile parquet data to the Process Control Data Model.</span>

<span class="sd">    This DataFrame should contain a path and the binary data. Typically this can be done using the Autoloader source component and specify &quot;binaryFile&quot; as the format.</span>

<span class="sd">    For more information about the SSIP PI Batch Connector, please see [here.](https://bakerhughesc3.ai/oai-solution/shell-sensor-intelligence-platform/)</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import SSIPPIBinaryFileToPCDMTransformer</span>

<span class="sd">    ssip_pi_binary_file_to_pcdm_transformer = SSIPPIBinaryFileToPCDMTransformer(</span>
<span class="sd">        data=df</span>
<span class="sd">    )</span>

<span class="sd">    result = ssip_pi_binary_file_to_pcdm_transformer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): DataFrame containing the path and binaryFile data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_pypi_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;pyarrow&quot;</span><span class="p">))</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_pypi_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;pandas&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_binary_to_pandas</span><span class="p">(</span><span class="n">pdf</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">binary_list</span> <span class="o">=</span> <span class="n">pdf</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">binary_data</span> <span class="o">=</span> <span class="n">binary_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">py_buffer</span><span class="p">(</span><span class="n">binary_data</span><span class="p">)</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;EventDate&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;TagName&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;str&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;EventTime&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;str&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;str&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;ValueType&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;str&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;ChangeType&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;str&quot;</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="n">output_pdf</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;ValueType&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output_pdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">value_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value_type</span> <span class="o">==</span> <span class="s2">&quot;int16&quot;</span> <span class="ow">or</span> <span class="n">value_type</span> <span class="o">==</span> <span class="s2">&quot;int32&quot;</span><span class="p">:</span>
                <span class="n">value_type</span> <span class="o">=</span> <span class="s2">&quot;integer&quot;</span>
            <span class="n">output_pdf</span><span class="p">[</span><span class="s2">&quot;ValueType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_type</span>

        <span class="k">if</span> <span class="s2">&quot;ChangeType&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output_pdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">output_pdf</span><span class="p">[</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;insert&quot;</span>

        <span class="n">output_pdf</span><span class="p">[</span><span class="s2">&quot;EventDate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_pdf</span><span class="p">[</span><span class="s2">&quot;EventTime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>
        <span class="n">output_pdf</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_pdf</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">output_pdf</span> <span class="o">=</span> <span class="n">output_pdf</span><span class="p">[</span>
            <span class="p">[</span>
                <span class="s2">&quot;EventDate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;TagName&quot;</span><span class="p">,</span>
                <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Status&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Value&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">output_pdf</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the provided Binary data convert to PCDM</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">applyInPandas</span><span class="p">(</span>
            <span class="n">SSIPPIBinaryFileToPCDMTransformer</span><span class="o">.</span><span class="n">_convert_binary_to_pandas</span><span class="p">,</span>
            <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;EventDate DATE, TagName STRING, EventTime TIMESTAMP, Status STRING, Value STRING, ValueType STRING, ChangeType STRING&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SSIPPIBinaryFileToPCDMTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SSIPPIBinaryFileToPCDMTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/ssip_pi_binary_file_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SSIPPIBinaryFileToPCDMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the provided Binary data convert to PCDM</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/ssip_pi_binary_file_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the provided Binary data convert to PCDM</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">applyInPandas</span><span class="p">(</span>
        <span class="n">SSIPPIBinaryFileToPCDMTransformer</span><span class="o">.</span><span class="n">_convert_binary_to_pandas</span><span class="p">,</span>
        <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;EventDate DATE, TagName STRING, EventTime TIMESTAMP, Status STRING, Value STRING, ValueType STRING, ChangeType STRING&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SSIPPIJsonStreamToPCDMTransformer" class="doc doc-heading">
            <code>SSIPPIJsonStreamToPCDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Spark DataFrame containing Binary JSON data and related Properties to the Process Control Data Model</p>
<p>For more information about the SSIP PI Streaming Connector, please see <a href="https://bakerhughesc3.ai/oai-solution/shell-sensor-intelligence-platform/">here.</a></p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SSIPPIJsonStreamToPCDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">SSIPPIJsonStreamToPCDMTransformer</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">ssip_pi_json_stream_to_pcdm_transformer</span> <span class="o">=</span> <span class="n">SSIPPIJsonStreamToPCDMTransformer</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">source_column_name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="p">,</span>
    <span class="n">properties_column_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">metadata_delta_table</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">ssip_pi_json_stream_to_pcdm_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing the path and binaryFile data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe column containing the Binary json data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>properties_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe struct typed column containing an element with the PointType</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>metadata_delta_table</code></td>
            <td>
                  <code>(optional, str)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of a metadata table that can be used for PointType mappings</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/ssip_pi_binary_json_to_pcdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SSIPPIJsonStreamToPCDMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Spark DataFrame containing Binary JSON data and related Properties to the Process Control Data Model</span>

<span class="sd">    For more information about the SSIP PI Streaming Connector, please see [here.](https://bakerhughesc3.ai/oai-solution/shell-sensor-intelligence-platform/)</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import SSIPPIJsonStreamToPCDMTransformer</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    ssip_pi_json_stream_to_pcdm_transformer = SSIPPIJsonStreamToPCDMTransformer(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        data=df,</span>
<span class="sd">        source_column_name=&quot;body&quot;,</span>
<span class="sd">        properties_column_name=&quot;&quot;,</span>
<span class="sd">        metadata_delta_table=None</span>
<span class="sd">    )</span>

<span class="sd">    result = ssip_pi_json_stream_to_pcdm_transformer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session</span>
<span class="sd">        data (DataFrame): DataFrame containing the path and binaryFile data</span>
<span class="sd">        source_column_name (str): Spark Dataframe column containing the Binary json data</span>
<span class="sd">        properties_column_name (str): Spark Dataframe struct typed column containing an element with the PointType</span>
<span class="sd">        metadata_delta_table (optional, str): Name of a metadata table that can be used for PointType mappings</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">properties_column_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metadata_delta_table</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">properties_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">metadata_delta_table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">=</span> <span class="n">source_column_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties_column_name</span> <span class="o">=</span> <span class="n">properties_column_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata_delta_table</span> <span class="o">=</span> <span class="n">metadata_delta_table</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the provided Binary data converted to PCDM</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;EventDate&quot;</span><span class="p">,</span>
                <span class="n">get_json_object</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;$.EventTime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                    <span class="s2">&quot;date&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;TagName&quot;</span><span class="p">,</span>
                <span class="n">get_json_object</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;$.TagName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                    <span class="s2">&quot;string&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span>
                <span class="n">get_json_object</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;$.EventTime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                    <span class="s2">&quot;timestamp&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;Status&quot;</span><span class="p">,</span>
                <span class="n">get_json_object</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;$.Quality&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                    <span class="s2">&quot;string&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;Value&quot;</span><span class="p">,</span>
                <span class="n">get_json_object</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;$.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;PointType&quot;</span><span class="p">,</span> <span class="n">element_at</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_column_name</span><span class="p">),</span> <span class="s2">&quot;PointType&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;Action&quot;</span><span class="p">,</span>
                <span class="n">element_at</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_column_name</span><span class="p">),</span> <span class="s2">&quot;Action&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_delta_table</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata_df</span> <span class="o">=</span> <span class="n">SparkDeltaSource</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="p">{},</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_delta_table</span>
            <span class="p">)</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
            <span class="n">metadata_df</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;MetadataPointType&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metadata_df</span><span class="p">,</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">TagName</span> <span class="o">==</span> <span class="n">metadata_df</span><span class="o">.</span><span class="n">TagName</span><span class="p">),</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;PointType&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;MetadataPointType&quot;</span><span class="p">)))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Digital&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Float16&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Float32&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Float64&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Int16&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Int32&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span>
                <span class="s2">&quot;*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CASE WHEN ValueType = &#39;integer&#39; THEN try_cast(Value as integer) END as Value_Integer&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CASE WHEN ValueType = &#39;float&#39; THEN try_cast(Value as float) END as Value_Float&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
                <span class="n">when</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value_Integer&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;integer&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value_Float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Insert&quot;</span><span class="p">,</span> <span class="s2">&quot;insert&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Add&quot;</span><span class="p">,</span> <span class="s2">&quot;insert&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Delete&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Update&quot;</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Refresh&quot;</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;EventDate&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SSIPPIJsonStreamToPCDMTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SSIPPIJsonStreamToPCDMTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/ssip_pi_binary_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SSIPPIJsonStreamToPCDMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the provided Binary data converted to PCDM</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/ssip_pi_binary_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the provided Binary data converted to PCDM</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;EventDate&quot;</span><span class="p">,</span>
            <span class="n">get_json_object</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;$.EventTime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                <span class="s2">&quot;date&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;TagName&quot;</span><span class="p">,</span>
            <span class="n">get_json_object</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;$.TagName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                <span class="s2">&quot;string&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span>
            <span class="n">get_json_object</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;$.EventTime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                <span class="s2">&quot;timestamp&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;Status&quot;</span><span class="p">,</span>
            <span class="n">get_json_object</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;$.Quality&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                <span class="s2">&quot;string&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;Value&quot;</span><span class="p">,</span>
            <span class="n">get_json_object</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;$.Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;PointType&quot;</span><span class="p">,</span> <span class="n">element_at</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_column_name</span><span class="p">),</span> <span class="s2">&quot;PointType&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;Action&quot;</span><span class="p">,</span>
            <span class="n">element_at</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_column_name</span><span class="p">),</span> <span class="s2">&quot;Action&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_delta_table</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">metadata_df</span> <span class="o">=</span> <span class="n">SparkDeltaSource</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="p">{},</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_delta_table</span>
        <span class="p">)</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
        <span class="n">metadata_df</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;MetadataPointType&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metadata_df</span><span class="p">,</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">TagName</span> <span class="o">==</span> <span class="n">metadata_df</span><span class="o">.</span><span class="n">TagName</span><span class="p">),</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;PointType&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;MetadataPointType&quot;</span><span class="p">)))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Digital&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Float16&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Float32&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Float64&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Int16&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PointType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Int32&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span>
            <span class="s2">&quot;*&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CASE WHEN ValueType = &#39;integer&#39; THEN try_cast(Value as integer) END as Value_Integer&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CASE WHEN ValueType = &#39;float&#39; THEN try_cast(Value as float) END as Value_Float&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
            <span class="n">when</span><span class="p">(</span>
                <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value_Integer&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;integer&quot;</span><span class="p">),</span>
                <span class="s2">&quot;string&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value_Float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span><span class="p">),</span>
                <span class="s2">&quot;string&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Insert&quot;</span><span class="p">,</span> <span class="s2">&quot;insert&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Add&quot;</span><span class="p">,</span> <span class="s2">&quot;insert&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Delete&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Update&quot;</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Refresh&quot;</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span><span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;EventDate&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AIOJsonToPCDMTransformer" class="doc doc-heading">
            <code>AIOJsonToPCDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Spark Dataframe column containing a json string created by AIO to the Process Control Data Model.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AIOJsonToPCDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">AIOJsonToPCDMTransformer</span>

<span class="n">aio_json_to_pcdm_transfromer</span> <span class="o">=</span> <span class="n">AIOJsonToPCDMTransformer</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">souce_column_name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="p">,</span>
    <span class="n">status_null_value</span><span class="o">=</span><span class="s2">&quot;Good&quot;</span><span class="p">,</span>
    <span class="n">change_type_value</span><span class="o">=</span><span class="s2">&quot;insert&quot;</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">aio_json_to_pcdm_transfromer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe containing the column with Json AIO data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe column containing the Json AIO data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>status_null_value</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'Good' in the Status column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Good&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>change_type_value</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'insert' in the ChangeType column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;insert&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/aio_json_to_pcdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AIOJsonToPCDMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Spark Dataframe column containing a json string created by AIO to the Process Control Data Model.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import AIOJsonToPCDMTransformer</span>

<span class="sd">    aio_json_to_pcdm_transfromer = AIOJsonToPCDMTransformer(</span>
<span class="sd">        data=df,</span>
<span class="sd">        souce_column_name=&quot;body&quot;,</span>
<span class="sd">        status_null_value=&quot;Good&quot;,</span>
<span class="sd">        change_type_value=&quot;insert&quot;</span>
<span class="sd">    )</span>

<span class="sd">    result = aio_json_to_pcdm_transfromer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe containing the column with Json AIO data</span>
<span class="sd">        source_column_name (str): Spark Dataframe column containing the Json AIO data</span>
<span class="sd">        status_null_value (str): If populated, will replace &#39;Good&#39; in the Status column with the specified value.</span>
<span class="sd">        change_type_value (optional str): If populated, will replace &#39;insert&#39; in the ChangeType column with the specified value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Good&quot;</span><span class="p">,</span>
        <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;insert&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># NOSONAR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">=</span> <span class="n">source_column_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span> <span class="o">=</span> <span class="n">status_null_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span> <span class="o">=</span> <span class="n">change_type_value</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;Payload STRING&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">from_json</span><span class="p">(</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;body.Payload&quot;</span><span class="p">),</span> <span class="n">AIO_SCHEMA</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">),</span> <span class="s2">&quot;value.*&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;SourceTimestamp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span> <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
                <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                    <span class="s2">&quot;string&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AIOJsonToPCDMTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AIOJsonToPCDMTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/aio_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AIOJsonToPCDMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the specified column converted to PCDM</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/aio_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;Payload STRING&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">from_json</span><span class="p">(</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;body.Payload&quot;</span><span class="p">),</span> <span class="n">AIO_SCHEMA</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">),</span> <span class="s2">&quot;value.*&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;SourceTimestamp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span> <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
            <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                <span class="s2">&quot;string&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCUAJsonToPCDMTransformer" class="doc doc-heading">
            <code>OPCUAJsonToPCDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Spark Dataframe column containing a json string created by Open Source OPC UA to the Process Control Data Model.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCUAJsonToPCDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">OPCUAJsonToPCDMTransformer</span>

<span class="n">opcua_json_to_pcdm_transfromer</span> <span class="o">=</span> <span class="n">OPCUAJsonToPCDMTransformer</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">souce_column_name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="p">,</span>
    <span class="n">status_null_value</span><span class="o">=</span><span class="s2">&quot;Good&quot;</span><span class="p">,</span>
    <span class="n">change_type_value</span><span class="o">=</span><span class="s2">&quot;insert&quot;</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">opcua_json_to_pcdm_transfromer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe containing the column with Json OPC UA data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe column containing the OPC Publisher Json OPC UA data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>status_null_value</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'Good' in the Status column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Good&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>change_type_value</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'insert' in the ChangeType column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;insert&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/opcua_json_to_pcdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">OPCUAJsonToPCDMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Spark Dataframe column containing a json string created by Open Source OPC UA to the Process Control Data Model.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import OPCUAJsonToPCDMTransformer</span>

<span class="sd">    opcua_json_to_pcdm_transfromer = OPCUAJsonToPCDMTransformer(</span>
<span class="sd">        data=df,</span>
<span class="sd">        souce_column_name=&quot;body&quot;,</span>
<span class="sd">        status_null_value=&quot;Good&quot;,</span>
<span class="sd">        change_type_value=&quot;insert&quot;</span>
<span class="sd">    )</span>

<span class="sd">    result = opcua_json_to_pcdm_transfromer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe containing the column with Json OPC UA data</span>
<span class="sd">        source_column_name (str): Spark Dataframe column containing the OPC Publisher Json OPC UA data</span>
<span class="sd">        status_null_value (str): If populated, will replace &#39;Good&#39; in the Status column with the specified value.</span>
<span class="sd">        change_type_value (optional str): If populated, will replace &#39;insert&#39; in the ChangeType column with the specified value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Good&quot;</span><span class="p">,</span>
        <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;insert&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># NOSONAR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">=</span> <span class="n">source_column_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span> <span class="o">=</span> <span class="n">status_null_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span> <span class="o">=</span> <span class="n">change_type_value</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;Messages STRING&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">from_json</span><span class="p">(</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;body.Messages&quot;</span><span class="p">),</span> <span class="n">OPCUA_SCHEMA</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s2">&quot;inline(body)&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span> <span class="n">explode</span><span class="p">(</span><span class="s2">&quot;Payload&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">),</span> <span class="s2">&quot;value.*&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
                <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                    <span class="s2">&quot;string&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCUAJsonToPCDMTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCUAJsonToPCDMTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/opcua_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.OPCUAJsonToPCDMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the specified column converted to PCDM</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/opcua_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">),</span> <span class="s2">&quot;Messages STRING&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">from_json</span><span class="p">(</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;body.Messages&quot;</span><span class="p">),</span> <span class="n">OPCUA_SCHEMA</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s2">&quot;inline(body)&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span> <span class="n">explode</span><span class="p">(</span><span class="s2">&quot;Payload&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">),</span> <span class="s2">&quot;value.*&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
            <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                <span class="s2">&quot;string&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.CAISOToMDMTransformer" class="doc doc-heading">
            <code>CAISOToMDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm.BaseRawToMDMTransformer" href="../../transformers/spark/iso/pjm_to_mdm/#src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm.BaseRawToMDMTransformer">BaseRawToMDMTransformer</a></code></p>


      <p>Converts CAISO Raw data into Meters Data Model.</p>
<p>Please check the BaseRawToMDMTransformer for the required arguments and methods.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.CAISOToMDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">CAISOToMDMTransformer</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">caiso_to_mdm_transformer</span> <span class="o">=</span> <span class="n">CAISOToMDMTransformer</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;usage&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">value_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">series_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">series_parent_id</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">caiso_to_mdm_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/iso/caiso_to_mdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CAISOToMDMTransformer</span><span class="p">(</span><span class="n">BaseRawToMDMTransformer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts CAISO Raw data into Meters Data Model.</span>

<span class="sd">    Please check the BaseRawToMDMTransformer for the required arguments and methods.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import CAISOToMDMTransformer</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    caiso_to_mdm_transformer = CAISOToMDMTransformer(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        data=df,</span>
<span class="sd">        output_type=&quot;usage&quot;,</span>
<span class="sd">        name=None,</span>
<span class="sd">        description=None,</span>
<span class="sd">        value_type=None,</span>
<span class="sd">        version=None,</span>
<span class="sd">        series_id=None,</span>
<span class="sd">        series_parent_id=None</span>
<span class="sd">    )</span>

<span class="sd">    result = caiso_to_mdm_transformer.transform()</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">input_schema</span> <span class="o">=</span> <span class="n">CAISO_SCHEMA</span>
    <span class="n">uid_col</span> <span class="o">=</span> <span class="s2">&quot;TacAreaName&quot;</span>
    <span class="n">series_id_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;series_std_001&#39;&quot;</span>
    <span class="n">timestamp_col</span> <span class="o">=</span> <span class="s2">&quot;to_timestamp(StartTime)&quot;</span>
    <span class="n">interval_timestamp_col</span> <span class="o">=</span> <span class="s2">&quot;Timestamp + INTERVAL 1 HOURS&quot;</span>
    <span class="n">value_col</span> <span class="o">=</span> <span class="s2">&quot;Load&quot;</span>
    <span class="n">series_parent_id_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;series_parent_std_001&#39;&quot;</span>
    <span class="n">name_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;CAISO API&#39;&quot;</span>
    <span class="n">uom_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;mwh&#39;&quot;</span>
    <span class="n">description_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;CAISO data pulled from CAISO ISO API&#39;&quot;</span>
    <span class="n">timestamp_start_col</span> <span class="o">=</span> <span class="s2">&quot;StartTime&quot;</span>
    <span class="n">timestamp_end_col</span> <span class="o">=</span> <span class="s2">&quot;StartTime + INTERVAL 1 HOURS&quot;</span>
    <span class="n">time_zone_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;PST&#39;&quot;</span>
    <span class="n">version_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;1&#39;&quot;</span>
    <span class="n">series_type</span> <span class="o">=</span> <span class="n">SeriesType</span><span class="o">.</span><span class="n">Hour</span>
    <span class="n">model_type</span> <span class="o">=</span> <span class="n">ModelType</span><span class="o">.</span><span class="n">Default</span>
    <span class="n">value_type</span> <span class="o">=</span> <span class="n">ValueType</span><span class="o">.</span><span class="n">Usage</span>
    <span class="n">properties_col</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ERCOTToMDMTransformer" class="doc doc-heading">
            <code>ERCOTToMDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm.BaseRawToMDMTransformer" href="../../transformers/spark/iso/pjm_to_mdm/#src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm.BaseRawToMDMTransformer">BaseRawToMDMTransformer</a></code></p>


      <p>Converts ERCOT Raw data into Meters Data Model.</p>
<p>Please check the BaseRawToMDMTransformer for the required arguments and methods.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ERCOTToMDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">ERCOTToMDMTransformer</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">ercot_to_mdm_transformer</span> <span class="o">=</span> <span class="n">ERCOTToMDMTransformer</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;usage&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">value_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">series_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">series_parent_id</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">ercot_to_mdm_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/iso/ercot_to_mdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ERCOTToMDMTransformer</span><span class="p">(</span><span class="n">BaseRawToMDMTransformer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts ERCOT Raw data into Meters Data Model.</span>

<span class="sd">    Please check the BaseRawToMDMTransformer for the required arguments and methods.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import ERCOTToMDMTransformer</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    ercot_to_mdm_transformer = ERCOTToMDMTransformer(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        data=df,</span>
<span class="sd">        output_type=&quot;usage&quot;,</span>
<span class="sd">        name=None,</span>
<span class="sd">        description=None,</span>
<span class="sd">        value_type=None,</span>
<span class="sd">        version=None,</span>
<span class="sd">        series_id=None,</span>
<span class="sd">        series_parent_id=None</span>
<span class="sd">    )</span>

<span class="sd">    result = ercot_to_mdm_transformer.transform()</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">input_schema</span> <span class="o">=</span> <span class="n">ERCOT_SCHEMA</span>
    <span class="n">uid_col</span> <span class="o">=</span> <span class="s2">&quot;variable&quot;</span>
    <span class="n">series_id_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;series_std_001&#39;&quot;</span>
    <span class="n">timestamp_col</span> <span class="o">=</span> <span class="s2">&quot;to_utc_timestamp(StartTime, &#39;America/Chicago&#39;)&quot;</span>
    <span class="n">interval_timestamp_col</span> <span class="o">=</span> <span class="s2">&quot;Timestamp + INTERVAL 1 HOURS&quot;</span>
    <span class="n">value_col</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span>
    <span class="n">series_parent_id_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;series_parent_std_001&#39;&quot;</span>
    <span class="n">name_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;ERCOT API&#39;&quot;</span>
    <span class="n">uom_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;mwh&#39;&quot;</span>
    <span class="n">description_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;ERCOT data pulled from ERCOT ISO API&#39;&quot;</span>
    <span class="n">timestamp_start_col</span> <span class="o">=</span> <span class="s2">&quot;StartTime&quot;</span>
    <span class="n">timestamp_end_col</span> <span class="o">=</span> <span class="s2">&quot;StartTime + INTERVAL 1 HOURS&quot;</span>
    <span class="n">time_zone_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;America/Chicago&#39;&quot;</span>
    <span class="n">version_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;1&#39;&quot;</span>
    <span class="n">series_type</span> <span class="o">=</span> <span class="n">SeriesType</span><span class="o">.</span><span class="n">Hour</span>
    <span class="n">model_type</span> <span class="o">=</span> <span class="n">ModelType</span><span class="o">.</span><span class="n">Default</span>
    <span class="n">value_type</span> <span class="o">=</span> <span class="n">ValueType</span><span class="o">.</span><span class="n">Usage</span>
    <span class="n">properties_col</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span>

    <span class="k">def</span> <span class="nf">_pre_process</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ERCOTToMDMTransformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_pre_process</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">melt</span><span class="p">(</span>
            <span class="n">df</span><span class="p">,</span>
            <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;HourEnding&quot;</span><span class="p">,</span> <span class="s2">&quot;DstFlag&quot;</span><span class="p">],</span>
            <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;Coast&quot;</span><span class="p">,</span>
                <span class="s2">&quot;East&quot;</span><span class="p">,</span>
                <span class="s2">&quot;FarWest&quot;</span><span class="p">,</span>
                <span class="s2">&quot;North&quot;</span><span class="p">,</span>
                <span class="s2">&quot;NorthCentral&quot;</span><span class="p">,</span>
                <span class="s2">&quot;SouthCentral&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Southern&quot;</span><span class="p">,</span>
                <span class="s2">&quot;West&quot;</span><span class="p">,</span>
                <span class="s2">&quot;SystemTotal&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;StartTime&quot;</span><span class="p">,</span>
            <span class="n">F</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span>
                <span class="s2">&quot;Date + MAKE_INTERVAL(0,0,0,0,cast(split(HourEnding,&#39;:&#39;)[0] as integer),0,0)&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MISOToMDMTransformer" class="doc doc-heading">
            <code>MISOToMDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm.BaseRawToMDMTransformer" href="../../transformers/spark/iso/pjm_to_mdm/#src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm.BaseRawToMDMTransformer">BaseRawToMDMTransformer</a></code></p>


      <p>Converts MISO Raw data into Meters Data Model.</p>
<p>Please check the BaseRawToMDMTransformer for the required arguments and methods.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MISOToMDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">MISOToMDMTransformer</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">miso_to_mdm_transformer</span> <span class="o">=</span> <span class="n">MISOToMDMTransformer</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;usage&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">value_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">series_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">series_parent_id</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">miso_to_mdm_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<details class="baserawtomdmtransformer" open>
  <summary>BaseRawToMDMTransformer</summary>
  <div class="doc doc-object doc-module">



<a id="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm.BaseRawToMDMTransformer" class="doc doc-heading">
            <code>BaseRawToMDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Base class for all the Raw to Meters Data Model Transformers.</p>


<details class="meters-data-model-requires-two-outputs" open>
  <summary>Meters Data Model requires two outputs</summary>
  <ul>
<li><code>UsageData</code> : To store measurement(value) as timeseries data.</li>
<li><code>MetaData</code> : To store meters related meta information.</li>
</ul>
</details>      <p>It supports the generation of both the outputs as they share some common properties.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe containing the raw MISO data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>output_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be one of <code>usage</code> or <code>meta</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set this to override default <code>name</code> column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>description</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set this to override default <code>description</code> column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>value_type</code></td>
            <td>
                  <code><span title="src.sdk.python.rtdip_sdk.data_models.timeseries.ValueType">ValueType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set this to override default <code>value_type</code> column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>version</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set this to override default <code>version</code> column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>series_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set this to override default <code>series_id</code> column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>series_parent_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set this to override default <code>series_parent_id</code> column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/base_raw_to_mdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseRawToMDMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all the Raw to Meters Data Model Transformers.</span>

<span class="sd">    Meters Data Model requires two outputs:</span>
<span class="sd">        - `UsageData` : To store measurement(value) as timeseries data.</span>
<span class="sd">        - `MetaData` : To store meters related meta information.</span>

<span class="sd">    It supports the generation of both the outputs as they share some common properties.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance.</span>
<span class="sd">        data (DataFrame): Dataframe containing the raw MISO data.</span>
<span class="sd">        output_type (str): Must be one of `usage` or `meta`.</span>
<span class="sd">        name (str): Set this to override default `name` column.</span>
<span class="sd">        description (str): Set this to override default `description` column.</span>
<span class="sd">        value_type (ValueType): Set this to override default `value_type` column.</span>
<span class="sd">        version (str): Set this to override default `version` column.</span>
<span class="sd">        series_id (str): Set this to override default `series_id` column.</span>
<span class="sd">        series_parent_id (str): Set this to override default `series_parent_id` column.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">output_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">input_schema</span><span class="p">:</span> <span class="n">StructType</span>
    <span class="n">target_schema</span><span class="p">:</span> <span class="n">StructType</span>
    <span class="n">uid_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">series_id_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">interval_timestamp_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">series_parent_id_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">uom_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp_start_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp_end_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">time_zone_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">version_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">series_type</span><span class="p">:</span> <span class="n">SeriesType</span>
    <span class="n">model_type</span><span class="p">:</span> <span class="n">ModelType</span>
    <span class="n">value_type</span><span class="p">:</span> <span class="n">ValueType</span>
    <span class="n">properties_col</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">output_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value_type</span><span class="p">:</span> <span class="n">ValueType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">series_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">series_parent_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="o">=</span> <span class="n">output_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">description</span> <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">description_col</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_type</span> <span class="o">=</span> <span class="n">value_type</span> <span class="k">if</span> <span class="n">value_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span> <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">series_id</span> <span class="o">=</span> <span class="n">series_id</span> <span class="k">if</span> <span class="n">series_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_id_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">series_parent_id</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">series_parent_id</span>
            <span class="k">if</span> <span class="n">series_parent_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_parent_id_col</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">valid_output_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_output_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid output_type `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_type</span><span class="si">}</span><span class="s2">` given. Must be one of </span><span class="si">{</span><span class="n">valid_output_types</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_schema</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_type</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">SeriesType</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">ModelType</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_type</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">ValueType</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_get_transformed_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="o">==</span> <span class="s2">&quot;usage&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span> <span class="o">=</span> <span class="n">MDM_USAGE_SCHEMA</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_usage_transformed_df</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span> <span class="o">=</span> <span class="n">MDM_META_SCHEMA</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_meta_transformed_df</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_convert_into_target_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a Spark DataFrame structure into new structure based on the Target Schema.</span>

<span class="sd">        Returns: Nothing.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">dataType</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rdd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the raw data converted into MDM.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pre_transform_validation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transformed_df</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_into_target_schema</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_transform_validation</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">_add_uid_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Uid&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uid_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_series_id_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;SeriesId&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_id</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_timestamp_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_interval_timestamp_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;IntervalTimestamp&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval_timestamp_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_value_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_series_parent_id_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;SeriesParentId&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_parent_id</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_name_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_uom_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Uom&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uom_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_description_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_timestamp_start_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;TimestampStart&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_start_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_timestamp_end_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;TimestampEnd&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_end_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_time_zone_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Timezone&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_zone_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_version_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Version&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_series_type_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;SeriesType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_type</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_model_type_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ModelType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_value_type_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_type</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_properties_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Properties&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pre_process</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_post_process</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_usage_transformed_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_process</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_uid_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_series_id_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_timestamp_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_interval_timestamp_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_value_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_process</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_meta_transformed_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_process</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_uid_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_series_id_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_series_parent_id_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_name_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_uom_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_description_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_timestamp_start_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_timestamp_end_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_time_zone_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_version_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_series_type_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_model_type_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_value_type_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_properties_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_process</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm.BaseRawToMDMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the raw data converted into MDM.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/base_raw_to_mdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the raw data converted into MDM.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pre_transform_validation</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transformed_df</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_convert_into_target_schema</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">post_transform_validation</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
</details>
              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/iso/miso_to_mdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MISOToMDMTransformer</span><span class="p">(</span><span class="n">BaseRawToMDMTransformer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts MISO Raw data into Meters Data Model.</span>

<span class="sd">    Please check the BaseRawToMDMTransformer for the required arguments and methods.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import MISOToMDMTransformer</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    miso_to_mdm_transformer = MISOToMDMTransformer(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        data=df,</span>
<span class="sd">        output_type=&quot;usage&quot;,</span>
<span class="sd">        name=None,</span>
<span class="sd">        description=None,</span>
<span class="sd">        value_type=None,</span>
<span class="sd">        version=None,</span>
<span class="sd">        series_id=None,</span>
<span class="sd">        series_parent_id=None</span>
<span class="sd">    )</span>

<span class="sd">    result = miso_to_mdm_transformer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    BaseRawToMDMTransformer:</span>
<span class="sd">        ::: src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">input_schema</span> <span class="o">=</span> <span class="n">MISO_SCHEMA</span>
    <span class="n">uid_col</span> <span class="o">=</span> <span class="s2">&quot;variable&quot;</span>
    <span class="n">series_id_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;series_std_001&#39;&quot;</span>
    <span class="n">timestamp_col</span> <span class="o">=</span> <span class="s2">&quot;to_utc_timestamp(Datetime, &#39;US/Central&#39;)&quot;</span>
    <span class="n">interval_timestamp_col</span> <span class="o">=</span> <span class="s2">&quot;Timestamp + INTERVAL 1 HOURS&quot;</span>
    <span class="n">value_col</span> <span class="o">=</span> <span class="s2">&quot;bround(value, 2)&quot;</span>
    <span class="n">series_parent_id_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;series_parent_std_001&#39;&quot;</span>
    <span class="n">name_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;Miso API&#39;&quot;</span>
    <span class="n">uom_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;mwh&#39;&quot;</span>
    <span class="n">description_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;Miso data pulled from Miso ISO API&#39;&quot;</span>
    <span class="n">timestamp_start_col</span> <span class="o">=</span> <span class="s2">&quot;Datetime&quot;</span>
    <span class="n">timestamp_end_col</span> <span class="o">=</span> <span class="s2">&quot;Datetime + INTERVAL 1 HOURS&quot;</span>
    <span class="n">time_zone_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;US/Central&#39;&quot;</span>
    <span class="n">version_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;1&#39;&quot;</span>
    <span class="n">series_type</span> <span class="o">=</span> <span class="n">SeriesType</span><span class="o">.</span><span class="n">Hour</span>
    <span class="n">model_type</span> <span class="o">=</span> <span class="n">ModelType</span><span class="o">.</span><span class="n">Default</span>
    <span class="n">value_type</span> <span class="o">=</span> <span class="n">ValueType</span><span class="o">.</span><span class="n">Usage</span>
    <span class="n">properties_col</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span>

    <span class="k">def</span> <span class="nf">_pre_process</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">MISOToMDMTransformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_pre_process</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">melt</span><span class="p">(</span>
            <span class="n">df</span><span class="p">,</span>
            <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Datetime&quot;</span><span class="p">],</span>
            <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;Lrz1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Lrz2_7&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Lrz3_5&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Lrz4&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Lrz6&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Lrz8_9_10&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Miso&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMToMDMTransformer" class="doc doc-heading">
            <code>PJMToMDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm.BaseRawToMDMTransformer" href="../../transformers/spark/iso/pjm_to_mdm/#src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm.BaseRawToMDMTransformer">BaseRawToMDMTransformer</a></code></p>


      <p>Converts PJM Raw data into Meters Data Model.</p>
<p>Please check the BaseRawToMDMTransformer for the required arguments and methods.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PJMToMDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">PJMToMDMTransformer</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">pjm_to_mdm_transformer</span> <span class="o">=</span> <span class="n">PJMToMDMTransformer</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;usage&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">value_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">series_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">series_parent_id</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">pjm_to_mdm_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<details class="baserawtomdmtransformer" open>
  <summary>BaseRawToMDMTransformer</summary>
  <div class="doc doc-object doc-module">



<a id="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm.BaseRawToMDMTransformer" class="doc doc-heading">
            <code>BaseRawToMDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Base class for all the Raw to Meters Data Model Transformers.</p>


<details class="meters-data-model-requires-two-outputs" open>
  <summary>Meters Data Model requires two outputs</summary>
  <ul>
<li><code>UsageData</code> : To store measurement(value) as timeseries data.</li>
<li><code>MetaData</code> : To store meters related meta information.</li>
</ul>
</details>      <p>It supports the generation of both the outputs as they share some common properties.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe containing the raw MISO data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>output_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Must be one of <code>usage</code> or <code>meta</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set this to override default <code>name</code> column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>description</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set this to override default <code>description</code> column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>value_type</code></td>
            <td>
                  <code><span title="src.sdk.python.rtdip_sdk.data_models.timeseries.ValueType">ValueType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set this to override default <code>value_type</code> column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>version</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set this to override default <code>version</code> column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>series_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set this to override default <code>series_id</code> column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>series_parent_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set this to override default <code>series_parent_id</code> column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/base_raw_to_mdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseRawToMDMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all the Raw to Meters Data Model Transformers.</span>

<span class="sd">    Meters Data Model requires two outputs:</span>
<span class="sd">        - `UsageData` : To store measurement(value) as timeseries data.</span>
<span class="sd">        - `MetaData` : To store meters related meta information.</span>

<span class="sd">    It supports the generation of both the outputs as they share some common properties.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance.</span>
<span class="sd">        data (DataFrame): Dataframe containing the raw MISO data.</span>
<span class="sd">        output_type (str): Must be one of `usage` or `meta`.</span>
<span class="sd">        name (str): Set this to override default `name` column.</span>
<span class="sd">        description (str): Set this to override default `description` column.</span>
<span class="sd">        value_type (ValueType): Set this to override default `value_type` column.</span>
<span class="sd">        version (str): Set this to override default `version` column.</span>
<span class="sd">        series_id (str): Set this to override default `series_id` column.</span>
<span class="sd">        series_parent_id (str): Set this to override default `series_parent_id` column.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">output_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">input_schema</span><span class="p">:</span> <span class="n">StructType</span>
    <span class="n">target_schema</span><span class="p">:</span> <span class="n">StructType</span>
    <span class="n">uid_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">series_id_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">interval_timestamp_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">series_parent_id_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">uom_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp_start_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp_end_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">time_zone_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">version_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">series_type</span><span class="p">:</span> <span class="n">SeriesType</span>
    <span class="n">model_type</span><span class="p">:</span> <span class="n">ModelType</span>
    <span class="n">value_type</span><span class="p">:</span> <span class="n">ValueType</span>
    <span class="n">properties_col</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">output_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value_type</span><span class="p">:</span> <span class="n">ValueType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">series_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">series_parent_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="o">=</span> <span class="n">output_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">description</span> <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">description_col</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_type</span> <span class="o">=</span> <span class="n">value_type</span> <span class="k">if</span> <span class="n">value_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span> <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">series_id</span> <span class="o">=</span> <span class="n">series_id</span> <span class="k">if</span> <span class="n">series_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_id_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">series_parent_id</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">series_parent_id</span>
            <span class="k">if</span> <span class="n">series_parent_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_parent_id_col</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">valid_output_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_output_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid output_type `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_type</span><span class="si">}</span><span class="s2">` given. Must be one of </span><span class="si">{</span><span class="n">valid_output_types</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_schema</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_type</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">SeriesType</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">ModelType</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_type</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">ValueType</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_get_transformed_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="o">==</span> <span class="s2">&quot;usage&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span> <span class="o">=</span> <span class="n">MDM_USAGE_SCHEMA</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_usage_transformed_df</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span> <span class="o">=</span> <span class="n">MDM_META_SCHEMA</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_meta_transformed_df</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_convert_into_target_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a Spark DataFrame structure into new structure based on the Target Schema.</span>

<span class="sd">        Returns: Nothing.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">dataType</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rdd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the raw data converted into MDM.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pre_transform_validation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transformed_df</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_into_target_schema</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_transform_validation</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">_add_uid_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Uid&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uid_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_series_id_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;SeriesId&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_id</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_timestamp_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_interval_timestamp_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;IntervalTimestamp&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval_timestamp_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_value_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_series_parent_id_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;SeriesParentId&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_parent_id</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_name_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_uom_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Uom&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uom_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_description_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_timestamp_start_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;TimestampStart&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_start_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_timestamp_end_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;TimestampEnd&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_end_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_time_zone_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Timezone&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_zone_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_version_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Version&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_series_type_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;SeriesType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_type</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_model_type_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ModelType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_value_type_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_type</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_properties_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Properties&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pre_process</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_post_process</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_usage_transformed_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_process</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_uid_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_series_id_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_timestamp_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_interval_timestamp_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_value_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_process</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_get_meta_transformed_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_process</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_uid_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_series_id_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_series_parent_id_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_name_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_uom_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_description_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_timestamp_start_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_timestamp_end_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_time_zone_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_version_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_series_type_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_model_type_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_value_type_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_properties_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_process</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm.BaseRawToMDMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the raw data converted into MDM.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/base_raw_to_mdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the raw data converted into MDM.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pre_transform_validation</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transformed_df</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_convert_into_target_schema</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">post_transform_validation</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
</details>
              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/iso/pjm_to_mdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PJMToMDMTransformer</span><span class="p">(</span><span class="n">BaseRawToMDMTransformer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts PJM Raw data into Meters Data Model.</span>

<span class="sd">    Please check the BaseRawToMDMTransformer for the required arguments and methods.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import PJMToMDMTransformer</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    pjm_to_mdm_transformer = PJMToMDMTransformer(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        data=df,</span>
<span class="sd">        output_type=&quot;usage&quot;,</span>
<span class="sd">        name=None,</span>
<span class="sd">        description=None,</span>
<span class="sd">        value_type=None,</span>
<span class="sd">        version=None,</span>
<span class="sd">        series_id=None,</span>
<span class="sd">        series_parent_id=None</span>
<span class="sd">    )</span>

<span class="sd">    result = pjm_to_mdm_transformer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    BaseRawToMDMTransformer:</span>
<span class="sd">        ::: src.sdk.python.rtdip_sdk.pipelines.transformers.spark.base_raw_to_mdm</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">input_schema</span> <span class="o">=</span> <span class="n">PJM_SCHEMA</span>
    <span class="n">uid_col</span> <span class="o">=</span> <span class="s2">&quot;Zone&quot;</span>
    <span class="n">series_id_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;series_std_001&#39;&quot;</span>
    <span class="n">timestamp_col</span> <span class="o">=</span> <span class="s2">&quot;to_utc_timestamp(StartTime, &#39;America/New_York&#39;)&quot;</span>
    <span class="n">interval_timestamp_col</span> <span class="o">=</span> <span class="s2">&quot;Timestamp + INTERVAL 1 HOURS&quot;</span>
    <span class="n">value_col</span> <span class="o">=</span> <span class="s2">&quot;bround(Load, 2)&quot;</span>
    <span class="n">series_parent_id_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;series_parent_std_001&#39;&quot;</span>
    <span class="n">name_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;PJM API&#39;&quot;</span>
    <span class="n">uom_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;mwh&#39;&quot;</span>
    <span class="n">description_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;PJM data pulled from PJM ISO API&#39;&quot;</span>
    <span class="n">timestamp_start_col</span> <span class="o">=</span> <span class="s2">&quot;StartTime&quot;</span>
    <span class="n">timestamp_end_col</span> <span class="o">=</span> <span class="s2">&quot;StartTime + INTERVAL 1 HOURS&quot;</span>
    <span class="n">time_zone_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;America/New_York&#39;&quot;</span>
    <span class="n">version_col</span> <span class="o">=</span> <span class="s2">&quot;&#39;1&#39;&quot;</span>
    <span class="n">series_type</span> <span class="o">=</span> <span class="n">SeriesType</span><span class="o">.</span><span class="n">Hour</span>
    <span class="n">model_type</span> <span class="o">=</span> <span class="n">ModelType</span><span class="o">.</span><span class="n">Default</span>
    <span class="n">value_type</span> <span class="o">=</span> <span class="n">ValueType</span><span class="o">.</span><span class="n">Usage</span>
    <span class="n">properties_col</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer" class="doc doc-heading">
            <code>EdgeXOPCUAJsonToPCDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Spark Dataframe column containing a json string created by EdgeX to the Process Control Data Model.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">EdgeXOPCUAJsonToPCDMTransformer</span>

<span class="n">edge_opcua_json_to_pcdm_transformer</span> <span class="o">=</span> <span class="n">EdgeXOPCUAJsonToPCDMTransformer</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">souce_column_name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="p">,</span>
    <span class="n">status_null_value</span><span class="o">=</span><span class="s2">&quot;Good&quot;</span><span class="p">,</span>
    <span class="n">change_type_value</span><span class="o">=</span><span class="s2">&quot;insert&quot;</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">edge_opcua_json_to_pcdm_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe containing the column with EdgeX data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe column containing the OPC Publisher Json OPC UA data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>status_null_value</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'Good' in the Status column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Good&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>change_type_value</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'insert' in the ChangeType column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;insert&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/edgex_opcua_json_to_pcdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EdgeXOPCUAJsonToPCDMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Spark Dataframe column containing a json string created by EdgeX to the Process Control Data Model.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import EdgeXOPCUAJsonToPCDMTransformer</span>

<span class="sd">    edge_opcua_json_to_pcdm_transformer = EdgeXOPCUAJsonToPCDMTransformer(</span>
<span class="sd">        data=df,</span>
<span class="sd">        souce_column_name=&quot;body&quot;,</span>
<span class="sd">        status_null_value=&quot;Good&quot;,</span>
<span class="sd">        change_type_value=&quot;insert&quot;</span>
<span class="sd">    )</span>

<span class="sd">    result = edge_opcua_json_to_pcdm_transformer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe containing the column with EdgeX data</span>
<span class="sd">        source_column_name (str): Spark Dataframe column containing the OPC Publisher Json OPC UA data</span>
<span class="sd">        status_null_value (optional str): If populated, will replace &#39;Good&#39; in the Status column with the specified value.</span>
<span class="sd">        change_type_value (optional str): If populated, will replace &#39;insert&#39; in the ChangeType column with the specified value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">tagname_field</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Good&quot;</span><span class="p">,</span>
        <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;insert&quot;</span><span class="p">,</span>
        <span class="n">tagname_field</span><span class="o">=</span><span class="s2">&quot;resourceName&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">=</span> <span class="n">source_column_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span> <span class="o">=</span> <span class="n">status_null_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span> <span class="o">=</span> <span class="n">change_type_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tagname_field</span> <span class="o">=</span> <span class="n">tagname_field</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
                <span class="n">from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">EDGEX_SCHEMA</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">explode</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.readings&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">)))</span>
            <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span>
                <span class="s2">&quot;explode(</span><span class="si">{}</span><span class="s2">.readings.</span><span class="si">{}</span><span class="s2">) as TagName&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagname_field</span>
                <span class="p">),</span>
                <span class="s2">&quot;to_utc_timestamp(to_timestamp((col.origin / 1000000000)), current_timezone()) as EventTime&quot;</span><span class="p">,</span>
                <span class="s2">&quot;col.value as Value&quot;</span><span class="p">,</span>
                <span class="s2">&quot;col.valueType as ValueType&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Int8&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Int16&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Int32&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Int64&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Uint8&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Uint16&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Uint32&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Uint64&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Float32&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Float64&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Bool&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/edgex_opcua_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EdgeXOPCUAJsonToPCDMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the specified column converted to PCDM</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/edgex_opcua_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
            <span class="n">from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">EDGEX_SCHEMA</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">explode</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.readings&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">)))</span>
        <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span>
            <span class="s2">&quot;explode(</span><span class="si">{}</span><span class="s2">.readings.</span><span class="si">{}</span><span class="s2">) as TagName&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagname_field</span>
            <span class="p">),</span>
            <span class="s2">&quot;to_utc_timestamp(to_timestamp((col.origin / 1000000000)), current_timezone()) as EventTime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;col.value as Value&quot;</span><span class="p">,</span>
            <span class="s2">&quot;col.valueType as ValueType&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Int8&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Int16&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Int32&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Int64&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Uint8&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Uint16&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Uint32&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Uint64&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Float32&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Float64&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Bool&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractBaseToWeatherDataModel" class="doc doc-heading">
            <code>ECMWFExtractBaseToWeatherDataModel</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Base class for extracting forecast data downloaded in .nc format from ECMWF MARS Server.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>load_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to local directory where the nc files will be stored, in format "yyyy-mm-dd_HH.nc"</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>date_start</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date of extraction in "YYYY-MM-DD HH:MM:SS" format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>date_end</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date of extraction in "YYYY-MM-DD HH:MM:SS" format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>run_frequency</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency format of runs to download, e.g. "H"</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>run_interval</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interval of runs, e.g. a run_frequency of "H" and run_interval of "12" will extract the data of the 00 and 12 run for each day.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lat</code></td>
            <td>
                  <code>DataArray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values to extract from nc files</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lon</code></td>
            <td>
                  <code>DataArray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values to extract from nc files</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>utc</code></td>
            <td>
                  <code>bool = True</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to convert the time to UTC or not</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/ecmwf/nc_extractbase_to_weather_data_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ECMWFExtractBaseToWeatherDataModel</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for extracting forecast data downloaded in .nc format from ECMWF MARS Server.</span>

<span class="sd">    Args:</span>
<span class="sd">        load_path (str): Path to local directory where the nc files will be stored, in format &quot;yyyy-mm-dd_HH.nc&quot;</span>
<span class="sd">        date_start (str): Start date of extraction in &quot;YYYY-MM-DD HH:MM:SS&quot; format</span>
<span class="sd">        date_end (str): End date of extraction in &quot;YYYY-MM-DD HH:MM:SS&quot; format</span>
<span class="sd">        run_frequency (str):Frequency format of runs to download, e.g. &quot;H&quot;</span>
<span class="sd">        run_interval (str): Interval of runs, e.g. a run_frequency of &quot;H&quot; and run_interval of &quot;12&quot; will extract the data of the 00 and 12 run for each day.</span>
<span class="sd">        lat (DataArray): Latitude values to extract from nc files</span>
<span class="sd">        lon (DataArray): Longitude values to extract from nc files</span>
<span class="sd">        utc (bool = True): Whether to convert the time to UTC or not</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">load_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">date_start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">date_end</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">run_interval</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">run_frequency</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">lat</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
        <span class="n">lon</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
        <span class="n">utc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_path</span> <span class="o">=</span> <span class="n">load_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_start</span> <span class="o">=</span> <span class="n">date_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_end</span> <span class="o">=</span> <span class="n">date_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_frequency</span> <span class="o">=</span> <span class="n">run_frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_interval</span> <span class="o">=</span> <span class="n">run_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utc</span> <span class="o">=</span> <span class="n">utc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
            <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_start</span><span class="p">,</span>
            <span class="n">end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_end</span><span class="p">,</span>
            <span class="n">freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_interval</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_frequency</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_ws_tag_names</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the tag names of wind speed from the format used in the nc files to the format used in the weather data model.</span>

<span class="sd">        Args:</span>
<span class="sd">            x (list): List of variable names of raw tags to be extracted from the nc files</span>

<span class="sd">        Returns:</span>
<span class="sd">            new_tags(list): List of variable names of raw tags to be extracted from the nc files, converted to the format used in the weather data model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">convert_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;10u&quot;</span><span class="p">:</span> <span class="s2">&quot;u10&quot;</span><span class="p">,</span>
            <span class="s2">&quot;100u&quot;</span><span class="p">:</span> <span class="s2">&quot;u100&quot;</span><span class="p">,</span>
            <span class="s2">&quot;200u&quot;</span><span class="p">:</span> <span class="s2">&quot;u200&quot;</span><span class="p">,</span>
            <span class="s2">&quot;10v&quot;</span><span class="p">:</span> <span class="s2">&quot;v10&quot;</span><span class="p">,</span>
            <span class="s2">&quot;100v&quot;</span><span class="p">:</span> <span class="s2">&quot;v100&quot;</span><span class="p">,</span>
            <span class="s2">&quot;200v&quot;</span><span class="p">:</span> <span class="s2">&quot;v200&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">new_tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">convert_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new_tags</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">tag_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract raw data from stored nc filed downloaded via ECMWF MARS.</span>

<span class="sd">        Args:</span>
<span class="sd">            tag_prefix (str): Prefix of the tag names of raw tags to be added to the dataframe</span>
<span class="sd">            variables (list): List of variable names of raw tags to be extracted from the nc files</span>
<span class="sd">            method (str, optional): The method used to match latitude/longitude in xarray using .sel(), by default &quot;nearest&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            df (pd.DataFrame): Raw data extracted with lat, lon, run_time, target_time as a pd.multiindex and variables as columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># e.g. 10u variable is saved as u10 in the file...</span>
        <span class="n">vars_processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_ws_tag_names</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">date</span><span class="p">())</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hour</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">.nc&quot;</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ds</span><span class="p">[</span><span class="n">vars_processed</span><span class="p">]</span>
                <span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
                <span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;run_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;target_time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span>
                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">([</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">])</span>
        <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;level&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="n">index_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="s2">&quot;run_time&quot;</span><span class="p">,</span> <span class="s2">&quot;target_time&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;run_time&quot;</span><span class="p">,</span> <span class="s2">&quot;target_time&quot;</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">index_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">utc</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;target_time&quot;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;run_time&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">))]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">df_new</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">df_new</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="s2">&quot;Latitude&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="s2">&quot;Longitude&quot;</span><span class="p">,</span>
                <span class="s2">&quot;run_time&quot;</span><span class="p">:</span> <span class="s2">&quot;EnqueuedTime&quot;</span><span class="p">,</span>
                <span class="s2">&quot;target_time&quot;</span><span class="p">:</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">df_new</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df_new</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;Latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;Longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;EnqueuedTime&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">])[</span>
                <span class="n">vars_processed</span>
            <span class="p">]</span>
            <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s2">&quot;Measure&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">stack</span><span class="p">()</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ECMWF_MARS&quot;</span>
        <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Good&quot;</span>
        <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Latest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;EventDate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;EventTime&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>
        <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;TagName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">tag_prefix</span>
            <span class="o">+</span> <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Latitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
            <span class="o">+</span> <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Longitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
            <span class="o">+</span> <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Source&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
            <span class="o">+</span> <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Measure&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">df_final</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Measure&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df_final</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractBaseToWeatherDataModel.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractBaseToWeatherDataModel.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/ecmwf/nc_extractbase_to_weather_data_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractBaseToWeatherDataModel.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">tag_prefix</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Extract raw data from stored nc filed downloaded via ECMWF MARS.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tag_prefix</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prefix of the tag names of raw tags to be added to the dataframe</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>variables</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of variable names of raw tags to be extracted from the nc files</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>method</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method used to match latitude/longitude in xarray using .sel(), by default "nearest"</p>
              </div>
            </td>
            <td>
                  <code>&#39;nearest&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>df</code></td>            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw data extracted with lat, lon, run_time, target_time as a pd.multiindex and variables as columns.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/ecmwf/nc_extractbase_to_weather_data_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">tag_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract raw data from stored nc filed downloaded via ECMWF MARS.</span>

<span class="sd">    Args:</span>
<span class="sd">        tag_prefix (str): Prefix of the tag names of raw tags to be added to the dataframe</span>
<span class="sd">        variables (list): List of variable names of raw tags to be extracted from the nc files</span>
<span class="sd">        method (str, optional): The method used to match latitude/longitude in xarray using .sel(), by default &quot;nearest&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">        df (pd.DataFrame): Raw data extracted with lat, lon, run_time, target_time as a pd.multiindex and variables as columns.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># e.g. 10u variable is saved as u10 in the file...</span>
    <span class="n">vars_processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_ws_tag_names</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">date</span><span class="p">())</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hour</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">.nc&quot;</span>
        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ds</span><span class="p">[</span><span class="n">vars_processed</span><span class="p">]</span>
            <span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;run_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span>
        <span class="n">index</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;target_time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">([</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;level&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
        <span class="n">index_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="s2">&quot;run_time&quot;</span><span class="p">,</span> <span class="s2">&quot;target_time&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">index_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;run_time&quot;</span><span class="p">,</span> <span class="s2">&quot;target_time&quot;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">index_names</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">utc</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;target_time&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;run_time&quot;</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">))]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">df_new</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="n">df_new</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="s2">&quot;Latitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="s2">&quot;Longitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;run_time&quot;</span><span class="p">:</span> <span class="s2">&quot;EnqueuedTime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;target_time&quot;</span><span class="p">:</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">df_new</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df_new</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;Latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;Longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;EnqueuedTime&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">])[</span>
            <span class="n">vars_processed</span>
        <span class="p">]</span>
        <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s2">&quot;Measure&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="o">.</span><span class="n">stack</span><span class="p">()</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ECMWF_MARS&quot;</span>
    <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Good&quot;</span>
    <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Latest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;EventDate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;EventTime&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>
    <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;TagName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">tag_prefix</span>
        <span class="o">+</span> <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Latitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
        <span class="o">+</span> <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Longitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
        <span class="o">+</span> <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Source&quot;</span><span class="p">]</span>
        <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
        <span class="o">+</span> <span class="n">df_new</span><span class="p">[</span><span class="s2">&quot;Measure&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">df_final</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Measure&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_final</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractGridToWeatherDataModel" class="doc doc-heading">
            <code>ECMWFExtractGridToWeatherDataModel</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.ecmwf.nc_extractbase_to_weather_data_model.ECMWFExtractBaseToWeatherDataModel" href="../../transformers/spark/ecmwf/nc_extractbase_to_weather_data_model/#src.sdk.python.rtdip_sdk.pipelines.transformers.spark.ecmwf.nc_extractbase_to_weather_data_model.ECMWFExtractBaseToWeatherDataModel">ECMWFExtractBaseToWeatherDataModel</a></code></p>


      <p>Extract a grid from a local .nc file downloaded from ECMWF via MARS</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lat_min</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum latitude of grid to extract</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lat_max</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum latitude of grid to extract</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lon_min</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum longitude of grid to extract</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lon_max</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum longitude of grid to extract</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>grid_step</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The grid length to use to define the grid, e.g. 0.1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>load_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to local directory with nc files downloaded in format "yyyy-mm-dd_HH.nc"</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>date_start</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date of extraction in "YYYY-MM-DD HH:MM:SS" format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>date_end</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date of extraction in "YYYY-MM-DD HH:MM:SS" format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>run_frequency</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency format of runs to download, e.g. "H"</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>run_interval</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interval of runs, e.g. a run_frequency of "H" and run_interval of "12" will extract the data of the 00 and 12 run for each day.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>utc</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Add utc to the datetime indexes? Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/ecmwf/nc_extractgrid_to_weather_data_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ECMWFExtractGridToWeatherDataModel</span><span class="p">(</span><span class="n">ECMWFExtractBaseToWeatherDataModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract a grid from a local .nc file downloaded from ECMWF via MARS</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_min (float): Minimum latitude of grid to extract</span>
<span class="sd">        lat_max (float): Maximum latitude of grid to extract</span>
<span class="sd">        lon_min (float): Minimum longitude of grid to extract</span>
<span class="sd">        lon_max (float): Maximum longitude of grid to extract</span>
<span class="sd">        grid_step (float): The grid length to use to define the grid, e.g. 0.1.</span>
<span class="sd">        load_path (str): Path to local directory with nc files downloaded in format &quot;yyyy-mm-dd_HH.nc&quot;</span>
<span class="sd">        date_start (str): Start date of extraction in &quot;YYYY-MM-DD HH:MM:SS&quot; format</span>
<span class="sd">        date_end (str): End date of extraction in &quot;YYYY-MM-DD HH:MM:SS&quot; format</span>
<span class="sd">        run_frequency (str): Frequency format of runs to download, e.g. &quot;H&quot;</span>
<span class="sd">        run_interval (str): Interval of runs, e.g. a run_frequency of &quot;H&quot; and run_interval of &quot;12&quot; will extract the data of the 00 and 12 run for each day.</span>
<span class="sd">        utc (bool, optional): Add utc to the datetime indexes? Defaults to True.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lat_min</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">lat_max</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">lon_min</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">lon_max</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">grid_step</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">load_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">date_start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">date_end</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">run_interval</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">run_frequency</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">utc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># hmm careful with floating points, this seems to work ok...</span>
        <span class="n">lat_xr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">lat_max</span> <span class="o">-</span> <span class="n">lat_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">grid_step</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">),</span>
            <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">lon_xr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">lon_max</span> <span class="o">-</span> <span class="n">lon_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">grid_step</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">),</span>
            <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_path</span> <span class="o">=</span> <span class="n">load_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat_min</span> <span class="o">=</span> <span class="n">lat_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat_max</span> <span class="o">=</span> <span class="n">lat_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon_min</span> <span class="o">=</span> <span class="n">lon_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon_max</span> <span class="o">=</span> <span class="n">lon_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_step</span> <span class="o">=</span> <span class="n">grid_step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat_xr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">lon_xr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_start</span> <span class="o">=</span> <span class="n">date_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_end</span> <span class="o">=</span> <span class="n">date_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_frequency</span> <span class="o">=</span> <span class="n">run_frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_interval</span> <span class="o">=</span> <span class="n">run_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utc</span> <span class="o">=</span> <span class="n">utc</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ECMWFExtractGridToWeatherDataModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">lat</span><span class="o">=</span><span class="n">lat_xr</span><span class="p">,</span>
            <span class="n">lon</span><span class="o">=</span><span class="n">lon_xr</span><span class="p">,</span>
            <span class="n">load_path</span><span class="o">=</span><span class="n">load_path</span><span class="p">,</span>
            <span class="n">date_start</span><span class="o">=</span><span class="n">date_start</span><span class="p">,</span>
            <span class="n">date_end</span><span class="o">=</span><span class="n">date_end</span><span class="p">,</span>
            <span class="n">run_interval</span><span class="o">=</span><span class="n">run_interval</span><span class="p">,</span>
            <span class="n">run_frequency</span><span class="o">=</span><span class="n">run_frequency</span><span class="p">,</span>
            <span class="n">utc</span><span class="o">=</span><span class="n">utc</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ECMWFExtractPointToWeatherDataModel" class="doc doc-heading">
            <code>ECMWFExtractPointToWeatherDataModel</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.ecmwf.nc_extractbase_to_weather_data_model.ECMWFExtractBaseToWeatherDataModel" href="../../transformers/spark/ecmwf/nc_extractbase_to_weather_data_model/#src.sdk.python.rtdip_sdk.pipelines.transformers.spark.ecmwf.nc_extractbase_to_weather_data_model.ECMWFExtractBaseToWeatherDataModel">ECMWFExtractBaseToWeatherDataModel</a></code></p>


      <p>Extract a single point from a local .nc file downloaded from ECMWF via MARS</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lat</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude of point to extract</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lon</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude of point to extract</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>load_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to local directory with nc files downloaded in format "yyyy-mm-dd_HH.nc"</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>date_start</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date of extraction in "YYYY-MM-DD HH:MM:SS" format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>date_end</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date of extraction in "YYYY-MM-DD HH:MM:SS" format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>run_frequency</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency format of runs to download, e.g. "H"</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>run_interval</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interval of runs, e.g. a run_frequency of "H" and run_interval of "12" will extract the data of the 00 and 12 run for each day.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>utc</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Add utc to the datetime indexes? Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/ecmwf/nc_extractpoint_to_weather_data_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ECMWFExtractPointToWeatherDataModel</span><span class="p">(</span><span class="n">ECMWFExtractBaseToWeatherDataModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract a single point from a local .nc file downloaded from ECMWF via MARS</span>

<span class="sd">    Args:</span>
<span class="sd">        lat (float): Latitude of point to extract</span>
<span class="sd">        lon (float): Longitude of point to extract</span>
<span class="sd">        load_path (str): Path to local directory with nc files downloaded in format &quot;yyyy-mm-dd_HH.nc&quot;</span>
<span class="sd">        date_start (str): Start date of extraction in &quot;YYYY-MM-DD HH:MM:SS&quot; format</span>
<span class="sd">        date_end (str): End date of extraction in &quot;YYYY-MM-DD HH:MM:SS&quot; format</span>
<span class="sd">        run_frequency (str): Frequency format of runs to download, e.g. &quot;H&quot;</span>
<span class="sd">        run_interval (str): Interval of runs, e.g. a run_frequency of &quot;H&quot; and run_interval of &quot;12&quot; will extract the data of the 00 and 12 run for each day.</span>
<span class="sd">        utc (bool, optional): Add utc to the datetime indexes? Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lat</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">lon</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">load_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">date_start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">date_end</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">run_interval</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">run_frequency</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">utc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">lat_xr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">([</span><span class="n">lat</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">])</span>
        <span class="n">lon_xr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">([</span><span class="n">lon</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat_xr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">lon_xr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_path</span> <span class="o">=</span> <span class="n">load_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_start</span> <span class="o">=</span> <span class="n">date_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_end</span> <span class="o">=</span> <span class="n">date_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_frequency</span> <span class="o">=</span> <span class="n">run_frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_interval</span> <span class="o">=</span> <span class="n">run_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utc</span> <span class="o">=</span> <span class="n">utc</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ECMWFExtractPointToWeatherDataModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">lat</span><span class="o">=</span><span class="n">lat_xr</span><span class="p">,</span>
            <span class="n">lon</span><span class="o">=</span><span class="n">lon_xr</span><span class="p">,</span>
            <span class="n">load_path</span><span class="o">=</span><span class="n">load_path</span><span class="p">,</span>
            <span class="n">date_start</span><span class="o">=</span><span class="n">date_start</span><span class="p">,</span>
            <span class="n">date_end</span><span class="o">=</span><span class="n">date_end</span><span class="p">,</span>
            <span class="n">run_interval</span><span class="o">=</span><span class="n">run_interval</span><span class="p">,</span>
            <span class="n">run_frequency</span><span class="o">=</span><span class="n">run_frequency</span><span class="p">,</span>
            <span class="n">utc</span><span class="o">=</span><span class="n">utc</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.RawForecastToWeatherDataModel" class="doc doc-heading">
            <code>RawForecastToWeatherDataModel</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a raw forecast into weather data model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe to be transformed</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/the_weather_company/raw_forecast_to_weather_data_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RawForecastToWeatherDataModel</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a raw forecast into weather data model.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session instance.</span>
<span class="sd">        data (DataFrame): Dataframe to be transformed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span> <span class="o">=</span> <span class="n">WEATHER_DATA_MODEL</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_convert_into_target_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a Spark DataFrame structure into new structure based on the Target Schema.</span>

<span class="sd">        Returns: Nothing.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">dataType</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rdd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_schema</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A Forecast dataframe converted into Weather Data Model</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pre_transform_validation</span><span class="p">()</span>

        <span class="n">processed_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;WeatherDay&quot;</span><span class="p">,</span> <span class="n">substring</span><span class="p">(</span><span class="s2">&quot;FcstValidLocal&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;WeatherHour&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="n">substring</span><span class="p">(</span><span class="s2">&quot;FcstValidLocal&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;WeatherTimezoneOffset&quot;</span><span class="p">,</span> <span class="n">substring</span><span class="p">(</span><span class="s2">&quot;FcstValidLocal&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;WeatherType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ProcessedDate&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="n">processed_date</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Temp&quot;</span><span class="p">,</span> <span class="s2">&quot;Temperature&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Dewpt&quot;</span><span class="p">,</span> <span class="s2">&quot;DewPoint&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Rh&quot;</span><span class="p">,</span> <span class="s2">&quot;Humidity&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Hi&quot;</span><span class="p">,</span> <span class="s2">&quot;HeatIndex&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Wc&quot;</span><span class="p">,</span> <span class="s2">&quot;WindChill&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Wdir&quot;</span><span class="p">,</span> <span class="s2">&quot;WindDirection&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Wspd&quot;</span><span class="p">,</span> <span class="s2">&quot;WindSpeed&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Clds&quot;</span><span class="p">,</span> <span class="s2">&quot;CloudCover&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;WetBulbTemp&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;SolarIrradiance&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Qpf&quot;</span><span class="p">,</span> <span class="s2">&quot;Precipitation&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;DayInd&quot;</span><span class="p">,</span> <span class="s2">&quot;DayOrNight&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Dow&quot;</span><span class="p">,</span> <span class="s2">&quot;DayOfWeek&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Gust&quot;</span><span class="p">,</span> <span class="s2">&quot;WindGust&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Mslp&quot;</span><span class="p">,</span> <span class="s2">&quot;MslPressure&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Num&quot;</span><span class="p">,</span> <span class="s2">&quot;ForecastDayNum&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Pop&quot;</span><span class="p">,</span> <span class="s2">&quot;PropOfPrecip&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;PrecipType&quot;</span><span class="p">,</span> <span class="s2">&quot;PrecipType&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;SnowQpf&quot;</span><span class="p">,</span> <span class="s2">&quot;SnowAccumulation&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;UvIndex&quot;</span><span class="p">,</span> <span class="s2">&quot;UvIndex&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Vis&quot;</span><span class="p">,</span> <span class="s2">&quot;Visibility&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="n">column</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">column</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_into_target_schema</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_transform_validation</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.RawForecastToWeatherDataModel.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.RawForecastToWeatherDataModel.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/the_weather_company/raw_forecast_to_weather_data_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.RawForecastToWeatherDataModel.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Forecast dataframe converted into Weather Data Model</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/the_weather_company/raw_forecast_to_weather_data_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A Forecast dataframe converted into Weather Data Model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pre_transform_validation</span><span class="p">()</span>

    <span class="n">processed_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;WeatherDay&quot;</span><span class="p">,</span> <span class="n">substring</span><span class="p">(</span><span class="s2">&quot;FcstValidLocal&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;WeatherHour&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">substring</span><span class="p">(</span><span class="s2">&quot;FcstValidLocal&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;WeatherTimezoneOffset&quot;</span><span class="p">,</span> <span class="n">substring</span><span class="p">(</span><span class="s2">&quot;FcstValidLocal&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;WeatherType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ProcessedDate&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="n">processed_date</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Temp&quot;</span><span class="p">,</span> <span class="s2">&quot;Temperature&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Dewpt&quot;</span><span class="p">,</span> <span class="s2">&quot;DewPoint&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Rh&quot;</span><span class="p">,</span> <span class="s2">&quot;Humidity&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Hi&quot;</span><span class="p">,</span> <span class="s2">&quot;HeatIndex&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Wc&quot;</span><span class="p">,</span> <span class="s2">&quot;WindChill&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Wdir&quot;</span><span class="p">,</span> <span class="s2">&quot;WindDirection&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Wspd&quot;</span><span class="p">,</span> <span class="s2">&quot;WindSpeed&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Clds&quot;</span><span class="p">,</span> <span class="s2">&quot;CloudCover&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;WetBulbTemp&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;SolarIrradiance&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Qpf&quot;</span><span class="p">,</span> <span class="s2">&quot;Precipitation&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;DayInd&quot;</span><span class="p">,</span> <span class="s2">&quot;DayOrNight&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Dow&quot;</span><span class="p">,</span> <span class="s2">&quot;DayOfWeek&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Gust&quot;</span><span class="p">,</span> <span class="s2">&quot;WindGust&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Mslp&quot;</span><span class="p">,</span> <span class="s2">&quot;MslPressure&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Num&quot;</span><span class="p">,</span> <span class="s2">&quot;ForecastDayNum&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Pop&quot;</span><span class="p">,</span> <span class="s2">&quot;PropOfPrecip&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;PrecipType&quot;</span><span class="p">,</span> <span class="s2">&quot;PrecipType&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;SnowQpf&quot;</span><span class="p">,</span> <span class="s2">&quot;SnowAccumulation&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;UvIndex&quot;</span><span class="p">,</span> <span class="s2">&quot;UvIndex&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;Vis&quot;</span><span class="p">,</span> <span class="s2">&quot;Visibility&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="n">column</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">column</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_convert_into_target_schema</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">post_transform_validation</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PCDMToHoneywellAPMTransformer" class="doc doc-heading">
            <code>PCDMToHoneywellAPMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Spark Dataframe in PCDM format to Honeywell APM format.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PCDMToHoneywellAPMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">PCDMToHoneywellAPMTransformer</span>

<span class="n">pcdm_to_honeywell_apm_transformer</span> <span class="o">=</span> <span class="n">PCDMToHoneywellAPMTransformer</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">quality</span><span class="o">=</span><span class="s2">&quot;Good&quot;</span><span class="p">,</span>
    <span class="n">history_samples_per_message</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">compress_payload</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">pcdm_to_honeywell_apm_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code>Dataframe</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe in PCDM format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>quality</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value for quality inside HistorySamples</p>
              </div>
            </td>
            <td>
                  <code>&#39;Good&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>history_samples_per_message</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of HistorySamples for each row in the DataFrame (Batch Only)</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>compress_payload</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True compresses CloudPlatformEvent with gzip compression</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/pcdm_to_honeywell_apm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PCDMToHoneywellAPMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Spark Dataframe in PCDM format to Honeywell APM format.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import PCDMToHoneywellAPMTransformer</span>

<span class="sd">    pcdm_to_honeywell_apm_transformer = PCDMToHoneywellAPMTransformer(</span>
<span class="sd">        data=df,</span>
<span class="sd">        quality=&quot;Good&quot;,</span>
<span class="sd">        history_samples_per_message=1,</span>
<span class="sd">        compress_payload=True</span>
<span class="sd">    )</span>

<span class="sd">    result = pcdm_to_honeywell_apm_transformer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (Dataframe): Spark Dataframe in PCDM format</span>
<span class="sd">        quality (str): Value for quality inside HistorySamples</span>
<span class="sd">        history_samples_per_message (int): The number of HistorySamples for each row in the DataFrame (Batch Only)</span>
<span class="sd">        compress_payload (bool): If True compresses CloudPlatformEvent with gzip compression</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">quality</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">history_samples_per_message</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">compress_payload</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">quality</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Good&quot;</span><span class="p">,</span>
        <span class="n">history_samples_per_message</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">compress_payload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quality</span> <span class="o">=</span> <span class="n">quality</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history_samples_per_message</span> <span class="o">=</span> <span class="n">history_samples_per_message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compress_payload</span> <span class="o">=</span> <span class="n">compress_payload</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with with rows in Honeywell APM format</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@udf</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_compress_payload</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">compressed_data</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
            <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">compressed_data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">encoded_data</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isStreaming</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_samples_per_message</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">)</span>
            <span class="n">cleaned_pcdm_df</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                    <span class="s2">&quot;index&quot;</span><span class="p">,</span>
                    <span class="n">floor</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_samples_per_message</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                    <span class="s2">&quot;HistorySamples&quot;</span><span class="p">,</span>
                    <span class="n">struct</span><span class="p">(</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ItemName&quot;</span><span class="p">),</span>
                        <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Quality&quot;</span><span class="p">),</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">),</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">),</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;HistorySamples&quot;</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">collect_list</span><span class="p">(</span><span class="s2">&quot;HistorySamples&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;HistorySamples&quot;</span><span class="p">))</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">,</span> <span class="n">sha2</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">),</span> <span class="mi">256</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">))</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">,</span>
                    <span class="n">struct</span><span class="p">(</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;SystemGuid&quot;</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;HistorySamples&quot;</span><span class="p">)</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cleaned_pcdm_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;guid&quot;</span><span class="p">,</span> <span class="n">sha2</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">),</span> <span class="mi">256</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;value&quot;</span><span class="p">,</span>
                <span class="n">struct</span><span class="p">(</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;SystemGuid&quot;</span><span class="p">),</span>
                    <span class="n">array</span><span class="p">(</span>
                        <span class="n">struct</span><span class="p">(</span>
                            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ItemName&quot;</span><span class="p">),</span>
                            <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Quality&quot;</span><span class="p">),</span>
                            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">),</span>
                            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">),</span>
                        <span class="p">),</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;HistorySamples&quot;</span><span class="p">),</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">cleaned_pcdm_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;CloudPlatformEvent&quot;</span><span class="p">,</span>
                <span class="n">struct</span><span class="p">(</span>
                    <span class="n">lit</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">UTC</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;CreatedTime&quot;</span><span class="p">),</span>
                    <span class="n">lit</span><span class="p">(</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;uuid()&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">),</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;CreatorId&quot;</span><span class="p">),</span>
                    <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;CloudPlatformSystem&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;CreatorType&quot;</span><span class="p">),</span>
                    <span class="n">lit</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;GeneratorId&quot;</span><span class="p">),</span>
                    <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;CloudPlatformTenant&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;GeneratorType&quot;</span><span class="p">),</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;TargetId&quot;</span><span class="p">),</span>
                    <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;CloudPlatformTenant&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;TargetType&quot;</span><span class="p">),</span>
                    <span class="n">lit</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;TargetContext&quot;</span><span class="p">),</span>
                    <span class="n">struct</span><span class="p">(</span>
                        <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;TextualBody&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span>
                        <span class="n">to_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">),</span>
                        <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;application/json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">),</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Body&quot;</span><span class="p">),</span>
                    <span class="n">array</span><span class="p">(</span>
                        <span class="n">struct</span><span class="p">(</span>
                            <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;SystemType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Key&quot;</span><span class="p">),</span>
                            <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;apm-system&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">),</span>
                        <span class="p">),</span>
                        <span class="n">struct</span><span class="p">(</span>
                            <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;SystemGuid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Key&quot;</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
                        <span class="p">),</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;BodyProperties&quot;</span><span class="p">),</span>
                    <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;DataChange.Update&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventType&quot;</span><span class="p">),</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;AnnotationStreamIds&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;partitionKey&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compress_payload</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">_compress_payload</span><span class="p">(</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&quot;CloudPlatformEvent&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
                    <span class="s2">&quot;CloudPlatformEvent&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;AnnotationStreamIds&quot;</span><span class="p">,</span>
                <span class="s2">&quot;partitionKey&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="s2">&quot;CloudPlatformEvent&quot;</span><span class="p">,</span> <span class="s2">&quot;AnnotationStreamIds&quot;</span><span class="p">,</span> <span class="s2">&quot;partitionKey&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PCDMToHoneywellAPMTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PCDMToHoneywellAPMTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/pcdm_to_honeywell_apm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PCDMToHoneywellAPMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with with rows in Honeywell APM format</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/pcdm_to_honeywell_apm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with with rows in Honeywell APM format</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@udf</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compress_payload</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">compressed_data</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
        <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">compressed_data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">encoded_data</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isStreaming</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_samples_per_message</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">)</span>
        <span class="n">cleaned_pcdm_df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;index&quot;</span><span class="p">,</span>
                <span class="n">floor</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_samples_per_message</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;HistorySamples&quot;</span><span class="p">,</span>
                <span class="n">struct</span><span class="p">(</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ItemName&quot;</span><span class="p">),</span>
                    <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Quality&quot;</span><span class="p">),</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">),</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">),</span>
                <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;HistorySamples&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">collect_list</span><span class="p">(</span><span class="s2">&quot;HistorySamples&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;HistorySamples&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">,</span> <span class="n">sha2</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">),</span> <span class="mi">256</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;value&quot;</span><span class="p">,</span>
                <span class="n">struct</span><span class="p">(</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;SystemGuid&quot;</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;HistorySamples&quot;</span><span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cleaned_pcdm_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;guid&quot;</span><span class="p">,</span> <span class="n">sha2</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">),</span> <span class="mi">256</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;value&quot;</span><span class="p">,</span>
            <span class="n">struct</span><span class="p">(</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;SystemGuid&quot;</span><span class="p">),</span>
                <span class="n">array</span><span class="p">(</span>
                    <span class="n">struct</span><span class="p">(</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ItemName&quot;</span><span class="p">),</span>
                        <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Quality&quot;</span><span class="p">),</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">),</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">),</span>
                    <span class="p">),</span>
                <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;HistorySamples&quot;</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cleaned_pcdm_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;CloudPlatformEvent&quot;</span><span class="p">,</span>
            <span class="n">struct</span><span class="p">(</span>
                <span class="n">lit</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">UTC</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;CreatedTime&quot;</span><span class="p">),</span>
                <span class="n">lit</span><span class="p">(</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;uuid()&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;CreatorId&quot;</span><span class="p">),</span>
                <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;CloudPlatformSystem&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;CreatorType&quot;</span><span class="p">),</span>
                <span class="n">lit</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;GeneratorId&quot;</span><span class="p">),</span>
                <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;CloudPlatformTenant&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;GeneratorType&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;TargetId&quot;</span><span class="p">),</span>
                <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;CloudPlatformTenant&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;TargetType&quot;</span><span class="p">),</span>
                <span class="n">lit</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;TargetContext&quot;</span><span class="p">),</span>
                <span class="n">struct</span><span class="p">(</span>
                    <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;TextualBody&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span>
                    <span class="n">to_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">),</span>
                    <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;application/json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">),</span>
                <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Body&quot;</span><span class="p">),</span>
                <span class="n">array</span><span class="p">(</span>
                    <span class="n">struct</span><span class="p">(</span>
                        <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;SystemType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Key&quot;</span><span class="p">),</span>
                        <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;apm-system&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="n">struct</span><span class="p">(</span>
                        <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;SystemGuid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Key&quot;</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
                    <span class="p">),</span>
                <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;BodyProperties&quot;</span><span class="p">),</span>
                <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;DataChange.Update&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventType&quot;</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;AnnotationStreamIds&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;partitionKey&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compress_payload</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">_compress_payload</span><span class="p">(</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&quot;CloudPlatformEvent&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
                <span class="s2">&quot;CloudPlatformEvent&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;AnnotationStreamIds&quot;</span><span class="p">,</span>
            <span class="s2">&quot;partitionKey&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="s2">&quot;CloudPlatformEvent&quot;</span><span class="p">,</span> <span class="s2">&quot;AnnotationStreamIds&quot;</span><span class="p">,</span> <span class="s2">&quot;partitionKey&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HoneywellAPMJsonToPCDMTransformer" class="doc doc-heading">
            <code>HoneywellAPMJsonToPCDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Spark Dataframe column containing a json string created by Honeywell APM to the Process Control Data Model.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HoneywellAPMJsonToPCDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">HoneywellAPMJsonToPCDMTransformer</span>

<span class="n">honeywell_apm_json_to_pcdm_transformer</span> <span class="o">=</span> <span class="n">HoneywellAPMJsonToPCDMTransformer</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">souce_column_name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="p">,</span>
    <span class="n">status_null_value</span><span class="o">=</span><span class="s2">&quot;Good&quot;</span><span class="p">,</span>
    <span class="n">change_type_value</span><span class="o">=</span><span class="s2">&quot;insert&quot;</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">honeywell_apm_json_to_pcdm_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe containing the column with EdgeX data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe column containing the OPC Publisher Json OPC UA data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>status_null_value</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'Good' in the Status column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Good&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>change_type_value</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'insert' in the ChangeType column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;insert&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/honeywell_apm_to_pcdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HoneywellAPMJsonToPCDMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Spark Dataframe column containing a json string created by Honeywell APM to the Process Control Data Model.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import HoneywellAPMJsonToPCDMTransformer</span>

<span class="sd">    honeywell_apm_json_to_pcdm_transformer = HoneywellAPMJsonToPCDMTransformer(</span>
<span class="sd">        data=df,</span>
<span class="sd">        souce_column_name=&quot;body&quot;,</span>
<span class="sd">        status_null_value=&quot;Good&quot;,</span>
<span class="sd">        change_type_value=&quot;insert&quot;</span>
<span class="sd">    )</span>

<span class="sd">    result = honeywell_apm_json_to_pcdm_transformer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe containing the column with EdgeX data</span>
<span class="sd">        source_column_name (str): Spark Dataframe column containing the OPC Publisher Json OPC UA data</span>
<span class="sd">        status_null_value (optional str): If populated, will replace &#39;Good&#39; in the Status column with the specified value.</span>
<span class="sd">        change_type_value (optional str): If populated, will replace &#39;insert&#39; in the ChangeType column with the specified value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Good&quot;</span><span class="p">,</span>
        <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;insert&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">=</span> <span class="n">source_column_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span> <span class="o">=</span> <span class="n">status_null_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span> <span class="o">=</span> <span class="n">change_type_value</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="n">from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">APM_SCHEMA</span><span class="p">))</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;body.SystemTimeSeries.Samples&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;to_timestamp(col.Time) as EventTime&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;col.Itemname&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;col.Value&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
                <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="s2">&quot;string&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HoneywellAPMJsonToPCDMTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HoneywellAPMJsonToPCDMTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/honeywell_apm_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HoneywellAPMJsonToPCDMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the specified column converted to PCDM</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/honeywell_apm_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="n">from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">APM_SCHEMA</span><span class="p">))</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;body.SystemTimeSeries.Samples&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;to_timestamp(col.Time) as EventTime&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;col.Itemname&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;col.Value&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span>
            <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="s2">&quot;string&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SEMJsonToPCDMTransformer" class="doc doc-heading">
            <code>SEMJsonToPCDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Spark Dataframe column containing a json string created by SEM to the Process Control Data Model.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SEMJsonToPCDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">SEMJsonToPCDMTransformer</span>

<span class="n">sem_json_to_pcdm_transformer</span> <span class="o">=</span> <span class="n">SEMJsonToPCDMTransformer</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span>
    <span class="n">source_column_name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">status_null_value</span><span class="o">=</span><span class="s2">&quot;Good&quot;</span><span class="p">,</span>
    <span class="n">change_type_value</span><span class="o">=</span><span class="s2">&quot;insert&quot;</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">sem_json_to_pcdm_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe containing the column with SEM data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe column containing the Json SEM data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>version</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The version for the OBC field mappings. The latest version is 10.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>status_null_value</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'Good' in the Status column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Good&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>change_type_value</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'insert' in the ChangeType column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;insert&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/sem_json_to_pcdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SEMJsonToPCDMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Spark Dataframe column containing a json string created by SEM to the Process Control Data Model.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import SEMJsonToPCDMTransformer</span>

<span class="sd">    sem_json_to_pcdm_transformer = SEMJsonToPCDMTransformer(</span>
<span class="sd">        data=df</span>
<span class="sd">        source_column_name=&quot;body&quot;,</span>
<span class="sd">        version=10,</span>
<span class="sd">        status_null_value=&quot;Good&quot;,</span>
<span class="sd">        change_type_value=&quot;insert&quot;</span>
<span class="sd">    )</span>

<span class="sd">    result = sem_json_to_pcdm_transformer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe containing the column with SEM data</span>
<span class="sd">        source_column_name (str): Spark Dataframe column containing the Json SEM data</span>
<span class="sd">        version (int): The version for the OBC field mappings. The latest version is 10.</span>
<span class="sd">        status_null_value (optional str): If populated, will replace &#39;Good&#39; in the Status column with the specified value.</span>
<span class="sd">        change_type_value (optional str): If populated, will replace &#39;insert&#39; in the ChangeType column with the specified value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Good&quot;</span><span class="p">,</span>
        <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;insert&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_package_version_meets_minimum</span><span class="p">(</span><span class="s2">&quot;pyspark&quot;</span><span class="p">,</span> <span class="s2">&quot;3.4.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">=</span> <span class="n">source_column_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span> <span class="o">=</span> <span class="n">status_null_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span> <span class="o">=</span> <span class="n">change_type_value</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="n">obc_field_mappings</span><span class="o">.</span><span class="n">OBC_FIELD_MAPPINGS_V10</span>
            <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
                    <span class="n">from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">SEM_SCHEMA</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">+</span> <span class="s2">&quot;.readings&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">melt</span><span class="p">(</span>
                    <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;readings.resourceName&quot;</span><span class="p">],</span>
                    <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;readings.value&quot;</span><span class="p">],</span>
                    <span class="n">variableColumnName</span><span class="o">=</span><span class="s2">&quot;var&quot;</span><span class="p">,</span>
                    <span class="n">valueColumnName</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">map_from_arrays</span><span class="p">(</span><span class="s2">&quot;resourceName&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;resourceName&quot;</span><span class="p">))</span>
                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;resourceName.dID&quot;</span><span class="p">,</span> <span class="s2">&quot;resourceName.d&quot;</span><span class="p">,</span> <span class="s2">&quot;resourceName.t&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">select</span><span class="p">(</span>
                    <span class="n">regexp_replace</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">),</span> <span class="s2">&quot;(\d</span><span class="si">{10}</span><span class="s2">)(\d+)&quot;</span><span class="p">,</span> <span class="s2">&quot;$1.$2&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;dID&quot;</span><span class="p">,</span>
                    <span class="n">posexplode</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;substring(d, 2, length(d)-2)&quot;</span><span class="p">),</span> <span class="s2">&quot;,&quot;</span><span class="p">)),</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">select</span><span class="p">(</span>
                    <span class="n">to_timestamp</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;dID&quot;</span><span class="p">),</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;pos&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">),</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;col&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                    <span class="s2">&quot;TagName&quot;</span><span class="p">,</span>
                    <span class="n">concat</span><span class="p">(</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;dID&quot;</span><span class="p">),</span>
                        <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">),</span>
                        <span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">mapping</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s2">&quot;TagName&quot;</span><span class="p">])(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;pos&quot;</span><span class="p">)),</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                    <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">mapping</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s2">&quot;ValueType&quot;</span><span class="p">])(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;pos&quot;</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">))</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;The wrong version was specified. Please use the latest version&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SEMJsonToPCDMTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SEMJsonToPCDMTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/sem_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SEMJsonToPCDMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the specified column converted to PCDM</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/sem_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">obc_field_mappings</span><span class="o">.</span><span class="n">OBC_FIELD_MAPPINGS_V10</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
                <span class="n">from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">SEM_SCHEMA</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">+</span> <span class="s2">&quot;.readings&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">melt</span><span class="p">(</span>
                <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;readings.resourceName&quot;</span><span class="p">],</span>
                <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;readings.value&quot;</span><span class="p">],</span>
                <span class="n">variableColumnName</span><span class="o">=</span><span class="s2">&quot;var&quot;</span><span class="p">,</span>
                <span class="n">valueColumnName</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">map_from_arrays</span><span class="p">(</span><span class="s2">&quot;resourceName&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;resourceName&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;resourceName.dID&quot;</span><span class="p">,</span> <span class="s2">&quot;resourceName.d&quot;</span><span class="p">,</span> <span class="s2">&quot;resourceName.t&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">regexp_replace</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">),</span> <span class="s2">&quot;(\d</span><span class="si">{10}</span><span class="s2">)(\d+)&quot;</span><span class="p">,</span> <span class="s2">&quot;$1.$2&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">),</span>
                <span class="s2">&quot;dID&quot;</span><span class="p">,</span>
                <span class="n">posexplode</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;substring(d, 2, length(d)-2)&quot;</span><span class="p">),</span> <span class="s2">&quot;,&quot;</span><span class="p">)),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">to_timestamp</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;dID&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;pos&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;col&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;TagName&quot;</span><span class="p">,</span>
                <span class="n">concat</span><span class="p">(</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;dID&quot;</span><span class="p">),</span>
                    <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">),</span>
                    <span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">mapping</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s2">&quot;TagName&quot;</span><span class="p">])(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;pos&quot;</span><span class="p">)),</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">mapping</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s2">&quot;ValueType&quot;</span><span class="p">])(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;pos&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
            <span class="s2">&quot;The wrong version was specified. Please use the latest version&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToPCDMTransformer" class="doc doc-heading">
            <code>MiricoJsonToPCDMTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Spark Dataframe column containing a json string created from Mirico to the Process Control Data Model.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToPCDMTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">MiricoJsonToPCDMTransformer</span>

<span class="n">mirico_json_to_pcdm_transformer</span> <span class="o">=</span> <span class="n">MiricoJsonToPCDMTransformer</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span>
    <span class="n">source_column_name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="p">,</span>
    <span class="n">status_null_value</span><span class="o">=</span><span class="s2">&quot;Good&quot;</span><span class="p">,</span>
    <span class="n">change_type_value</span><span class="o">=</span><span class="s2">&quot;insert&quot;</span>
    <span class="n">tagname_field</span><span class="o">=</span><span class="s2">&quot;test&quot;</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">mirico_json_to_pcdm_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe containing the column with Mirico data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe column containing the Json Mirico data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>status_null_value</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'Good' in the Status column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Good&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>change_type_value</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will replace 'insert' in the ChangeType column with the specified value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;insert&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tagname_field</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If populated, will add the specified field to the TagName column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/mirico_json_to_pcdm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MiricoJsonToPCDMTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Spark Dataframe column containing a json string created from Mirico to the Process Control Data Model.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import MiricoJsonToPCDMTransformer</span>

<span class="sd">    mirico_json_to_pcdm_transformer = MiricoJsonToPCDMTransformer(</span>
<span class="sd">        data=df</span>
<span class="sd">        source_column_name=&quot;body&quot;,</span>
<span class="sd">        status_null_value=&quot;Good&quot;,</span>
<span class="sd">        change_type_value=&quot;insert&quot;</span>
<span class="sd">        tagname_field=&quot;test&quot;</span>
<span class="sd">    )</span>

<span class="sd">    result = mirico_json_to_pcdm_transformer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe containing the column with Mirico data</span>
<span class="sd">        source_column_name (str): Spark Dataframe column containing the Json Mirico data</span>
<span class="sd">        status_null_value (optional str): If populated, will replace &#39;Good&#39; in the Status column with the specified value.</span>
<span class="sd">        change_type_value (optional str): If populated, will replace &#39;insert&#39; in the ChangeType column with the specified value.</span>
<span class="sd">        tagname_field (optional str): If populated, will add the specified field to the TagName column.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">status_null_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Good&quot;</span><span class="p">,</span>
        <span class="n">change_type_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;insert&quot;</span><span class="p">,</span>
        <span class="n">tagname_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_package_version_meets_minimum</span><span class="p">(</span><span class="s2">&quot;pyspark&quot;</span><span class="p">,</span> <span class="s2">&quot;3.4.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">=</span> <span class="n">source_column_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_null_value</span> <span class="o">=</span> <span class="n">status_null_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_type_value</span> <span class="o">=</span> <span class="n">change_type_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tagname_field</span> <span class="o">=</span> <span class="n">tagname_field</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mapping</span> <span class="o">=</span> <span class="n">mirico_field_mappings</span><span class="o">.</span><span class="n">MIRICO_FIELD_MAPPINGS</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
                <span class="n">from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="s2">&quot;map&lt;string,string&gt;&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="n">map_keys</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">map_values</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">map_from_arrays</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span>
                <span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;x.timeStamp&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;x.siteName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;siteName&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;x.gasType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;gasType&quot;</span><span class="p">),</span>
                <span class="n">col</span><span class="p">(</span><span class="s2">&quot;x.retroName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;retroName&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;siteName&quot;</span><span class="p">,</span> <span class="s2">&quot;gasType&quot;</span><span class="p">,</span> <span class="s2">&quot;retroName&quot;</span><span class="p">,</span> <span class="n">posexplode</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">mapping</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s2">&quot;ValueType&quot;</span><span class="p">])(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;pos&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;Good&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;insert&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;TagName&quot;</span><span class="p">,</span>
                <span class="n">when</span><span class="p">(</span>
                    <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagname_field</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span>
                    <span class="n">concat_ws</span><span class="p">(</span>
                        <span class="s2">&quot;:&quot;</span><span class="p">,</span>
                        <span class="o">*</span><span class="p">[</span>
                            <span class="n">upper</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagname_field</span><span class="p">)),</span>
                            <span class="n">concat_ws</span><span class="p">(</span>
                                <span class="s2">&quot;_&quot;</span><span class="p">,</span>
                                <span class="o">*</span><span class="p">[</span>
                                    <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;siteName&quot;</span><span class="p">)),</span>
                                    <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;retroName&quot;</span><span class="p">)),</span>
                                    <span class="n">when</span><span class="p">(</span>
                                        <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;GASPPM&quot;</span><span class="p">,</span>
                                        <span class="n">concat_ws</span><span class="p">(</span>
                                            <span class="s2">&quot;_&quot;</span><span class="p">,</span>
                                            <span class="o">*</span><span class="p">[</span><span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)),</span> <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;gasType&quot;</span><span class="p">))]</span>
                                        <span class="p">),</span>
                                    <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">))),</span>
                                <span class="p">]</span>
                            <span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">),</span>
                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                    <span class="n">concat_ws</span><span class="p">(</span>
                        <span class="s2">&quot;_&quot;</span><span class="p">,</span>
                        <span class="o">*</span><span class="p">[</span>
                            <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;siteName&quot;</span><span class="p">)),</span>
                            <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;retroName&quot;</span><span class="p">)),</span>
                            <span class="n">when</span><span class="p">(</span>
                                <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;GASPPM&quot;</span><span class="p">,</span>
                                <span class="n">concat_ws</span><span class="p">(</span>
                                    <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)),</span> <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;gasType&quot;</span><span class="p">))]</span>
                                <span class="p">),</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">))),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="o">~</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                    <span class="s2">&quot;timeStamp&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;gasType&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;retroLongitude&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;retroLatitude&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;retroAltitude&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;sensorLongitude&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;sensorLatitude&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;sensorAltitude&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;siteName&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;siteKey&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;retroName&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToPCDMTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToPCDMTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/mirico_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToPCDMTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the specified column converted to PCDM</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/mirico_json_to_pcdm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the specified column converted to PCDM</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mapping</span> <span class="o">=</span> <span class="n">mirico_field_mappings</span><span class="o">.</span><span class="n">MIRICO_FIELD_MAPPINGS</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span>
            <span class="n">from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="s2">&quot;map&lt;string,string&gt;&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="n">map_keys</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">map_values</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">map_from_arrays</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span>
            <span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;x.timeStamp&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;x.siteName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;siteName&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;x.gasType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;gasType&quot;</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;x.retroName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;retroName&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;siteName&quot;</span><span class="p">,</span> <span class="s2">&quot;gasType&quot;</span><span class="p">,</span> <span class="s2">&quot;retroName&quot;</span><span class="p">,</span> <span class="n">posexplode</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">mapping</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s2">&quot;ValueType&quot;</span><span class="p">])(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;pos&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;Good&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;insert&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;TagName&quot;</span><span class="p">,</span>
            <span class="n">when</span><span class="p">(</span>
                <span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagname_field</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span>
                <span class="n">concat_ws</span><span class="p">(</span>
                    <span class="s2">&quot;:&quot;</span><span class="p">,</span>
                    <span class="o">*</span><span class="p">[</span>
                        <span class="n">upper</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagname_field</span><span class="p">)),</span>
                        <span class="n">concat_ws</span><span class="p">(</span>
                            <span class="s2">&quot;_&quot;</span><span class="p">,</span>
                            <span class="o">*</span><span class="p">[</span>
                                <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;siteName&quot;</span><span class="p">)),</span>
                                <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;retroName&quot;</span><span class="p">)),</span>
                                <span class="n">when</span><span class="p">(</span>
                                    <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;GASPPM&quot;</span><span class="p">,</span>
                                    <span class="n">concat_ws</span><span class="p">(</span>
                                        <span class="s2">&quot;_&quot;</span><span class="p">,</span>
                                        <span class="o">*</span><span class="p">[</span><span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)),</span> <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;gasType&quot;</span><span class="p">))]</span>
                                    <span class="p">),</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">))),</span>
                            <span class="p">]</span>
                        <span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">),</span>
            <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                <span class="n">concat_ws</span><span class="p">(</span>
                    <span class="s2">&quot;_&quot;</span><span class="p">,</span>
                    <span class="o">*</span><span class="p">[</span>
                        <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;siteName&quot;</span><span class="p">)),</span>
                        <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;retroName&quot;</span><span class="p">)),</span>
                        <span class="n">when</span><span class="p">(</span>
                            <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;GASPPM&quot;</span><span class="p">,</span>
                            <span class="n">concat_ws</span><span class="p">(</span>
                                <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)),</span> <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;gasType&quot;</span><span class="p">))]</span>
                            <span class="p">),</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">))),</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="o">~</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                <span class="s2">&quot;timeStamp&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gasType&quot;</span><span class="p">,</span>
                <span class="s2">&quot;retroLongitude&quot;</span><span class="p">,</span>
                <span class="s2">&quot;retroLatitude&quot;</span><span class="p">,</span>
                <span class="s2">&quot;retroAltitude&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sensorLongitude&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sensorLatitude&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sensorAltitude&quot;</span><span class="p">,</span>
                <span class="s2">&quot;siteName&quot;</span><span class="p">,</span>
                <span class="s2">&quot;siteKey&quot;</span><span class="p">,</span>
                <span class="s2">&quot;retroName&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToMetadataTransformer" class="doc doc-heading">
            <code>MiricoJsonToMetadataTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Spark Dataframe column containing a json string created from Mirico to the Metadata Model.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToMetadataTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">MiricoJsonToMetadataTransformer</span>

<span class="n">mirico_json_to_metadata_transformer</span> <span class="o">=</span> <span class="n">MiricoJsonToMetadataTransformer</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span>
    <span class="n">source_column_name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">mirico_json_to_metadata_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe containing the column with Mirico data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_column_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Dataframe column containing the Json Mirico data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/mirico_json_to_metadata.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MiricoJsonToMetadataTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Spark Dataframe column containing a json string created from Mirico to the Metadata Model.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import MiricoJsonToMetadataTransformer</span>

<span class="sd">    mirico_json_to_metadata_transformer = MiricoJsonToMetadataTransformer(</span>
<span class="sd">        data=df</span>
<span class="sd">        source_column_name=&quot;body&quot;</span>
<span class="sd">    )</span>

<span class="sd">    result = mirico_json_to_metadata_transformer.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe containing the column with Mirico data</span>
<span class="sd">        source_column_name (str): Spark Dataframe column containing the Json Mirico data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">source_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_package_version_meets_minimum</span><span class="p">(</span><span class="s2">&quot;pyspark&quot;</span><span class="p">,</span> <span class="s2">&quot;3.4.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span> <span class="o">=</span> <span class="n">source_column_name</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A dataframe with the specified column converted to Metadata model</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">MIRICO_METADATA_SCHEMA</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">tag_name_expr</span> <span class="o">=</span> <span class="n">concat_ws</span><span class="p">(</span>
            <span class="s2">&quot;_&quot;</span><span class="p">,</span>
            <span class="o">*</span><span class="p">[</span>
                <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;body.siteName&quot;</span><span class="p">)),</span>
                <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;body.retroName&quot;</span><span class="p">)),</span>
                <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;body.gasType&quot;</span><span class="p">)),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">tag_name_expr</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">),</span>
            <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">),</span>
            <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;UoM&quot;</span><span class="p">),</span>
            <span class="n">expr</span><span class="p">(</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;struct(</span>
<span class="sd">                body.retroAltitude,</span>
<span class="sd">                body.retroLongitude,</span>
<span class="sd">                body.retroLatitude,</span>
<span class="sd">                body.sensorAltitude,</span>
<span class="sd">                body.sensorLongitude,</span>
<span class="sd">                body.sensorLatitude)&quot;&quot;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Properties&quot;</span><span class="p">),</span>
        <span class="p">)</span><span class="o">.</span><span class="n">dropDuplicates</span><span class="p">([</span><span class="s2">&quot;TagName&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="s2">&quot;UoM&quot;</span><span class="p">,</span> <span class="s2">&quot;Properties&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToMetadataTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToMetadataTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/mirico_json_to_metadata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.MiricoJsonToMetadataTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe with the specified column converted to Metadata model</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/mirico_json_to_metadata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A dataframe with the specified column converted to Metadata model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="n">from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_column_name</span><span class="p">,</span> <span class="n">MIRICO_METADATA_SCHEMA</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">tag_name_expr</span> <span class="o">=</span> <span class="n">concat_ws</span><span class="p">(</span>
        <span class="s2">&quot;_&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="p">[</span>
            <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;body.siteName&quot;</span><span class="p">)),</span>
            <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;body.retroName&quot;</span><span class="p">)),</span>
            <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;body.gasType&quot;</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="n">tag_name_expr</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">),</span>
        <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">),</span>
        <span class="n">lit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;UoM&quot;</span><span class="p">),</span>
        <span class="n">expr</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;struct(</span>
<span class="sd">            body.retroAltitude,</span>
<span class="sd">            body.retroLongitude,</span>
<span class="sd">            body.retroLatitude,</span>
<span class="sd">            body.sensorAltitude,</span>
<span class="sd">            body.sensorLongitude,</span>
<span class="sd">            body.sensorLatitude)&quot;&quot;&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Properties&quot;</span><span class="p">),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">dropDuplicates</span><span class="p">([</span><span class="s2">&quot;TagName&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="s2">&quot;UoM&quot;</span><span class="p">,</span> <span class="s2">&quot;Properties&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PandasToPySparkTransformer" class="doc doc-heading">
            <code>PandasToPySparkTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a Pandas DataFrame to a PySpark DataFrame.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PandasToPySparkTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">PandasToPySparkTransformer</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">pandas_to_pyspark</span> <span class="o">=</span> <span class="n">PandasToPySparkTransformer</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">pandas_to_pyspark</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session required to convert DataFrame</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>df</code></td>
            <td>
                  <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.mirico_json_to_metadata.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pandas DataFrame to be converted</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/pandas_to_pyspark.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PandasToPySparkTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Pandas DataFrame to a PySpark DataFrame.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import PandasToPySparkTransformer</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    pandas_to_pyspark = PandasToPySparkTransformer(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        df=df,</span>
<span class="sd">    )</span>

<span class="sd">    result = pandas_to_pyspark.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session required to convert DataFrame</span>
<span class="sd">        df (DataFrame): Pandas DataFrame to be converted</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">PandasDataFrame</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">PandasDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PySparkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A PySpark dataframe converted from a Pandas DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PandasToPySparkTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PandasToPySparkTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/pandas_to_pyspark.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PandasToPySparkTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pyspark.sql.dataframe.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A PySpark dataframe converted from a Pandas DataFrame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/pandas_to_pyspark.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PySparkDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A PySpark dataframe converted from a Pandas DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">_prepare_pandas_to_convert_to_spark</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PySparkToPandasTransformer" class="doc doc-heading">
            <code>PySparkToPandasTransformer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.interfaces.TransformerInterface">TransformerInterface</span></code></p>


      <p>Converts a PySpark DataFrame to a Pandas DataFrame.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PySparkToPandasTransformer--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.transformers</span> <span class="kn">import</span> <span class="n">PySparkToPandasTransformer</span>

<span class="n">pyspark_to_pandas</span> <span class="o">=</span> <span class="n">PySparkToPandasTransformer</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">pyspark_to_pandas</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>df</code></td>
            <td>
                  <code><span title="src.sdk.python.rtdip_sdk.pipelines.transformers.spark.mirico_json_to_metadata.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PySpark DataFrame to be converted</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/pyspark_to_pandas.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PySparkToPandasTransformer</span><span class="p">(</span><span class="n">TransformerInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a PySpark DataFrame to a Pandas DataFrame.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.transformers import PySparkToPandasTransformer</span>

<span class="sd">    pyspark_to_pandas = PySparkToPandasTransformer(</span>
<span class="sd">        df=df</span>
<span class="sd">    )</span>

<span class="sd">    result = pyspark_to_pandas.transform()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        df (DataFrame): PySpark DataFrame to be converted</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span><span class="p">:</span> <span class="n">PySparkDataFrame</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">PySparkDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_transform_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PandasDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A Pandas dataframe converted from a PySpark DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PySparkToPandasTransformer.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PySparkToPandasTransformer.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/pyspark_to_pandas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PySparkToPandasTransformer.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Pandas dataframe converted from a PySpark DataFrame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/transformers/spark/pyspark_to_pandas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PandasDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A Pandas dataframe converted from a PySpark DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination" class="doc doc-heading">
            <code>SparkDeltaDestination</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.destinations.interfaces.DestinationInterface">DestinationInterface</span></code></p>


      <p>The Spark Delta Destination is used to write data to a Delta table.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination--examples">Examples</h4>
<p><div class="highlight"><pre><span></span><code><span class="c1">#Delta Destination for Streaming Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkDeltaDestination</span>

<span class="n">delta_destination</span> <span class="o">=</span> <span class="n">SparkDeltaDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;checkpointLocation&quot;</span><span class="p">:</span> <span class="s2">&quot;/{CHECKPOINT-LOCATION}/&quot;</span>
    <span class="p">},</span>
    <span class="n">destination</span><span class="o">=</span><span class="s2">&quot;DELTA-TABLE-PATH&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;DeltaDestination&quot;</span><span class="p">,</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">delta_destination</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">#Delta Destination for Batch Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkDeltaDestination</span>

<span class="n">delta_destination</span> <span class="o">=</span> <span class="n">SparkDeltaDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;overwriteSchema&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="n">destination</span><span class="o">=</span><span class="s2">&quot;DELTA-TABLE-PATH&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;DeltaDestination&quot;</span><span class="p">,</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">delta_destination</span><span class="o">.</span><span class="n">write_batch</span><span class="p">()</span>
</code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe to be written to Delta</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Options that can be specified for a Delta Table write operation (See Attributes table below). Further information on the options is available for <a href="https://docs.delta.io/latest/delta-batch.html#write-to-a-table" target="_blank">batch</a> and <a href="https://docs.delta.io/latest/delta-streaming.html#delta-table-as-a-sink" target="_blank">streaming</a>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>destination</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Either the name of the Hive Metastore or Unity Catalog Delta Table <strong>or</strong> the path to the Delta table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mode</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method of writing to Delta Table - append/overwrite (batch), append/update/complete (stream). Default is append</p>
              </div>
            </td>
            <td>
                  <code>&#39;append&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trigger</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency of the write operation. Specify "availableNow" to execute a trigger once, otherwise specify a time period such as "30 seconds", "5 minutes". Set to "0 seconds" if you do not want to use a trigger. (stream) Default is 10 seconds</p>
              </div>
            </td>
            <td>
                  <code>&#39;10 seconds&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_name</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique name for the query in associated SparkSession. (stream) Default is DeltaDestination</p>
              </div>
            </td>
            <td>
                  <code>&#39;DeltaDestination&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_wait_interval</code></td>
            <td>
                  <code>optional int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set, waits for the streaming query to complete before returning. (stream) Default is None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.checkpointLocation">checkpointLocation</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to checkpoint files. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.txnAppId">txnAppId</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A unique string that you can pass on each DataFrame write. (Batch &amp; Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.txnVersion">txnVersion</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A monotonically increasing number that acts as transaction version. (Batch &amp; Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.maxRecordsPerFile">maxRecordsPerFile</span></code></td>
            <td>
                  <code>int str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specify the maximum number of records to write to a single file for a Delta Lake table. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.replaceWhere">replaceWhere</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Condition(s) for overwriting. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.partitionOverwriteMode">partitionOverwriteMode</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When set to dynamic, overwrites all existing data in each logical partition for which the write will commit new data. Default is static. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.overwriteSchema">overwriteSchema</span></code></td>
            <td>
                  <code>bool str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, overwrites the schema as well as the table data. (Batch)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/delta.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkDeltaDestination</span><span class="p">(</span><span class="n">DestinationInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Spark Delta Destination is used to write data to a Delta table.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    #Delta Destination for Streaming Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkDeltaDestination</span>

<span class="sd">    delta_destination = SparkDeltaDestination(</span>
<span class="sd">        data=df,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;checkpointLocation&quot;: &quot;/{CHECKPOINT-LOCATION}/&quot;</span>
<span class="sd">        },</span>
<span class="sd">        destination=&quot;DELTA-TABLE-PATH&quot;,</span>
<span class="sd">        mode=&quot;append&quot;,</span>
<span class="sd">        trigger=&quot;10 seconds&quot;,</span>
<span class="sd">        query_name=&quot;DeltaDestination&quot;,</span>
<span class="sd">        query_wait_interval=None</span>
<span class="sd">    )</span>

<span class="sd">    delta_destination.write_stream()</span>
<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">    #Delta Destination for Batch Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkDeltaDestination</span>

<span class="sd">    delta_destination = SparkDeltaDestination(</span>
<span class="sd">        data=df,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;overwriteSchema&quot;: True</span>
<span class="sd">        },</span>
<span class="sd">        destination=&quot;DELTA-TABLE-PATH&quot;,</span>
<span class="sd">        mode=&quot;append&quot;,</span>
<span class="sd">        trigger=&quot;10 seconds&quot;,</span>
<span class="sd">        query_name=&quot;DeltaDestination&quot;,</span>
<span class="sd">        query_wait_interval=None</span>
<span class="sd">    )</span>

<span class="sd">    delta_destination.write_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe to be written to Delta</span>
<span class="sd">        options (dict): Options that can be specified for a Delta Table write operation (See Attributes table below). Further information on the options is available for [batch](https://docs.delta.io/latest/delta-batch.html#write-to-a-table){ target=&quot;_blank&quot; } and [streaming](https://docs.delta.io/latest/delta-streaming.html#delta-table-as-a-sink){ target=&quot;_blank&quot; }.</span>
<span class="sd">        destination (str): Either the name of the Hive Metastore or Unity Catalog Delta Table **or** the path to the Delta table</span>
<span class="sd">        mode (optional str): Method of writing to Delta Table - append/overwrite (batch), append/update/complete (stream). Default is append</span>
<span class="sd">        trigger (optional str): Frequency of the write operation. Specify &quot;availableNow&quot; to execute a trigger once, otherwise specify a time period such as &quot;30 seconds&quot;, &quot;5 minutes&quot;. Set to &quot;0 seconds&quot; if you do not want to use a trigger. (stream) Default is 10 seconds</span>
<span class="sd">        query_name (optional str): Unique name for the query in associated SparkSession. (stream) Default is DeltaDestination</span>
<span class="sd">        query_wait_interval (optional int): If set, waits for the streaming query to complete before returning. (stream) Default is None</span>

<span class="sd">    Attributes:</span>
<span class="sd">        checkpointLocation (str): Path to checkpoint files. (Streaming)</span>
<span class="sd">        txnAppId (str): A unique string that you can pass on each DataFrame write. (Batch &amp; Streaming)</span>
<span class="sd">        txnVersion (str): A monotonically increasing number that acts as transaction version. (Batch &amp; Streaming)</span>
<span class="sd">        maxRecordsPerFile (int str): Specify the maximum number of records to write to a single file for a Delta Lake table. (Batch)</span>
<span class="sd">        replaceWhere (str): Condition(s) for overwriting. (Batch)</span>
<span class="sd">        partitionOverwriteMode (str): When set to dynamic, overwrites all existing data in each logical partition for which the write will commit new data. Default is static. (Batch)</span>
<span class="sd">        overwriteSchema (bool str): If True, overwrites the schema as well as the table data. (Batch)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;append&quot;</span><span class="p">,</span>
        <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
        <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DeltaDestination&quot;</span><span class="p">,</span>
        <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">=</span> <span class="n">query_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span> <span class="o">=</span> <span class="n">query_wait_interval</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_delta_core&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;spark.sql.extensions&quot;</span><span class="p">:</span> <span class="s2">&quot;io.delta.sql.DeltaSparkSessionExtension&quot;</span><span class="p">,</span>
            <span class="s2">&quot;spark.sql.catalog.spark_catalog&quot;</span><span class="p">:</span> <span class="s2">&quot;org.apache.spark.sql.delta.catalog.DeltaCatalog&quot;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">pre_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes batch data to Delta. Most of the options provided by the Apache Spark DataFrame write API are supported for performing batch writes on tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">saveAsTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes streaming data to Delta. Exactly-once processing is guaranteed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
            <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">toTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.write_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes batch data to Delta. Most of the options provided by the Apache Spark DataFrame write API are supported for performing batch writes on tables.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes batch data to Delta. Most of the options provided by the Apache Spark DataFrame write API are supported for performing batch writes on tables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">saveAsTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaDestination.write_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes streaming data to Delta. Exactly-once processing is guaranteed</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes streaming data to Delta. Exactly-once processing is guaranteed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
        <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
                <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
                <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">toTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination" class="doc doc-heading">
            <code>SparkDeltaMergeDestination</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.destinations.interfaces.DestinationInterface">DestinationInterface</span></code></p>


      <p>The Spark Delta Merge Destination is used to merge data into a Delta table. Refer to this <a href="https://docs.delta.io/latest/delta-update.html#upsert-into-a-table-using-merge&amp;language-python">documentation</a> for more information about Delta Merge.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination--examples">Examples</h4>
<p><div class="highlight"><pre><span></span><code><span class="c1">#Delta Merge Destination for Streaming Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkDeltaMergeDestination</span>

<span class="n">delta_merge_destination</span> <span class="o">=</span> <span class="n">SparkDeltaMergeDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">destination</span><span class="o">=</span><span class="s2">&quot;DELTA-TABLE-PATH&quot;</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;checkpointLocation&quot;</span><span class="p">:</span> <span class="s2">&quot;/{CHECKPOINT-LOCATION}/&quot;</span>
    <span class="p">},</span>
    <span class="n">merge_condition</span><span class="o">=</span><span class="s2">&quot;`source.id = target.id`&quot;</span>
    <span class="n">when_matched_update_list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">when_matched_delete_list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">when_not_matched_insert_list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">when_not_matched_by_source_update_list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">when_not_matched_by_source_delete_list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">try_broadcast_join</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;DeltaDestination&quot;</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">delta_merge_destination</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">#Delta Merge Destination for Batch Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkDeltaMergeDestination</span>

<span class="n">delta_merge_destination</span> <span class="o">=</span> <span class="n">SparkDeltaMergeDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">destination</span><span class="o">=</span><span class="s2">&quot;DELTA-TABLE-PATH&quot;</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">merge_condition</span><span class="o">=</span><span class="s2">&quot;`source.id = target.id`&quot;</span><span class="p">,</span>
    <span class="n">when_matched_update_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">when_matched_delete_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">when_not_matched_insert_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">when_not_matched_by_source_update_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">when_not_matched_by_source_delete_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">try_broadcast_join</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;DeltaDestination&quot;</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">delta_merge_destination</span><span class="o">.</span><span class="n">write_batch</span><span class="p">()</span>
</code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe to be merged into a Delta Table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>destination</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Either the name of the Hive Metastore or Unity Catalog Delta Table <strong>or</strong> the path to the Delta table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Options that can be specified for a Delta Table read operation (See Attributes table below). Further information on the options is available for <a href="https://docs.delta.io/latest/delta-batch.html#write-to-a-table" target="_blank">batch</a> and <a href="https://docs.delta.io/latest/delta-streaming.html#delta-table-as-a-sink" target="_blank">streaming</a>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>merge_condition</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Condition for matching records between dataframe and delta table. Reference Dataframe columns as <code>source</code> and Delta Table columns as <code>target</code>. For example <code>source.id = target.id</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>when_matched_update_list</code></td>
            <td>
                  <code>optional list[DeltaMergeConditionValues]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Conditions(optional) and values to be used when updating rows that match the <code>merge_condition</code>. Specify <code>*</code> for Values if all columns from Dataframe should be inserted.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>when_matched_delete_list</code></td>
            <td>
                  <code>optional list[DeltaMergeCondition]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Conditions(optional) to be used when deleting rows that match the <code>merge_condition</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>when_not_matched_insert_list</code></td>
            <td>
                  <code>optional list[DeltaMergeConditionValues]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Conditions(optional) and values to be used when inserting rows that do not match the <code>merge_condition</code>. Specify <code>*</code> for Values if all columns from Dataframe should be inserted.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>when_not_matched_by_source_update_list</code></td>
            <td>
                  <code>optional list[DeltaMergeConditionValues]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Conditions(optional) and values to be used when updating rows that do not match the <code>merge_condition</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>when_not_matched_by_source_delete_list</code></td>
            <td>
                  <code>optional list[DeltaMergeCondition]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Conditions(optional) to be used when deleting rows that do not match the <code>merge_condition</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>try_broadcast_join</code></td>
            <td>
                  <code>optional bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Attempts to perform a broadcast join in the merge which can leverage data skipping using partition pruning and file pruning automatically. Can fail if dataframe being merged is large and therefore more suitable for streaming merges than batch merges</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trigger</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency of the write operation. Specify "availableNow" to execute a trigger once, otherwise specify a time period such as "30 seconds", "5 minutes". Set to "0 seconds" if you do not want to use a trigger. (stream) Default is 10 seconds</p>
              </div>
            </td>
            <td>
                  <code>&#39;10 seconds&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_name</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique name for the query in associated SparkSession</p>
              </div>
            </td>
            <td>
                  <code>&#39;DeltaMergeDestination&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_wait_interval</code></td>
            <td>
                  <code>optional int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set, waits for the streaming query to complete before returning. (stream) Default is None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination.checkpointLocation">checkpointLocation</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to checkpoint files. (Streaming)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/delta_merge.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkDeltaMergeDestination</span><span class="p">(</span><span class="n">DestinationInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Spark Delta Merge Destination is used to merge data into a Delta table. Refer to this [documentation](https://docs.delta.io/latest/delta-update.html#upsert-into-a-table-using-merge&amp;language-python) for more information about Delta Merge.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    #Delta Merge Destination for Streaming Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkDeltaMergeDestination</span>

<span class="sd">    delta_merge_destination = SparkDeltaMergeDestination(</span>
<span class="sd">        data=df,</span>
<span class="sd">        destination=&quot;DELTA-TABLE-PATH&quot;,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;checkpointLocation&quot;: &quot;/{CHECKPOINT-LOCATION}/&quot;</span>
<span class="sd">        },</span>
<span class="sd">        merge_condition=&quot;`source.id = target.id`&quot;</span>
<span class="sd">        when_matched_update_list=None</span>
<span class="sd">        when_matched_delete_list=None</span>
<span class="sd">        when_not_matched_insert_list=None</span>
<span class="sd">        when_not_matched_by_source_update_list=None</span>
<span class="sd">        when_not_matched_by_source_delete_list=None</span>
<span class="sd">        try_broadcast_join=False</span>
<span class="sd">        trigger=&quot;10 seconds&quot;,</span>
<span class="sd">        query_name=&quot;DeltaDestination&quot;</span>
<span class="sd">        query_wait_interval=None</span>
<span class="sd">    )</span>

<span class="sd">    delta_merge_destination.write_stream()</span>
<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">    #Delta Merge Destination for Batch Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkDeltaMergeDestination</span>

<span class="sd">    delta_merge_destination = SparkDeltaMergeDestination(</span>
<span class="sd">        data=df,</span>
<span class="sd">        destination=&quot;DELTA-TABLE-PATH&quot;,</span>
<span class="sd">        options={},</span>
<span class="sd">        merge_condition=&quot;`source.id = target.id`&quot;,</span>
<span class="sd">        when_matched_update_list=None,</span>
<span class="sd">        when_matched_delete_list=None,</span>
<span class="sd">        when_not_matched_insert_list=None,</span>
<span class="sd">        when_not_matched_by_source_update_list=None,</span>
<span class="sd">        when_not_matched_by_source_delete_list=None,</span>
<span class="sd">        try_broadcast_join=False,</span>
<span class="sd">        trigger=&quot;10 seconds&quot;,</span>
<span class="sd">        query_name=&quot;DeltaDestination&quot;</span>
<span class="sd">        query_wait_interval=None</span>
<span class="sd">    )</span>

<span class="sd">    delta_merge_destination.write_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe to be merged into a Delta Table</span>
<span class="sd">        destination (str): Either the name of the Hive Metastore or Unity Catalog Delta Table **or** the path to the Delta table</span>
<span class="sd">        options (dict): Options that can be specified for a Delta Table read operation (See Attributes table below). Further information on the options is available for [batch](https://docs.delta.io/latest/delta-batch.html#write-to-a-table){ target=&quot;_blank&quot; } and [streaming](https://docs.delta.io/latest/delta-streaming.html#delta-table-as-a-sink){ target=&quot;_blank&quot; }.</span>
<span class="sd">        merge_condition (str): Condition for matching records between dataframe and delta table. Reference Dataframe columns as `source` and Delta Table columns as `target`. For example `source.id = target.id`.</span>
<span class="sd">        when_matched_update_list (optional list[DeltaMergeConditionValues]): Conditions(optional) and values to be used when updating rows that match the `merge_condition`. Specify `*` for Values if all columns from Dataframe should be inserted.</span>
<span class="sd">        when_matched_delete_list (optional list[DeltaMergeCondition]): Conditions(optional) to be used when deleting rows that match the `merge_condition`.</span>
<span class="sd">        when_not_matched_insert_list (optional list[DeltaMergeConditionValues]): Conditions(optional) and values to be used when inserting rows that do not match the `merge_condition`. Specify `*` for Values if all columns from Dataframe should be inserted.</span>
<span class="sd">        when_not_matched_by_source_update_list (optional list[DeltaMergeConditionValues]): Conditions(optional) and values to be used when updating rows that do not match the `merge_condition`.</span>
<span class="sd">        when_not_matched_by_source_delete_list (optional list[DeltaMergeCondition]): Conditions(optional) to be used when deleting rows that do not match the `merge_condition`.</span>
<span class="sd">        try_broadcast_join (optional bool): Attempts to perform a broadcast join in the merge which can leverage data skipping using partition pruning and file pruning automatically. Can fail if dataframe being merged is large and therefore more suitable for streaming merges than batch merges</span>
<span class="sd">        trigger (optional str): Frequency of the write operation. Specify &quot;availableNow&quot; to execute a trigger once, otherwise specify a time period such as &quot;30 seconds&quot;, &quot;5 minutes&quot;. Set to &quot;0 seconds&quot; if you do not want to use a trigger. (stream) Default is 10 seconds</span>
<span class="sd">        query_name (optional str): Unique name for the query in associated SparkSession</span>
<span class="sd">        query_wait_interval (optional int): If set, waits for the streaming query to complete before returning. (stream) Default is None</span>

<span class="sd">    Attributes:</span>
<span class="sd">        checkpointLocation (str): Path to checkpoint files. (Streaming)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">merge_condition</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">when_matched_update_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeltaMergeConditionValues</span><span class="p">]</span>
    <span class="n">when_matched_delete_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeltaMergeCondition</span><span class="p">]</span>
    <span class="n">when_not_matched_insert_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeltaMergeConditionValues</span><span class="p">]</span>
    <span class="n">when_not_matched_by_source_update_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeltaMergeConditionValues</span><span class="p">]</span>
    <span class="n">when_not_matched_by_source_delete_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeltaMergeCondition</span><span class="p">]</span>
    <span class="n">try_broadcast_join</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">merge_condition</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">when_matched_update_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeltaMergeConditionValues</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">when_matched_delete_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeltaMergeCondition</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">when_not_matched_insert_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeltaMergeConditionValues</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">when_not_matched_by_source_update_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeltaMergeConditionValues</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">when_not_matched_by_source_delete_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeltaMergeCondition</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">try_broadcast_join</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
        <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DeltaMergeDestination&quot;</span><span class="p">,</span>
        <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merge_condition</span> <span class="o">=</span> <span class="n">merge_condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">when_matched_update_list</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[]</span> <span class="k">if</span> <span class="n">when_matched_update_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">when_matched_update_list</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">when_matched_delete_list</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[]</span> <span class="k">if</span> <span class="n">when_matched_delete_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">when_matched_delete_list</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">when_not_matched_insert_list</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[]</span> <span class="k">if</span> <span class="n">when_not_matched_insert_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">when_not_matched_insert_list</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">when_not_matched_by_source_update_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">when_not_matched_by_source_update_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="n">_package_version_meets_minimum</span><span class="p">(</span><span class="s2">&quot;delta-spark&quot;</span><span class="p">,</span> <span class="s2">&quot;2.3.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">when_not_matched_by_source_update_list</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[]</span>
            <span class="k">if</span> <span class="n">when_not_matched_by_source_update_list</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">when_not_matched_by_source_update_list</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">when_not_matched_by_source_delete_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">when_not_matched_by_source_delete_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="n">_package_version_meets_minimum</span><span class="p">(</span><span class="s2">&quot;delta-spark&quot;</span><span class="p">,</span> <span class="s2">&quot;2.3.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">when_not_matched_by_source_delete_list</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[]</span>
            <span class="k">if</span> <span class="n">when_not_matched_by_source_delete_list</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">when_not_matched_by_source_delete_list</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">try_broadcast_join</span> <span class="o">=</span> <span class="n">try_broadcast_join</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">=</span> <span class="n">query_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span> <span class="o">=</span> <span class="n">query_wait_interval</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_delta_core&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;spark.sql.extensions&quot;</span><span class="p">:</span> <span class="s2">&quot;io.delta.sql.DeltaSparkSessionExtension&quot;</span><span class="p">,</span>
            <span class="s2">&quot;spark.sql.catalog.spark_catalog&quot;</span><span class="p">:</span> <span class="s2">&quot;org.apache.spark.sql.delta.catalog.DeltaCatalog&quot;</span><span class="p">,</span>
            <span class="s2">&quot;spark.databricks.delta.schema.autoMerge.enabled&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">pre_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_delta_merge_builder</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">try_broadcast_join</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeltaMergeBuilder</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">:</span>
            <span class="n">delta_table</span> <span class="o">=</span> <span class="n">DeltaTable</span><span class="o">.</span><span class="n">forPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta_table</span> <span class="o">=</span> <span class="n">DeltaTable</span><span class="o">.</span><span class="n">forName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">try_broadcast_join</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">delta_merge_builder</span> <span class="o">=</span> <span class="n">delta_table</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="n">broadcast</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">),</span> <span class="n">condition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">merge_condition</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta_merge_builder</span> <span class="o">=</span> <span class="n">delta_table</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">),</span> <span class="n">condition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">merge_condition</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">when_matched_update</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">when_matched_update_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">when_matched_update</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
                <span class="n">delta_merge_builder</span> <span class="o">=</span> <span class="n">delta_merge_builder</span><span class="o">.</span><span class="n">whenMatchedUpdateAll</span><span class="p">(</span>
                    <span class="n">condition</span><span class="o">=</span><span class="n">when_matched_update</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delta_merge_builder</span> <span class="o">=</span> <span class="n">delta_merge_builder</span><span class="o">.</span><span class="n">whenMatchedUpdate</span><span class="p">(</span>
                    <span class="n">condition</span><span class="o">=</span><span class="n">when_matched_update</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span>
                    <span class="nb">set</span><span class="o">=</span><span class="n">when_matched_update</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">when_matched_delete</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">when_matched_delete_list</span><span class="p">:</span>
            <span class="n">delta_merge_builder</span> <span class="o">=</span> <span class="n">delta_merge_builder</span><span class="o">.</span><span class="n">whenMatchedDelete</span><span class="p">(</span>
                <span class="n">condition</span><span class="o">=</span><span class="n">when_matched_delete</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">when_not_matched_insert</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">when_not_matched_insert_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">when_not_matched_insert</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
                <span class="n">delta_merge_builder</span> <span class="o">=</span> <span class="n">delta_merge_builder</span><span class="o">.</span><span class="n">whenNotMatchedInsertAll</span><span class="p">(</span>
                    <span class="n">condition</span><span class="o">=</span><span class="n">when_not_matched_insert</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delta_merge_builder</span> <span class="o">=</span> <span class="n">delta_merge_builder</span><span class="o">.</span><span class="n">whenNotMatchedInsert</span><span class="p">(</span>
                    <span class="n">condition</span><span class="o">=</span><span class="n">when_not_matched_insert</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span>
                    <span class="n">values</span><span class="o">=</span><span class="n">when_not_matched_insert</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span>
            <span class="n">when_not_matched_by_source_update</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">when_not_matched_by_source_update_list</span><span class="p">:</span>
            <span class="n">delta_merge_builder</span> <span class="o">=</span> <span class="n">delta_merge_builder</span><span class="o">.</span><span class="n">whenNotMatchedBySourceUpdate</span><span class="p">(</span>
                <span class="n">condition</span><span class="o">=</span><span class="n">when_not_matched_by_source_update</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span>
                <span class="nb">set</span><span class="o">=</span><span class="n">when_not_matched_by_source_update</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span>
            <span class="n">when_not_matched_by_source_delete</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">when_not_matched_by_source_delete_list</span><span class="p">:</span>
            <span class="n">delta_merge_builder</span> <span class="o">=</span> <span class="n">delta_merge_builder</span><span class="o">.</span><span class="n">whenNotMatchedBySourceDelete</span><span class="p">(</span>
                <span class="n">condition</span><span class="o">=</span><span class="n">when_not_matched_by_source_delete</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">delta_merge_builder</span>

    <span class="k">def</span> <span class="nf">_stream_merge_micro_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">micro_batch_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">epoch_id</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>  <span class="c1"># NOSONAR</span>
        <span class="n">micro_batch_df</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>

        <span class="n">retry_delta_merge</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_broadcast_join</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">delta_merge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta_merge_builder</span><span class="p">(</span>
                    <span class="n">micro_batch_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_broadcast_join</span>
                <span class="p">)</span>
                <span class="n">delta_merge</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;SparkOutOfMemoryError&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                    <span class="n">retry_delta_merge</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_broadcast_join</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">retry_delta_merge</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">delta_merge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta_merge_builder</span><span class="p">(</span><span class="n">micro_batch_df</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">delta_merge</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

        <span class="n">micro_batch_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merges batch data into a Delta Table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">delta_merge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta_merge_builder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_broadcast_join</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">delta_merge</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merges streaming data to Delta using foreachBatch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
            <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">foreachBatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stream_merge_micro_batch</span><span class="p">)</span>
                <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
                <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/delta_merge.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination.write_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Merges batch data into a Delta Table.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/delta_merge.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merges batch data into a Delta Table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">delta_merge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta_merge_builder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_broadcast_join</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delta_merge</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkDeltaMergeDestination.write_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Merges streaming data to Delta using foreachBatch</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/delta_merge.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merges streaming data to Delta using foreachBatch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
        <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">foreachBatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stream_merge_micro_batch</span><span class="p">)</span>
            <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
            <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination" class="doc doc-heading">
            <code>SparkEventhubDestination</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.destinations.interfaces.DestinationInterface">DestinationInterface</span></code></p>


      <p>This Spark destination class is used to write batch or streaming data to Eventhubs. Eventhub configurations need to be specified as options in a dictionary.
Additionally, there are more optional configurations which can be found <a href="https://github.com/Azure/azure-event-hubs-spark/blob/master/docs/PySpark/structured-streaming-pyspark.md#event-hubs-configuration" target="_blank">here.</a>
If using startingPosition or endingPosition make sure to check out <strong>Event Position</strong> section for more details and examples.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination--examples">Examples</h4>
<p><div class="highlight"><pre><span></span><code><span class="c1">#Eventhub Destination for Streaming Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkEventhubDestination</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">connectionString</span> <span class="o">=</span> <span class="n">Endpoint</span><span class="o">=</span><span class="n">sb</span><span class="p">:</span><span class="o">//</span><span class="p">{</span><span class="n">NAMESPACE</span><span class="p">}</span><span class="o">.</span><span class="n">servicebus</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="p">;</span><span class="n">SharedAccessKeyName</span><span class="o">=</span><span class="p">{</span><span class="n">ACCESS_KEY_NAME</span><span class="p">};</span><span class="n">SharedAccessKey</span><span class="o">=</span><span class="p">{</span><span class="n">ACCESS_KEY</span><span class="p">}</span><span class="o">=</span><span class="p">;</span><span class="n">EntityPath</span><span class="o">=</span><span class="p">{</span><span class="n">EVENT_HUB_NAME</span><span class="p">}</span>

<span class="n">eventhub_destination</span> <span class="o">=</span> <span class="n">SparkEventhubDestination</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;eventhubs.connectionString&quot;</span><span class="p">:</span> <span class="n">connectionString</span><span class="p">,</span>
        <span class="s2">&quot;eventhubs.consumerGroup&quot;</span><span class="p">:</span> <span class="s2">&quot;{YOUR-EVENTHUB-CONSUMER-GROUP}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;checkpointLocation&quot;</span><span class="p">:</span> <span class="s2">&quot;/{CHECKPOINT-LOCATION}/&quot;</span>
    <span class="p">},</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;EventhubDestination&quot;</span><span class="p">,</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">eventhub_destination</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">#Eventhub Destination for Batch Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkEventhubDestination</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">connectionString</span> <span class="o">=</span> <span class="n">Endpoint</span><span class="o">=</span><span class="n">sb</span><span class="p">:</span><span class="o">//</span><span class="p">{</span><span class="n">NAMESPACE</span><span class="p">}</span><span class="o">.</span><span class="n">servicebus</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="p">;</span><span class="n">SharedAccessKeyName</span><span class="o">=</span><span class="p">{</span><span class="n">ACCESS_KEY_NAME</span><span class="p">};</span><span class="n">SharedAccessKey</span><span class="o">=</span><span class="p">{</span><span class="n">ACCESS_KEY</span><span class="p">}</span><span class="o">=</span><span class="p">;</span><span class="n">EntityPath</span><span class="o">=</span><span class="p">{</span><span class="n">EVENT_HUB_NAME</span><span class="p">}</span>


<span class="n">eventhub_destination</span> <span class="o">=</span> <span class="n">SparkEventhubDestination</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;eventhubs.connectionString&quot;</span><span class="p">:</span> <span class="n">connectionString</span><span class="p">,</span>
        <span class="s2">&quot;eventhubs.consumerGroup&quot;</span><span class="p">:</span> <span class="s2">&quot;{YOUR-EVENTHUB-CONSUMER-GROUP}&quot;</span>
    <span class="p">},</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;EventhubDestination&quot;</span><span class="p">,</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">eventhub_destination</span><span class="o">.</span><span class="n">write_batch</span><span class="p">()</span>
</code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe to be written to Eventhub</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of Eventhub configurations (See Attributes table below). All Configuration options for Eventhubs can be found <a href="https://github.com/Azure/azure-event-hubs-spark/blob/master/docs/PySpark/structured-streaming-pyspark.md#event-hubs-configuration" target="_blank">here.</a></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trigger</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency of the write operation. Specify "availableNow" to execute a trigger once, otherwise specify a time period such as "30 seconds", "5 minutes". Set to "0 seconds" if you do not want to use a trigger. (stream) Default is 10 seconds</p>
              </div>
            </td>
            <td>
                  <code>&#39;10 seconds&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique name for the query in associated SparkSession</p>
              </div>
            </td>
            <td>
                  <code>&#39;EventhubDestination&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_wait_interval</code></td>
            <td>
                  <code>optional int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set, waits for the streaming query to complete before returning. (stream) Default is None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.checkpointLocation">checkpointLocation</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to checkpoint files. (Streaming)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.eventhubs.connectionString">eventhubs.connectionString</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Eventhubs connection string is required to connect to the Eventhubs service. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.eventhubs.consumerGroup">eventhubs.consumerGroup</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A consumer group is a view of an entire eventhub. Consumer groups enable multiple consuming applications to each have a separate view of the event stream, and to read the stream independently at their own pace and with their own offsets. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.eventhubs.startingPosition">eventhubs.startingPosition</span></code></td>
            <td>
                  <code>JSON str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The starting position for your Structured Streaming job. If a specific EventPosition is not set for a partition using startingPositions, then we use the EventPosition set in startingPosition. If nothing is set in either option, we will begin consuming from the end of the partition. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.eventhubs.endingPosition">eventhubs.endingPosition</span></code></td>
            <td>
                  <code>JSON str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(JSON str): The ending position of a batch query. This works the same as startingPosition. (Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.maxEventsPerTrigger">maxEventsPerTrigger</span></code></td>
            <td>
                  <code>long</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rate limit on maximum number of events processed per trigger interval. The specified total number of events will be proportionally split across partitions of different volume. (Stream)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/eventhub.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkEventhubDestination</span><span class="p">(</span><span class="n">DestinationInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Spark destination class is used to write batch or streaming data to Eventhubs. Eventhub configurations need to be specified as options in a dictionary.</span>
<span class="sd">    Additionally, there are more optional configurations which can be found [here.](https://github.com/Azure/azure-event-hubs-spark/blob/master/docs/PySpark/structured-streaming-pyspark.md#event-hubs-configuration){ target=&quot;_blank&quot; }</span>
<span class="sd">    If using startingPosition or endingPosition make sure to check out **Event Position** section for more details and examples.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    #Eventhub Destination for Streaming Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkEventhubDestination</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    connectionString = Endpoint=sb://{NAMESPACE}.servicebus.windows.net/;SharedAccessKeyName={ACCESS_KEY_NAME};SharedAccessKey={ACCESS_KEY}=;EntityPath={EVENT_HUB_NAME}</span>

<span class="sd">    eventhub_destination = SparkEventhubDestination(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        data=df,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;eventhubs.connectionString&quot;: connectionString,</span>
<span class="sd">            &quot;eventhubs.consumerGroup&quot;: &quot;{YOUR-EVENTHUB-CONSUMER-GROUP}&quot;,</span>
<span class="sd">            &quot;checkpointLocation&quot;: &quot;/{CHECKPOINT-LOCATION}/&quot;</span>
<span class="sd">        },</span>
<span class="sd">        trigger=&quot;10 seconds&quot;,</span>
<span class="sd">        query_name=&quot;EventhubDestination&quot;,</span>
<span class="sd">        query_wait_interval=None</span>
<span class="sd">    )</span>

<span class="sd">    eventhub_destination.write_stream()</span>
<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">    #Eventhub Destination for Batch Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkEventhubDestination</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    connectionString = Endpoint=sb://{NAMESPACE}.servicebus.windows.net/;SharedAccessKeyName={ACCESS_KEY_NAME};SharedAccessKey={ACCESS_KEY}=;EntityPath={EVENT_HUB_NAME}</span>


<span class="sd">    eventhub_destination = SparkEventhubDestination(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        data=df,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;eventhubs.connectionString&quot;: connectionString,</span>
<span class="sd">            &quot;eventhubs.consumerGroup&quot;: &quot;{YOUR-EVENTHUB-CONSUMER-GROUP}&quot;</span>
<span class="sd">        },</span>
<span class="sd">        trigger=&quot;10 seconds&quot;,</span>
<span class="sd">        query_name=&quot;EventhubDestination&quot;,</span>
<span class="sd">        query_wait_interval=None</span>
<span class="sd">    )</span>

<span class="sd">    eventhub_destination.write_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session</span>
<span class="sd">        data (DataFrame): Dataframe to be written to Eventhub</span>
<span class="sd">        options (dict): A dictionary of Eventhub configurations (See Attributes table below). All Configuration options for Eventhubs can be found [here.](https://github.com/Azure/azure-event-hubs-spark/blob/master/docs/PySpark/structured-streaming-pyspark.md#event-hubs-configuration){ target=&quot;_blank&quot; }</span>
<span class="sd">        trigger (optional str): Frequency of the write operation. Specify &quot;availableNow&quot; to execute a trigger once, otherwise specify a time period such as &quot;30 seconds&quot;, &quot;5 minutes&quot;. Set to &quot;0 seconds&quot; if you do not want to use a trigger. (stream) Default is 10 seconds</span>
<span class="sd">        query_name (str): Unique name for the query in associated SparkSession</span>
<span class="sd">        query_wait_interval (optional int): If set, waits for the streaming query to complete before returning. (stream) Default is None</span>

<span class="sd">    Attributes:</span>
<span class="sd">        checkpointLocation (str): Path to checkpoint files. (Streaming)</span>
<span class="sd">        eventhubs.connectionString (str):  Eventhubs connection string is required to connect to the Eventhubs service. (Streaming and Batch)</span>
<span class="sd">        eventhubs.consumerGroup (str): A consumer group is a view of an entire eventhub. Consumer groups enable multiple consuming applications to each have a separate view of the event stream, and to read the stream independently at their own pace and with their own offsets. (Streaming and Batch)</span>
<span class="sd">        eventhubs.startingPosition (JSON str): The starting position for your Structured Streaming job. If a specific EventPosition is not set for a partition using startingPositions, then we use the EventPosition set in startingPosition. If nothing is set in either option, we will begin consuming from the end of the partition. (Streaming and Batch)</span>
<span class="sd">        eventhubs.endingPosition: (JSON str): The ending position of a batch query. This works the same as startingPosition. (Batch)</span>
<span class="sd">        maxEventsPerTrigger (long): Rate limit on maximum number of events processed per trigger interval. The specified total number of events will be proportionally split across partitions of different volume. (Stream)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
        <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;EventhubDestination&quot;</span><span class="p">,</span>
        <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">=</span> <span class="n">query_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span> <span class="o">=</span> <span class="n">query_wait_interval</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">spark_libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">spark_libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_azure_eventhub&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">spark_libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">prepare_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;body&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dataType</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">StringType</span><span class="p">(),</span> <span class="n">BinaryType</span><span class="p">()]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">StringType</span><span class="p">()))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;&#39;body&#39; column must be of string or binary type&quot;</span><span class="p">,</span> <span class="n">e</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;body&quot;</span><span class="p">,</span>
                <span class="n">to_json</span><span class="p">(</span>
                    <span class="n">struct</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">col</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>
                            <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;partitionId&quot;</span><span class="p">,</span> <span class="s2">&quot;partitionKey&quot;</span><span class="p">]</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">schema</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;partitionId&quot;</span><span class="p">,</span> <span class="s2">&quot;partitionKey&quot;</span><span class="p">]</span>
                <span class="ow">and</span> <span class="n">column</span><span class="o">.</span><span class="n">dataType</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                        <span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">StringType</span><span class="p">())</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be of string type&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">column</span>
                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;partitionId&quot;</span><span class="p">,</span> <span class="s2">&quot;partitionKey&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes batch data to Eventhubs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eventhub_connection_string</span> <span class="o">=</span> <span class="s2">&quot;eventhubs.connectionString&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">eventhub_connection_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">sc</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">eventhubs</span><span class="o">.</span><span class="n">EventHubsUtils</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_columns</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;eventhubs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes steaming data to Eventhubs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eventhub_connection_string</span> <span class="o">=</span> <span class="s2">&quot;eventhubs.connectionString&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">eventhub_connection_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">sc</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">eventhubs</span><span class="o">.</span><span class="n">EventHubsUtils</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_columns</span><span class="p">()</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">column</span>
                    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>
                    <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;partitionId&quot;</span><span class="p">,</span> <span class="s2">&quot;partitionKey&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">df</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;eventhubs&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
                <span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/eventhub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.write_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes batch data to Eventhubs.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/eventhub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes batch data to Eventhubs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eventhub_connection_string</span> <span class="o">=</span> <span class="s2">&quot;eventhubs.connectionString&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">eventhub_connection_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">sc</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">eventhubs</span><span class="o">.</span><span class="n">EventHubsUtils</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_columns</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;eventhubs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkEventhubDestination.write_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes steaming data to Eventhubs.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/eventhub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes steaming data to Eventhubs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eventhub_connection_string</span> <span class="o">=</span> <span class="s2">&quot;eventhubs.connectionString&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
            <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">eventhub_connection_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">sc</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">eventhubs</span><span class="o">.</span><span class="n">EventHubsUtils</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">eventhub_connection_string</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_columns</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">column</span>
                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;partitionId&quot;</span><span class="p">,</span> <span class="s2">&quot;partitionKey&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;eventhubs&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
            <span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination" class="doc doc-heading">
            <code>SparkKafkaDestination</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.destinations.interfaces.DestinationInterface">DestinationInterface</span></code></p>


      <p>This Spark destination class is used to write batch or streaming data from Kafka. Required and optional configurations can be found in the Attributes tables below.</p>
<p>Additionally, there are more optional configurations which can be found <a href="https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html" target="_blank">here.</a></p>
<p>For compatibility between Spark and Kafka, the columns in the input dataframe are concatenated into one 'value' column of JSON string.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkKafkaDestination</span>

<span class="n">kafka_destination</span> <span class="o">=</span> <span class="n">SparkKafkaDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;kafka.bootstrap.servers&quot;</span><span class="p">:</span> <span class="s2">&quot;host1:port1,host2:port2&quot;</span>
    <span class="p">},</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;KafkaDestination&quot;</span><span class="p">,</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">kafka_destination</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>

<span class="n">OR</span>

<span class="n">kafka_destination</span><span class="o">.</span><span class="n">write_batch</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe to be written to Kafka</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of Kafka configurations (See Attributes tables below). For more information on configuration options see <a href="https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html" target="_blank">here</a></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trigger</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency of the write operation. Specify "availableNow" to execute a trigger once, otherwise specify a time period such as "30 seconds", "5 minutes". Set to "0 seconds" if you do not want to use a trigger. (stream) Default is 10 seconds</p>
              </div>
            </td>
            <td>
                  <code>&#39;10 seconds&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique name for the query in associated SparkSession</p>
              </div>
            </td>
            <td>
                  <code>&#39;KafkaDestination&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_wait_interval</code></td>
            <td>
                  <code>optional int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set, waits for the streaming query to complete before returning. (stream) Default is None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The following options must be set for the Kafka destination for both batch and streaming queries.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination.kafka.bootstrap.servers">kafka.bootstrap.servers</span></code></td>
            <td>
                  <code>A comma-separated list of host︰port</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Kafka "bootstrap.servers" configuration. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The following configurations are optional:</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination.topic">topic</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sets the topic that all rows will be written to in Kafka. This option overrides any topic column that may exist in the data. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination.includeHeaders">includeHeaders</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include the Kafka headers in the row. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/kafka.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkKafkaDestination</span><span class="p">(</span><span class="n">DestinationInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Spark destination class is used to write batch or streaming data from Kafka. Required and optional configurations can be found in the Attributes tables below.</span>

<span class="sd">    Additionally, there are more optional configurations which can be found [here.](https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html){ target=&quot;_blank&quot; }</span>

<span class="sd">    For compatibility between Spark and Kafka, the columns in the input dataframe are concatenated into one &#39;value&#39; column of JSON string.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkKafkaDestination</span>

<span class="sd">    kafka_destination = SparkKafkaDestination(</span>
<span class="sd">        data=df,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;kafka.bootstrap.servers&quot;: &quot;host1:port1,host2:port2&quot;</span>
<span class="sd">        },</span>
<span class="sd">        trigger=&quot;10 seconds&quot;,</span>
<span class="sd">        query_name=&quot;KafkaDestination&quot;,</span>
<span class="sd">        query_wait_interval=None</span>
<span class="sd">    )</span>

<span class="sd">    kafka_destination.write_stream()</span>

<span class="sd">    OR</span>

<span class="sd">    kafka_destination.write_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe to be written to Kafka</span>
<span class="sd">        options (dict): A dictionary of Kafka configurations (See Attributes tables below). For more information on configuration options see [here](https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html){ target=&quot;_blank&quot; }</span>
<span class="sd">        trigger (optional str): Frequency of the write operation. Specify &quot;availableNow&quot; to execute a trigger once, otherwise specify a time period such as &quot;30 seconds&quot;, &quot;5 minutes&quot;. Set to &quot;0 seconds&quot; if you do not want to use a trigger. (stream) Default is 10 seconds</span>
<span class="sd">        query_name (str): Unique name for the query in associated SparkSession</span>
<span class="sd">        query_wait_interval (optional int): If set, waits for the streaming query to complete before returning. (stream) Default is None</span>

<span class="sd">    The following options must be set for the Kafka destination for both batch and streaming queries.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        kafka.bootstrap.servers (A comma-separated list of host︰port): The Kafka &quot;bootstrap.servers&quot; configuration. (Streaming and Batch)</span>

<span class="sd">    The following configurations are optional:</span>

<span class="sd">    Attributes:</span>
<span class="sd">        topic (str):Sets the topic that all rows will be written to in Kafka. This option overrides any topic column that may exist in the data. (Streaming and Batch)</span>
<span class="sd">        includeHeaders (bool): Whether to include the Kafka headers in the row. (Streaming and Batch)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
        <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;KafkaDestination&quot;</span><span class="p">,</span>
        <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">=</span> <span class="n">query_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span> <span class="o">=</span> <span class="n">query_wait_interval</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">spark_libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">spark_libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_sql_kafka&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">spark_libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes batch data to Kafka.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">to_json</span><span class="p">(</span><span class="n">struct</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span>
                <span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes steaming data to Kafka.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">to_json</span><span class="p">(</span><span class="n">struct</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span>
                <span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
                <span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/kafka.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination.write_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes batch data to Kafka.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/kafka.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes batch data to Kafka.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">to_json</span><span class="p">(</span><span class="n">struct</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaDestination.write_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes steaming data to Kafka.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/kafka.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes steaming data to Kafka.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
            <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">to_json</span><span class="p">(</span><span class="n">struct</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
            <span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination" class="doc doc-heading">
            <code>SparkKinesisDestination</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.destinations.interfaces.DestinationInterface">DestinationInterface</span></code></p>


      <p>This Kinesis destination class is used to write batch or streaming data to Kinesis. Kinesis configurations need to be specified as options in a dictionary.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkKinesisDestination</span>

<span class="n">kinesis_destination</span> <span class="o">=</span> <span class="n">SparkKinesisDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;endpointUrl&quot;</span><span class="p">:</span> <span class="s2">&quot;https://kinesis.</span><span class="si">{REGION}</span><span class="s2">.amazonaws.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;awsAccessKey&quot;</span><span class="p">:</span> <span class="s2">&quot;{YOUR-AWS-ACCESS-KEY}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;awsSecretKey&quot;</span><span class="p">:</span> <span class="s2">&quot;{YOUR-AWS-SECRET-KEY}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;streamName&quot;</span><span class="p">:</span> <span class="s2">&quot;{YOUR-STREAM-NAME}&quot;</span>
    <span class="p">},</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;KinesisDestination&quot;</span><span class="p">,</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">kinesis_destination</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>

<span class="n">OR</span>

<span class="n">kinesis_destination</span><span class="o">.</span><span class="n">write_batch</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe to be written to Delta</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of Kinesis configurations (See Attributes table below). All Configuration options for Kinesis can be found <a href="https://github.com/qubole/kinesis-sql#kinesis-sink-configuration" target="_blank">here.</a></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method of writing to Kinesis - append, complete, update</p>
              </div>
            </td>
            <td>
                  <code>&#39;update&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trigger</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency of the write operation. Specify "availableNow" to execute a trigger once, otherwise specify a time period such as "30 seconds", "5 minutes". Set to "0 seconds" if you do not want to use a trigger. (stream) Default is 10 seconds</p>
              </div>
            </td>
            <td>
                  <code>&#39;10 seconds&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique name for the query in associated SparkSession</p>
              </div>
            </td>
            <td>
                  <code>&#39;KinesisDestination&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_wait_interval</code></td>
            <td>
                  <code>optional int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set, waits for the streaming query to complete before returning. (stream) Default is None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.endpointUrl">endpointUrl</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Endpoint of the kinesis stream.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.awsAccessKey">awsAccessKey</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>AWS access key.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.awsSecretKey">awsSecretKey</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>AWS secret access key corresponding to the access key.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.streamName">streamName</span></code></td>
            <td>
                  <code><span title="src.sdk.python.rtdip_sdk.pipelines.destinations.spark.delta_merge.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the streams in Kinesis to write to.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/kinesis.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkKinesisDestination</span><span class="p">(</span><span class="n">DestinationInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Kinesis destination class is used to write batch or streaming data to Kinesis. Kinesis configurations need to be specified as options in a dictionary.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkKinesisDestination</span>

<span class="sd">    kinesis_destination = SparkKinesisDestination(</span>
<span class="sd">        data=df,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;endpointUrl&quot;: &quot;https://kinesis.{REGION}.amazonaws.com&quot;,</span>
<span class="sd">            &quot;awsAccessKey&quot;: &quot;{YOUR-AWS-ACCESS-KEY}&quot;,</span>
<span class="sd">            &quot;awsSecretKey&quot;: &quot;{YOUR-AWS-SECRET-KEY}&quot;,</span>
<span class="sd">            &quot;streamName&quot;: &quot;{YOUR-STREAM-NAME}&quot;</span>
<span class="sd">        },</span>
<span class="sd">        mode=&quot;update&quot;,</span>
<span class="sd">        trigger=&quot;10 seconds&quot;,</span>
<span class="sd">        query_name=&quot;KinesisDestination&quot;,</span>
<span class="sd">        query_wait_interval=None</span>
<span class="sd">    )</span>

<span class="sd">    kinesis_destination.write_stream()</span>

<span class="sd">    OR</span>

<span class="sd">    kinesis_destination.write_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe to be written to Delta</span>
<span class="sd">        options (dict): A dictionary of Kinesis configurations (See Attributes table below). All Configuration options for Kinesis can be found [here.](https://github.com/qubole/kinesis-sql#kinesis-sink-configuration){ target=&quot;_blank&quot; }</span>
<span class="sd">        mode (str): Method of writing to Kinesis - append, complete, update</span>
<span class="sd">        trigger (optional str): Frequency of the write operation. Specify &quot;availableNow&quot; to execute a trigger once, otherwise specify a time period such as &quot;30 seconds&quot;, &quot;5 minutes&quot;. Set to &quot;0 seconds&quot; if you do not want to use a trigger. (stream) Default is 10 seconds</span>
<span class="sd">        query_name (str): Unique name for the query in associated SparkSession</span>
<span class="sd">        query_wait_interval (optional int): If set, waits for the streaming query to complete before returning. (stream) Default is None</span>

<span class="sd">    Attributes:</span>
<span class="sd">        endpointUrl (str): Endpoint of the kinesis stream.</span>
<span class="sd">        awsAccessKey (str): AWS access key.</span>
<span class="sd">        awsSecretKey (str): AWS secret access key corresponding to the access key.</span>
<span class="sd">        streamName (List[str]): Name of the streams in Kinesis to write to.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;update&quot;</span><span class="p">,</span>
        <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
        <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;KinesisDestination&quot;</span><span class="p">,</span>
        <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">=</span> <span class="n">query_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span> <span class="o">=</span> <span class="n">query_wait_interval</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK_DATABRICKS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK_DATABRICKS</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">spark_libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">spark_libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes batch data to Kinesis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kinesis&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes steaming data to Kinesis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kinesis&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
                <span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK_DATABRICKS</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/kinesis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK_DATABRICKS</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK_DATABRICKS</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.write_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes batch data to Kinesis.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/kinesis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes batch data to Kinesis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kinesis&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKinesisDestination.write_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes steaming data to Kinesis.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/kinesis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes steaming data to Kinesis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
            <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kinesis&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
            <span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination" class="doc doc-heading">
            <code>SparkRestAPIDestination</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.destinations.interfaces.DestinationInterface">DestinationInterface</span></code></p>


      <p>The Spark Rest API Destination is used to write data to a Rest API.</p>
<p>The payload sent to the API is constructed by converting each row in the DataFrame to Json.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While it is possible to use the <code>write_batch</code> method, it is easy to overwhlem a Rest API with large volumes of data.
Consider reducing data volumes when writing to a Rest API in Batch mode to prevent API errors including throtting.</p>
</div>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination--example">Example</h4>
<p><div class="highlight"><pre><span></span><code><span class="c1">#Rest API Destination for Streaming Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkRestAPIDestination</span>

<span class="n">rest_api_destination</span> <span class="o">=</span> <span class="n">SparkRestAPIDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;checkpointLocation&quot;</span><span class="p">:</span> <span class="s2">&quot;{/CHECKPOINT-LOCATION/}&quot;</span>
    <span class="p">},</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;{REST-API-URL}&quot;</span><span class="p">,</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{TOKEN}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
    <span class="n">parallelism</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;1 minute&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;DeltaRestAPIDestination&quot;</span><span class="p">,</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">rest_api_destination</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">#Rest API Destination for Batch Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkRestAPIDestination</span>

<span class="n">rest_api_destination</span> <span class="o">=</span> <span class="n">SparkRestAPIDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;{REST-API-URL}&quot;</span><span class="p">,</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{TOKEN}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
    <span class="n">parallelism</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;1 minute&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;DeltaRestAPIDestination&quot;</span><span class="p">,</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">rest_api_destination</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>
</code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe to be merged into a Delta Table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of options for streaming writes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>url</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Rest API Url</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>headers</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of headers to be provided to the Rest API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>batch_size</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of DataFrame rows to be used in each Rest API call</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>method</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method to be used when calling the Rest API. Allowed values are POST, PATCH and PUT</p>
              </div>
            </td>
            <td>
                  <code>&#39;POST&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>parallelism</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of concurrent calls to be made to the Rest API</p>
              </div>
            </td>
            <td>
                  <code>8</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trigger</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency of the write operation. Specify "availableNow" to execute a trigger once, otherwise specify a time period such as "30 seconds", "5 minutes". Set to "0 seconds" if you do not want to use a trigger. (stream) Default is 10 seconds</p>
              </div>
            </td>
            <td>
                  <code>&#39;1 minutes&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique name for the query in associated SparkSession</p>
              </div>
            </td>
            <td>
                  <code>&#39;DeltaRestAPIDestination&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_wait_interval</code></td>
            <td>
                  <code>optional int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set, waits for the streaming query to complete before returning. (stream) Default is None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination.checkpointLocation">checkpointLocation</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to checkpoint files. (Streaming)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/rest_api.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkRestAPIDestination</span><span class="p">(</span><span class="n">DestinationInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Spark Rest API Destination is used to write data to a Rest API.</span>

<span class="sd">    The payload sent to the API is constructed by converting each row in the DataFrame to Json.</span>

<span class="sd">    !!! Note</span>
<span class="sd">        While it is possible to use the `write_batch` method, it is easy to overwhlem a Rest API with large volumes of data.</span>
<span class="sd">        Consider reducing data volumes when writing to a Rest API in Batch mode to prevent API errors including throtting.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    #Rest API Destination for Streaming Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkRestAPIDestination</span>

<span class="sd">    rest_api_destination = SparkRestAPIDestination(</span>
<span class="sd">        data=df,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;checkpointLocation&quot;: &quot;{/CHECKPOINT-LOCATION/}&quot;</span>
<span class="sd">        },</span>
<span class="sd">        url=&quot;{REST-API-URL}&quot;,</span>
<span class="sd">        headers = {</span>
<span class="sd">            &#39;Authorization&#39;: &#39;Bearer {}&#39;.format(&quot;{TOKEN}&quot;)</span>
<span class="sd">        },</span>
<span class="sd">        batch_size=100,</span>
<span class="sd">        method=&quot;POST&quot;,</span>
<span class="sd">        parallelism=8,</span>
<span class="sd">        trigger=&quot;1 minute&quot;,</span>
<span class="sd">        query_name=&quot;DeltaRestAPIDestination&quot;,</span>
<span class="sd">        query_wait_interval=None</span>
<span class="sd">    )</span>

<span class="sd">    rest_api_destination.write_stream()</span>
<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">    #Rest API Destination for Batch Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkRestAPIDestination</span>

<span class="sd">    rest_api_destination = SparkRestAPIDestination(</span>
<span class="sd">        data=df,</span>
<span class="sd">        options={},</span>
<span class="sd">        url=&quot;{REST-API-URL}&quot;,</span>
<span class="sd">        headers = {</span>
<span class="sd">            &#39;Authorization&#39;: &#39;Bearer {}&#39;.format(&quot;{TOKEN}&quot;)</span>
<span class="sd">        },</span>
<span class="sd">        batch_size=10,</span>
<span class="sd">        method=&quot;POST&quot;,</span>
<span class="sd">        parallelism=4,</span>
<span class="sd">        trigger=&quot;1 minute&quot;,</span>
<span class="sd">        query_name=&quot;DeltaRestAPIDestination&quot;,</span>
<span class="sd">        query_wait_interval=None</span>
<span class="sd">    )</span>

<span class="sd">    rest_api_destination.write_stream()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe to be merged into a Delta Table</span>
<span class="sd">        options (dict): A dictionary of options for streaming writes</span>
<span class="sd">        url (str): The Rest API Url</span>
<span class="sd">        headers (dict): A dictionary of headers to be provided to the Rest API</span>
<span class="sd">        batch_size (int): The number of DataFrame rows to be used in each Rest API call</span>
<span class="sd">        method (str): The method to be used when calling the Rest API. Allowed values are POST, PATCH and PUT</span>
<span class="sd">        parallelism (int): The number of concurrent calls to be made to the Rest API</span>
<span class="sd">        trigger (optional str): Frequency of the write operation. Specify &quot;availableNow&quot; to execute a trigger once, otherwise specify a time period such as &quot;30 seconds&quot;, &quot;5 minutes&quot;. Set to &quot;0 seconds&quot; if you do not want to use a trigger. (stream) Default is 10 seconds</span>
<span class="sd">        query_name (str): Unique name for the query in associated SparkSession</span>
<span class="sd">        query_wait_interval (optional int): If set, waits for the streaming query to complete before returning. (stream) Default is None</span>

<span class="sd">    Attributes:</span>
<span class="sd">        checkpointLocation (str): Path to checkpoint files. (Streaming)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">parallelism</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="n">parallelism</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
        <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;1 minutes&quot;</span><span class="p">,</span>
        <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DeltaRestAPIDestination&quot;</span><span class="p">,</span>
        <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parallelism</span> <span class="o">=</span> <span class="n">parallelism</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">=</span> <span class="n">query_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span> <span class="o">=</span> <span class="n">query_wait_interval</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_pypi_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;api_requests&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_pre_batch_records_for_api_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">micro_batch_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">batch_count</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">micro_batch_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">)</span>
        <span class="n">micro_batch_df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">micro_batch_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="n">to_json</span><span class="p">(</span><span class="n">struct</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">,</span> <span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">Window</span><span class="p">()</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">))))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;batch_id&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">batch_count</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">micro_batch_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;batch_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
            <span class="n">concat_ws</span><span class="p">(</span><span class="s2">&quot;,|&quot;</span><span class="p">,</span> <span class="n">collect_list</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_api_micro_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">micro_batch_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">epoch_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># NOSONAR</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>
        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span>

        <span class="nd">@udf</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_rest_api_execute</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
            <span class="n">adapter</span> <span class="o">=</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">&quot;http://&quot;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>  <span class="c1"># NOSONAR</span>
            <span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;PATCH&quot;</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;PUT&quot;</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Method </span><span class="si">{}</span><span class="s2"> is not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="p">))</span>  <span class="c1"># NOSONAR</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span> <span class="ow">or</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">201</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Response status : </span><span class="si">{}</span><span class="s2"> .Response message : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">),</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
                    <span class="p">)</span>
                <span class="p">)</span>  <span class="c1"># NOSONAR</span>

            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>

        <span class="n">micro_batch_df</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
        <span class="n">micro_batch_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_batch_records_for_api_call</span><span class="p">(</span><span class="n">micro_batch_df</span><span class="p">)</span>

        <span class="n">micro_batch_df</span> <span class="o">=</span> <span class="n">micro_batch_df</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parallelism</span><span class="p">)</span>

        <span class="p">(</span>
            <span class="n">micro_batch_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;rest_api_response_code&quot;</span><span class="p">,</span> <span class="n">_rest_api_execute</span><span class="p">(</span><span class="n">micro_batch_df</span><span class="p">[</span><span class="s2">&quot;payload&quot;</span><span class="p">])</span>
            <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">micro_batch_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes batch data to a Rest API</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_micro_batch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes streaming data to a Rest API</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
                <span class="o">.</span><span class="n">foreachBatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_micro_batch</span><span class="p">)</span>
                <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
                <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/rest_api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination.write_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes batch data to a Rest API</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/rest_api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes batch data to a Rest API</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_micro_batch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkRestAPIDestination.write_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes streaming data to a Rest API</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/rest_api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes streaming data to a Rest API</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
            <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
            <span class="o">.</span><span class="n">foreachBatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_micro_batch</span><span class="p">)</span>
            <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
            <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination" class="doc doc-heading">
            <code>SparkPCDMToDeltaDestination</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.destinations.interfaces.DestinationInterface">DestinationInterface</span></code></p>


      <p>The Process Control Data Model written to Delta.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination--example">Example</h4>
<p><div class="highlight"><pre><span></span><code><span class="c1">#PCDM Latest To Delta Destination for Streaming Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkPCDMToDeltaDestination</span>

<span class="n">pcdm_to_delta_destination</span> <span class="o">=</span> <span class="n">SparkPCDMToDeltaDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;checkpointLocation&quot;</span><span class="p">:</span> <span class="s2">&quot;{/CHECKPOINT-LOCATION/}&quot;</span>
    <span class="p">},</span>
    <span class="n">destination_float</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{DELTA_TABLE_PATH_FLOAT}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">destination_string</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{DELTA_TABLE_PATH_STRING}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">destination_integer</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{DELTA_TABLE_PATH_INTEGER}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;PCDMToDeltaDestination&quot;</span><span class="p">,</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">merge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">try_broadcast_join</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">remove_nanoseconds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">remove_duplicates</span><span class="o">-</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">pcdm_to_delta_destination</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">#PCDM Latest To Delta Destination for Batch Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkPCDMToDeltaDestination</span>

<span class="n">pcdm_to_delta_destination</span> <span class="o">=</span> <span class="n">SparkPCDMToDeltaDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;maxRecordsPerFile&quot;</span><span class="p">,</span> <span class="s2">&quot;10000&quot;</span>
    <span class="p">},</span>
    <span class="n">destination_float</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{DELTA_TABLE_PATH_FLOAT}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">destination_string</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{DELTA_TABLE_PATH_STRING}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">destination_integer</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{DELTA_TABLE_PATH_INTEGER}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;PCDMToDeltaDestination&quot;</span><span class="p">,</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">merge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">try_broadcast_join</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">remove_nanoseconds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">remove_duplicates</span><span class="o">-</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">pcdm_to_delta_destination</span><span class="o">.</span><span class="n">write_batch</span><span class="p">()</span>
</code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe to be merged into a Delta Table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Options that can be specified for a Delta Table read operation (See Attributes table below). Further information on the options is available for <a href="https://docs.delta.io/latest/delta-batch.html#write-to-a-table" target="_blank">batch</a> and <a href="https://docs.delta.io/latest/delta-streaming.html#delta-table-as-a-sink" target="_blank">streaming</a>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>destination_float</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Either the name of the Hive Metastore or Unity Catalog Delta Table <strong>or</strong> the path to the Delta table to store float values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>destination_string</code></td>
            <td>
                  <code>Optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Either the name of the Hive Metastore or Unity Catalog Delta Table <strong>or</strong> the path to the Delta table to store string values.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>destination_integer</code></td>
            <td>
                  <code>Optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Either the name of the Hive Metastore or Unity Catalog Delta Table <strong>or</strong> the path to the Delta table to store integer values</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method of writing to Delta Table - append/overwrite (batch), append/complete (stream)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trigger</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency of the write operation. Specify "availableNow" to execute a trigger once, otherwise specify a time period such as "30 seconds", "5 minutes". Set to "0 seconds" if you do not want to use a trigger. (stream) Default is 10 seconds</p>
              </div>
            </td>
            <td>
                  <code>&#39;10 seconds&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique name for the query in associated SparkSession</p>
              </div>
            </td>
            <td>
                  <code>&#39;PCDMToDeltaDestination&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_wait_interval</code></td>
            <td>
                  <code>optional int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set, waits for the streaming query to complete before returning. (stream) Default is None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>merge</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Use Delta Merge to perform inserts, updates and deletes</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>try_broadcast_join</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Attempts to perform a broadcast join in the merge which can leverage data skipping using partition pruning and file pruning automatically. Can fail if dataframe being merged is large and therefore more suitable for streaming merges than batch merges</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>remove_nanoseconds</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Removes nanoseconds from the EventTime column and replaces with zeros</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>remove_duplicates</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Removes duplicates before writing the data</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination.checkpointLocation">checkpointLocation</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to checkpoint files. (Streaming)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/pcdm_to_delta.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkPCDMToDeltaDestination</span><span class="p">(</span><span class="n">DestinationInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Process Control Data Model written to Delta.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    #PCDM Latest To Delta Destination for Streaming Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkPCDMToDeltaDestination</span>

<span class="sd">    pcdm_to_delta_destination = SparkPCDMToDeltaDestination(</span>
<span class="sd">        data=df,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;checkpointLocation&quot;: &quot;{/CHECKPOINT-LOCATION/}&quot;</span>
<span class="sd">        },</span>
<span class="sd">        destination_float=&quot;{DELTA_TABLE_PATH_FLOAT}&quot;,</span>
<span class="sd">        destination_string=&quot;{DELTA_TABLE_PATH_STRING}&quot;,</span>
<span class="sd">        destination_integer=&quot;{DELTA_TABLE_PATH_INTEGER}&quot;,</span>
<span class="sd">        mode=&quot;append&quot;,</span>
<span class="sd">        trigger=&quot;10 seconds&quot;,</span>
<span class="sd">        query_name=&quot;PCDMToDeltaDestination&quot;,</span>
<span class="sd">        query_wait_interval=None,</span>
<span class="sd">        merge=True,</span>
<span class="sd">        try_broadcast_join=False,</span>
<span class="sd">        remove_nanoseconds=False,</span>
<span class="sd">        remove_duplicates-True</span>
<span class="sd">    )</span>

<span class="sd">    pcdm_to_delta_destination.write_stream()</span>
<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">    #PCDM Latest To Delta Destination for Batch Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkPCDMToDeltaDestination</span>

<span class="sd">    pcdm_to_delta_destination = SparkPCDMToDeltaDestination(</span>
<span class="sd">        data=df,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;maxRecordsPerFile&quot;, &quot;10000&quot;</span>
<span class="sd">        },</span>
<span class="sd">        destination_float=&quot;{DELTA_TABLE_PATH_FLOAT}&quot;,</span>
<span class="sd">        destination_string=&quot;{DELTA_TABLE_PATH_STRING}&quot;,</span>
<span class="sd">        destination_integer=&quot;{DELTA_TABLE_PATH_INTEGER}&quot;,</span>
<span class="sd">        mode=&quot;overwrite&quot;,</span>
<span class="sd">        trigger=&quot;10 seconds&quot;,</span>
<span class="sd">        query_name=&quot;PCDMToDeltaDestination&quot;,</span>
<span class="sd">        query_wait_interval=None,</span>
<span class="sd">        merge=True,</span>
<span class="sd">        try_broadcast_join=False,</span>
<span class="sd">        remove_nanoseconds=False,</span>
<span class="sd">        remove_duplicates-True</span>
<span class="sd">    )</span>

<span class="sd">    pcdm_to_delta_destination.write_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe to be merged into a Delta Table</span>
<span class="sd">        options (dict): Options that can be specified for a Delta Table read operation (See Attributes table below). Further information on the options is available for [batch](https://docs.delta.io/latest/delta-batch.html#write-to-a-table){ target=&quot;_blank&quot; } and [streaming](https://docs.delta.io/latest/delta-streaming.html#delta-table-as-a-sink){ target=&quot;_blank&quot; }.</span>
<span class="sd">        destination_float (str): Either the name of the Hive Metastore or Unity Catalog Delta Table **or** the path to the Delta table to store float values.</span>
<span class="sd">        destination_string (Optional str): Either the name of the Hive Metastore or Unity Catalog Delta Table **or** the path to the Delta table to store string values.</span>
<span class="sd">        destination_integer (Optional str): Either the name of the Hive Metastore or Unity Catalog Delta Table **or** the path to the Delta table to store integer values</span>
<span class="sd">        mode (str): Method of writing to Delta Table - append/overwrite (batch), append/complete (stream)</span>
<span class="sd">        trigger (optional str): Frequency of the write operation. Specify &quot;availableNow&quot; to execute a trigger once, otherwise specify a time period such as &quot;30 seconds&quot;, &quot;5 minutes&quot;. Set to &quot;0 seconds&quot; if you do not want to use a trigger. (stream) Default is 10 seconds</span>
<span class="sd">        query_name (str): Unique name for the query in associated SparkSession</span>
<span class="sd">        query_wait_interval (optional int): If set, waits for the streaming query to complete before returning. (stream) Default is None</span>
<span class="sd">        merge (bool): Use Delta Merge to perform inserts, updates and deletes</span>
<span class="sd">        try_broadcast_join (bool): Attempts to perform a broadcast join in the merge which can leverage data skipping using partition pruning and file pruning automatically. Can fail if dataframe being merged is large and therefore more suitable for streaming merges than batch merges</span>
<span class="sd">        remove_nanoseconds (bool): Removes nanoseconds from the EventTime column and replaces with zeros</span>
<span class="sd">        remove_duplicates (bool: Removes duplicates before writing the data</span>

<span class="sd">    Attributes:</span>
<span class="sd">        checkpointLocation (str): Path to checkpoint files. (Streaming)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">destination_float</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">destination_string</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">destination_integer</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">try_broadcast_join</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">remove_nanoseconds</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">remove_duplicates</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">destination_float</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">destination_string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">destination_integer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
        <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;PCDMToDeltaDestination&quot;</span><span class="p">,</span>
        <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">try_broadcast_join</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">remove_nanoseconds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">remove_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destination_float</span> <span class="o">=</span> <span class="n">destination_float</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destination_string</span> <span class="o">=</span> <span class="n">destination_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destination_integer</span> <span class="o">=</span> <span class="n">destination_integer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">=</span> <span class="n">query_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span> <span class="o">=</span> <span class="n">query_wait_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merge</span> <span class="o">=</span> <span class="n">merge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">try_broadcast_join</span> <span class="o">=</span> <span class="n">try_broadcast_join</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_nanoseconds</span> <span class="o">=</span> <span class="n">remove_nanoseconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span> <span class="o">=</span> <span class="n">remove_duplicates</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_delta_core&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_get_eventdate_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">dates_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EventDate&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
        <span class="n">dates_df</span> <span class="o">=</span> <span class="n">dates_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">date_format</span><span class="p">(</span><span class="s2">&quot;EventDate&quot;</span><span class="p">,</span> <span class="s2">&quot;yyyy-MM-dd&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EventDate&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">dates_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dates_df</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()[</span><span class="s2">&quot;EventDate&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">dates_list</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_delta_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="s2">&quot;EventDate&quot;</span><span class="p">,</span> <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span>
        <span class="p">)</span>
        <span class="n">when_matched_update_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">DeltaMergeConditionValues</span><span class="p">(</span>
                <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;(source.ChangeType IN (&#39;insert&#39;, &#39;update&#39;, &#39;upsert&#39;)) AND ((source.Status != target.Status) OR (source.Value != target.Value))&quot;</span><span class="p">,</span>
                <span class="n">values</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;EventDate&quot;</span><span class="p">:</span> <span class="s2">&quot;source.EventDate&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;TagName&quot;</span><span class="p">:</span> <span class="s2">&quot;source.TagName&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;EventTime&quot;</span><span class="p">:</span> <span class="s2">&quot;source.EventTime&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="s2">&quot;source.Status&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;source.Value&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="n">when_matched_delete_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">DeltaMergeCondition</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;source.ChangeType = &#39;delete&#39;&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">when_not_matched_insert_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">DeltaMergeConditionValues</span><span class="p">(</span>
                <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;(source.ChangeType IN (&#39;insert&#39;, &#39;update&#39;, &#39;upsert&#39;))&quot;</span><span class="p">,</span>
                <span class="n">values</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;EventDate&quot;</span><span class="p">:</span> <span class="s2">&quot;source.EventDate&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;TagName&quot;</span><span class="p">:</span> <span class="s2">&quot;source.TagName&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;EventTime&quot;</span><span class="p">:</span> <span class="s2">&quot;source.EventTime&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="s2">&quot;source.Status&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;source.Value&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
        <span class="p">]</span>

        <span class="n">merge_condition</span> <span class="o">=</span> <span class="s2">&quot;source.EventDate = target.EventDate AND source.TagName = target.TagName AND source.EventTime = target.EventTime&quot;</span>

        <span class="n">perform_merge</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_broadcast_join</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">eventdate_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_eventdate_string</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">eventdate_string</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">eventdate_string</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">perform_merge</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">merge_condition</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;target.EventDate in (</span><span class="si">{}</span><span class="s2">) AND &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eventdate_string</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">merge_condition</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">perform_merge</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">SparkDeltaMergeDestination</span><span class="p">(</span>
                <span class="n">spark</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
                <span class="n">destination</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
                <span class="n">merge_condition</span><span class="o">=</span><span class="n">merge_condition</span><span class="p">,</span>
                <span class="n">when_matched_update_list</span><span class="o">=</span><span class="n">when_matched_update_list</span><span class="p">,</span>
                <span class="n">when_matched_delete_list</span><span class="o">=</span><span class="n">when_matched_delete_list</span><span class="p">,</span>
                <span class="n">when_not_matched_insert_list</span><span class="o">=</span><span class="n">when_not_matched_insert_list</span><span class="p">,</span>
                <span class="n">try_broadcast_join</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">try_broadcast_join</span><span class="p">,</span>
                <span class="n">trigger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span>
                <span class="n">query_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">write_batch</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_write_delta_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;EventDate&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;EventDate&quot;</span><span class="p">,</span> <span class="n">date_format</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;yyyy-MM-dd&quot;</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_write_delta_merge</span><span class="p">(</span>
                <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s2">&quot;insert&quot;</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span><span class="p">,</span> <span class="s2">&quot;upsert&quot;</span><span class="p">)),</span>
                <span class="n">destination</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_delta_merge</span><span class="p">(</span>
                <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;delete&quot;</span><span class="p">),</span> <span class="n">destination</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span>
            <span class="n">SparkDeltaDestination</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
                <span class="n">destination</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
                <span class="n">trigger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span>
                <span class="n">query_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">write_batch</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_write_data_by_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;ChangeType&quot;</span><span class="p">,</span>
                <span class="n">when</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s2">&quot;insert&quot;</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span><span class="p">),</span> <span class="s2">&quot;upsert&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;ChangeType&quot;</span><span class="p">]</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_nanoseconds</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                    <span class="s2">&quot;timestamp&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeType&quot;</span><span class="p">])</span>

        <span class="n">float_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ValueTypeConstants</span><span class="o">.</span><span class="n">FLOAT_VALUE</span><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_delta_batch</span><span class="p">(</span><span class="n">float_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_float</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_string</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">string_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ValueTypeConstants</span><span class="o">.</span><span class="n">STRING_VALUE</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_delta_batch</span><span class="p">(</span><span class="n">string_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_string</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_integer</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">integer_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ValueTypeConstants</span><span class="o">.</span><span class="n">INTEGER_VALUE</span><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;integer&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_delta_batch</span><span class="p">(</span><span class="n">integer_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_integer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_stream_microbatches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">epoch_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># NOSONAR</span>
        <span class="n">df</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_data_by_type</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes Process Control Data Model data to Delta</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_broadcast_join</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_write_data_by_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_broadcast_join</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes streaming Process Control Data Model data to Delta using foreachBatch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">foreachBatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_stream_microbatches</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">default_checkpoint_location</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">float_checkpoint_location</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">string_checkpoint_location</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">integer_checkpoint_location</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">append_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="s2">&quot;checkpointLocation&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                    <span class="n">default_checkpoint_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;checkpointLocation&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">default_checkpoint_location</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
                        <span class="n">default_checkpoint_location</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
                    <span class="n">float_checkpoint_location</span> <span class="o">=</span> <span class="n">default_checkpoint_location</span> <span class="o">+</span> <span class="s2">&quot;float&quot;</span>
                    <span class="n">string_checkpoint_location</span> <span class="o">=</span> <span class="n">default_checkpoint_location</span> <span class="o">+</span> <span class="s2">&quot;string&quot;</span>
                    <span class="n">integer_checkpoint_location</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">default_checkpoint_location</span> <span class="o">+</span> <span class="s2">&quot;integer&quot;</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="n">float_checkpoint_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">append_options</span><span class="p">[</span><span class="s2">&quot;checkpointLocation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">float_checkpoint_location</span>

                <span class="n">delta_float</span> <span class="o">=</span> <span class="n">SparkDeltaDestination</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ValueTypeConstants</span><span class="o">.</span><span class="n">FLOAT_VALUE</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)),</span>
                    <span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">destination_float</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="n">append_options</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
                    <span class="n">trigger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span>
                    <span class="n">query_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">+</span> <span class="s2">&quot;_float&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">delta_float</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_string</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">string_checkpoint_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">append_options</span><span class="p">[</span><span class="s2">&quot;checkpointLocation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">string_checkpoint_location</span>
                        <span class="p">)</span>

                    <span class="n">delta_string</span> <span class="o">=</span> <span class="n">SparkDeltaDestination</span><span class="p">(</span>
                        <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                            <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ValueTypeConstants</span><span class="o">.</span><span class="n">STRING_VALUE</span><span class="p">),</span>
                        <span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">destination_string</span><span class="p">,</span>
                        <span class="n">options</span><span class="o">=</span><span class="n">append_options</span><span class="p">,</span>
                        <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
                        <span class="n">trigger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span>
                        <span class="n">query_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">+</span> <span class="s2">&quot;_string&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">delta_string</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_integer</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">integer_checkpoint_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">append_options</span><span class="p">[</span><span class="s2">&quot;checkpointLocation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">integer_checkpoint_location</span>
                        <span class="p">)</span>

                    <span class="n">delta_integer</span> <span class="o">=</span> <span class="n">SparkDeltaDestination</span><span class="p">(</span>
                        <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ValueTypeConstants</span><span class="o">.</span><span class="n">INTEGER_VALUE</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;integer&quot;</span><span class="p">)),</span>
                        <span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">destination_integer</span><span class="p">,</span>
                        <span class="n">options</span><span class="o">=</span><span class="n">append_options</span><span class="p">,</span>
                        <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
                        <span class="n">trigger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span>
                        <span class="n">query_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">+</span> <span class="s2">&quot;_integer&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">delta_integer</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
                    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">streams</span><span class="o">.</span><span class="n">active</span> <span class="o">!=</span> <span class="p">[]:</span>
                        <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">streams</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                                <span class="p">)</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/pcdm_to_delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination.write_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes Process Control Data Model data to Delta</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/pcdm_to_delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes Process Control Data Model data to Delta</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_broadcast_join</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_data_by_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_broadcast_join</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMToDeltaDestination.write_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes streaming Process Control Data Model data to Delta using foreachBatch</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/pcdm_to_delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes streaming Process Control Data Model data to Delta using foreachBatch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
            <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">foreachBatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_stream_microbatches</span><span class="p">)</span>
                <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
                <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">default_checkpoint_location</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">float_checkpoint_location</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">string_checkpoint_location</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">integer_checkpoint_location</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">append_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;checkpointLocation&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="n">default_checkpoint_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;checkpointLocation&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">default_checkpoint_location</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
                    <span class="n">default_checkpoint_location</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
                <span class="n">float_checkpoint_location</span> <span class="o">=</span> <span class="n">default_checkpoint_location</span> <span class="o">+</span> <span class="s2">&quot;float&quot;</span>
                <span class="n">string_checkpoint_location</span> <span class="o">=</span> <span class="n">default_checkpoint_location</span> <span class="o">+</span> <span class="s2">&quot;string&quot;</span>
                <span class="n">integer_checkpoint_location</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">default_checkpoint_location</span> <span class="o">+</span> <span class="s2">&quot;integer&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">float_checkpoint_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">append_options</span><span class="p">[</span><span class="s2">&quot;checkpointLocation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">float_checkpoint_location</span>

            <span class="n">delta_float</span> <span class="o">=</span> <span class="n">SparkDeltaDestination</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ValueTypeConstants</span><span class="o">.</span><span class="n">FLOAT_VALUE</span><span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)),</span>
                <span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">destination_float</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="n">append_options</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
                <span class="n">trigger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span>
                <span class="n">query_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">+</span> <span class="s2">&quot;_float&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">delta_float</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_string</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">string_checkpoint_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">append_options</span><span class="p">[</span><span class="s2">&quot;checkpointLocation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">string_checkpoint_location</span>
                    <span class="p">)</span>

                <span class="n">delta_string</span> <span class="o">=</span> <span class="n">SparkDeltaDestination</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                        <span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ValueTypeConstants</span><span class="o">.</span><span class="n">STRING_VALUE</span><span class="p">),</span>
                    <span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">destination_string</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="n">append_options</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
                    <span class="n">trigger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span>
                    <span class="n">query_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">+</span> <span class="s2">&quot;_string&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">delta_string</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_integer</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">integer_checkpoint_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">append_options</span><span class="p">[</span><span class="s2">&quot;checkpointLocation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">integer_checkpoint_location</span>
                    <span class="p">)</span>

                <span class="n">delta_integer</span> <span class="o">=</span> <span class="n">SparkDeltaDestination</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ValueTypeConstants</span><span class="o">.</span><span class="n">INTEGER_VALUE</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;integer&quot;</span><span class="p">)),</span>
                    <span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">destination_integer</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="n">append_options</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
                    <span class="n">trigger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span>
                    <span class="n">query_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">+</span> <span class="s2">&quot;_integer&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">delta_integer</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">streams</span><span class="o">.</span><span class="n">active</span> <span class="o">!=</span> <span class="p">[]:</span>
                    <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">streams</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                            <span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination" class="doc doc-heading">
            <code>SparkPCDMLatestToDeltaDestination</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.destinations.interfaces.DestinationInterface">DestinationInterface</span></code></p>


      <p>The Process Control Data Model Latest Values written to Delta.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination--example">Example</h4>
<p><div class="highlight"><pre><span></span><code><span class="c1">#PCDM Latest To Delta Destination for Streaming Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkPCDMLatestToDeltaDestination</span>

<span class="n">pcdm_latest_to_delta_destination</span> <span class="o">=</span> <span class="n">SparkPCDMLatestToDeltaDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;checkpointLocation&quot;</span><span class="p">:</span> <span class="s2">&quot;{/CHECKPOINT-LOCATION/}&quot;</span>
    <span class="p">},</span>
    <span class="n">destination</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{DELTA_TABLE_PATH}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;PCDMLatestToDeltaDestination&quot;</span><span class="p">,</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">pcdm_latest_to_delta_destination</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">#PCDM Latest To Delta Destination for Batch Queries</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkPCDMLatestToDeltaDestination</span>

<span class="n">pcdm_latest_to_delta_destination</span> <span class="o">=</span> <span class="n">SparkPCDMLatestToDeltaDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;maxRecordsPerFile&quot;</span><span class="p">,</span> <span class="s2">&quot;10000&quot;</span>
    <span class="p">},</span>
    <span class="n">destination</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{DELTA_TABLE_PATH}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;PCDMLatestToDeltaDestination&quot;</span><span class="p">,</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">pcdm_latest_to_delta_destination</span><span class="o">.</span><span class="n">write_batch</span><span class="p">()</span>
</code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe to be merged into a Delta Table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Options that can be specified for a Delta Table read operation (See Attributes table below). Further information on the options is available for <a href="https://docs.delta.io/latest/delta-batch.html#write-to-a-table" target="_blank">batch</a> and <a href="https://docs.delta.io/latest/delta-streaming.html#delta-table-as-a-sink" target="_blank">streaming</a>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>destination</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Either the name of the Hive Metastore or Unity Catalog Delta Table <strong>or</strong> the path to the Delta table to store the latest values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method of writing to Delta Table - append/overwrite (batch), append/complete (stream)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trigger</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency of the write operation. Specify "availableNow" to execute a trigger once, otherwise specify a time period such as "30 seconds", "5 minutes". Set to "0 seconds" if you do not want to use a trigger. (stream) Default is 10 seconds</p>
              </div>
            </td>
            <td>
                  <code>&#39;10 seconds&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique name for the query in associated SparkSession</p>
              </div>
            </td>
            <td>
                  <code>&#39;PCDMLatestToDeltaDestination&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_wait_interval</code></td>
            <td>
                  <code>optional int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set, waits for the streaming query to complete before returning. (stream) Default is None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination.checkpointLocation">checkpointLocation</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to checkpoint files. (Streaming)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/pcdm_latest_to_delta.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkPCDMLatestToDeltaDestination</span><span class="p">(</span><span class="n">DestinationInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Process Control Data Model Latest Values written to Delta.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    #PCDM Latest To Delta Destination for Streaming Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkPCDMLatestToDeltaDestination</span>

<span class="sd">    pcdm_latest_to_delta_destination = SparkPCDMLatestToDeltaDestination(</span>
<span class="sd">        data=df,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;checkpointLocation&quot;: &quot;{/CHECKPOINT-LOCATION/}&quot;</span>
<span class="sd">        },</span>
<span class="sd">        destination=&quot;{DELTA_TABLE_PATH}&quot;,</span>
<span class="sd">        mode=&quot;append&quot;,</span>
<span class="sd">        trigger=&quot;10 seconds&quot;,</span>
<span class="sd">        query_name=&quot;PCDMLatestToDeltaDestination&quot;,</span>
<span class="sd">        query_wait_interval=None</span>
<span class="sd">    )</span>

<span class="sd">    pcdm_latest_to_delta_destination.write_stream()</span>
<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">    #PCDM Latest To Delta Destination for Batch Queries</span>

<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkPCDMLatestToDeltaDestination</span>

<span class="sd">    pcdm_latest_to_delta_destination = SparkPCDMLatestToDeltaDestination(</span>
<span class="sd">        data=df,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;maxRecordsPerFile&quot;, &quot;10000&quot;</span>
<span class="sd">        },</span>
<span class="sd">        destination=&quot;{DELTA_TABLE_PATH}&quot;,</span>
<span class="sd">        mode=&quot;overwrite&quot;,</span>
<span class="sd">        trigger=&quot;10 seconds&quot;,</span>
<span class="sd">        query_name=&quot;PCDMLatestToDeltaDestination&quot;,</span>
<span class="sd">        query_wait_interval=None</span>
<span class="sd">    )</span>

<span class="sd">    pcdm_latest_to_delta_destination.write_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (DataFrame): Dataframe to be merged into a Delta Table</span>
<span class="sd">        options (dict): Options that can be specified for a Delta Table read operation (See Attributes table below). Further information on the options is available for [batch](https://docs.delta.io/latest/delta-batch.html#write-to-a-table){ target=&quot;_blank&quot; } and [streaming](https://docs.delta.io/latest/delta-streaming.html#delta-table-as-a-sink){ target=&quot;_blank&quot; }.</span>
<span class="sd">        destination (str): Either the name of the Hive Metastore or Unity Catalog Delta Table **or** the path to the Delta table to store the latest values</span>
<span class="sd">        mode (str): Method of writing to Delta Table - append/overwrite (batch), append/complete (stream)</span>
<span class="sd">        trigger (optional str): Frequency of the write operation. Specify &quot;availableNow&quot; to execute a trigger once, otherwise specify a time period such as &quot;30 seconds&quot;, &quot;5 minutes&quot;. Set to &quot;0 seconds&quot; if you do not want to use a trigger. (stream) Default is 10 seconds</span>
<span class="sd">        query_name (str): Unique name for the query in associated SparkSession</span>
<span class="sd">        query_wait_interval (optional int): If set, waits for the streaming query to complete before returning. (stream) Default is None</span>

<span class="sd">    Attributes:</span>
<span class="sd">        checkpointLocation (str): Path to checkpoint files. (Streaming)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
        <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;PCDMLatestToDeltaDestination&quot;</span><span class="p">,</span>
        <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">=</span> <span class="n">query_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span> <span class="o">=</span> <span class="n">query_wait_interval</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_delta_core&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_write_latest_to_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">epoch_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># NOSONAR</span>
        <span class="n">df</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>

        <span class="n">latest_df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;Latest&quot;</span><span class="p">,</span>
                <span class="nb">max</span><span class="p">(</span><span class="n">struct</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">)),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;GoodLatest&quot;</span><span class="p">,</span>
                <span class="n">when</span><span class="p">(</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Latest.Status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Good&quot;</span><span class="p">,</span>
                    <span class="n">struct</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;ValueType&quot;</span><span class="p">)),</span>
                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span>
                        <span class="n">when</span><span class="p">(</span>
                            <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Good&quot;</span><span class="p">,</span>
                            <span class="n">struct</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;ValueType&quot;</span><span class="p">),</span>
                        <span class="p">)</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">&quot;TagName&quot;</span><span class="p">))</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;EventTime&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;Latest.EventTime&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Latest&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">dropDuplicates</span><span class="p">([</span><span class="s2">&quot;TagName&quot;</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="n">when_matched_update_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">DeltaMergeConditionValues</span><span class="p">(</span>
                <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;source.EventTime &gt; target.EventTime AND (source.GoodLatest.EventTime IS NULL OR source.GoodLatest.EventTime &lt;= target.GoodEventTime)&quot;</span><span class="p">,</span>
                <span class="n">values</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;EventTime&quot;</span><span class="p">:</span> <span class="s2">&quot;source.EventTime&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="s2">&quot;source.Status&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;source.Value&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ValueType&quot;</span><span class="p">:</span> <span class="s2">&quot;source.ValueType&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">),</span>
            <span class="n">DeltaMergeConditionValues</span><span class="p">(</span>
                <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;source.EventTime &gt; target.EventTime AND (source.GoodLatest.EventTime IS NOT NULL AND (source.GoodLatest.EventTime &gt; target.GoodEventTime OR target.GoodEventTime IS NULL))&quot;</span><span class="p">,</span>
                <span class="n">values</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;EventTime&quot;</span><span class="p">:</span> <span class="s2">&quot;source.EventTime&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="s2">&quot;source.Status&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;source.Value&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ValueType&quot;</span><span class="p">:</span> <span class="s2">&quot;source.ValueType&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;GoodEventTime&quot;</span><span class="p">:</span> <span class="s2">&quot;source.GoodLatest.EventTime&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;GoodValue&quot;</span><span class="p">:</span> <span class="s2">&quot;source.GoodLatest.Value&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;GoodValueType&quot;</span><span class="p">:</span> <span class="s2">&quot;source.GoodLatest.ValueType&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">),</span>
            <span class="n">DeltaMergeConditionValues</span><span class="p">(</span>
                <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;source.EventTime &lt;= target.EventTime AND (source.GoodLatest.EventTime IS NOT NULL AND (source.GoodLatest.EventTime &gt; target.GoodEventTime OR target.GoodEventTime IS NULL))&quot;</span><span class="p">,</span>
                <span class="n">values</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;GoodEventTime&quot;</span><span class="p">:</span> <span class="s2">&quot;source.GoodLatest.EventTime&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;GoodValue&quot;</span><span class="p">:</span> <span class="s2">&quot;source.GoodLatest.Value&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;GoodValueType&quot;</span><span class="p">:</span> <span class="s2">&quot;source.GoodLatest.ValueType&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">),</span>
        <span class="p">]</span>

        <span class="n">when_not_matched_insert_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">DeltaMergeConditionValues</span><span class="p">(</span>
                <span class="n">values</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;TagName&quot;</span><span class="p">:</span> <span class="s2">&quot;source.TagName&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;EventTime&quot;</span><span class="p">:</span> <span class="s2">&quot;source.EventTime&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="s2">&quot;source.Status&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;source.Value&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ValueType&quot;</span><span class="p">:</span> <span class="s2">&quot;source.ValueType&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;GoodEventTime&quot;</span><span class="p">:</span> <span class="s2">&quot;source.GoodLatest.EventTime&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;GoodValue&quot;</span><span class="p">:</span> <span class="s2">&quot;source.GoodLatest.Value&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;GoodValueType&quot;</span><span class="p">:</span> <span class="s2">&quot;source.GoodLatest.ValueType&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
        <span class="p">]</span>

        <span class="n">merge_condition</span> <span class="o">=</span> <span class="s2">&quot;source.TagName = target.TagName&quot;</span>

        <span class="n">SparkDeltaMergeDestination</span><span class="p">(</span>
            <span class="n">spark</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">latest_df</span><span class="p">,</span>
            <span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
            <span class="n">merge_condition</span><span class="o">=</span><span class="n">merge_condition</span><span class="p">,</span>
            <span class="n">when_matched_update_list</span><span class="o">=</span><span class="n">when_matched_update_list</span><span class="p">,</span>
            <span class="n">when_not_matched_insert_list</span><span class="o">=</span><span class="n">when_not_matched_insert_list</span><span class="p">,</span>
            <span class="n">trigger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span>
            <span class="n">query_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">write_batch</span><span class="p">()</span>

        <span class="n">df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes Process Control Data Model data to Delta</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_latest_to_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes streaming Process Control Data Model data to Delta using foreachBatch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
            <span class="p">)</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">foreachBatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_latest_to_delta</span><span class="p">)</span>
                <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
                <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s2">&quot;append&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/pcdm_latest_to_delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination.write_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes Process Control Data Model data to Delta</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/pcdm_latest_to_delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes Process Control Data Model data to Delta</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_latest_to_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkPCDMLatestToDeltaDestination.write_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes streaming Process Control Data Model data to Delta using foreachBatch</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/pcdm_latest_to_delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes streaming Process Control Data Model data to Delta using foreachBatch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
            <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">foreachBatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_latest_to_delta</span><span class="p">)</span>
            <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
            <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s2">&quot;append&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination" class="doc doc-heading">
            <code>SparkKafkaEventhubDestination</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.destinations.interfaces.DestinationInterface">DestinationInterface</span></code></p>


      <p>This Spark Destination class is used to write batch or streaming data to an Eventhub using the Kafka protocol. This enables Eventhubs to be used as a destination in applications like Delta Live Tables or Databricks Serverless Jobs as the Spark Eventhubs JAR is not supported in these scenarios.</p>
<p>Default settings will be specified if not provided in the <code>options</code> parameter:</p>
<ul>
<li><code>kafka.sasl.mechanism</code> will be set to <code>PLAIN</code></li>
<li><code>kafka.security.protocol</code> will be set to <code>SASL_SSL</code></li>
<li><code>kafka.request.timeout.ms</code> will be set to <code>60000</code></li>
<li><code>kafka.session.timeout.ms</code> will be set to <code>60000</code></li>
</ul>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">SparkKafkaEventhubDestination</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">connectionString</span> <span class="o">=</span> <span class="n">Endpoint</span><span class="o">=</span><span class="n">sb</span><span class="p">:</span><span class="o">//</span><span class="p">{</span><span class="n">NAMESPACE</span><span class="p">}</span><span class="o">.</span><span class="n">servicebus</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="p">;</span><span class="n">SharedAccessKeyName</span><span class="o">=</span><span class="p">{</span><span class="n">ACCESS_KEY_NAME</span><span class="p">};</span><span class="n">SharedAccessKey</span><span class="o">=</span><span class="p">{</span><span class="n">ACCESS_KEY</span><span class="p">}</span><span class="o">=</span><span class="p">;</span><span class="n">EntityPath</span><span class="o">=</span><span class="p">{</span><span class="n">EVENT_HUB_NAME</span><span class="p">}</span>

<span class="n">eventhub_destination</span> <span class="o">=</span> <span class="n">SparkKafkaEventhubDestination</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;kafka.bootstrap.servers&quot;</span><span class="p">:</span> <span class="s2">&quot;host1:port1,host2:port2&quot;</span>
    <span class="p">},</span>
    <span class="n">connection_string</span><span class="o">=</span><span class="s2">&quot;{YOUR-EVENTHUB-CONNECTION-STRING}&quot;</span><span class="p">,</span>
    <span class="n">consumer_group</span><span class="o">=</span><span class="s2">&quot;{YOUR-EVENTHUB-CONSUMER-GROUP}&quot;</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
    <span class="n">query_name</span><span class="o">=</span><span class="s2">&quot;KafkaEventhubDestination&quot;</span><span class="p">,</span>
    <span class="n">query_wait_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">eventhub_destination</span><span class="o">.</span><span class="n">write_stream</span><span class="p">()</span>

<span class="n">OR</span>

<span class="n">eventhub_destination</span><span class="o">.</span><span class="n">write_batch</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="pyspark.sql.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Any columns not listed in the required schema <a href="https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html#writing-data-to-kafka" target="_blank">here</a> will be merged into a single column named "value", or ignored if "value" is an existing column</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>connection_string</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Eventhubs connection string is required to connect to the Eventhubs service. This must include the Eventhub name as the <code>EntityPath</code> parameter. Example <code>"Endpoint=sb://test.servicebus.windows.net/;SharedAccessKeyName=test;SharedAccessKey=test_key;EntityPath=test_eventhub"</code></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of Kafka configurations (See Attributes tables below)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>consumer_group</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Eventhub consumer group to use for the connection</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trigger</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency of the write operation. Specify "availableNow" to execute a trigger once, otherwise specify a time period such as "30 seconds", "5 minutes". Set to "0 seconds" if you do not want to use a trigger. (stream) Default is 10 seconds</p>
              </div>
            </td>
            <td>
                  <code>&#39;10 seconds&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_name</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique name for the query in associated SparkSession</p>
              </div>
            </td>
            <td>
                  <code>&#39;KafkaEventhubDestination&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>query_wait_interval</code></td>
            <td>
                  <code>optional int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set, waits for the streaming query to complete before returning. (stream) Default is None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
      <p>The following are commonly used parameters that may be included in the options dict. kafka.bootstrap.servers is the only required config. A full list of configs can be found <a href="https://kafka.apache.org/documentation/#producerconfigs" target="_blank">here</a></p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination.kafka.bootstrap.servers">kafka.bootstrap.servers</span></code></td>
            <td>
                  <code>A comma-separated list of host︰port</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Kafka "bootstrap.servers" configuration. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination.topic">topic</span></code></td>
            <td>
                  <code>string</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required if there is no existing topic column in your DataFrame. Sets the topic that all rows will be written to in Kafka. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination.includeHeaders">includeHeaders</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Determines whether to include the Kafka headers in the row; defaults to False. (Streaming and Batch)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/kafka_eventhub.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkKafkaEventhubDestination</span><span class="p">(</span><span class="n">DestinationInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Spark Destination class is used to write batch or streaming data to an Eventhub using the Kafka protocol. This enables Eventhubs to be used as a destination in applications like Delta Live Tables or Databricks Serverless Jobs as the Spark Eventhubs JAR is not supported in these scenarios.</span>

<span class="sd">    Default settings will be specified if not provided in the `options` parameter:</span>

<span class="sd">    - `kafka.sasl.mechanism` will be set to `PLAIN`</span>
<span class="sd">    - `kafka.security.protocol` will be set to `SASL_SSL`</span>
<span class="sd">    - `kafka.request.timeout.ms` will be set to `60000`</span>
<span class="sd">    - `kafka.session.timeout.ms` will be set to `60000`</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.destinations import SparkKafkaEventhubDestination</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    connectionString = Endpoint=sb://{NAMESPACE}.servicebus.windows.net/;SharedAccessKeyName={ACCESS_KEY_NAME};SharedAccessKey={ACCESS_KEY}=;EntityPath={EVENT_HUB_NAME}</span>

<span class="sd">    eventhub_destination = SparkKafkaEventhubDestination(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        data=df,</span>
<span class="sd">        options={</span>
<span class="sd">            &quot;kafka.bootstrap.servers&quot;: &quot;host1:port1,host2:port2&quot;</span>
<span class="sd">        },</span>
<span class="sd">        connection_string=&quot;{YOUR-EVENTHUB-CONNECTION-STRING}&quot;,</span>
<span class="sd">        consumer_group=&quot;{YOUR-EVENTHUB-CONSUMER-GROUP}&quot;,</span>
<span class="sd">        trigger=&quot;10 seconds&quot;,</span>
<span class="sd">        query_name=&quot;KafkaEventhubDestination&quot;,</span>
<span class="sd">        query_wait_interval=None</span>
<span class="sd">    )</span>

<span class="sd">    eventhub_destination.write_stream()</span>

<span class="sd">    OR</span>

<span class="sd">    eventhub_destination.write_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session</span>
<span class="sd">        data (DataFrame): Any columns not listed in the required schema [here](https://spark.apache.org/docs/latest/structured-streaming-kafka-integration.html#writing-data-to-kafka){ target=&quot;_blank&quot; } will be merged into a single column named &quot;value&quot;, or ignored if &quot;value&quot; is an existing column</span>
<span class="sd">        connection_string (str): Eventhubs connection string is required to connect to the Eventhubs service. This must include the Eventhub name as the `EntityPath` parameter. Example `&quot;Endpoint=sb://test.servicebus.windows.net/;SharedAccessKeyName=test;SharedAccessKey=test_key;EntityPath=test_eventhub&quot;`</span>
<span class="sd">        options (dict): A dictionary of Kafka configurations (See Attributes tables below)</span>
<span class="sd">        consumer_group (str): The Eventhub consumer group to use for the connection</span>
<span class="sd">        trigger (optional str): Frequency of the write operation. Specify &quot;availableNow&quot; to execute a trigger once, otherwise specify a time period such as &quot;30 seconds&quot;, &quot;5 minutes&quot;. Set to &quot;0 seconds&quot; if you do not want to use a trigger. (stream) Default is 10 seconds</span>
<span class="sd">        query_name (optional str): Unique name for the query in associated SparkSession</span>
<span class="sd">        query_wait_interval (optional int): If set, waits for the streaming query to complete before returning. (stream) Default is None</span>

<span class="sd">    The following are commonly used parameters that may be included in the options dict. kafka.bootstrap.servers is the only required config. A full list of configs can be found [here](https://kafka.apache.org/documentation/#producerconfigs){ target=&quot;_blank&quot; }</span>

<span class="sd">    Attributes:</span>
<span class="sd">        kafka.bootstrap.servers (A comma-separated list of host︰port):  The Kafka &quot;bootstrap.servers&quot; configuration. (Streaming and Batch)</span>
<span class="sd">        topic (string): Required if there is no existing topic column in your DataFrame. Sets the topic that all rows will be written to in Kafka. (Streaming and Batch)</span>
<span class="sd">        includeHeaders (bool): Determines whether to include the Kafka headers in the row; defaults to False. (Streaming and Batch)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span>
    <span class="n">connection_string</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">consumer_group</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">connection_string_properties</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">connection_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">consumer_group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;10 seconds&quot;</span><span class="p">,</span>
        <span class="n">query_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;KafkaEventhubDestination&quot;</span><span class="p">,</span>
        <span class="n">query_wait_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_string</span> <span class="o">=</span> <span class="n">connection_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consumer_group</span> <span class="o">=</span> <span class="n">consumer_group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_name</span> <span class="o">=</span> <span class="n">query_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_string_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_connection_string</span><span class="p">(</span>
            <span class="n">connection_string</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configure_options</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span> <span class="o">=</span> <span class="n">query_wait_interval</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">spark_libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">spark_libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_sql_kafka&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">spark_libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Code is from Azure Eventhub Python SDK. Will import the package if possible with Conda in the  conda-forge channel in the future</span>
    <span class="k">def</span> <span class="nf">_parse_connection_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">conn_settings</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">connection_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">conn_settings</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Connection string is either blank or malformed.&quot;</span><span class="p">)</span>
        <span class="n">conn_settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">conn_settings</span><span class="p">)</span>
        <span class="n">shared_access_signature</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">conn_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sharedaccesssignature&quot;</span><span class="p">:</span>
                <span class="n">shared_access_signature</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">shared_access_key</span> <span class="o">=</span> <span class="n">conn_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SharedAccessKey&quot;</span><span class="p">)</span>
        <span class="n">shared_access_key_name</span> <span class="o">=</span> <span class="n">conn_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SharedAccessKeyName&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">shared_access_key</span><span class="p">,</span> <span class="n">shared_access_key_name</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="n">shared_access_key</span><span class="p">,</span> <span class="n">shared_access_key_name</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Connection string must have both SharedAccessKeyName and SharedAccessKey.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">shared_access_signature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">shared_access_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Only one of the SharedAccessKey or SharedAccessSignature must be present.&quot;</span>
            <span class="p">)</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="n">conn_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Endpoint&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Connection string is either blank or malformed.&quot;</span><span class="p">)</span>
        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">endpoint</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed</span><span class="o">.</span><span class="n">netloc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Endpoint on the Connection String.&quot;</span><span class="p">)</span>
        <span class="n">namespace</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">netloc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;fully_qualified_namespace&quot;</span><span class="p">:</span> <span class="n">namespace</span><span class="p">,</span>
            <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span> <span class="n">endpoint</span><span class="p">,</span>
            <span class="s2">&quot;eventhub_name&quot;</span><span class="p">:</span> <span class="n">conn_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;EntityPath&quot;</span><span class="p">),</span>
            <span class="s2">&quot;shared_access_signature&quot;</span><span class="p">:</span> <span class="n">shared_access_signature</span><span class="p">,</span>
            <span class="s2">&quot;shared_access_key_name&quot;</span><span class="p">:</span> <span class="n">shared_access_key_name</span><span class="p">,</span>
            <span class="s2">&quot;shared_access_key&quot;</span><span class="p">:</span> <span class="n">shared_access_key</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">properties</span>

    <span class="k">def</span> <span class="nf">_connection_string_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">connection_string</span> <span class="o">=</span> <span class="s2">&quot;Endpoint=&quot;</span> <span class="o">+</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;endpoint&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>

        <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shared_access_key&quot;</span><span class="p">):</span>
            <span class="n">connection_string</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;SharedAccessKey=&quot;</span> <span class="o">+</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shared_access_key&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shared_access_key_name&quot;</span><span class="p">):</span>
            <span class="n">connection_string</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;SharedAccessKeyName=&quot;</span> <span class="o">+</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shared_access_key_name&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shared_access_signature&quot;</span><span class="p">):</span>
            <span class="n">connection_string</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;SharedAccessSignature=&quot;</span>
                <span class="o">+</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shared_access_signature&quot;</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">connection_string</span>

    <span class="k">def</span> <span class="nf">_configure_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;topic&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;topic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_string_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;eventhub_name&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.bootstrap.servers&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.bootstrap.servers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_string_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fully_qualified_namespace&quot;</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;:9093&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.sasl.mechanism&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.sasl.mechanism&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PLAIN&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.security.protocol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.security.protocol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SASL_SSL&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.sasl.jaas.config&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">kafka_package</span> <span class="o">=</span> <span class="s2">&quot;org.apache.kafka.common.security.plain.PlainLoginModule&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;DATABRICKS_RUNTIME_VERSION&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="s2">&quot;_client&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="vm">__dict__</span>
                <span class="ow">and</span> <span class="s2">&quot;databricks&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">host</span>
            <span class="p">):</span>
                <span class="n">kafka_package</span> <span class="o">=</span> <span class="s2">&quot;kafkashaded.org.apache.kafka.common.security.plain.PlainLoginModule&quot;</span>
            <span class="n">connection_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_string_builder</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_string_properties</span>
            <span class="p">)</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.sasl.jaas.config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> required username=&quot;$ConnectionString&quot; password=&quot;</span><span class="si">{}</span><span class="s1">&quot;;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">kafka_package</span><span class="p">,</span> <span class="n">connection_string</span>
                <span class="p">)</span>
            <span class="p">)</span>  <span class="c1"># NOSONAR</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.request.timeout.ms&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.request.timeout.ms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;60000&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.session.timeout.ms&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.session.timeout.ms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;60000&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;kafka.group.id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;kafka.group.id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer_group</span>

        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;includeHeaders&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>

        <span class="k">return</span> <span class="n">options</span>

    <span class="k">def</span> <span class="nf">_transform_to_eventhub_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">column_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;headers&quot;</span><span class="p">,</span> <span class="s2">&quot;topic&quot;</span><span class="p">,</span> <span class="s2">&quot;partition&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;value&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;value&quot;</span><span class="p">,</span>
                <span class="n">to_json</span><span class="p">(</span>
                    <span class="n">struct</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">col</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
                            <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">column_list</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;headers&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="s2">&quot;headers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dataType</span><span class="o">.</span><span class="n">elementType</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nullable</span> <span class="o">==</span> <span class="kc">True</span>
            <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="s2">&quot;headers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dataType</span><span class="o">.</span><span class="n">elementType</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nullable</span> <span class="o">==</span> <span class="kc">True</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;key and value in the headers column cannot be nullable&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">column</span>
                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;headers&quot;</span><span class="p">,</span> <span class="s2">&quot;topic&quot;</span><span class="p">,</span> <span class="s2">&quot;partition&quot;</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads batch data from Kafka.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_to_eventhub_schema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads streaming data from Kafka.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_to_eventhub_schema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">df</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
                <span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/kafka_eventhub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination.write_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads batch data from Kafka.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/kafka_eventhub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads batch data from Kafka.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_to_eventhub_schema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkKafkaEventhubDestination.write_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reads streaming data from Kafka.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/spark/kafka_eventhub.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads streaming data from Kafka.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_to_eventhub_schema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">TRIGGER_OPTION</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;availableNow&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">==</span> <span class="s2">&quot;availableNow&quot;</span>
            <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;processingTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">writeStream</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="o">**</span><span class="n">TRIGGER_OPTION</span><span class="p">)</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;kafka&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">.</span><span class="n">queryName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_name</span><span class="p">)</span>
            <span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">isActive</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastProgress</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_wait_interval</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination" class="doc doc-heading">
            <code>EVMContractDestination</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.destinations.interfaces.DestinationInterface">DestinationInterface</span></code></p>


      <p>The EVM Contract Destination is used to write to a smart contract blockchain.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination--examples">Examples</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">EVMContractDestination</span>

<span class="n">evm_contract_destination</span> <span class="o">=</span> <span class="n">EVMContractDestination</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://polygon-mumbai.g.alchemy.com/v2/⟨API_KEY⟩&quot;</span><span class="p">,</span>
    <span class="n">account</span><span class="o">=</span><span class="s2">&quot;{ACCOUNT-ADDRESS}&quot;</span><span class="p">,</span>
    <span class="n">private_key</span><span class="o">=</span><span class="s2">&quot;{PRIVATE-KEY}&quot;</span><span class="p">,</span>
    <span class="n">abi</span><span class="o">=</span><span class="s2">&quot;{SMART-CONTRACT&#39;S-ABI}&quot;</span><span class="p">,</span>
    <span class="n">contract</span><span class="o">=</span><span class="s2">&quot;{SMART-CONTRACT-ADDRESS}&quot;</span><span class="p">,</span>
    <span class="n">function_name</span><span class="o">=</span><span class="s2">&quot;{SMART-CONTRACT-FUNCTION}&quot;</span><span class="p">,</span>
    <span class="n">function_params</span><span class="o">=</span><span class="p">({</span><span class="n">PARAMETER_1</span><span class="p">},</span> <span class="p">{</span><span class="n">PARAMETER_2</span><span class="p">},</span> <span class="p">{</span><span class="n">PARAMETER_3</span><span class="p">}),</span>
    <span class="n">transaction</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gas&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">GAS</span><span class="p">},</span> <span class="s1">&#39;gasPrice&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">GAS</span><span class="o">-</span><span class="n">PRICE</span><span class="p">}},</span>
<span class="p">)</span>

<span class="n">evm_contract_destination</span><span class="o">.</span><span class="n">write_batch</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>url</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Blockchain network URL e.g. 'https://polygon-mumbai.g.alchemy.com/v2/⟨API_KEY⟩'</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>account</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Address of the sender that will be signing the transaction.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>private_key</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Private key for your blockchain account.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>abi</code></td>
            <td>
                  <code>json str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Smart contract's ABI.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>contract</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Address of the smart contract.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>function_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Smart contract method to call on.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>function_params</code></td>
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters of given function.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>transaction</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing a set of instructions to interact with a smart contract deployed on the blockchain (See common parameters in Attributes table below).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination.data">data</span></code></td>
            <td>
                  <code>hexadecimal str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional information store in the transaction.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination.from">from</span></code></td>
            <td>
                  <code>hexadecimal str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Address of sender for a transaction.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination.gas">gas</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Amount of gas units to perform a transaction.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination.gasPrice">gasPrice</span></code></td>
            <td>
                  <code>int Wei</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Price to pay for each unit of gas. Integers are specified in Wei, web3's to_wei function can be used to specify the amount in a different currency.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination.nonce">nonce</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of transactions sent from a given address.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination.to">to</span></code></td>
            <td>
                  <code>hexadecimal str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Address of recipient for a transaction.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination.value">value</span></code></td>
            <td>
                  <code>int Wei</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value being transferred in a transaction. Integers are specified in Wei, web3's to_wei function can be used to specify the amount in a different currency.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/blockchain/evm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EVMContractDestination</span><span class="p">(</span><span class="n">DestinationInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The EVM Contract Destination is used to write to a smart contract blockchain.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.destinations import EVMContractDestination</span>

<span class="sd">    evm_contract_destination = EVMContractDestination(</span>
<span class="sd">        url=&quot;https://polygon-mumbai.g.alchemy.com/v2/⟨API_KEY⟩&quot;,</span>
<span class="sd">        account=&quot;{ACCOUNT-ADDRESS}&quot;,</span>
<span class="sd">        private_key=&quot;{PRIVATE-KEY}&quot;,</span>
<span class="sd">        abi=&quot;{SMART-CONTRACT&#39;S-ABI}&quot;,</span>
<span class="sd">        contract=&quot;{SMART-CONTRACT-ADDRESS}&quot;,</span>
<span class="sd">        function_name=&quot;{SMART-CONTRACT-FUNCTION}&quot;,</span>
<span class="sd">        function_params=({PARAMETER_1}, {PARAMETER_2}, {PARAMETER_3}),</span>
<span class="sd">        transaction={&#39;gas&#39;: {GAS}, &#39;gasPrice&#39;: {GAS-PRICE}},</span>
<span class="sd">    )</span>

<span class="sd">    evm_contract_destination.write_batch()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        url (str): Blockchain network URL e.g. &#39;https://polygon-mumbai.g.alchemy.com/v2/⟨API_KEY⟩&#39;</span>
<span class="sd">        account (str): Address of the sender that will be signing the transaction.</span>
<span class="sd">        private_key (str): Private key for your blockchain account.</span>
<span class="sd">        abi (json str): Smart contract&#39;s ABI.</span>
<span class="sd">        contract (str): Address of the smart contract.</span>
<span class="sd">        function_name (str): Smart contract method to call on.</span>
<span class="sd">        function_params (tuple): Parameters of given function.</span>
<span class="sd">        transaction (dict): A dictionary containing a set of instructions to interact with a smart contract deployed on the blockchain (See common parameters in Attributes table below).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        data (hexadecimal str): Additional information store in the transaction.</span>
<span class="sd">        from (hexadecimal str): Address of sender for a transaction.</span>
<span class="sd">        gas (int): Amount of gas units to perform a transaction.</span>
<span class="sd">        gasPrice (int Wei): Price to pay for each unit of gas. Integers are specified in Wei, web3&#39;s to_wei function can be used to specify the amount in a different currency.</span>
<span class="sd">        nonce (int): The number of transactions sent from a given address.</span>
<span class="sd">        to (hexadecimal str): Address of recipient for a transaction.</span>
<span class="sd">        value (int Wei): Value being transferred in a transaction. Integers are specified in Wei, web3&#39;s to_wei function can be used to specify the amount in a different currency.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">account</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">abi</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">contract</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">function_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">function_params</span><span class="p">:</span> <span class="nb">tuple</span>
    <span class="n">transaction</span><span class="p">:</span> <span class="nb">dict</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">abi</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">contract</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">function_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">function_params</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">transaction</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">account</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">private_key</span> <span class="o">=</span> <span class="n">private_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abi</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">abi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract</span> <span class="o">=</span> <span class="n">contract</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="n">function_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_params</span> <span class="o">=</span> <span class="n">function_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transaction</span> <span class="o">=</span> <span class="n">transaction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">web3</span> <span class="o">=</span> <span class="n">Web3</span><span class="p">(</span><span class="n">Web3</span><span class="o">.</span><span class="n">HTTPProvider</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_process_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;nonce&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transaction</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">nonce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_transaction_count</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">account</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transaction</span><span class="p">[</span><span class="s2">&quot;nonce&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nonce</span>
        <span class="k">if</span> <span class="s2">&quot;from&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transaction</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transaction</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">account</span>

    <span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes to a smart contract deployed in a blockchain and returns the transaction hash.</span>

<span class="sd">        Example:</span>
<span class="sd">        ```</span>
<span class="sd">        from web3 import Web3</span>

<span class="sd">        web3 = Web3(Web3.HTTPProvider(&quot;https://polygon-mumbai.g.alchemy.com/v2/&lt;API_KEY&gt;&quot;))</span>

<span class="sd">        x = EVMContractDestination(</span>
<span class="sd">                            url=&quot;https://polygon-mumbai.g.alchemy.com/v2/&lt;API_KEY&gt;&quot;,</span>
<span class="sd">                            account=&#39;&lt;ACCOUNT&gt;&#39;,</span>
<span class="sd">                            private_key=&#39;&lt;PRIVATE_KEY&gt;&#39;,</span>
<span class="sd">                            contract=&#39;&lt;CONTRACT&gt;&#39;,</span>
<span class="sd">                            function_name=&#39;transferFrom&#39;,</span>
<span class="sd">                            function_params=(&#39;&lt;FROM_ACCOUNT&gt;&#39;, &#39;&lt;TO_ACCOUNT&gt;&#39;, 0),</span>
<span class="sd">                            abi = &#39;ABI&#39;,</span>
<span class="sd">                            transaction={</span>
<span class="sd">                                &#39;gas&#39;: 100000,</span>
<span class="sd">                                &#39;gasPrice&#39;: 1000000000 # or web3.to_wei(&#39;1&#39;, &#39;gwei&#39;)</span>
<span class="sd">                                },</span>
<span class="sd">                            )</span>

<span class="sd">        print(x.write_batch())</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contract</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">contract</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_process_transaction</span><span class="p">()</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">](</span>
            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">function_params</span>
        <span class="p">)</span><span class="o">.</span><span class="n">build_transaction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transaction</span><span class="p">)</span>

        <span class="n">signed_tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">sign_transaction</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">private_key</span><span class="p">)</span>
        <span class="n">tx_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">send_raw_transaction</span><span class="p">(</span><span class="n">signed_tx</span><span class="o">.</span><span class="n">rawTransaction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">wait_for_transaction_receipt</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">web3</span><span class="o">.</span><span class="n">to_hex</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: Write stream is not supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;EVMContractDestination only supports batch writes.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination.write_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes to a smart contract deployed in a blockchain and returns the transaction hash.</p>
<p>Example:
<div class="highlight"><pre><span></span><code>from web3 import Web3

web3 = Web3(Web3.HTTPProvider(&quot;https://polygon-mumbai.g.alchemy.com/v2/&lt;API_KEY&gt;&quot;))

x = EVMContractDestination(
                    url=&quot;https://polygon-mumbai.g.alchemy.com/v2/&lt;API_KEY&gt;&quot;,
                    account=&#39;&lt;ACCOUNT&gt;&#39;,
                    private_key=&#39;&lt;PRIVATE_KEY&gt;&#39;,
                    contract=&#39;&lt;CONTRACT&gt;&#39;,
                    function_name=&#39;transferFrom&#39;,
                    function_params=(&#39;&lt;FROM_ACCOUNT&gt;&#39;, &#39;&lt;TO_ACCOUNT&gt;&#39;, 0),
                    abi = &#39;ABI&#39;,
                    transaction={
                        &#39;gas&#39;: 100000,
                        &#39;gasPrice&#39;: 1000000000 # or web3.to_wei(&#39;1&#39;, &#39;gwei&#39;)
                        },
                    )

print(x.write_batch())
</code></pre></div></p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/blockchain/evm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes to a smart contract deployed in a blockchain and returns the transaction hash.</span>

<span class="sd">    Example:</span>
<span class="sd">    ```</span>
<span class="sd">    from web3 import Web3</span>

<span class="sd">    web3 = Web3(Web3.HTTPProvider(&quot;https://polygon-mumbai.g.alchemy.com/v2/&lt;API_KEY&gt;&quot;))</span>

<span class="sd">    x = EVMContractDestination(</span>
<span class="sd">                        url=&quot;https://polygon-mumbai.g.alchemy.com/v2/&lt;API_KEY&gt;&quot;,</span>
<span class="sd">                        account=&#39;&lt;ACCOUNT&gt;&#39;,</span>
<span class="sd">                        private_key=&#39;&lt;PRIVATE_KEY&gt;&#39;,</span>
<span class="sd">                        contract=&#39;&lt;CONTRACT&gt;&#39;,</span>
<span class="sd">                        function_name=&#39;transferFrom&#39;,</span>
<span class="sd">                        function_params=(&#39;&lt;FROM_ACCOUNT&gt;&#39;, &#39;&lt;TO_ACCOUNT&gt;&#39;, 0),</span>
<span class="sd">                        abi = &#39;ABI&#39;,</span>
<span class="sd">                        transaction={</span>
<span class="sd">                            &#39;gas&#39;: 100000,</span>
<span class="sd">                            &#39;gasPrice&#39;: 1000000000 # or web3.to_wei(&#39;1&#39;, &#39;gwei&#39;)</span>
<span class="sd">                            },</span>
<span class="sd">                        )</span>

<span class="sd">    print(x.write_batch())</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contract</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">contract</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_process_transaction</span><span class="p">()</span>
    <span class="n">tx</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">](</span>
        <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">function_params</span>
    <span class="p">)</span><span class="o">.</span><span class="n">build_transaction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transaction</span><span class="p">)</span>

    <span class="n">signed_tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">sign_transaction</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">private_key</span><span class="p">)</span>
    <span class="n">tx_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">send_raw_transaction</span><span class="p">(</span><span class="n">signed_tx</span><span class="o">.</span><span class="n">rawTransaction</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">wait_for_transaction_receipt</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">web3</span><span class="o">.</span><span class="n">to_hex</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.EVMContractDestination.write_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>NotImplementedError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Write stream is not supported.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/blockchain/evm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: Write stream is not supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;EVMContractDestination only supports batch writes.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination" class="doc doc-heading">
            <code>PythonDeltaDestination</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.destinations.interfaces.DestinationInterface">DestinationInterface</span></code></p>


      <p>The Python Delta Destination is used to write data to a Delta table from a Polars LazyFrame.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination--example">Example</h4>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination--__tabbed_1_1" name="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination--__tabbed_1" type="radio" /><input id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination--__tabbed_1_2" name="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination--__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination--__tabbed_1_1">Azure</label><label for="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination--__tabbed_1_2">AWS</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">PythonDeltaDestination</span>

<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;abfss://{FILE-SYSTEM}@{ACCOUNT-NAME}.dfs.core.windows.net/</span><span class="si">{PATH}</span><span class="s2">/{FILE-NAME}</span>

<span class="n">python_delta_destination</span> <span class="o">=</span> <span class="n">PythonDeltaDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">LazyFrame</span>
    <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
    <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;azure_storage_account_name&quot;</span><span class="p">:</span> <span class="s2">&quot;{AZURE-STORAGE-ACCOUNT-NAME}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;azure_storage_account_key&quot;</span><span class="p">:</span> <span class="s2">&quot;{AZURE-STORAGE-ACCOUNT-KEY}&quot;</span>
    <span class="p">},</span>
    <span class="n">mode</span><span class="o">=</span><span class="p">:</span><span class="n">error</span><span class="s2">&quot;,</span>
    <span class="n">overwrite_schema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">delta_write_options</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">python_delta_destination</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.destinations</span> <span class="kn">import</span> <span class="n">PythonDeltaDestination</span>

<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;https://s3.{REGION-CODE}.amazonaws.com/{BUCKET-NAME}/{KEY-NAME}&quot;</span>

<span class="n">python_delta_destination</span> <span class="o">=</span> <span class="n">PythonDeltaDestination</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">LazyFrame</span>
    <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;aws_access_key_id&quot;</span><span class="p">:</span> <span class="s2">&quot;{AWS-ACCESS-KEY-ID}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aws_secret_access_key&quot;</span><span class="p">:</span> <span class="s2">&quot;{AWS-SECRET-ACCESS-KEY}&quot;</span>
    <span class="p">},</span>
    <span class="n">mode</span><span class="o">=</span><span class="p">:</span><span class="n">error</span><span class="s2">&quot;,</span>
    <span class="n">overwrite_schema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">delta_write_options</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">python_delta_destination</span><span class="o">.</span><span class="n">read_batch</span><span class="p">()</span>
</code></pre></div>
</div>
</div>
</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="polars.LazyFrame">LazyFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Polars LazyFrame to be written to Delta</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to Delta table to be written to; either local or <a href="https://delta-io.github.io/delta-rs/python/usage.html#loading-a-delta-table" target="_blank">remote</a>. <strong>Locally</strong> if the Table does't exist one will be created, but to write to AWS or Azure, you must have an existing Delta Table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>options</code></td>
            <td>
                  <code>Optional dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Used if writing to a remote location. For AWS use format {"aws_access_key_id": "&lt;&gt;", "aws_secret_access_key": "&lt;&gt;"}. For Azure use format {"azure_storage_account_name": "storageaccountname", "azure_storage_access_key": "&lt;&gt;"}</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mode</code></td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;error&#39;, &#39;append&#39;, &#39;overwrite&#39;, &#39;ignore&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Defaults to error if table exists, 'ignore' won't write anything if table exists</p>
              </div>
            </td>
            <td>
                  <code>&#39;error&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>overwrite_schema</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True will allow for the table schema to be overwritten</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>delta_write_options</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Options when writing to a Delta table. See <a href="https://delta-io.github.io/delta-rs/python/api_reference.html#writing-deltatables" target="_blank">here</a> for all options</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/python/delta.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PythonDeltaDestination</span><span class="p">(</span><span class="n">DestinationInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Python Delta Destination is used to write data to a Delta table from a Polars LazyFrame.</span>

<span class="sd">     Example</span>
<span class="sd">    --------</span>
<span class="sd">    === &quot;Azure&quot;</span>

<span class="sd">        ```python</span>
<span class="sd">        from rtdip_sdk.pipelines.destinations import PythonDeltaDestination</span>

<span class="sd">        path = &quot;abfss://{FILE-SYSTEM}@{ACCOUNT-NAME}.dfs.core.windows.net/{PATH}/{FILE-NAME}</span>

<span class="sd">        python_delta_destination = PythonDeltaDestination(</span>
<span class="sd">            data=LazyFrame</span>
<span class="sd">            path=path,</span>
<span class="sd">            storage_options={</span>
<span class="sd">                &quot;azure_storage_account_name&quot;: &quot;{AZURE-STORAGE-ACCOUNT-NAME}&quot;,</span>
<span class="sd">                &quot;azure_storage_account_key&quot;: &quot;{AZURE-STORAGE-ACCOUNT-KEY}&quot;</span>
<span class="sd">            },</span>
<span class="sd">            mode=:error&quot;,</span>
<span class="sd">            overwrite_schema=False,</span>
<span class="sd">            delta_write_options=None</span>
<span class="sd">        )</span>

<span class="sd">        python_delta_destination.read_batch()</span>

<span class="sd">        ```</span>
<span class="sd">    === &quot;AWS&quot;</span>

<span class="sd">        ```python</span>
<span class="sd">        from rtdip_sdk.pipelines.destinations import PythonDeltaDestination</span>

<span class="sd">        path = &quot;https://s3.{REGION-CODE}.amazonaws.com/{BUCKET-NAME}/{KEY-NAME}&quot;</span>

<span class="sd">        python_delta_destination = PythonDeltaDestination(</span>
<span class="sd">            data=LazyFrame</span>
<span class="sd">            path=path,</span>
<span class="sd">            options={</span>
<span class="sd">                &quot;aws_access_key_id&quot;: &quot;{AWS-ACCESS-KEY-ID}&quot;,</span>
<span class="sd">                &quot;aws_secret_access_key&quot;: &quot;{AWS-SECRET-ACCESS-KEY}&quot;</span>
<span class="sd">            },</span>
<span class="sd">            mode=:error&quot;,</span>
<span class="sd">            overwrite_schema=False,</span>
<span class="sd">            delta_write_options=None</span>
<span class="sd">        )</span>

<span class="sd">        python_delta_destination.read_batch()</span>
<span class="sd">        ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (LazyFrame): Polars LazyFrame to be written to Delta</span>
<span class="sd">        path (str): Path to Delta table to be written to; either local or [remote](https://delta-io.github.io/delta-rs/python/usage.html#loading-a-delta-table){ target=&quot;_blank&quot; }. **Locally** if the Table does&#39;t exist one will be created, but to write to AWS or Azure, you must have an existing Delta Table</span>
<span class="sd">        options (Optional dict): Used if writing to a remote location. For AWS use format {&quot;aws_access_key_id&quot;: &quot;&lt;&gt;&quot;, &quot;aws_secret_access_key&quot;: &quot;&lt;&gt;&quot;}. For Azure use format {&quot;azure_storage_account_name&quot;: &quot;storageaccountname&quot;, &quot;azure_storage_access_key&quot;: &quot;&lt;&gt;&quot;}</span>
<span class="sd">        mode (Literal[&#39;error&#39;, &#39;append&#39;, &#39;overwrite&#39;, &#39;ignore&#39;]): Defaults to error if table exists, &#39;ignore&#39; won&#39;t write anything if table exists</span>
<span class="sd">        overwrite_schema (bool): If True will allow for the table schema to be overwritten</span>
<span class="sd">        delta_write_options (dict): Options when writing to a Delta table. See [here](https://delta-io.github.io/delta-rs/python/api_reference.html#writing-deltatables){ target=&quot;_blank&quot; } for all options</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">:</span> <span class="n">LazyFrame</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">]</span>
    <span class="n">overwrite_schema</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">delta_write_options</span><span class="p">:</span> <span class="nb">dict</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">LazyFrame</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
        <span class="n">overwrite_schema</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">delta_write_options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overwrite_schema</span> <span class="o">=</span> <span class="n">overwrite_schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_write_options</span> <span class="o">=</span> <span class="n">delta_write_options</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYTHON</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">pre_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">post_write_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes batch data to Delta without using Spark.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">write_delta</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
                <span class="n">overwrite_schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overwrite_schema</span><span class="p">,</span>
                <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
                <span class="n">delta_write_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_write_options</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Data must be a Polars LazyFrame. See https://pola-rs.github.io/polars/py-polars/html/reference/lazyframe/index.html&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: Writing to a Delta table using Python is only possible for batch writes. To perform a streaming read, use the write_stream method of the SparkDeltaDestination component.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Writing to a Delta table using Python is only possible for batch writes. To perform a streaming read, use the write_stream method of the SparkDeltaDestination component&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYTHON</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/python/delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYTHON</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination.write_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_batch</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Writes batch data to Delta without using Spark.</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/python/delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes batch data to Delta without using Spark.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">write_delta</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">overwrite_schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overwrite_schema</span><span class="p">,</span>
            <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
            <span class="n">delta_write_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_write_options</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Data must be a Polars LazyFrame. See https://pola-rs.github.io/polars/py-polars/html/reference/lazyframe/index.html&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PythonDeltaDestination.write_stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_stream</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>NotImplementedError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Writing to a Delta table using Python is only possible for batch writes. To perform a streaming read, use the write_stream method of the SparkDeltaDestination component.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/destinations/python/delta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: Writing to a Delta table using Python is only possible for batch writes. To perform a streaming read, use the write_stream method of the SparkDeltaDestination component.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="s2">&quot;Writing to a Delta table using Python is only possible for batch writes. To perform a streaming read, use the write_stream method of the SparkDeltaDestination component&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets" class="doc doc-heading">
            <code>DatabricksSecrets</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.secrets.interfaces.SecretsInterface">SecretsInterface</span></code></p>


      <p>Retrieves secrets from Databricks Secret Scopes. For more information about Databricks Secret Scopes, see <a href="https://docs.databricks.com/security/secrets/secret-scopes.html">here.</a></p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Reads Secrets from Databricks Secret Scopes</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.secrets</span> <span class="kn">import</span> <span class="n">DatabricksSecrets</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">get_databricks_secret</span> <span class="o">=</span> <span class="n">DatabricksSecrets</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">vault</span><span class="o">=</span><span class="s2">&quot;{NAME-OF-DATABRICKS-SECRET-SCOPE}&quot;</span>
    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;{KEY-NAME-OF-SECRET}&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">get_databricks_secret</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session required to read data from a Delta table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>vault</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the Databricks Secret Scope</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>key</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name/Key of the secret in the Databricks Secret Scope</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/secrets/databricks.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DatabricksSecrets</span><span class="p">(</span><span class="n">SecretsInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves secrets from Databricks Secret Scopes. For more information about Databricks Secret Scopes, see [here.](https://docs.databricks.com/security/secrets/secret-scopes.html)</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    ```python</span>
<span class="sd">    # Reads Secrets from Databricks Secret Scopes</span>

<span class="sd">    from rtdip_sdk.pipelines.secrets import DatabricksSecrets</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    get_databricks_secret = DatabricksSecrets(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        vault=&quot;{NAME-OF-DATABRICKS-SECRET-SCOPE}&quot;</span>
<span class="sd">        key=&quot;{KEY-NAME-OF-SECRET}&quot;,</span>
<span class="sd">    )</span>

<span class="sd">    get_databricks_secret.get()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark: Spark Session required to read data from a Delta table</span>
<span class="sd">        vault: Name of the Databricks Secret Scope</span>
<span class="sd">        key: Name/Key of the secret in the Databricks Secret Scope</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">vault</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">vault</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vault</span> <span class="o">=</span> <span class="n">vault</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK on Databricks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK_DATABRICKS</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the secret from the Databricks Secret Scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dbutils</span> <span class="o">=</span> <span class="n">get_dbutils</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dbutils</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vault</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the secret in the Secret Scope</span>
<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: Will be implemented at a later point in time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK on Databricks</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/secrets/databricks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK on Databricks</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK_DATABRICKS</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Retrieves the secret from the Databricks Secret Scope</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/secrets/databricks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the secret from the Databricks Secret Scope</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dbutils</span> <span class="o">=</span> <span class="n">get_dbutils</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dbutils</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vault</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DatabricksSecrets.set" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">set</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Sets the secret in the Secret Scope
Raises:
    NotImplementedError: Will be implemented at a later point in time</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/secrets/databricks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets the secret in the Secret Scope</span>
<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: Will be implemented at a later point in time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets" class="doc doc-heading">
            <code>HashiCorpVaultSecrets</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.secrets.interfaces.SecretsInterface">SecretsInterface</span></code></p>


      <p>Retrieves and creates/updates secrets in a Hashicorp Vault. For more information about Hashicorp Vaults, see <a href="https://developer.hashicorp.com/vault/docs/get-started/developer-qs">here.</a></p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets--example">Example</h4>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Retrieves Secrets from HashiCorp Vault</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.secrets</span> <span class="kn">import</span> <span class="n">HashiCorpVaultSecrets</span>

<span class="n">get_hashicorp_secret</span> <span class="o">=</span> <span class="n">HashiCorpVaultSecrets</span><span class="p">(</span>
    <span class="n">vault</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1:8200&quot;</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{KEY}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">secret</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">credential</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{CREDENTIAL}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">get_hashicorp_secret</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Creates or Updates Secrets in Hashicorp Vault</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.secrets</span> <span class="kn">import</span> <span class="n">HashiCorpVaultSecrets</span>

<span class="n">set_hashicorp_secret</span> <span class="o">=</span> <span class="n">AzureKeyVaultSecrets</span><span class="p">(</span>
    <span class="n">vault</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1:8200&quot;</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{KEY}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">secret</span><span class="o">=</span><span class="s2">&quot;{SECRET-TO-BE-SET}&quot;</span><span class="p">,</span>
    <span class="n">credential</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{CREDENTIAL}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">set_hashicorp_secret</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>vault</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hashicorp Vault URL</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>key</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name/Key of the secret in the Hashicorp Vault</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>secret</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Secret or Password to be stored in the Hashicorp Vault</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>credential</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Token for authentication with the Hashicorp Vault</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>kwargs</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of additional parameters to be passed when creating a Hashicorp Vault Client. Please see <a href="https://hvac.readthedocs.io/en/stable/overview.html#initialize-the-client">here</a> for more details on parameters that can be provided to the client</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/secrets/hashicorp_vault.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HashiCorpVaultSecrets</span><span class="p">(</span><span class="n">SecretsInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves and creates/updates secrets in a Hashicorp Vault. For more information about Hashicorp Vaults, see [here.](https://developer.hashicorp.com/vault/docs/get-started/developer-qs)</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    ```python</span>
<span class="sd">    # Retrieves Secrets from HashiCorp Vault</span>

<span class="sd">    from rtdip_sdk.pipelines.secrets import HashiCorpVaultSecrets</span>

<span class="sd">    get_hashicorp_secret = HashiCorpVaultSecrets(</span>
<span class="sd">        vault=&quot;http://127.0.0.1:8200&quot;,</span>
<span class="sd">        key=&quot;{KEY}&quot;,</span>
<span class="sd">        secret=None,</span>
<span class="sd">        credential=&quot;{CREDENTIAL}&quot;,</span>
<span class="sd">        kwargs=None</span>
<span class="sd">    )</span>

<span class="sd">    get_hashicorp_secret.get()</span>

<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">    # Creates or Updates Secrets in Hashicorp Vault</span>

<span class="sd">    from rtdip_sdk.pipelines.secrets import HashiCorpVaultSecrets</span>

<span class="sd">    set_hashicorp_secret = AzureKeyVaultSecrets(</span>
<span class="sd">        vault=&quot;http://127.0.0.1:8200&quot;,</span>
<span class="sd">        key=&quot;{KEY}&quot;,</span>
<span class="sd">        secret=&quot;{SECRET-TO-BE-SET}&quot;,</span>
<span class="sd">        credential=&quot;{CREDENTIAL}&quot;,</span>
<span class="sd">        kwargs=None</span>
<span class="sd">    )</span>

<span class="sd">    set_hashicorp_secret.set()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        vault (str): Hashicorp Vault URL</span>
<span class="sd">        key (str): Name/Key of the secret in the Hashicorp Vault</span>
<span class="sd">        secret (str): Secret or Password to be stored in the Hashicorp Vault</span>
<span class="sd">        credential (str): Token for authentication with the Hashicorp Vault</span>
<span class="sd">        kwargs (dict): List of additional parameters to be passed when creating a Hashicorp Vault Client. Please see [here](https://hvac.readthedocs.io/en/stable/overview.html#initialize-the-client) for more details on parameters that can be provided to the client</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">vault</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">credential</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">vault</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">credential</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="p">):</span>  <span class="c1"># NOSONAR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vault</span> <span class="o">=</span> <span class="n">vault</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secret</span> <span class="o">=</span> <span class="n">secret</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">credential</span> <span class="o">=</span> <span class="n">credential</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_hvac_client</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYTHON</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_pypi_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;hashicorp_vault&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_get_hvac_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">hvac</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vault</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credential</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the secret from the Hashicorp Vault</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">kv</span><span class="o">.</span><span class="n">read_secret_version</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;password&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates or updates a secret in the Hashicorp Vault</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">kv</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">create_or_update_secret</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
            <span class="n">secret</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYTHON</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/secrets/hashicorp_vault.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYTHON</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Retrieves the secret from the Hashicorp Vault</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/secrets/hashicorp_vault.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the secret from the Hashicorp Vault</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">kv</span><span class="o">.</span><span class="n">read_secret_version</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;password&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.HashiCorpVaultSecrets.set" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">set</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Creates or updates a secret in the Hashicorp Vault</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/secrets/hashicorp_vault.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates or updates a secret in the Hashicorp Vault</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">kv</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">create_or_update_secret</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
        <span class="n">secret</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets" class="doc doc-heading">
            <code>AzureKeyVaultSecrets</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.secrets.interfaces.SecretsInterface">SecretsInterface</span></code></p>


      <p>Retrieves and creates/updates secrets in Azure Key Vault. For more information about Azure Key Vaults, see <a href="https://learn.microsoft.com/en-gb/azure/key-vault/general/overview">here.</a></p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets--example">Example</h4>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Retrieves Secrets from Azure Key Vault</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.secrets</span> <span class="kn">import</span> <span class="n">AzureKeyVaultSecrets</span>

<span class="n">get_key_vault_secret</span> <span class="o">=</span> <span class="n">AzureKeyVaultSecrets</span><span class="p">(</span>
    <span class="n">vault</span><span class="o">=</span><span class="s2">&quot;https://{YOUR-KEY-VAULT}.azure.net/&quot;</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{KEY}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">secret</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">credential</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{CREDENTIAL}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">get_key_vault_secret</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Creates or Updates Secrets in Azure Key Vault</span>

<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.secrets</span> <span class="kn">import</span> <span class="n">AzureKeyVaultSecrets</span>

<span class="n">set_key_vault_secret</span> <span class="o">=</span> <span class="n">AzureKeyVaultSecrets</span><span class="p">(</span>
    <span class="n">vault</span><span class="o">=</span><span class="s2">&quot;https://{YOUR-KEY-VAULT}.azure.net/&quot;</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{KEY}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">secret</span><span class="o">=</span><span class="s2">&quot;{SECRET-TO-BE-SET}&quot;</span><span class="p">,</span>
    <span class="n">credential</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{CREDENTIAL}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">set_key_vault_secret</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>vault</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Azure Key Vault URL</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>key</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Key for the secret</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>secret</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Secret or Password to be set in the Azure Key Vault</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>credential</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Credential for authenticating with Azure Key Vault</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>kwargs</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of additional parameters to be passed when creating a Azure Key Vault Client. Please see <a href="https://github.com/Azure/azure-sdk-for-python/tree/main/sdk/keyvault/azure-keyvault-secrets">here</a> for more details on parameters that can be provided to the client</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/secrets/azure_key_vault.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AzureKeyVaultSecrets</span><span class="p">(</span><span class="n">SecretsInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves and creates/updates secrets in Azure Key Vault. For more information about Azure Key Vaults, see [here.](https://learn.microsoft.com/en-gb/azure/key-vault/general/overview)</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    ```python</span>
<span class="sd">    # Retrieves Secrets from Azure Key Vault</span>

<span class="sd">    from rtdip_sdk.pipelines.secrets import AzureKeyVaultSecrets</span>

<span class="sd">    get_key_vault_secret = AzureKeyVaultSecrets(</span>
<span class="sd">        vault=&quot;https://{YOUR-KEY-VAULT}.azure.net/&quot;,</span>
<span class="sd">        key=&quot;{KEY}&quot;,</span>
<span class="sd">        secret=None,</span>
<span class="sd">        credential=&quot;{CREDENTIAL}&quot;,</span>
<span class="sd">        kwargs=None</span>
<span class="sd">    )</span>

<span class="sd">    get_key_vault_secret.get()</span>

<span class="sd">    ```</span>
<span class="sd">    ```python</span>
<span class="sd">    # Creates or Updates Secrets in Azure Key Vault</span>

<span class="sd">    from rtdip_sdk.pipelines.secrets import AzureKeyVaultSecrets</span>

<span class="sd">    set_key_vault_secret = AzureKeyVaultSecrets(</span>
<span class="sd">        vault=&quot;https://{YOUR-KEY-VAULT}.azure.net/&quot;,</span>
<span class="sd">        key=&quot;{KEY}&quot;,</span>
<span class="sd">        secret=&quot;{SECRET-TO-BE-SET}&quot;,</span>
<span class="sd">        credential=&quot;{CREDENTIAL}&quot;,</span>
<span class="sd">        kwargs=None</span>
<span class="sd">    )</span>

<span class="sd">    set_key_vault_secret.set()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        vault (str): Azure Key Vault URL</span>
<span class="sd">        key (str): Key for the secret</span>
<span class="sd">        secret (str): Secret or Password to be set in the Azure Key Vault</span>
<span class="sd">        credential (str): Credential for authenticating with Azure Key Vault</span>
<span class="sd">        kwargs (dict): List of additional parameters to be passed when creating a Azure Key Vault Client. Please see [here](https://github.com/Azure/azure-sdk-for-python/tree/main/sdk/keyvault/azure-keyvault-secrets) for more details on parameters that can be provided to the client</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">vault</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">credential</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">vault</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">credential</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vault</span> <span class="o">=</span> <span class="n">vault</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secret</span> <span class="o">=</span> <span class="n">secret</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">credential</span> <span class="o">=</span> <span class="n">credential</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_akv_client</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYTHON</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_pypi_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;azure_key_vault_secret&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_get_akv_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SecretClient</span><span class="p">(</span>
            <span class="n">vault_url</span><span class="o">=</span><span class="s2">&quot;https://</span><span class="si">{}</span><span class="s2">.vault.azure.net&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vault</span><span class="p">),</span>
            <span class="n">credential</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credential</span><span class="p">,</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the secret from the Azure Key Vault</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_secret</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates or updates a secret in the Azure Key Vault</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">set_secret</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYTHON</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/secrets/azure_key_vault.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYTHON</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Retrieves the secret from the Azure Key Vault</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/secrets/azure_key_vault.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the secret from the Azure Key Vault</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_secret</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureKeyVaultSecrets.set" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">set</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Creates or updates a secret in the Azure Key Vault</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/secrets/azure_key_vault.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates or updates a secret in the Azure Key Vault</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">set_secret</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SystemType" class="doc doc-heading">
            <code>SystemType</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


      <p>The type of the system.</p>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/_pipeline_utils/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SystemType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The type of the system.&quot;&quot;&quot;</span>

    <span class="c1"># Executable in a python environment</span>
    <span class="n">PYTHON</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># Executable in a pyspark environment</span>
    <span class="n">PYSPARK</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="c1"># Executable in a databricks environment</span>
    <span class="n">PYSPARK_DATABRICKS</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableCreateUtility" class="doc doc-heading">
            <code>DeltaTableCreateUtility</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.utilities.interfaces.UtilitiesInterface">UtilitiesInterface</span></code></p>


      <p>Creates a Delta Table in a Hive Metastore or in Databricks Unity Catalog.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableCreateUtility--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities.spark.delta_table_create</span> <span class="kn">import</span> <span class="n">DeltaTableCreateUtility</span><span class="p">,</span> <span class="n">DeltaTableColumn</span>

<span class="n">table_create_utility</span> <span class="o">=</span> <span class="n">DeltaTableCreateUtility</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark_session</span><span class="p">,</span>
    <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;delta_table&quot;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
        <span class="n">DeltaTableColumn</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;EventDate&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;delta.generationExpression&quot;</span><span class="p">:</span> <span class="s2">&quot;CAST(EventTime AS DATE)&quot;</span><span class="p">}),</span>
        <span class="n">DeltaTableColumn</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">DeltaTableColumn</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;EventTime&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">DeltaTableColumn</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">DeltaTableColumn</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">partitioned_by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;EventDate&quot;</span><span class="p">],</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;delta.logRetentionDuration&quot;</span><span class="p">:</span> <span class="s2">&quot;7 days&quot;</span><span class="p">,</span> <span class="s2">&quot;delta.enableChangeDataFeed&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">},</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Creation of Delta Table&quot;</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">table_create_utility</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session required to read data from cloud storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>table_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the table, including catalog and schema if table is to be created in Unity Catalog</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>columns</code></td>
            <td>
                  <code>list[<span title="src.sdk.python.rtdip_sdk.pipelines.utilities.spark.delta_table_create.DeltaTableColumn">DeltaTableColumn</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns and their related column properties</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>partitioned_by</code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of column names to partition the table by</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>location</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to storage location</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>properties</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Propoerties that can be specified for a Delta Table. Further information on the options available are <a href="https://docs.databricks.com/delta/table-properties.html#delta-table-properties">here</a></p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>comment</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Provides a comment on the table metadata</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/delta_table_create.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DeltaTableCreateUtility</span><span class="p">(</span><span class="n">UtilitiesInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a Delta Table in a Hive Metastore or in Databricks Unity Catalog.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities.spark.delta_table_create import DeltaTableCreateUtility, DeltaTableColumn</span>

<span class="sd">    table_create_utility = DeltaTableCreateUtility(</span>
<span class="sd">        spark=spark_session,</span>
<span class="sd">        table_name=&quot;delta_table&quot;,</span>
<span class="sd">        columns=[</span>
<span class="sd">            DeltaTableColumn(name=&quot;EventDate&quot;, type=&quot;date&quot;, nullable=False, metadata={&quot;delta.generationExpression&quot;: &quot;CAST(EventTime AS DATE)&quot;}),</span>
<span class="sd">            DeltaTableColumn(name=&quot;TagName&quot;, type=&quot;string&quot;, nullable=False),</span>
<span class="sd">            DeltaTableColumn(name=&quot;EventTime&quot;, type=&quot;timestamp&quot;, nullable=False),</span>
<span class="sd">            DeltaTableColumn(name=&quot;Status&quot;, type=&quot;string&quot;, nullable=True),</span>
<span class="sd">            DeltaTableColumn(name=&quot;Value&quot;, type=&quot;float&quot;, nullable=True)</span>
<span class="sd">        ],</span>
<span class="sd">        partitioned_by=[&quot;EventDate&quot;],</span>
<span class="sd">        properties={&quot;delta.logRetentionDuration&quot;: &quot;7 days&quot;, &quot;delta.enableChangeDataFeed&quot;: &quot;true&quot;},</span>
<span class="sd">        comment=&quot;Creation of Delta Table&quot;</span>
<span class="sd">    )</span>

<span class="sd">    result = table_create_utility.execute()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session required to read data from cloud storage</span>
<span class="sd">        table_name (str): Name of the table, including catalog and schema if table is to be created in Unity Catalog</span>
<span class="sd">        columns (list[DeltaTableColumn]): List of columns and their related column properties</span>
<span class="sd">        partitioned_by (list[str], optional): List of column names to partition the table by</span>
<span class="sd">        location (str, optional): Path to storage location</span>
<span class="sd">        properties (dict, optional): Propoerties that can be specified for a Delta Table. Further information on the options available are [here](https://docs.databricks.com/delta/table-properties.html#delta-table-properties)</span>
<span class="sd">        comment (str, optional): Provides a comment on the table metadata</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeltaTableColumn</span><span class="p">]</span>
    <span class="n">partitioned_by</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">StructField</span><span class="p">],</span>
        <span class="n">partitioned_by</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partitioned_by</span> <span class="o">=</span> <span class="n">partitioned_by</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="n">properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_delta_core&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">StructField</span><span class="o">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

            <span class="n">delta_table</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">DeltaTable</span><span class="o">.</span><span class="n">createIfNotExists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">)</span>
                <span class="o">.</span><span class="n">tableName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
                <span class="o">.</span><span class="n">addColumns</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitioned_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">delta_table</span> <span class="o">=</span> <span class="n">delta_table</span><span class="o">.</span><span class="n">partitionedBy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partitioned_by</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">delta_table</span> <span class="o">=</span> <span class="n">delta_table</span><span class="o">.</span><span class="n">location</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">delta_table</span> <span class="o">=</span> <span class="n">delta_table</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">delta_table</span> <span class="o">=</span> <span class="n">delta_table</span><span class="o">.</span><span class="n">comment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>

            <span class="n">delta_table</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableCreateUtility.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableCreateUtility.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/delta_table_create.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableOptimizeUtility" class="doc doc-heading">
            <code>DeltaTableOptimizeUtility</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.utilities.interfaces.UtilitiesInterface">UtilitiesInterface</span></code></p>


      <p><a href="https://docs.delta.io/latest/optimizations-oss.html">Optimizes</a> a Delta Table.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableOptimizeUtility--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities.spark.delta_table_optimize</span> <span class="kn">import</span> <span class="n">DeltaTableOptimizeUtility</span>

<span class="n">table_optimize_utility</span> <span class="o">=</span> <span class="n">DeltaTableOptimizeUtility</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark_session</span><span class="p">,</span>
    <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;delta_table&quot;</span><span class="p">,</span>
    <span class="n">where</span><span class="o">=</span><span class="s2">&quot;EventDate&lt;=current_date()&quot;</span><span class="p">,</span>
    <span class="n">zorder_by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;EventDate&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">table_optimize_utility</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session required to read data from cloud storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>table_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the table, including catalog and schema if table is to be created in Unity Catalog</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>where</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Apply a partition filter to limit optimize to specific partitions. Example, "date='2021-11-18'" or "EventDate&lt;=current_date()"</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>zorder_by</code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of column names to zorder the table by. For more information, see <a href="https://docs.delta.io/latest/optimizations-oss.html#optimize-performance-with-file-management&amp;language-python">here.</a></p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/delta_table_optimize.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DeltaTableOptimizeUtility</span><span class="p">(</span><span class="n">UtilitiesInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    [Optimizes](https://docs.delta.io/latest/optimizations-oss.html) a Delta Table.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities.spark.delta_table_optimize import DeltaTableOptimizeUtility</span>

<span class="sd">    table_optimize_utility = DeltaTableOptimizeUtility(</span>
<span class="sd">        spark=spark_session,</span>
<span class="sd">        table_name=&quot;delta_table&quot;,</span>
<span class="sd">        where=&quot;EventDate&lt;=current_date()&quot;,</span>
<span class="sd">        zorder_by=[&quot;EventDate&quot;]</span>
<span class="sd">    )</span>

<span class="sd">    result = table_optimize_utility.execute()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session required to read data from cloud storage</span>
<span class="sd">        table_name (str): Name of the table, including catalog and schema if table is to be created in Unity Catalog</span>
<span class="sd">        where (str, optional): Apply a partition filter to limit optimize to specific partitions. Example, &quot;date=&#39;2021-11-18&#39;&quot; or &quot;EventDate&lt;=current_date()&quot;</span>
<span class="sd">        zorder_by (list[str], optional): List of column names to zorder the table by. For more information, see [here.](https://docs.delta.io/latest/optimizations-oss.html#optimize-performance-with-file-management&amp;language-python)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">zorder_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">where</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">zorder_by</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">where</span> <span class="o">=</span> <span class="n">where</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zorder_by</span> <span class="o">=</span> <span class="n">zorder_by</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_delta_core&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">delta_table</span> <span class="o">=</span> <span class="n">DeltaTable</span><span class="o">.</span><span class="n">forName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">delta_table</span> <span class="o">=</span> <span class="n">delta_table</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zorder_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">delta_table</span> <span class="o">=</span> <span class="n">delta_table</span><span class="o">.</span><span class="n">executeZOrderBy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zorder_by</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delta_table</span><span class="o">.</span><span class="n">executeCompaction</span><span class="p">()</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableOptimizeUtility.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableOptimizeUtility.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/delta_table_optimize.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableVacuumUtility" class="doc doc-heading">
            <code>DeltaTableVacuumUtility</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.utilities.interfaces.UtilitiesInterface">UtilitiesInterface</span></code></p>


      <p><a href="https://docs.delta.io/latest/delta-utility.html#-delta-vacuum">Vacuums</a> a Delta Table.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableVacuumUtility--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities.spark.delta_table_vacuum</span> <span class="kn">import</span> <span class="n">DeltaTableVacuumUtility</span>

<span class="n">table_vacuum_utility</span> <span class="o">=</span>  <span class="n">DeltaTableVacuumUtility</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark_session</span><span class="p">,</span>
    <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;delta_table&quot;</span><span class="p">,</span>
    <span class="n">retention_hours</span><span class="o">=</span><span class="s2">&quot;168&quot;</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">table_vacuum_utility</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session required to read data from cloud storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>table_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the table, including catalog and schema if table is to be created in Unity Catalog</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retention_hours</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sets the retention threshold in hours.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/delta_table_vacuum.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DeltaTableVacuumUtility</span><span class="p">(</span><span class="n">UtilitiesInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    [Vacuums](https://docs.delta.io/latest/delta-utility.html#-delta-vacuum) a Delta Table.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities.spark.delta_table_vacuum import DeltaTableVacuumUtility</span>

<span class="sd">    table_vacuum_utility =  DeltaTableVacuumUtility(</span>
<span class="sd">        spark=spark_session,</span>
<span class="sd">        table_name=&quot;delta_table&quot;,</span>
<span class="sd">        retention_hours=&quot;168&quot;</span>
<span class="sd">    )</span>

<span class="sd">    result = table_vacuum_utility.execute()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session required to read data from cloud storage</span>
<span class="sd">        table_name (str): Name of the table, including catalog and schema if table is to be created in Unity Catalog</span>
<span class="sd">        retention_hours (int, optional): Sets the retention threshold in hours.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">retention_hours</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">retention_hours</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retention_hours</span> <span class="o">=</span> <span class="n">retention_hours</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_maven_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;spark_delta_core&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">delta_table</span> <span class="o">=</span> <span class="n">DeltaTable</span><span class="o">.</span><span class="n">forName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>

            <span class="n">delta_table</span><span class="o">.</span><span class="n">vacuum</span><span class="p">(</span><span class="n">retentionHours</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">retention_hours</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableVacuumUtility.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.DeltaTableVacuumUtility.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/delta_table_vacuum.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkConfigurationUtility" class="doc doc-heading">
            <code>SparkConfigurationUtility</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.utilities.interfaces.UtilitiesInterface">UtilitiesInterface</span></code></p>


      <p>Sets configuration key value pairs to a Spark Session</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkConfigurationUtility--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.sources</span> <span class="kn">import</span> <span class="n">SparkConfigurationUtility</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">configuration_utility</span> <span class="o">=</span> <span class="n">SparkConfigurationUtility</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="p">{}</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">configuration_utility</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session required to read data from cloud storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>config</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of spark configuration to be applied to the spark session</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/configuration.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkConfigurationUtility</span><span class="p">(</span><span class="n">UtilitiesInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets configuration key value pairs to a Spark Session</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.sources import SparkConfigurationUtility</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    configuration_utility = SparkConfigurationUtility(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        config={}</span>
<span class="sd">    )</span>

<span class="sd">    result = configuration_utility.execute()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session required to read data from cloud storage</span>
<span class="sd">        config (dict): Dictionary of spark configuration to be applied to the spark session</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">StructField</span><span class="p">]</span>
    <span class="n">partitioned_by</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes configuration key value pairs to a Spark Session&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">configuration</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">configuration</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">configuration</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkConfigurationUtility.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkConfigurationUtility.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/configuration.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkConfigurationUtility.execute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Executes configuration key value pairs to a Spark Session</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/configuration.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Executes configuration key value pairs to a Spark Session&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">configuration</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">configuration</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">configuration</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkADLSGen2SPNConnectUtility" class="doc doc-heading">
            <code>SparkADLSGen2SPNConnectUtility</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.utilities.interfaces.UtilitiesInterface">UtilitiesInterface</span></code></p>


      <p>Configures Spark to Connect to an ADLS Gen 2 Storage Account using a Service Principal.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkADLSGen2SPNConnectUtility--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkADLSGen2SPNConnectUtility</span>
<span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="c1"># Not required if using Databricks</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">adls_gen2_connect_utility</span> <span class="o">=</span> <span class="n">SparkADLSGen2SPNConnectUtility</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
    <span class="n">storage_account</span><span class="o">=</span><span class="s2">&quot;YOUR-STORAGAE-ACCOUNT-NAME&quot;</span><span class="p">,</span>
    <span class="n">tenant_id</span><span class="o">=</span><span class="s2">&quot;YOUR-TENANT-ID&quot;</span><span class="p">,</span>
    <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;YOUR-CLIENT-ID&quot;</span><span class="p">,</span>
    <span class="n">client_secret</span><span class="o">=</span><span class="s2">&quot;YOUR-CLIENT-SECRET&quot;</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">adls_gen2_connect_utility</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spark</code></td>
            <td>
                  <code><span title="pyspark.sql.SparkSession">SparkSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spark Session required to read data from cloud storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>storage_account</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the ADLS Gen 2 Storage Account</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tenant_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tenant ID of the Service Principal</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>client_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Service Principal Client ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>client_secret</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Service Principal Client Secret</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/adls_gen2_spn_connect.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkADLSGen2SPNConnectUtility</span><span class="p">(</span><span class="n">UtilitiesInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configures Spark to Connect to an ADLS Gen 2 Storage Account using a Service Principal.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkADLSGen2SPNConnectUtility</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    # Not required if using Databricks</span>
<span class="sd">    spark = SparkSessionUtility(config={}).execute()</span>

<span class="sd">    adls_gen2_connect_utility = SparkADLSGen2SPNConnectUtility(</span>
<span class="sd">        spark=spark,</span>
<span class="sd">        storage_account=&quot;YOUR-STORAGAE-ACCOUNT-NAME&quot;,</span>
<span class="sd">        tenant_id=&quot;YOUR-TENANT-ID&quot;,</span>
<span class="sd">        client_id=&quot;YOUR-CLIENT-ID&quot;,</span>
<span class="sd">        client_secret=&quot;YOUR-CLIENT-SECRET&quot;</span>
<span class="sd">    )</span>

<span class="sd">    result = adls_gen2_connect_utility.execute()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spark (SparkSession): Spark Session required to read data from cloud storage</span>
<span class="sd">        storage_account (str): Name of the ADLS Gen 2 Storage Account</span>
<span class="sd">        tenant_id (str): Tenant ID of the Service Principal</span>
<span class="sd">        client_id (str): Service Principal Client ID</span>
<span class="sd">        client_secret (str): Service Principal Client Secret</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">storage_account</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">tenant_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span>
        <span class="n">storage_account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">tenant_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span> <span class="o">=</span> <span class="n">storage_account</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tenant_id</span> <span class="o">=</span> <span class="n">tenant_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">=</span> <span class="n">client_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">=</span> <span class="n">client_secret</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes spark configuration to connect to an ADLS Gen 2 Storage Account using a service principal&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">adls_gen2_config</span> <span class="o">=</span> <span class="n">SparkConfigurationUtility</span><span class="p">(</span>
                <span class="n">spark</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span>
                <span class="n">config</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;fs.azure.account.auth.type.</span><span class="si">{}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span>
                    <span class="p">):</span> <span class="s2">&quot;OAuth&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;fs.azure.account.oauth.provider.type.</span><span class="si">{}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span>
                    <span class="p">):</span> <span class="s2">&quot;org.apache.hadoop.fs.azurebfs.oauth2.ClientCredsTokenProvider&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;fs.azure.account.oauth2.client.id.</span><span class="si">{}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span>
                    <span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
                    <span class="s2">&quot;fs.azure.account.oauth2.client.secret.</span><span class="si">{}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span>
                    <span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span><span class="p">,</span>
                    <span class="s2">&quot;fs.azure.account.oauth2.client.endpoint.</span><span class="si">{}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span>
                    <span class="p">):</span> <span class="s2">&quot;https://login.microsoftonline.com/</span><span class="si">{}</span><span class="s2">/oauth2/token&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tenant_id</span>
                    <span class="p">),</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">adls_gen2_config</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkADLSGen2SPNConnectUtility.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkADLSGen2SPNConnectUtility.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/adls_gen2_spn_connect.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkADLSGen2SPNConnectUtility.execute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Executes spark configuration to connect to an ADLS Gen 2 Storage Account using a service principal</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/adls_gen2_spn_connect.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Executes spark configuration to connect to an ADLS Gen 2 Storage Account using a service principal&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">adls_gen2_config</span> <span class="o">=</span> <span class="n">SparkConfigurationUtility</span><span class="p">(</span>
            <span class="n">spark</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;fs.azure.account.auth.type.</span><span class="si">{}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span>
                <span class="p">):</span> <span class="s2">&quot;OAuth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fs.azure.account.oauth.provider.type.</span><span class="si">{}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span>
                <span class="p">):</span> <span class="s2">&quot;org.apache.hadoop.fs.azurebfs.oauth2.ClientCredsTokenProvider&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fs.azure.account.oauth2.client.id.</span><span class="si">{}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span>
                <span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
                <span class="s2">&quot;fs.azure.account.oauth2.client.secret.</span><span class="si">{}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span>
                <span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span><span class="p">,</span>
                <span class="s2">&quot;fs.azure.account.oauth2.client.endpoint.</span><span class="si">{}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span>
                <span class="p">):</span> <span class="s2">&quot;https://login.microsoftonline.com/</span><span class="si">{}</span><span class="s2">/oauth2/token&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tenant_id</span>
                <span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="n">adls_gen2_config</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="n">Py4JJavaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ADLSGen2DirectoryACLUtility" class="doc doc-heading">
            <code>ADLSGen2DirectoryACLUtility</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.utilities.interfaces.UtilitiesInterface">UtilitiesInterface</span></code></p>


      <p>Assigns Azure AD Groups to ACLs on directories in an Azure Data Lake Store Gen 2 storage account.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ADLSGen2DirectoryACLUtility--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">ADLSGen2DirectoryACLUtility</span>

<span class="n">adls_gen2_directory_acl_utility</span> <span class="o">=</span> <span class="n">ADLSGen2DirectoryACLUtility</span><span class="p">(</span>
    <span class="n">storage_account</span><span class="o">=</span><span class="s2">&quot;YOUR-STORAGAE-ACCOUNT-NAME&quot;</span><span class="p">,</span>
    <span class="n">container</span><span class="o">=</span><span class="s2">&quot;YOUR-ADLS_CONTAINER_NAME&quot;</span><span class="p">,</span>
    <span class="n">credential</span><span class="o">=</span><span class="s2">&quot;YOUR-TOKEN-CREDENTIAL&quot;</span><span class="p">,</span>
    <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;DIRECTORY&quot;</span><span class="p">,</span>
    <span class="n">group_object_id</span><span class="o">=</span><span class="s2">&quot;GROUP-OBJECT&quot;</span><span class="p">,</span>
    <span class="n">folder_permissions</span><span class="o">=</span><span class="s2">&quot;r-x&quot;</span><span class="p">,</span>
    <span class="n">parent_folder_permissions</span><span class="o">=</span><span class="s2">&quot;r-x&quot;</span><span class="p">,</span>
    <span class="n">root_folder_permissions</span><span class="o">=</span><span class="s2">&quot;r-x&quot;</span><span class="p">,</span>
    <span class="n">set_as_default_acl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">create_directory_if_not_exists</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">adls_gen2_directory_acl_utility</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>storage_account</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ADLS Gen 2 Storage Account Name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>container</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ADLS Gen 2 Container Name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>credential</code></td>
            <td>
                  <code><span title="azure.core.credentials.TokenCredential">TokenCredential</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Credentials to authenticate with ADLS Gen 2 Storage Account</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>directory</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to be assign ACLS to in an ADLS Gen 2</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>group_object_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Azure AD Group Object ID to be assigned to Directory</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>folder_permissions</code></td>
            <td>
                  <code>(optional, str)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Folder Permissions to Assign to directory</p>
              </div>
            </td>
            <td>
                  <code>&#39;r-x&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>parent_folder_permissions</code></td>
            <td>
                  <code>(optional, str)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Folder Permissions to Assign to parent directories. Parent Folder ACLs not set if None</p>
              </div>
            </td>
            <td>
                  <code>&#39;r-x&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>root_folder_permissions</code></td>
            <td>
                  <code>(optional, str)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Folder Permissions to Assign to root directory. Root Folder ACL not set if None</p>
              </div>
            </td>
            <td>
                  <code>&#39;r-x&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>set_as_default_acl</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sets the ACL as the default ACL on the folder</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>create_directory_if_not_exists</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Creates the directory(and Parent Directories) if it does not exist</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/azure/adls_gen2_acl.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ADLSGen2DirectoryACLUtility</span><span class="p">(</span><span class="n">UtilitiesInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assigns Azure AD Groups to ACLs on directories in an Azure Data Lake Store Gen 2 storage account.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import ADLSGen2DirectoryACLUtility</span>

<span class="sd">    adls_gen2_directory_acl_utility = ADLSGen2DirectoryACLUtility(</span>
<span class="sd">        storage_account=&quot;YOUR-STORAGAE-ACCOUNT-NAME&quot;,</span>
<span class="sd">        container=&quot;YOUR-ADLS_CONTAINER_NAME&quot;,</span>
<span class="sd">        credential=&quot;YOUR-TOKEN-CREDENTIAL&quot;,</span>
<span class="sd">        directory=&quot;DIRECTORY&quot;,</span>
<span class="sd">        group_object_id=&quot;GROUP-OBJECT&quot;,</span>
<span class="sd">        folder_permissions=&quot;r-x&quot;,</span>
<span class="sd">        parent_folder_permissions=&quot;r-x&quot;,</span>
<span class="sd">        root_folder_permissions=&quot;r-x&quot;,</span>
<span class="sd">        set_as_default_acl=True,</span>
<span class="sd">        create_directory_if_not_exists=True</span>
<span class="sd">    )</span>

<span class="sd">    result = adls_gen2_directory_acl_utility.execute()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        storage_account (str): ADLS Gen 2 Storage Account Name</span>
<span class="sd">        container (str): ADLS Gen 2 Container Name</span>
<span class="sd">        credential (TokenCredential): Credentials to authenticate with ADLS Gen 2 Storage Account</span>
<span class="sd">        directory (str): Directory to be assign ACLS to in an ADLS Gen 2</span>
<span class="sd">        group_object_id (str): Azure AD Group Object ID to be assigned to Directory</span>
<span class="sd">        folder_permissions (optional, str): Folder Permissions to Assign to directory</span>
<span class="sd">        parent_folder_permissions (optional, str): Folder Permissions to Assign to parent directories. Parent Folder ACLs not set if None</span>
<span class="sd">        root_folder_permissions (optional, str): Folder Permissions to Assign to root directory. Root Folder ACL not set if None</span>
<span class="sd">        set_as_default_acl (bool, optional): Sets the ACL as the default ACL on the folder</span>
<span class="sd">        create_directory_if_not_exists (bool, optional): Creates the directory(and Parent Directories) if it does not exist</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">storage_account</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">container</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">credential</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="nb">str</span><span class="p">,</span>
        <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">AzureNamedKeyCredential</span><span class="p">,</span>
        <span class="n">AzureSasCredential</span><span class="p">,</span>
        <span class="n">TokenCredential</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">group_object_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">folder_permissions</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">parent_folder_permissions</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">root_folder_permissions</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">set_as_default_acl</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">create_directory_if_not_exists</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">storage_account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">container</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">credential</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="nb">str</span><span class="p">,</span>
            <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
            <span class="n">AzureNamedKeyCredential</span><span class="p">,</span>
            <span class="n">AzureSasCredential</span><span class="p">,</span>
            <span class="n">TokenCredential</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">group_object_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">folder_permissions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r-x&quot;</span><span class="p">,</span>
        <span class="n">parent_folder_permissions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;r-x&quot;</span><span class="p">,</span>
        <span class="n">root_folder_permissions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;r-x&quot;</span><span class="p">,</span>
        <span class="n">set_as_default_acl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">create_directory_if_not_exists</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span> <span class="o">=</span> <span class="n">storage_account</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">credential</span> <span class="o">=</span> <span class="n">credential</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_object_id</span> <span class="o">=</span> <span class="n">group_object_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder_permissions</span> <span class="o">=</span> <span class="n">folder_permissions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_folder_permissions</span> <span class="o">=</span> <span class="n">parent_folder_permissions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_folder_permissions</span> <span class="o">=</span> <span class="n">root_folder_permissions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_as_default_acl</span> <span class="o">=</span> <span class="n">set_as_default_acl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_directory_if_not_exists</span> <span class="o">=</span> <span class="n">create_directory_if_not_exists</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYTHON</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_pypi_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;azure_adls_gen_2&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_set_acl</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">file_system_client</span><span class="p">:</span> <span class="n">FileSystemClient</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">group_object_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">folder_permissions</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">set_as_default_acl</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">acl_directory_client</span> <span class="o">=</span> <span class="n">file_system_client</span><span class="o">.</span><span class="n">get_directory_client</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="n">group_id_acl</span> <span class="o">=</span> <span class="s2">&quot;group:</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group_object_id</span><span class="p">,</span> <span class="n">folder_permissions</span><span class="p">)</span>
        <span class="n">acl_props</span> <span class="o">=</span> <span class="n">acl_directory_client</span><span class="o">.</span><span class="n">get_access_control</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;acl&quot;</span><span class="p">)</span>
        <span class="n">acl_props_list</span> <span class="o">=</span> <span class="n">acl_props</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">acl</span> <span class="ow">in</span> <span class="n">acl_props_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">group_object_id</span> <span class="ow">in</span> <span class="n">acl</span><span class="p">:</span>
                <span class="n">acl_props_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">acl</span><span class="p">)</span>

        <span class="n">acl_props_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_id_acl</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">set_as_default_acl</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">acl_props_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;default:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group_id_acl</span><span class="p">))</span>

        <span class="n">new_acl_props</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acl_props_list</span><span class="p">)</span>
        <span class="n">acl_directory_client</span><span class="o">.</span><span class="n">set_access_control</span><span class="p">(</span><span class="n">acl</span><span class="o">=</span><span class="n">new_acl_props</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Setup file system client</span>
            <span class="n">service_client</span> <span class="o">=</span> <span class="n">DataLakeServiceClient</span><span class="p">(</span>
                <span class="n">account_url</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">://</span><span class="si">{}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span>
                <span class="p">),</span>
                <span class="n">credential</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credential</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">file_system_client</span> <span class="o">=</span> <span class="n">service_client</span><span class="o">.</span><span class="n">get_file_system_client</span><span class="p">(</span>
                <span class="n">file_system</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span>
            <span class="p">)</span>

            <span class="c1"># Create directory if it doesn&#39;t already exist</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_directory_if_not_exists</span><span class="p">:</span>
                <span class="n">directory_client</span> <span class="o">=</span> <span class="n">file_system_client</span><span class="o">.</span><span class="n">get_directory_client</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">directory_client</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="n">file_system_client</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>

            <span class="n">group_object_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_object_id</span><span class="p">)</span>
            <span class="n">acl_path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">directory_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

            <span class="c1"># Set Root Folder ACLs if specified</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_folder_permissions</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_acl</span><span class="p">(</span>
                    <span class="n">file_system_client</span><span class="p">,</span>
                    <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                    <span class="n">group_object_id</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">root_folder_permissions</span><span class="p">,</span>
                    <span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Set Parent Folders ACLs if specified</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_folder_permissions</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">directory_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">directory</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">acl_path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="n">acl_path</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
                        <span class="n">acl_path</span> <span class="o">+=</span> <span class="n">directory</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">acl_path</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">directory</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_acl</span><span class="p">(</span>
                        <span class="n">file_system_client</span><span class="p">,</span>
                        <span class="n">acl_path</span><span class="p">,</span>
                        <span class="n">group_object_id</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parent_folder_permissions</span><span class="p">,</span>
                        <span class="kc">False</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="c1"># Set Folder ACLs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_acl</span><span class="p">(</span>
                <span class="n">file_system_client</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
                <span class="n">group_object_id</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">folder_permissions</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_as_default_acl</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ADLSGen2DirectoryACLUtility.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.ADLSGen2DirectoryACLUtility.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYTHON</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/azure/adls_gen2_acl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYTHON</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureAutoloaderResourcesUtility" class="doc doc-heading">
            <code>AzureAutoloaderResourcesUtility</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.utilities.interfaces.UtilitiesInterface">UtilitiesInterface</span></code></p>


      <p>Creates the required Azure Resources for the Databricks Autoloader Notification Mode.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureAutoloaderResourcesUtility--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">AzureAutoloaderResourcesUtility</span>

<span class="n">azure_autoloader_resources_utility</span> <span class="o">=</span> <span class="n">AzureAutoloaderResourcesUtility</span><span class="p">(</span>
    <span class="n">subscription_id</span><span class="o">=</span><span class="s2">&quot;YOUR-SUBSCRIPTION-ID&quot;</span><span class="p">,</span>
    <span class="n">resource_group_name</span><span class="o">=</span><span class="s2">&quot;YOUR-RESOURCE-GROUP&quot;</span><span class="p">,</span>
    <span class="n">storage_account</span><span class="o">=</span><span class="s2">&quot;YOUR-STORAGE-ACCOUNT-NAME&quot;</span><span class="p">,</span>
    <span class="n">container</span><span class="o">=</span><span class="s2">&quot;YOUR-CONTAINER-NAME&quot;</span><span class="p">,</span>
    <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;DIRECTORY&quot;</span><span class="p">,</span>
    <span class="n">credential</span><span class="o">=</span><span class="s2">&quot;YOUR-CLIENT-ID&quot;</span><span class="p">,</span>
    <span class="n">event_subscription_name</span><span class="o">=</span><span class="s2">&quot;YOUR-EVENT-SUBSCRIPTION&quot;</span><span class="p">,</span>
    <span class="n">queue_name</span><span class="o">=</span><span class="s2">&quot;YOUR-QUEUE-NAME&quot;</span><span class="p">,</span>
    <span class="n">system_topic_name</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">azure_autoloader_resources_utility</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>subscription_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Azure Subscription ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>resource_group_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resource Group Name of Subscription</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>storage_account</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage Account Name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>container</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Container Name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>directory</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to be used for filtering messages in the Event Subscription. This will be equivalent to the Databricks Autoloader Path</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>credential</code></td>
            <td>
                  <code><span title="azure.core.credentials.TokenCredential">TokenCredential</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Credentials to authenticate with Storage Account</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>event_subscription_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the Event Subscription</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>queue_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the queue that will be used for the Endpoint of the Messages</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/azure/autoloader_resources.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AzureAutoloaderResourcesUtility</span><span class="p">(</span><span class="n">UtilitiesInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates the required Azure Resources for the Databricks Autoloader Notification Mode.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import AzureAutoloaderResourcesUtility</span>

<span class="sd">    azure_autoloader_resources_utility = AzureAutoloaderResourcesUtility(</span>
<span class="sd">        subscription_id=&quot;YOUR-SUBSCRIPTION-ID&quot;,</span>
<span class="sd">        resource_group_name=&quot;YOUR-RESOURCE-GROUP&quot;,</span>
<span class="sd">        storage_account=&quot;YOUR-STORAGE-ACCOUNT-NAME&quot;,</span>
<span class="sd">        container=&quot;YOUR-CONTAINER-NAME&quot;,</span>
<span class="sd">        directory=&quot;DIRECTORY&quot;,</span>
<span class="sd">        credential=&quot;YOUR-CLIENT-ID&quot;,</span>
<span class="sd">        event_subscription_name=&quot;YOUR-EVENT-SUBSCRIPTION&quot;,</span>
<span class="sd">        queue_name=&quot;YOUR-QUEUE-NAME&quot;,</span>
<span class="sd">        system_topic_name=None</span>
<span class="sd">    )</span>

<span class="sd">    result = azure_autoloader_resources_utility.execute()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        subscription_id (str): Azure Subscription ID</span>
<span class="sd">        resource_group_name (str): Resource Group Name of Subscription</span>
<span class="sd">        storage_account (str): Storage Account Name</span>
<span class="sd">        container (str): Container Name</span>
<span class="sd">        directory (str): Directory to be used for filtering messages in the Event Subscription. This will be equivalent to the Databricks Autoloader Path</span>
<span class="sd">        credential (TokenCredential): Credentials to authenticate with Storage Account</span>
<span class="sd">        event_subscription_name (str): Name of the Event Subscription</span>
<span class="sd">        queue_name (str): Name of the queue that will be used for the Endpoint of the Messages</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">subscription_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">resource_group_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">storage_account</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">container</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">credential</span><span class="p">:</span> <span class="n">TokenCredential</span>
    <span class="n">event_subscription_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">subscription_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">resource_group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">storage_account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">container</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">credential</span><span class="p">:</span> <span class="n">TokenCredential</span><span class="p">,</span>
        <span class="n">event_subscription_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscription_id</span> <span class="o">=</span> <span class="n">subscription_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_group_name</span> <span class="o">=</span> <span class="n">resource_group_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span> <span class="o">=</span> <span class="n">storage_account</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">credential</span> <span class="o">=</span> <span class="n">credential</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_subscription_name</span> <span class="o">=</span> <span class="n">event_subscription_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">queue_name</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYTHON</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_pypi_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;azure_eventgrid_mgmt&quot;</span><span class="p">))</span>
        <span class="n">libraries</span><span class="o">.</span><span class="n">add_pypi_library</span><span class="p">(</span><span class="n">get_default_package</span><span class="p">(</span><span class="s2">&quot;azure_storage_mgmt&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">storage_mgmt_client</span> <span class="o">=</span> <span class="n">StorageManagementClient</span><span class="p">(</span>
            <span class="n">credential</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credential</span><span class="p">,</span> <span class="n">subscription_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subscription_id</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">queue_response</span> <span class="o">=</span> <span class="n">storage_mgmt_client</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">resource_group_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_group_name</span><span class="p">,</span>
                <span class="n">account_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span><span class="p">,</span>
                <span class="n">queue_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">ResourceNotFoundError</span><span class="p">:</span>
            <span class="n">queue_response</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">queue_response</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">storage_mgmt_client</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">resource_group_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_group_name</span><span class="p">,</span>
                <span class="n">account_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span><span class="p">,</span>
                <span class="n">queue_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span><span class="p">,</span>
                <span class="n">queue</span><span class="o">=</span><span class="n">StorageQueue</span><span class="p">(),</span>
            <span class="p">)</span>

        <span class="n">eventgrid_client</span> <span class="o">=</span> <span class="n">EventGridManagementClient</span><span class="p">(</span>
            <span class="n">credential</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credential</span><span class="p">,</span> <span class="n">subscription_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subscription_id</span>
        <span class="p">)</span>

        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;/subscriptions/</span><span class="si">{}</span><span class="s2">/resourceGroups/</span><span class="si">{}</span><span class="s2">/providers/Microsoft.Storage/StorageAccounts/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subscription_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_group_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">event_subscription_response</span> <span class="o">=</span> <span class="n">eventgrid_client</span><span class="o">.</span><span class="n">event_subscriptions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">scope</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">event_subscription_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">event_subscription_name</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">ResourceNotFoundError</span><span class="p">:</span>
            <span class="n">event_subscription_response</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">event_subscription_response</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">event_subscription_destination</span> <span class="o">=</span> <span class="n">StorageQueueEventSubscriptionDestination</span><span class="p">(</span>
                <span class="n">resource_id</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
                <span class="n">queue_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span><span class="p">,</span>
                <span class="n">queue_message_time_to_live_in_seconds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">event_subscription_filter</span> <span class="o">=</span> <span class="n">EventSubscriptionFilter</span><span class="p">(</span>
                <span class="n">subject_begins_with</span><span class="o">=</span><span class="s2">&quot;/blobServices/default/containers/</span><span class="si">{}</span><span class="s2">/blobs/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>
                <span class="p">),</span>
                <span class="n">included_event_types</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;Microsoft.Storage.BlobCreated&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Microsoft.Storage.BlobRenamed&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Microsoft.Storage.DirectoryRenamed&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">advanced_filters</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">StringContainsAdvancedFilter</span><span class="p">(</span>
                        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;data.api&quot;</span><span class="p">,</span>
                        <span class="n">values</span><span class="o">=</span><span class="p">[</span>
                            <span class="s2">&quot;CopyBlob&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;PutBlob&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;PutBlockList&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;FlushWithClose&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;RenameFile&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;RenameDirectory&quot;</span><span class="p">,</span>
                        <span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">],</span>
            <span class="p">)</span>

            <span class="n">retry_policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">()</span>

            <span class="n">event_subscription_info</span> <span class="o">=</span> <span class="n">EventSubscription</span><span class="p">(</span>
                <span class="n">destination</span><span class="o">=</span><span class="n">event_subscription_destination</span><span class="p">,</span>
                <span class="nb">filter</span><span class="o">=</span><span class="n">event_subscription_filter</span><span class="p">,</span>
                <span class="n">event_delivery_schema</span><span class="o">=</span><span class="n">EventDeliverySchema</span><span class="o">.</span><span class="n">EVENT_GRID_SCHEMA</span><span class="p">,</span>
                <span class="n">retry_policy</span><span class="o">=</span><span class="n">retry_policy</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">eventgrid_client</span><span class="o">.</span><span class="n">event_subscriptions</span><span class="o">.</span><span class="n">begin_create_or_update</span><span class="p">(</span>
                <span class="n">scope</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
                <span class="n">event_subscription_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">event_subscription_name</span><span class="p">,</span>
                <span class="n">event_subscription_info</span><span class="o">=</span><span class="n">event_subscription_info</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

            <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureAutoloaderResourcesUtility.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.AzureAutoloaderResourcesUtility.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYTHON</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/azure/autoloader_resources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYTHON</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineComponentsGetUtility" class="doc doc-heading">
            <code>PipelineComponentsGetUtility</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.utilities.interfaces.UtilitiesInterface">UtilitiesInterface</span></code></p>


      <p>Gets the list of imported RTDIP components. Returns the libraries and settings of the components to be used in the pipeline.</p>
<p>Call this component after all imports of the RTDIP components to ensure that the components can be determined.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>module</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Provide the module to use for imports of rtdip-sdk components. If not populated, it will use the calling module to check for imports</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>spark_config</code></td>
            <td>
                  <code>optional dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional spark configuration to be applied to the spark session</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/pipeline_components.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PipelineComponentsGetUtility</span><span class="p">(</span><span class="n">UtilitiesInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the list of imported RTDIP components. Returns the libraries and settings of the components to be used in the pipeline.</span>

<span class="sd">    Call this component after all imports of the RTDIP components to ensure that the components can be determined.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        module (optional str): Provide the module to use for imports of rtdip-sdk components. If not populated, it will use the calling module to check for imports</span>
<span class="sd">        spark_config (optional dict): Additional spark configuration to be applied to the spark session</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">spark_config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frm</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmodule</span><span class="p">(</span><span class="n">frm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark_config</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">spark_config</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">spark_config</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYTHON</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Libraries</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
        <span class="kn">from</span> <span class="nn">..sources.interfaces</span> <span class="kn">import</span> <span class="n">SourceInterface</span>
        <span class="kn">from</span> <span class="nn">..destinations.interfaces</span> <span class="kn">import</span> <span class="n">DestinationInterface</span>
        <span class="kn">from</span> <span class="nn">..deploy.interfaces</span> <span class="kn">import</span> <span class="n">DeployInterface</span>
        <span class="kn">from</span> <span class="nn">..secrets.interfaces</span> <span class="kn">import</span> <span class="n">SecretsInterface</span>
        <span class="kn">from</span> <span class="nn">..transformers.interfaces</span> <span class="kn">import</span> <span class="n">TransformerInterface</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">classes_imported</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">],</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span>
            <span class="p">)</span>
            <span class="n">component_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">classes_imported</span><span class="p">:</span>
                <span class="n">class_check</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">],</span> <span class="bp">cls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span>
                        <span class="nb">issubclass</span><span class="p">(</span><span class="n">class_check</span><span class="p">,</span> <span class="n">SourceInterface</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">class_check</span> <span class="o">!=</span> <span class="n">SourceInterface</span>
                    <span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span>
                        <span class="nb">issubclass</span><span class="p">(</span><span class="n">class_check</span><span class="p">,</span> <span class="n">DestinationInterface</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">class_check</span> <span class="o">!=</span> <span class="n">DestinationInterface</span>
                    <span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span>
                        <span class="nb">issubclass</span><span class="p">(</span><span class="n">class_check</span><span class="p">,</span> <span class="n">DeployInterface</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">class_check</span> <span class="o">!=</span> <span class="n">DeployInterface</span>
                    <span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span>
                        <span class="nb">issubclass</span><span class="p">(</span><span class="n">class_check</span><span class="p">,</span> <span class="n">SecretsInterface</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">class_check</span> <span class="o">!=</span> <span class="n">SecretsInterface</span>
                    <span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span>
                        <span class="nb">issubclass</span><span class="p">(</span><span class="n">class_check</span><span class="p">,</span> <span class="n">TransformerInterface</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">class_check</span> <span class="o">!=</span> <span class="n">TransformerInterface</span>
                    <span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span>
                        <span class="nb">issubclass</span><span class="p">(</span><span class="n">class_check</span><span class="p">,</span> <span class="n">UtilitiesInterface</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">class_check</span> <span class="o">!=</span> <span class="n">UtilitiesInterface</span>
                    <span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">component_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">task_libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
            <span class="n">task_libraries</span><span class="o">.</span><span class="n">get_libraries_from_components</span><span class="p">(</span><span class="n">component_list</span><span class="p">)</span>
            <span class="n">spark_configuration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark_config</span>
            <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">component_list</span><span class="p">:</span>
                <span class="n">spark_configuration</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">spark_configuration</span><span class="p">,</span> <span class="o">**</span><span class="n">component</span><span class="o">.</span><span class="n">settings</span><span class="p">()}</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">task_libraries</span><span class="p">,</span> <span class="n">spark_configuration</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineComponentsGetUtility.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineComponentsGetUtility.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYTHON</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/pipeline_components.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYTHON</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYTHON</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkSessionUtility" class="doc doc-heading">
            <code>SparkSessionUtility</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.utilities.interfaces.UtilitiesInterface">UtilitiesInterface</span></code></p>


      <p>Creates or Gets a Spark Session and uses settings and libraries of the imported RTDIP components to populate the spark configuration and jars in the spark session.</p>
<p>Call this component after all imports of the RTDIP components to ensure that the spark session is configured correctly.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkSessionUtility--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.utilities</span> <span class="kn">import</span> <span class="n">SparkSessionUtility</span>

<span class="n">spark_session_utility</span> <span class="o">=</span> <span class="n">SparkSessionUtility</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">module</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">remote</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">spark_session_utility</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>config</code></td>
            <td>
                  <code>optional dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of spark configuration to be applied to the spark session</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>module</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Provide the module to use for imports of rtdip-sdk components. If not populated, it will use the calling module to check for imports</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>remote</code></td>
            <td>
                  <code>optional str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specify the remote parameters if intending to use Spark Connect</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/session.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparkSessionUtility</span><span class="p">(</span><span class="n">UtilitiesInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates or Gets a Spark Session and uses settings and libraries of the imported RTDIP components to populate the spark configuration and jars in the spark session.</span>

<span class="sd">    Call this component after all imports of the RTDIP components to ensure that the spark session is configured correctly.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.utilities import SparkSessionUtility</span>

<span class="sd">    spark_session_utility = SparkSessionUtility(</span>
<span class="sd">        config={},</span>
<span class="sd">        module=None,</span>
<span class="sd">        remote=None</span>
<span class="sd">    )</span>

<span class="sd">    result = spark_session_utility.execute()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        config (optional dict): Dictionary of spark configuration to be applied to the spark session</span>
<span class="sd">        module (optional str): Provide the module to use for imports of rtdip-sdk components. If not populated, it will use the calling module to check for imports</span>
<span class="sd">        remote (optional str): Specify the remote parameters if intending to use Spark Connect</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">module</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">remote</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frm</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmodule</span><span class="p">(</span><span class="n">frm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remote</span> <span class="o">=</span> <span class="n">remote</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            SystemType (Environment): Requires PYSPARK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">libraries</span><span class="p">():</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">Libraries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">libraries</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SparkSession</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To execute&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="p">(</span><span class="n">task_libraries</span><span class="p">,</span> <span class="n">spark_configuration</span><span class="p">)</span> <span class="o">=</span> <span class="n">PipelineComponentsGetUtility</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
            <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkClient</span><span class="p">(</span>
                <span class="n">spark_configuration</span><span class="o">=</span><span class="n">spark_configuration</span><span class="p">,</span>
                <span class="n">spark_libraries</span><span class="o">=</span><span class="n">task_libraries</span><span class="p">,</span>
                <span class="n">spark_remote</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remote</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">spark_session</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkSessionUtility.system_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_type</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkSessionUtility.system_type.SystemType">SystemType</span></code></td>
            <td>
                  <code>Environment</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requires PYSPARK</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/session.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">system_type</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        SystemType (Environment): Requires PYSPARK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SystemType</span><span class="o">.</span><span class="n">PYSPARK</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.SparkSessionUtility.execute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>To execute</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/utilities/spark/session.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SparkSession</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;To execute&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="p">(</span><span class="n">task_libraries</span><span class="p">,</span> <span class="n">spark_configuration</span><span class="p">)</span> <span class="o">=</span> <span class="n">PipelineComponentsGetUtility</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
        <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkClient</span><span class="p">(</span>
            <span class="n">spark_configuration</span><span class="o">=</span><span class="n">spark_configuration</span><span class="p">,</span>
            <span class="n">spark_libraries</span><span class="o">=</span><span class="n">task_libraries</span><span class="p">,</span>
            <span class="n">spark_remote</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remote</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">spark_session</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobFromJsonConverter" class="doc doc-heading">
            <code>PipelineJobFromJsonConverter</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.interfaces.ConverterInterface">ConverterInterface</span></code></p>


      <p>Converts a json string into a Pipeline Job.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobFromJsonConverter--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.secrets</span> <span class="kn">import</span> <span class="n">PipelineJobFromJsonConverter</span>

<span class="n">convert_json_string_to_pipline_job</span> <span class="o">=</span> <span class="n">PipelineJobFromJsonConverter</span><span class="p">(</span>
    <span class="n">pipeline_json</span> <span class="o">=</span> <span class="s2">&quot;{JSON-STRING}&quot;</span>
<span class="p">)</span>

<span class="n">convert_json_string_to_pipline_job</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>pipeline_json</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Json representing PipelineJob information, including tasks and related steps</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/converters/pipeline_job_json.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PipelineJobFromJsonConverter</span><span class="p">(</span><span class="n">ConverterInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a json string into a Pipeline Job.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.secrets import PipelineJobFromJsonConverter</span>

<span class="sd">    convert_json_string_to_pipline_job = PipelineJobFromJsonConverter(</span>
<span class="sd">        pipeline_json = &quot;{JSON-STRING}&quot;</span>
<span class="sd">    )</span>

<span class="sd">    convert_json_string_to_pipline_job.convert()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        pipeline_json (str): Json representing PipelineJob information, including tasks and related steps</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pipeline_json</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_json</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_json</span> <span class="o">=</span> <span class="n">pipeline_json</span>

    <span class="k">def</span> <span class="nf">_try_convert_to_pipeline_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;pipeline_secret&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">value</span><span class="p">[</span><span class="s2">&quot;pipeline_secret&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;pipeline_secret&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">PipelineSecret</span><span class="o">.</span><span class="n">parse_obj</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;pipeline_secret&quot;</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>  <span class="c1"># NOSONAR</span>
            <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PipelineJob</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a json string to a Pipeline Job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipeline_job_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_json</span><span class="p">)</span>

        <span class="c1"># convert string component to class</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">pipeline_job_dict</span><span class="p">[</span><span class="s2">&quot;task_list&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;step_list&quot;</span><span class="p">]:</span>
                <span class="n">step</span><span class="p">[</span><span class="s2">&quot;component&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span> <span class="n">step</span><span class="p">[</span><span class="s2">&quot;component&quot;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">param_key</span><span class="p">,</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="n">step</span><span class="p">[</span><span class="s2">&quot;component_parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">step</span><span class="p">[</span><span class="s2">&quot;component_parameters&quot;</span><span class="p">][</span><span class="n">param_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_try_convert_to_pipeline_secret</span><span class="p">(</span><span class="n">param_value</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                        <span class="n">step</span><span class="p">[</span><span class="s2">&quot;component_parameters&quot;</span><span class="p">][</span><span class="n">param_key</span><span class="p">],</span> <span class="n">PipelineSecret</span>
                    <span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param_value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">param_value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">step</span><span class="p">[</span><span class="s2">&quot;component_parameters&quot;</span><span class="p">][</span><span class="n">param_key</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_try_convert_to_pipeline_secret</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                            <span class="p">)</span>

        <span class="k">return</span> <span class="n">PipelineJob</span><span class="p">(</span><span class="o">**</span><span class="n">pipeline_job_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobFromJsonConverter.convert" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Converts a json string to a Pipeline Job</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/converters/pipeline_job_json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PipelineJob</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a json string to a Pipeline Job</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pipeline_job_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_json</span><span class="p">)</span>

    <span class="c1"># convert string component to class</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">pipeline_job_dict</span><span class="p">[</span><span class="s2">&quot;task_list&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;step_list&quot;</span><span class="p">]:</span>
            <span class="n">step</span><span class="p">[</span><span class="s2">&quot;component&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span> <span class="n">step</span><span class="p">[</span><span class="s2">&quot;component&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">param_key</span><span class="p">,</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="n">step</span><span class="p">[</span><span class="s2">&quot;component_parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">step</span><span class="p">[</span><span class="s2">&quot;component_parameters&quot;</span><span class="p">][</span><span class="n">param_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_try_convert_to_pipeline_secret</span><span class="p">(</span><span class="n">param_value</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">step</span><span class="p">[</span><span class="s2">&quot;component_parameters&quot;</span><span class="p">][</span><span class="n">param_key</span><span class="p">],</span> <span class="n">PipelineSecret</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param_value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">param_value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">step</span><span class="p">[</span><span class="s2">&quot;component_parameters&quot;</span><span class="p">][</span><span class="n">param_key</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_try_convert_to_pipeline_secret</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="p">)</span>

    <span class="k">return</span> <span class="n">PipelineJob</span><span class="p">(</span><span class="o">**</span><span class="n">pipeline_job_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobToJsonConverter" class="doc doc-heading">
            <code>PipelineJobToJsonConverter</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.sdk.python.rtdip_sdk.pipelines.converters.interfaces.ConverterInterface">ConverterInterface</span></code></p>


      <p>Converts a Pipeline Job into a json string.</p>
<h4 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobToJsonConverter--example">Example</h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rtdip_sdk.pipelines.secrets</span> <span class="kn">import</span> <span class="n">PipelineJobToJsonConverter</span>

<span class="n">convert_pipeline_job_to_json_string</span> <span class="o">=</span> <span class="n">PipelineJobFromJsonConverter</span><span class="p">(</span>
    <span class="n">pipeline_json</span> <span class="o">=</span> <span class="n">PipelineJob</span>
<span class="p">)</span>

<span class="n">convert_pipeline_job_to_json_string</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>pipeline_job</code></td>
            <td>
                  <code><span title="src.sdk.python.rtdip_sdk.pipelines.execute.models.PipelineJob">PipelineJob</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Pipeline Job consisting of tasks and steps</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/converters/pipeline_job_json.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PipelineJobToJsonConverter</span><span class="p">(</span><span class="n">ConverterInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Pipeline Job into a json string.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    ```python</span>
<span class="sd">    from rtdip_sdk.pipelines.secrets import PipelineJobToJsonConverter</span>

<span class="sd">    convert_pipeline_job_to_json_string = PipelineJobFromJsonConverter(</span>
<span class="sd">        pipeline_json = PipelineJob</span>
<span class="sd">    )</span>

<span class="sd">    convert_pipeline_job_to_json_string.convert()</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters:</span>
<span class="sd">        pipeline_job (PipelineJob): A Pipeline Job consisting of tasks and steps</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pipeline_job</span><span class="p">:</span> <span class="n">PipelineJob</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_job</span><span class="p">:</span> <span class="n">PipelineJob</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_job</span> <span class="o">=</span> <span class="n">pipeline_job</span>

    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a Pipeline Job to a json string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># required because pydantic does not use encoders in subclasses</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_job</span><span class="o">.</span><span class="n">task_list</span><span class="p">:</span>
            <span class="n">step_dict_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">step_list</span><span class="p">:</span>
                <span class="n">step_dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">models_as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="n">task</span><span class="o">.</span><span class="n">step_list</span> <span class="o">=</span> <span class="n">step_dict_list</span>

        <span class="n">pipeline_job_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_job</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pipeline_job_json</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.sdk.python.rtdip_sdk.pipelines.converters.pipeline_job_json.PipelineJobToJsonConverter.convert" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Converts a Pipeline Job to a json string</p>

            <details class="quote">
              <summary>Source code in <code>src/sdk/python/rtdip_sdk/pipelines/converters/pipeline_job_json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Pipeline Job to a json string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># required because pydantic does not use encoders in subclasses</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_job</span><span class="o">.</span><span class="n">task_list</span><span class="p">:</span>
        <span class="n">step_dict_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">step_list</span><span class="p">:</span>
            <span class="n">step_dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">models_as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="n">task</span><span class="o">.</span><span class="n">step_list</span> <span class="o">=</span> <span class="n">step_dict_list</span>

    <span class="n">pipeline_job_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_job</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pipeline_job_json</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "navigation.indexes", "navigation.instant", "navigation.tabs", "navigation.top", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "tags": {"Pipelines": "pipelines"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
  
      <script src="../../../../../assets/javascripts/bundle.dd8806f2.min.js"></script>
      
    

  </body>
</html>